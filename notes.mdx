# Checkout

## TODO (pre how to roll checkout discussion - phase 1)

- check all e2e tests (express checkout fails since we changed delivery mode processes)
- smooth checkout UI (loading states etc.)
- multiple calls for setting cost center (user cost centers emits multiple times)
- move clear delivery address/mode methods from checkout-connector to checkout-delivery connector
- separate delivery address/mode to 2 services
- why we LoadCart on failed clearDeliveryMode call
- clearCheckoutDeliveryMode actually incremented/decremented cart process
- type for whole checkout state (after b2b entry point)
- normalizer for checkout details
- JaloError retry for super query (add retry for it)

  ```json
  {
    "errors": [
      {
        "message": "item 8796098958229 no longer valid (was removed): object no longer valid",
        "type": "JaloObjectNoLongerValidError"
      }
    ]
  }
  ```

- switch all commands and queries from getActiveCartId -> takeActiveCartId
- unify combineLatest with userId and cartId for all c&q in checkout services
- expose query reset events as property in classes
- better organize code related to order type clearing (constructor in checkout.service.ts - reuse query reset events?)

## TODO (details nice to have in actual spartacus release of new checkout)

- clear fields in occ endpoint configs that are no longer needed
- check feature config service in constructors
- adapter normalize error for delivery mode query PR
- error handling for delivery mode query PR for query
- getSelectedDeliveryMode was not working in supported delivery modes PR (basically code from review-submit component)
- put TODO to remove actions from setDeliveryAddressCommand after supported delivery modes query merged
- express checkout needs supported delivery modes query state (new method in service needed) - do in supported delivery mode processes PR
- move default-b2b-occ-config to b2b checkout entry point
- try to reproduce payment hasError reponse
- ask Bill about desired express checkout behaviour (should we always assign defaults or should we preserve user's selected options)

# Next session

- get po number with super query
- get payment type with super query
- should move scheduled replenishment to it's own service/entry point
- separate entry point for b2b checkout in checkout lib

### Checkout lib structure

- root
- occ
- core
- components

- b2b // augment @spartacus/checkout/root { CheckoutState }
