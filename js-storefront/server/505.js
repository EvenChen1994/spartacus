"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=505,exports.ids=[505],exports.modules={47505:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PDFInvoicesModule:()=>PDFInvoicesModule});var core=__webpack_require__(40305),spartacus_pdf_invoices_components=__webpack_require__(53617),spartacus_core=__webpack_require__(46167),spartacus_pdf_invoices_root=__webpack_require__(76953),Subscription=__webpack_require__(31765),shareReplay=__webpack_require__(21753),map=__webpack_require__(86466),distinctUntilChanged=__webpack_require__(33029);const PDF_INVOICES_LIST_INVOICES_NORMALIZER=new core.OlP("PDFInvoicesListInvoices");class PDFInvoicesAdapter{}__name(PDFInvoicesAdapter,"PDFInvoicesAdapter");class PDFInvoicesConnector{constructor(adapter){this.adapter=adapter}getInvoicesForOrder(userId,orderId,queryParams){return this.adapter.getInvoicesForOrder(userId,orderId,queryParams)}getInvoicePDF(userId,orderId,invoiceId,externalSystemId){return this.adapter.getInvoicePDF(userId,orderId,invoiceId,externalSystemId)}}__name(PDFInvoicesConnector,"PDFInvoicesConnector"),PDFInvoicesConnector.\u0275fac=__name(function(t){return new(t||PDFInvoicesConnector)(core.LFG(PDFInvoicesAdapter))},"PDFInvoicesConnector_Factory"),PDFInvoicesConnector.\u0275prov=core.Yz7({token:PDFInvoicesConnector,factory:PDFInvoicesConnector.\u0275fac,providedIn:"root"});class PDFInvoicesBadRequestHandler extends spartacus_core.kck{constructor(){super(...arguments),this.responseStatus=spartacus_core.sdw.BAD_REQUEST}hasMatch(errorResponse){return super.hasMatch(errorResponse)&&this.getErrors(errorResponse)?.length>0}handleError(request,response){this.handleInvoicesListError(request,response),this.handlePDFDownloadError(request,response)}handleInvoicesListError(_request,response){this.getErrors(response).filter(e=>this.isInvoicesListNotFoundError(e)).forEach(()=>{this.globalMessageService.add({key:"pdfInvoices.invoicesLoadingError"},spartacus_core.xUg.MSG_TYPE_ERROR)})}handlePDFDownloadError(_request,response){this.getErrors(response).filter(e=>this.isDownloadInvoiceError(e)).forEach(()=>{this.globalMessageService.add({key:"pdfInvoices.downloadPDFError"},spartacus_core.xUg.MSG_TYPE_ERROR)})}isInvoicesListNotFoundError(error){return"UnknownIdentifierError"===error?.type&&null!=error?.message&&error?.message.includes("Order")}isDownloadInvoiceError(error){return"UnknownIdentifierError"===error?.type&&null!=error?.message&&error?.message.includes("Invoice")}getErrors(response){return response.error?.errors.filter(error=>this.isInvoicesListNotFoundError(error)||this.isDownloadInvoiceError(error))}getPriority(){return 0}}__name(PDFInvoicesBadRequestHandler,"PDFInvoicesBadRequestHandler"),PDFInvoicesBadRequestHandler.\u0275fac=function(){let \u0275PDFInvoicesBadRequestHandler_BaseFactory;return __name(function(t){return(\u0275PDFInvoicesBadRequestHandler_BaseFactory||(\u0275PDFInvoicesBadRequestHandler_BaseFactory=core.n5z(PDFInvoicesBadRequestHandler)))(t||PDFInvoicesBadRequestHandler)},"PDFInvoicesBadRequestHandler_Factory")}(),PDFInvoicesBadRequestHandler.\u0275prov=core.Yz7({token:PDFInvoicesBadRequestHandler,factory:PDFInvoicesBadRequestHandler.\u0275fac,providedIn:"root"});class PDFInvoicesService{constructor(routingService,userIdService,pdfInvoicesConnector){this.routingService=routingService,this.userIdService=userIdService,this.pdfInvoicesConnector=pdfInvoicesConnector,this.subscriptions=new Subscription.w,this.subscriptions.add(this.userIdService.takeUserId().subscribe(userId=>this.userId=userId)),this.subscriptions.add(this.getOrderId().subscribe(orderId=>this.orderId=orderId))}getInvoicesForOrder(queryParams,userId,orderId){return this.pdfInvoicesConnector.getInvoicesForOrder(userId||this.userId,orderId||this.orderId,queryParams).pipe((0,shareReplay.d)(1))}getInvoicePDF(invoiceId,externalSystemId,userId,orderId){return this.pdfInvoicesConnector.getInvoicePDF(userId||this.userId,orderId||this.orderId,invoiceId,externalSystemId).pipe((0,shareReplay.d)(1))}getOrderId(){return this.routingService.getRouterState().pipe((0,map.U)(routingData=>routingData.state.params),(0,distinctUntilChanged.x)(),(0,map.U)(params=>params.orderCode))}ngOnDestroy(){this.subscriptions.unsubscribe()}}__name(PDFInvoicesService,"PDFInvoicesService"),PDFInvoicesService.\u0275fac=__name(function(t){return new(t||PDFInvoicesService)(core.LFG(spartacus_core.Znh),core.LFG(spartacus_core.XBV),core.LFG(PDFInvoicesConnector))},"PDFInvoicesService_Factory"),PDFInvoicesService.\u0275prov=core.Yz7({token:PDFInvoicesService,factory:PDFInvoicesService.\u0275fac});class PDFInvoicesCoreModule{}__name(PDFInvoicesCoreModule,"PDFInvoicesCoreModule"),PDFInvoicesCoreModule.\u0275fac=__name(function(t){return new(t||PDFInvoicesCoreModule)},"PDFInvoicesCoreModule_Factory"),PDFInvoicesCoreModule.\u0275mod=core.oAB({type:PDFInvoicesCoreModule}),PDFInvoicesCoreModule.\u0275inj=core.cJS({providers:[PDFInvoicesService,{provide:spartacus_pdf_invoices_root.sc,useExisting:PDFInvoicesService},{provide:spartacus_core.kck,useExisting:PDFInvoicesBadRequestHandler,multi:!0},PDFInvoicesConnector]});var http=__webpack_require__(48664),throwError=__webpack_require__(84724),catchError=__webpack_require__(2155),common=__webpack_require__(89318);class OccPDFInvoicesAdapter{constructor(http2,occEndpoints,converter){this.http=http2,this.occEndpoints=occEndpoints,this.converter=converter,this.logger=(0,core.f3M)(spartacus_core.mQy)}getInvoicesForOrder(userId,orderId,queryParams){return this.http.get(this.buildInvoiceListUrl(userId,orderId,queryParams)).pipe((0,catchError.K)(error=>(0,throwError._)((0,spartacus_core.cxH)(error,this.logger))),this.converter.pipeable(PDF_INVOICES_LIST_INVOICES_NORMALIZER))}getInvoicePDF(userId,orderId,invoiceId,externalSystemId){return this.http.get(this.buildInvoicePDFUrl(userId,orderId,invoiceId,externalSystemId),{responseType:"blob"}).pipe((0,catchError.K)(error=>(0,throwError._)((0,spartacus_core.cxH)(error,this.logger))))}buildInvoiceListUrl(userId,orderId,queryParams){return this.occEndpoints.buildUrl("pdfInvoicesListInvoices",{urlParams:{userId,orderId},queryParams})}buildInvoicePDFUrl(userId,orderId,invoiceId,externalSystemId){return this.occEndpoints.buildUrl("pdfInvoicesDownloadInvoicePDF",{urlParams:{userId,orderId,invoiceId},queryParams:externalSystemId?{externalSystemId}:void 0})}}__name(OccPDFInvoicesAdapter,"OccPDFInvoicesAdapter"),OccPDFInvoicesAdapter.\u0275fac=__name(function(t){return new(t||OccPDFInvoicesAdapter)(core.LFG(http.eN),core.LFG(spartacus_core.Lz0),core.LFG(spartacus_core.IXI))},"OccPDFInvoicesAdapter_Factory"),OccPDFInvoicesAdapter.\u0275prov=core.Yz7({token:OccPDFInvoicesAdapter,factory:OccPDFInvoicesAdapter.\u0275fac});class PDFInvoicesOccModule{}__name(PDFInvoicesOccModule,"PDFInvoicesOccModule"),PDFInvoicesOccModule.\u0275fac=__name(function(t){return new(t||PDFInvoicesOccModule)},"PDFInvoicesOccModule_Factory"),PDFInvoicesOccModule.\u0275mod=core.oAB({type:PDFInvoicesOccModule}),PDFInvoicesOccModule.\u0275inj=core.cJS({providers:[(0,spartacus_core.i51)({backend:{occ:{endpoints:{pdfInvoicesListInvoices:"users/${userId}/orders/${orderId}/invoices",pdfInvoicesDownloadInvoicePDF:"users/${userId}/orders/${orderId}/invoices/${invoiceId}/download"}}}}),{provide:PDFInvoicesAdapter,useClass:OccPDFInvoicesAdapter}],imports:[common.ez]});class PDFInvoicesModule{}__name(PDFInvoicesModule,"PDFInvoicesModule"),PDFInvoicesModule.\u0275fac=__name(function(t){return new(t||PDFInvoicesModule)},"PDFInvoicesModule_Factory"),PDFInvoicesModule.\u0275mod=core.oAB({type:PDFInvoicesModule}),PDFInvoicesModule.\u0275inj=core.cJS({imports:[spartacus_pdf_invoices_components.h,PDFInvoicesCoreModule,PDFInvoicesOccModule]})}};