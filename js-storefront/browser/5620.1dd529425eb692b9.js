"use strict";(self.webpackChunkstorefrontapp=self.webpackChunkstorefrontapp||[]).push([[5620],{5620:(de,y,i)=>{i.r(y),i.d(y,{OrganizationUserRegistrationWrapperModule:()=>ue});var e=i(4650),l=i(4006),A=i(2700),n=i(5955),p=i(5391),g=i(6895),R=i(7039),c=i(6916),I=i(1086),q=i(591),B=i(2654),u=i(2994),E=i(2198),U=i(7545),_=i(2986),L=i(2274),C=i(3222);const Z=function(t){return{ariaLabel:t}};function Q(t,o){if(1&t&&(e.TgZ(0,"label")(1,"span",4),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA(),e._UZ(4,"ng-select",24),e.ALo(5,"cxTranslate"),e.ALo(6,"cxTranslate"),e._UZ(7,"cx-form-errors",8),e.qZA()),2&t){const r=e.oxw().ngIf,s=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,7,"userRegistrationForm.fields.country.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(5,9,"userRegistrationForm.fields.country.placeholder")),e.Q6J("searchable",!0)("clearable",!1)("items",r)("cxNgSelectA11y",e.VKq(13,Z,e.lcZ(6,11,"userRegistrationForm.fields.country.label"))),e.xp6(3),e.Q6J("control",s.registerForm.get("country.isocode"))}}function w(t,o){if(1&t&&(e.ynx(0,22),e.YNc(1,Q,8,15,"label",23),e.BQk()),2&t){const r=o.ngIf;e.xp6(1),e.Q6J("ngIf",0!==r.length)}}function Y(t,o){if(1&t&&(e.TgZ(0,"label")(1,"span",4),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA(),e._UZ(4,"ng-select",26),e.ALo(5,"cxTranslate"),e.ALo(6,"cxTranslate"),e._UZ(7,"cx-form-errors",8),e.qZA()),2&t){const r=e.oxw().ngIf,s=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,7,"userRegistrationForm.fields.state.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(5,9,"userRegistrationForm.fields.state.placeholder")),e.Q6J("searchable",!0)("clearable",!1)("items",r)("cxNgSelectA11y",e.VKq(13,Z,e.lcZ(6,11,"userRegistrationForm.fields.state.label"))),e.xp6(3),e.Q6J("control",s.registerForm.get("region.isocode"))}}function k(t,o){if(1&t&&(e.ynx(0,25),e.YNc(1,Y,8,15,"label",23),e.BQk()),2&t){const r=o.ngIf;e.xp6(1),e.Q6J("ngIf",0!==r.length)}}const $=function(){return{cxRoute:"login"}};function j(t,o){if(1&t){const r=e.EpF();e.TgZ(0,"section"),e._UZ(1,"div",2),e.ALo(2,"cxTranslate"),e.TgZ(3,"form",3),e.NdJ("ngSubmit",function(){e.CHM(r);const a=e.oxw();return e.KtG(a.submit())}),e.TgZ(4,"label")(5,"span",4),e._uU(6),e.ALo(7,"cxTranslate"),e.qZA(),e._UZ(8,"ng-select",5),e.ALo(9,"async"),e.ALo(10,"cxTranslate"),e.ALo(11,"cxTranslate"),e.qZA(),e.TgZ(12,"label")(13,"span",6),e._uU(14),e.ALo(15,"cxTranslate"),e.qZA(),e._UZ(16,"input",7),e.ALo(17,"cxTranslate"),e._UZ(18,"cx-form-errors",8),e.qZA(),e.TgZ(19,"label")(20,"span",6),e._uU(21),e.ALo(22,"cxTranslate"),e.qZA(),e._UZ(23,"input",9),e.ALo(24,"cxTranslate"),e._UZ(25,"cx-form-errors",8),e.qZA(),e.TgZ(26,"label")(27,"span",6),e._uU(28),e.ALo(29,"cxTranslate"),e.qZA(),e._UZ(30,"input",10),e.ALo(31,"cxTranslate"),e._UZ(32,"cx-form-errors",8),e.qZA(),e.TgZ(33,"label")(34,"span",6),e._uU(35),e.ALo(36,"cxTranslate"),e.qZA(),e._UZ(37,"input",11),e.ALo(38,"cxTranslate"),e._UZ(39,"cx-form-errors",8),e.qZA(),e.YNc(40,w,2,1,"ng-container",12),e.ALo(41,"async"),e.TgZ(42,"label")(43,"span",4),e._uU(44),e.ALo(45,"cxTranslate"),e.qZA(),e._UZ(46,"input",13),e.ALo(47,"cxTranslate"),e._UZ(48,"cx-form-errors",8),e.qZA(),e.TgZ(49,"label")(50,"span",4),e._uU(51),e.ALo(52,"cxTranslate"),e.qZA(),e._UZ(53,"input",14),e.ALo(54,"cxTranslate"),e._UZ(55,"cx-form-errors",8),e.qZA(),e.TgZ(56,"label")(57,"span",4),e._uU(58),e.ALo(59,"cxTranslate"),e.qZA(),e._UZ(60,"input",15),e.ALo(61,"cxTranslate"),e._UZ(62,"cx-form-errors",8),e.qZA(),e.TgZ(63,"label")(64,"span",4),e._uU(65),e.ALo(66,"cxTranslate"),e.qZA(),e._UZ(67,"input",16),e.ALo(68,"cxTranslate"),e._UZ(69,"cx-form-errors",8),e.qZA(),e.YNc(70,k,2,1,"ng-container",17),e.ALo(71,"async"),e.TgZ(72,"label")(73,"span",4),e._uU(74),e.ALo(75,"cxTranslate"),e.qZA(),e._UZ(76,"input",18),e.ALo(77,"cxTranslate"),e._UZ(78,"cx-form-errors",8),e.qZA(),e.TgZ(79,"label")(80,"span",4),e._uU(81),e.ALo(82,"cxTranslate"),e.qZA(),e._UZ(83,"textarea",19),e.ALo(84,"cxTranslate"),e._UZ(85,"cx-form-errors",8),e.qZA(),e.TgZ(86,"button",20),e._uU(87),e.ALo(88,"cxTranslate"),e.qZA(),e.TgZ(89,"a",21),e.ALo(90,"cxUrl"),e._uU(91),e.ALo(92,"cxTranslate"),e.qZA()()()}if(2&t){const r=e.oxw();e.xp6(1),e.uIk("aria-label",e.lcZ(2,43,"common.loaded")),e.xp6(2),e.Q6J("formGroup",r.registerForm),e.xp6(3),e.Oqu(e.lcZ(7,45,"userRegistrationForm.fields.titleCode.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(10,49,"userRegistrationForm.fields.titleCode.placeholder")),e.Q6J("searchable",!1)("clearable",!1)("items",e.lcZ(9,47,r.titles$))("cxNgSelectA11y",e.VKq(103,Z,e.lcZ(11,51,"userRegistrationForm.fields.titleCode.label"))),e.xp6(6),e.Oqu(e.lcZ(15,53,"userRegistrationForm.fields.firstName.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(17,55,"userRegistrationForm.fields.firstName.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("firstName")),e.xp6(3),e.Oqu(e.lcZ(22,57,"userRegistrationForm.fields.lastName.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(24,59,"userRegistrationForm.fields.lastName.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("lastName")),e.xp6(3),e.Oqu(e.lcZ(29,61,"userRegistrationForm.fields.companyName.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(31,63,"userRegistrationForm.fields.companyName.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("companyName")),e.xp6(3),e.Oqu(e.lcZ(36,65,"userRegistrationForm.fields.email.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(38,67,"userRegistrationForm.fields.email.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("email")),e.xp6(1),e.Q6J("ngIf",e.lcZ(41,69,r.countries$)),e.xp6(4),e.Oqu(e.lcZ(45,71,"userRegistrationForm.fields.addressLine.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(47,73,"userRegistrationForm.fields.addressLine.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("line1")),e.xp6(3),e.Oqu(e.lcZ(52,75,"userRegistrationForm.fields.secondAddressLine.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(54,77,"userRegistrationForm.fields.secondAddressLine.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("line2")),e.xp6(3),e.Oqu(e.lcZ(59,79,"userRegistrationForm.fields.city.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(61,81,"userRegistrationForm.fields.city.label")),e.xp6(2),e.Q6J("control",r.registerForm.get("town")),e.xp6(3),e.Oqu(e.lcZ(66,83,"userRegistrationForm.fields.postalCode.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(68,85,"userRegistrationForm.fields.postalCode.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("postalCode")),e.xp6(1),e.Q6J("ngIf",e.lcZ(71,87,r.regions$)),e.xp6(4),e.Oqu(e.lcZ(75,89,"userRegistrationForm.fields.phoneNumber.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(77,91,"userRegistrationForm.fields.phoneNumber.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("phoneNumber")),e.xp6(3),e.Oqu(e.lcZ(82,93,"userRegistrationForm.fields.message.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(84,95,"userRegistrationForm.fields.message.placeholder")),e.xp6(2),e.Q6J("control",r.registerForm.get("message")),e.xp6(2),e.hij(" ",e.lcZ(88,97,"userRegistrationForm.formSubmitButtonLabel")," "),e.xp6(2),e.Q6J("routerLink",e.lcZ(90,99,e.DdM(105,$))),e.xp6(2),e.Oqu(e.lcZ(92,101,"userRegistrationForm.goToLoginButtonLabel"))}}function H(t,o){1&t&&(e.TgZ(0,"div",27),e._UZ(1,"cx-spinner"),e.qZA())}let f=(()=>{class t{buildForm(){return this.formBuilder.group({titleCode:[null],firstName:["",l.kI.required],lastName:["",l.kI.required],companyName:["",l.kI.required],email:["",[l.kI.required,c.kal.emailValidator]],country:this.formBuilder.group({isocode:[null]}),line1:[""],line2:[""],town:[""],region:this.formBuilder.group({isocode:[null]}),postalCode:[""],phoneNumber:[""],message:[""]})}get form(){return this._form}get countryControl(){return this.form.get("country.isocode")}get regionControl(){return this.form.get("region.isocode")}constructor(r,s,a,d,h,v,x,F){this.userRegisterFacade=r,this.userAddressService=s,this.organizationUserRegistrationFacade=a,this.translationService=d,this.globalMessageService=h,this.authConfigService=v,this.routingService=x,this.formBuilder=F,this._form=this.buildForm()}getTitles(){return this.userRegisterFacade.getTitles()}getCountries(){return this.userAddressService.getDeliveryCountries().pipe((0,u.b)(r=>{0===Object.keys(r).length&&this.userAddressService.loadDeliveryCountries()}))}getRegions(){return this.countryControl?.valueChanges.pipe((0,E.h)(s=>!!s),(0,U.w)(s=>(this.regionControl?.reset(),this.userAddressService.getRegions(s))))??(0,I.of)([])}buildMessageContent(r){return this.translationService.translate("userRegistrationForm.messageToApproverTemplate",{phoneNumber:r.get("phoneNumber")?.value,addressLine:r.get("line1")?.value,secondAddressLine:r.get("line2")?.value,city:r.get("city")?.value,state:r.get("region")?.get("isocode")?.value,postalCode:r.get("postalCode")?.value,country:r.get("country")?.get("isocode")?.value,companyName:r.get("companyName")?.value,message:r.get("message")?.value})}displayGlobalMessage(){return this.globalMessageService.add({key:"userRegistrationForm.successFormSubmitMessage"},n.xUg.MSG_TYPE_CONFIRMATION)}redirectToLogin(){this.authConfigService.getOAuthFlow()===n.C8C.ResourceOwnerPasswordFlow&&this.routingService.go({cxRoute:"login"})}registerUser(r){return this.buildMessageContent(r).pipe((0,_.q)(1),(0,U.w)(s=>this.organizationUserRegistrationFacade.registerUser({titleCode:r.get("titleCode")?.value,firstName:r.get("firstName")?.value,lastName:r.get("lastName")?.value,email:r.get("email")?.value,message:s})),(0,u.b)(()=>{this.displayGlobalMessage(),this.redirectToLogin(),r.reset()}))}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(L.zm),e.LFG(n.kFJ),e.LFG(C._n),e.LFG(n.D7D),e.LFG(n.IWp),e.LFG(n.dSP),e.LFG(n.Znh),e.LFG(l.qu))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),P=(()=>{class t{constructor(r){this.userRegistrationFormService=r,this.titles$=this.userRegistrationFormService.getTitles(),this.countries$=this.userRegistrationFormService.getCountries(),this.regions$=this.userRegistrationFormService.getRegions(),this.registerForm=this.userRegistrationFormService.form,this.isLoading$=new q.X(!1),this.subscriptions=new B.w}submit(){this.registerForm.valid?(this.isLoading$.next(!0),this.subscriptions.add(this.userRegistrationFormService.registerUser(this.registerForm).subscribe({complete:()=>this.isLoading$.next(!1),error:()=>this.isLoading$.next(!1)}))):this.registerForm.markAllAsTouched()}ngOnDestroy(){this.subscriptions.unsubscribe()}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(f))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cx-user-registration-form"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],["role","status"],[3,"formGroup","ngSubmit"],[1,"label-content"],["id","title-code-select","formControlName","titleCode","bindLabel","name","bindValue","code",3,"searchable","clearable","items","placeholder","cxNgSelectA11y"],[1,"label-content","required"],["required","true","type","text","name","firstname","formControlName","firstName",1,"form-control",3,"placeholder"],[3,"control"],["required","true","type","text","name","lastname","formControlName","lastName",1,"form-control",3,"placeholder"],["required","true","type","text","name","companyName","formControlName","companyName",1,"form-control",3,"placeholder"],["required","true","type","email","name","email","formControlName","email",1,"form-control",3,"placeholder"],["formGroupName","country",4,"ngIf"],["type","text","formControlName","line1",1,"form-control",3,"placeholder"],["type","text","formControlName","line2",1,"form-control",3,"placeholder"],["type","text","formControlName","town",1,"form-control",3,"placeholder"],["type","text","formControlName","postalCode",1,"form-control",3,"placeholder"],["formGroupName","region",4,"ngIf"],["type","tel","formControlName","phoneNumber",1,"form-control",3,"placeholder"],["formControlName","message","rows","5",1,"form-control",3,"placeholder"],["type","submit",1,"btn","btn-block","btn-primary"],[1,"cx-login-link","btn-link",3,"routerLink"],["formGroupName","country"],[4,"ngIf"],["id","country-select","formControlName","isocode","bindLabel","name","bindValue","isocode",1,"country-select",3,"searchable","clearable","items","placeholder","cxNgSelectA11y"],["formGroupName","region"],["formControlName","isocode","bindLabel","name","bindValue","isocode","id","region-select",1,"region-select",3,"searchable","clearable","items","placeholder","cxNgSelectA11y"],[1,"cx-spinner"]],template:function(r,s){if(1&r&&(e.YNc(0,j,93,106,"section",0),e.ALo(1,"async"),e.YNc(2,H,2,0,"ng-template",null,1,e.W1O)),2&r){const a=e.MAs(3);e.Q6J("ngIf",!e.lcZ(1,2,s.isLoading$))("ngIfElse",a)}},dependencies:[g.O5,l._Y,l.Fj,l.JJ,l.JL,l.Q7,l.sg,l.u,l.x0,p.rH,c.ORR,c.Ahv,R.w9,c.VnX,g.Ov,n.l2T,n.X$D],encapsulation:2,changeDetection:0}),t})(),V=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[f],imports:[g.ez,l.UX,p.Bz,n.bhT,n.LUR,c.Fme,c.Fym,R.A0,c.LcC,n.pEA.withConfig({cmsComponents:{OrganizationUserRegistrationComponent:{component:P,guards:[n.aOY]}}})]}),t})(),W=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[p.Bz,V]}),t})();var b=i(1737),X=i(4850);let K=(()=>{class t extends f{constructor(r,s,a,d,h,v,x,F,D,G,z,J){super(h,v,x,F,D,G,z,J),this.command=r,this.cdcJSService=s,this.authService=a,this.eventService=d,this.userRegisterFacade=h,this.userAddressService=v,this.organizationUserRegistrationFacade=x,this.translationService=F,this.globalMessageService=D,this.authConfigService=G,this.routingService=z,this.formBuilder=J,this.registerCommand=this.command.create(({orgInfo:m})=>this.cdcJSService.registerOrganisationWithoutScreenSet(m)),this.loadUserTokenFailed$=this.eventService.get(A.yB).pipe((0,X.U)(m=>!!m),(0,u.b)(m=>{if(m)throw new Error("User token failed to load.")}))}registerUser(r){if(!(r.get("firstName")?.value&&r.get("lastName")?.value&&r.get("email")?.value&&r.get("companyName")?.value))return(0,b._)(`The provided user is not valid: ${r.value}`);const s={firstName:r.get("firstName")?.value,lastName:r.get("lastName")?.value,email:r.get("email")?.value,companyName:r.get("companyName")?.value,addressLine1:r.get("line1")?.value,addressLine2:r.get("line2")?.value,postalCode:r.get("postalCode")?.value,town:r.get("town")?.value,region:r.get("region")?.get("isocode")?.value,country:r.get("country")?.get("isocode")?.value,phoneNumber:r.get("phoneNumber")?.value,message:r.get("message")?.value};return this.cdcJSService.didLoad().pipe((0,u.b)(a=>{if(!a)throw this.globalMessageService.add({key:"errorHandlers.scriptFailedToLoad"},n.xUg.MSG_TYPE_ERROR),new Error("CDC script didn't load.")}),(0,U.w)(()=>this.registerCommand.execute({orgInfo:s})),(0,u.b)(()=>{this.displayGlobalMessage(),this.redirectToLogin(),r.reset()}))}postRegisterMessage(){}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(n.VDr),e.LFG(A.bF),e.LFG(n.e80),e.LFG(n.POd),e.LFG(L.zm),e.LFG(n.kFJ),e.LFG(C._n),e.LFG(n.D7D),e.LFG(n.IWp),e.LFG(n.dSP),e.LFG(n.Znh),e.LFG(l.qu))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})(),ee=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[{provide:f,useClass:K}],imports:[g.ez,l.UX,p.Bz,n.bhT,n.LUR,c.Fme,c.Fym,R.A0,c.LcC]}),t})();const te=new e.OlP("OrganizationUserRegistrationSerializer");class T{}let N=(()=>{class t{constructor(r){this.adapter=r}registerUser(r){return this.adapter.registerUser(r)}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(T))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})(),S=(()=>{class t{constructor(r,s){this.userRegistrationConnector=r,this.command=s,this.registerOrganizationUserCommand=this.command.create(a=>this.userRegistrationConnector.registerUser(a.userData))}registerUser(r){return this.registerOrganizationUserCommand.execute({userData:r})}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(N),e.LFG(n.VDr))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();const re=[S,{provide:C._n,useExisting:S}];let oe=(()=>{class t extends n.kck{constructor(){super(...arguments),this.responseStatus=n.sdw.CONFLICT}handleError(r,s){r&&this.getErrors(s)?.length&&this.globalMessageService.add({key:"userRegistrationForm.httpHandlers.conflict"},n.xUg.MSG_TYPE_ERROR)}getErrors(r){return r.error?.errors.filter(s=>"AlreadyExistsError"===s?.type)}getPriority(){return 0}}return t.\u0275fac=function(){let o;return function(s){return(o||(o=e.n5z(t)))(s||t)}}(),t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ne=(()=>{class t{static forRoot(){return{ngModule:t,providers:[...re,N,{provide:n.kck,useExisting:oe,multi:!0}]}}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({}),t})();var M=i(529),se=i(7221);let ie=(()=>{class t{constructor(r,s,a){this.http=r,this.occEndpoints=s,this.converter=a,this.logger=(0,e.f3M)(n.mQy)}registerUser(r){const s=this.getOrganizationUserRegistrationEndpoint();let a=new M.WM({"Content-Type":"application/json"});return a=n.Fox.createHeader(n._Re,!0,a),r=this.converter.convert(r,te),this.http.post(s,r,{headers:a}).pipe((0,se.K)(d=>(0,b._)((0,n.cxH)(d,this.logger))))}getOrganizationUserRegistrationEndpoint(){return this.occEndpoints.buildUrl("organizationUserRegistration")}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(M.eN),e.LFG(n.Lz0),e.LFG(n.IXI))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ae={backend:{occ:{endpoints:{organizationUserRegistration:"/orgUsers"}}}};let le=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[(0,n.i51)(ae),{provide:T,useExisting:ie}],imports:[g.ez]}),t})(),ce=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[ne.forRoot(),W,le]}),t})();var ge=i(988);const O=[];ge.N.cdc&&O.push(ee);let ue=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[ce,O]}),t})()}}]);