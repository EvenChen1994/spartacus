"use strict";(self.webpackChunkstorefrontapp=self.webpackChunkstorefrontapp||[]).push([[5167],{5167:(ze,R,m)=>{m.r(R),m.d(R,{CustomerTicketingModule:()=>Be});var e=m(4650),u=m(4006),s=m(5955),a=m(6916),b=m(2654),P=m(591),U=m(1086),E=m(6053),T=m(4850),_=m(2986),k=m(7221),Y=m(7224),v=m(2994),G=m(2198),l=m(9531),g=m(6895),D=m(5391);const M=["element"];function V(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"button",2,3),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.openDialog())}),e._uU(3),e.ALo(4,"cxTranslate"),e.qZA()()}2&i&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"customerTicketingDetails.closeRequest")," "))}function $(i,c){1&i&&e._UZ(0,"cx-spinner",17)}const A=function(i){return{count:i}};function K(i,c){if(1&i&&(e.TgZ(0,"option",24),e._uU(1),e.qZA()),2&i){const t=c.$implicit,n=e.oxw(2);e.Q6J("ngValue",t)("selected",t.id===(null==n.selectedCategory?null:n.selectedCategory.id)),e.xp6(1),e.hij(" ",t.name," ")}}function B(i,c){if(1&i&&(e.TgZ(0,"label")(1,"span",9),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA(),e.TgZ(4,"select",21)(5,"option",22),e._uU(6),e.ALo(7,"cxTranslate"),e.qZA(),e.YNc(8,K,2,3,"option",23),e.qZA(),e._UZ(9,"cx-form-errors",11),e.qZA()),2&i){const t=c.ngIf,n=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,4,"createCustomerTicket.category")," "),e.xp6(4),e.hij(" ",e.lcZ(7,6,"createCustomerTicket.selectCategory")," "),e.xp6(2),e.Q6J("ngForOf",t),e.xp6(1),e.Q6J("control",n.form.get("ticketCategory"))}}function z(i,c){if(1&i&&(e.TgZ(0,"option",24),e._uU(1),e.qZA()),2&i){const t=c.$implicit,n=e.oxw(3);e.Q6J("ngValue",t)("selected",t.code===(null==n.selectedAssociatedObject?null:n.selectedAssociatedObject.code)),e.xp6(1),e.AsE(" ",t.type," ",t.code," ")}}function H(i,c){if(1&i&&(e.TgZ(0,"label")(1,"span",9),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA(),e.TgZ(4,"select",25)(5,"option",22),e._uU(6),e.ALo(7,"cxTranslate"),e.qZA(),e.YNc(8,z,2,4,"option",23),e.qZA()()),2&i){const t=e.oxw().ngIf;e.xp6(2),e.hij(" ",e.lcZ(3,3,"createCustomerTicket.associateTo")," "),e.xp6(4),e.hij(" ",e.lcZ(7,5,"createCustomerTicket.optionallySelectAssociatedObject")," "),e.xp6(2),e.Q6J("ngForOf",t)}}function X(i,c){if(1&i&&(e.ynx(0),e.YNc(1,H,9,7,"label",13),e.BQk()),2&i){const t=c.ngIf;e.xp6(1),e.Q6J("ngIf",t.length>0)}}function W(i,c){if(1&i&&(e._UZ(0,"cx-icon",6),e.TgZ(1,"span",26),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA()),2&i){const t=e.oxw();e.Q6J("type",t.iconTypes.UPLOAD),e.xp6(2),e.Oqu(e.lcZ(3,2,"customerTicketing.uploadFile"))}}function ee(i,c){if(1&i&&(e._UZ(0,"cx-icon",6),e.TgZ(1,"span",20),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA()),2&i){const t=e.oxw();e.Q6J("type",t.iconTypes.UPLOAD),e.xp6(2),e.Oqu(e.lcZ(3,2,"customerTicketing.uploadFile"))}}function te(i,c){1&i&&e._UZ(0,"cx-spinner",21)}const y=function(i){return{ticketCode:i}},Z=function(i){return{cxRoute:"supportTicketDetails",params:i}};function ie(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"tr",14),e.NdJ("click",function(){const r=e.CHM(t).$implicit,p=e.oxw(3);return e.KtG(p.goToTicketDetail(r.id))}),e.TgZ(1,"td",15)(2,"div",16),e._uU(3),e.ALo(4,"cxTranslate"),e.qZA(),e.TgZ(5,"a",17),e.ALo(6,"cxUrl"),e._uU(7),e.qZA()(),e.TgZ(8,"td",18)(9,"div",16),e._uU(10),e.ALo(11,"cxTranslate"),e.qZA(),e.TgZ(12,"a",17),e.ALo(13,"cxUrl"),e._uU(14),e.qZA()(),e.TgZ(15,"td",18)(16,"div",16),e._uU(17),e.ALo(18,"cxTranslate"),e.qZA(),e.TgZ(19,"a",17),e.ALo(20,"cxUrl"),e._uU(21),e.qZA()(),e.TgZ(22,"td",18)(23,"div",16),e._uU(24),e.ALo(25,"cxTranslate"),e.qZA(),e.TgZ(26,"a",17),e.ALo(27,"cxUrl"),e._uU(28),e.ALo(29,"cxDate"),e.qZA()(),e.TgZ(30,"td",18)(31,"div",16),e._uU(32),e.ALo(33,"cxTranslate"),e.qZA(),e.TgZ(34,"a",17),e.ALo(35,"cxUrl"),e._uU(36),e.ALo(37,"cxDate"),e.qZA()(),e.TgZ(38,"td",18)(39,"div",16),e._uU(40),e.ALo(41,"cxTranslate"),e.qZA(),e.TgZ(42,"a",19),e.ALo(43,"cxUrl"),e._uU(44),e.qZA()()()}if(2&i){const t=c.$implicit,n=e.oxw(3);e.xp6(3),e.hij(" ",e.lcZ(4,19,"customerTicketingList.mobile.ticketIdFull")," "),e.xp6(2),e.Q6J("routerLink",e.lcZ(6,21,e.VKq(49,Z,e.VKq(47,y,t.id)))),e.xp6(2),e.hij(" ",t.id," "),e.xp6(3),e.hij(" ",e.lcZ(11,23,"customerTicketingList.subject")," "),e.xp6(2),e.Q6J("routerLink",e.lcZ(13,25,e.VKq(53,Z,e.VKq(51,y,t.id)))),e.xp6(2),e.hij(" ",t.subject," "),e.xp6(3),e.hij(" ",e.lcZ(18,27,"customerTicketingList.ticketCategory")," "),e.xp6(2),e.Q6J("routerLink",e.lcZ(20,29,e.VKq(57,Z,e.VKq(55,y,t.id)))),e.xp6(2),e.hij(" ",null==t.ticketCategory?null:t.ticketCategory.name," "),e.xp6(3),e.hij(" ",e.lcZ(25,31,"customerTicketing.createdOn")," "),e.xp6(2),e.Q6J("routerLink",e.lcZ(27,33,e.VKq(61,Z,e.VKq(59,y,t.id)))),e.xp6(2),e.hij(" ",e.lcZ(29,35,t.createdAt)," "),e.xp6(4),e.hij(" ",e.lcZ(33,37,"customerTicketing.changedOn")," "),e.xp6(2),e.Q6J("routerLink",e.lcZ(35,39,e.VKq(65,Z,e.VKq(63,y,t.id)))),e.xp6(2),e.hij(" ",e.lcZ(37,41,t.modifiedAt)," "),e.xp6(4),e.hij(" ",e.lcZ(41,43,"customerTicketing.status")," "),e.xp6(2),e.Q6J("routerLink",e.lcZ(43,45,e.VKq(69,Z,e.VKq(67,y,t.id))))("ngClass",n.getStatusClass(t.status.id)),e.xp6(2),e.hij(" ",null==t.status?null:t.status.name," ")}}function ne(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",20)(1,"cx-pagination",21),e.NdJ("viewPageEvent",function(o){e.CHM(t);const r=e.oxw(3);return e.KtG(r.pageChange(o))}),e.qZA()()}if(2&i){const t=e.oxw(2).ngIf;e.xp6(1),e.Q6J("pagination",t.pagination)}}function oe(i,c){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",5)(2,"label",6)(3,"span"),e._uU(4),e.ALo(5,"cxTranslate"),e.qZA(),e.TgZ(6,"cx-sorting",7),e.NdJ("sortListEvent",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.changeSortCode(o))}),e.ALo(7,"async"),e.ALo(8,"cxTranslate"),e.ALo(9,"cxTranslate"),e.qZA()(),e._UZ(10,"cx-customer-ticketing-create"),e.qZA(),e.TgZ(11,"table",8)(12,"thead",9)(13,"tr")(14,"th",10),e._uU(15),e.ALo(16,"cxTranslate"),e.qZA(),e.TgZ(17,"th",10),e._uU(18),e.ALo(19,"cxTranslate"),e.qZA(),e.TgZ(20,"th",10),e._uU(21),e.ALo(22,"cxTranslate"),e.qZA(),e.TgZ(23,"th",10),e._uU(24),e.ALo(25,"cxTranslate"),e.qZA(),e.TgZ(26,"th",10),e._uU(27),e.ALo(28,"cxTranslate"),e.qZA(),e.TgZ(29,"th",10),e._uU(30),e.ALo(31,"cxTranslate"),e.qZA()()(),e.TgZ(32,"tbody"),e.YNc(33,ie,45,71,"tr",11),e.qZA()(),e.TgZ(34,"div",12),e.YNc(35,ne,2,1,"div",13),e.qZA(),e.BQk()}if(2&i){const t=e.oxw().ngIf,n=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,14,"customerTicketingList.sortSubtitle")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(8,18,"customerTicketingList.sortSubtitle")),e.Q6J("sortOptions",t.sorts)("sortLabels",e.lcZ(7,16,n.getSortLabels()))("selectedOption",null==t.pagination?null:t.pagination.sort)("ariaLabel",e.lcZ(9,20,"customerTicketingList.sortOrders")),e.xp6(9),e.Oqu(e.lcZ(16,22,"customerTicketing.ticketId")),e.xp6(3),e.hij(" ",e.lcZ(19,24,"customerTicketingList.subject")," "),e.xp6(3),e.hij(" ",e.lcZ(22,26,"customerTicketingList.ticketCategory")," "),e.xp6(3),e.Oqu(e.lcZ(25,28,"customerTicketing.createdOn")),e.xp6(3),e.Oqu(e.lcZ(28,30,"customerTicketing.changedOn")),e.xp6(3),e.Oqu(e.lcZ(31,32,"customerTicketing.status")),e.xp6(3),e.Q6J("ngForOf",t.tickets),e.xp6(2),e.Q6J("ngIf",(null==t.pagination?null:t.pagination.totalPages)>1)}}function ce(i,c){1&i&&(e._UZ(0,"cx-customer-ticketing-create"),e.ynx(1),e.TgZ(2,"div",22)(3,"h3"),e._uU(4),e.ALo(5,"cxTranslate"),e.qZA()(),e.BQk()),2&i&&(e.xp6(4),e.Oqu(e.lcZ(5,1,"customerTicketingList.noTickets")))}function se(i,c){if(1&i&&(e.ynx(0),e.TgZ(1,"span",2)(2,"h2",3),e._uU(3),e.ALo(4,"cxTranslate"),e.qZA()(),e.YNc(5,oe,36,34,"ng-container",0),e.YNc(6,ce,6,3,"ng-template",null,4,e.W1O),e.BQk()),2&i){const t=c.ngIf,n=e.MAs(7);e.xp6(3),e.AsE(" ",e.lcZ(4,4,"customerTicketingList.requestTitle")," (",(null==t.pagination?null:t.pagination.totalResults)||0,") "),e.xp6(2),e.Q6J("ngIf",t.tickets.length>0)("ngIfElse",n)}}function re(i,c){1&i&&e._UZ(0,"cx-spinner")}function ae(i,c){if(1&i&&(e.ynx(0),e.TgZ(1,"div",2)(2,"div",3)(3,"div",4),e._UZ(4,"cx-card",5),e.ALo(5,"async"),e.qZA(),e.TgZ(6,"div",4),e._UZ(7,"cx-card",5),e.ALo(8,"async"),e.ALo(9,"cxDate"),e.qZA(),e.TgZ(10,"div",4),e._UZ(11,"cx-card",5),e.ALo(12,"async"),e.ALo(13,"cxDate"),e.qZA(),e.TgZ(14,"div",4),e._UZ(15,"cx-card",5),e.ALo(16,"async"),e.qZA()()(),e.BQk()),2&i){const t=c.ngIf,n=e.oxw();let o,r;e.xp6(4),e.Q6J("content",e.lcZ(5,4,n.prepareCardContent(t.id,"customerTicketing.ticketId"))),e.xp6(3),e.Q6J("content",e.lcZ(8,6,n.prepareCardContent(null!==(o=e.xi3(9,8,t.createdAt,n.dateFormat))&&void 0!==o?o:n.dateFormat,"customerTicketing.createdOn"))),e.xp6(4),e.Q6J("content",e.lcZ(12,11,n.prepareCardContent(null!==(r=e.xi3(13,13,t.modifiedAt,n.dateFormat))&&void 0!==r?r:n.dateFormat,"customerTicketing.changedOn"))),e.xp6(4),e.Q6J("content",e.lcZ(16,16,n.prepareCardContent(t.status?t.status.name:void 0,"customerTicketing.status",t.status?t.status.id:void 0)))}}function ue(i,c){1&i&&e._UZ(0,"cx-spinner")}function le(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"button",2,3),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.openDialog())}),e._uU(3),e.ALo(4,"cxTranslate"),e.qZA()()}2&i&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"customerTicketingDetails.reopenRequest")," "))}const I=function(i){return{value:i}};function ge(i,c){if(1&i&&(e.ynx(0),e.TgZ(1,"div",9)(2,"span",10),e.ALo(3,"cxTranslate"),e._uU(4),e.qZA(),e.TgZ(5,"span",11),e._uU(6),e.qZA(),e.TgZ(7,"span",11),e.ALo(8,"cxTranslate"),e._uU(9),e.ALo(10,"cxTranslate"),e.qZA()(),e.TgZ(11,"div",11),e._uU(12),e.ALo(13,"cxTranslate"),e.ALo(14,"cxDate"),e.qZA(),e.BQk()),2&i){const t=c.$implicit;e.xp6(2),e.uIk("aria-label",e.lcZ(3,6,"myAccountV2CustomerTicketing.subjectLabel")),e.xp6(2),e.hij(" ",t.subject," "),e.xp6(2),e.hij(" | ",null==t.ticketCategory?null:t.ticketCategory.name," "),e.xp6(1),e.uIk("aria-label",e.lcZ(8,8,"myAccountV2CustomerTicketing.idLabel")),e.xp6(2),e.hij(" | ",e.xi3(10,10,"myAccountV2CustomerTicketing.ticketId",e.VKq(19,I,t.id))," "),e.xp6(3),e.hij(" ",e.xi3(13,13,"myAccountV2CustomerTicketing.changedOn",e.VKq(21,I,e.xi3(14,16,t.modifiedAt,"d, MMMM, yyyy")))," ")}}function me(i,c){if(1&i&&(e.ynx(0),e.TgZ(1,"div",7),e.YNc(2,ge,15,23,"ng-container",8),e.qZA(),e.BQk()),2&i){const t=e.oxw().ngIf;e.xp6(2),e.Q6J("ngForOf",t.tickets)}}function pe(i,c){if(1&i&&(e.ynx(0),e.YNc(1,me,3,1,"ng-container",4),e.BQk()),2&i){const t=c.ngIf;e.oxw();const n=e.MAs(15);e.xp6(1),e.Q6J("ngIf",t.tickets.length>0)("ngIfElse",n)}}function de(i,c){1&i&&(e.TgZ(0,"div",12),e.ALo(1,"cxTranslate"),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA()),2&i&&(e.uIk("aria-label",e.lcZ(1,2,"customerTicketingList.noTickets")),e.xp6(2),e.hij(" ",e.lcZ(3,4,"customerTicketingList.noTickets")," "))}function Te(i,c){1&i&&e._UZ(0,"cx-spinner")}const ke=function(){return{cxRoute:"supportTickets"}};let he=(()=>{class i{constructor(t,n,o){this.customerTicketingFacade=t,this.launchDialogService=n,this.vcr=o,this.subscription=new b.w,this.enableCloseButton$=this.customerTicketingFacade.getTicket().pipe((0,T.U)(r=>("OPEN"===r?.status?.id||"INPROCESS"===r?.status?.id)&&r.availableStatusTransitions?.some(p=>"CLOSED"===p.id.toUpperCase())))}openDialog(){const t=this.launchDialogService.openDialog("CUSTOMER_TICKETING_CLOSE",this.element,this.vcr);t&&this.subscription.add(t.pipe((0,_.q)(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.kr),e.Y36(a.Q3W),e.Y36(e.s_b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-close"]],viewQuery:function(t,n){if(1&t&&e.Gf(M,5),2&t){let o;e.iGM(o=e.CRH())&&(n.element=o.first)}},decls:2,vars:3,consts:[["class","col-xs-12 col-md-5 col-lg-4",4,"ngIf"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"],["element",""]],template:function(t,n){1&t&&(e.YNc(0,V,5,3,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.enableCloseButton$))},dependencies:[g.O5,g.Ov,s.X$D],encapsulation:2}),i})(),O=(()=>{class i{get messagesCharacterLeft(){return this.inputCharactersLimit-(this.form.get("message")?.value?.length||0)}get subjectCharacterLeft(){return this.inputCharactersForSubject-(this.form.get("subject")?.value?.length||0)}get allowedTypes(){return this.customerTicketingConfig.customerTicketing?.attachmentRestrictions?.allowedTypes}get getInputCharactersLimit(){return this.customerTicketingConfig.customerTicketing?.inputCharactersLimit??l.P7}get getInputCharactersForSubject(){return this.customerTicketingConfig.customerTicketing?.inputCharactersLimitForSubject??l.PW}get maxSize(){return this.customerTicketingConfig.customerTicketing?.attachmentRestrictions?.maxSize??l.hx}handleClick(t){t.target.tagName===this.el.nativeElement.tagName&&this.close("Click outside of the window")}constructor(t,n,o,r,p,C){this.launchDialogService=t,this.el=n,this.customerTicketingConfig=o,this.filesFormValidators=r,this.customerTicketingFacade=p,this.routingService=C,this.iconTypes=a.e1G,this.inputCharactersLimit=this.getInputCharactersLimit,this.inputCharactersForSubject=this.getInputCharactersForSubject,this.isDataLoading$=new P.X(!1),this.focusConfig={trap:!0,block:!0,autofocus:"button",focusOnEscape:!0}}buildForm(){const t=new u.cw({});t.setControl("message",new u.NI("",[u.kI.required,u.kI.maxLength(this.inputCharactersLimit)])),t.setControl("file",new u.NI("",[this.filesFormValidators.maxSize(this.maxSize),this.filesFormValidators.maxEntries(l.Bl),this.filesFormValidators.allowedTypes(this.allowedTypes)])),this.form=t}close(t){this.launchDialogService.closeDialog(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.Q3W),e.Y36(e.SBq),e.Y36(l.Yw),e.Y36(a.Lt1),e.Y36(l.kr),e.Y36(s.Znh))},i.\u0275dir=e.lG2({type:i,hostBindings:function(t,n){1&t&&e.NdJ("click",function(r){return n.handleClick(r)})}}),i})(),Ce=(()=>{class i extends O{ngOnInit(){this.buildForm()}closeRequest(){this.form.invalid?(this.form.markAllAsTouched(),a.hfq.deepUpdateValueAndValidity(this.form)):(this.isDataLoading$.next(!0),this.subscription=this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent()).subscribe({complete:()=>{this.onComplete()},error:()=>{this.onError()}}))}prepareTicketEvent(){return{message:this.form?.get("message")?.value,toStatus:{id:"CLOSED",name:"Closed"}}}onComplete(){this.isDataLoading$.next(!1),this.close("Ticket closed successfully"),this.routingService.go({cxRoute:"supportTickets"})}onError(){this.close("Something went wrong while closing the ticket"),this.isDataLoading$.next(!1)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return i.\u0275fac=function(){let c;return function(n){return(c||(c=e.n5z(i)))(n||i)}}(),i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-close-dialog"]],features:[e.qOj],decls:30,vars:29,consts:[[1,"cx-customer-ticket-form-dialog",3,"cxFocus","esc"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],[1,"cx-customer-ticket-form-title","modal-title"],[1,"cx-customer-ticket-form-close","close",3,"click"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[1,"cx-customer-ticket-form-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"],["class","overlay",4,"ngIf"],[1,"overlay"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.NdJ("esc",function(){return n.close("Escape clicked")}),e.TgZ(1,"form",1)(2,"div",2)(3,"div",3),e._uU(4),e.ALo(5,"cxTranslate"),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return n.close("Close Request Dialog")}),e.ALo(7,"cxTranslate"),e.TgZ(8,"span",5),e._UZ(9,"cx-icon",6),e.qZA()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"label")(13,"span",9),e._uU(14),e.ALo(15,"cxTranslate"),e.qZA(),e._UZ(16,"textarea",10)(17,"cx-form-errors",11),e.TgZ(18,"p",12),e._uU(19),e.ALo(20,"cxTranslate"),e.qZA()()(),e.TgZ(21,"div",13)(22,"button",14),e.NdJ("click",function(){return n.close("Close Request Dialog")}),e._uU(23),e.ALo(24,"cxTranslate"),e.qZA(),e.TgZ(25,"button",15),e.NdJ("click",function(){return n.closeRequest()}),e._uU(26),e.ALo(27,"cxTranslate"),e.qZA()()(),e.YNc(28,$,1,0,"cx-spinner",16),e.ALo(29,"async"),e.qZA()()),2&t&&(e.Q6J("cxFocus",n.focusConfig),e.xp6(1),e.Q6J("formGroup",n.form),e.xp6(3),e.hij(" ",e.lcZ(5,12,"customerTicketingDetails.closeRequest")," "),e.xp6(2),e.uIk("aria-label",e.lcZ(7,14,"common.close")),e.xp6(3),e.Q6J("type",n.iconTypes.CLOSE),e.xp6(5),e.hij(" ",e.lcZ(15,16,"customerTicketing.message")," "),e.xp6(2),e.Q6J("maxLength",n.inputCharactersLimit),e.xp6(1),e.Q6J("control",n.form.get("message")),e.xp6(2),e.hij(" ",e.xi3(20,18,"customerTicketing.charactersLeft",e.VKq(27,A,n.messagesCharacterLeft))," "),e.xp6(4),e.hij(" ",e.lcZ(24,21,"customerTicketing.cancel")," "),e.xp6(3),e.hij(" ",e.lcZ(27,23,"customerTicketing.submit")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(29,25,n.isDataLoading$)))},dependencies:[g.O5,a.oJW,a.RRe,u._Y,u.Fj,u.JJ,u.JL,u.sg,u.u,a.Ahv,a.ORR,g.Ov,s.X$D],encapsulation:2}),i})(),fe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[(0,s.i51)({cmsComponents:{SupportTicketCloseComponent:{component:he,guards:[s.a1M]}}})],imports:[g.ez,s.LUR,a.QX1,a.oPH,u.UX,a.Fym,a.Obx,a.Fme]}),i})(),xe=(()=>{class i extends O{constructor(){super(...arguments),this.ticketCategories$=this.customerTicketingFacade.getTicketCategories(),this.ticketAssociatedObjects$=this.customerTicketingFacade.getTicketAssociatedObjects().pipe((0,k.K)(t=>(this.handleError(t),(0,U.of)([])))),this.globalMessage=(0,e.f3M)(s.IWp),this.translationService=(0,e.f3M)(s.D7D)}getCreateTicketPayload(t){return{message:t?.get("message")?.value,subject:t?.get("subject")?.value,associatedTo:t?.get("associatedTo")?.value||void 0,ticketCategory:t?.get("ticketCategory")?.value}}ngOnInit(){this.buildForm()}buildForm(){const t=new u.cw({});t.setControl("subject",new u.NI("",[u.kI.required,u.kI.maxLength(this.inputCharactersForSubject)])),t.setControl("ticketCategory",new u.NI("",[u.kI.required])),t.setControl("associatedTo",new u.NI("")),t.setControl("message",new u.NI("",[u.kI.required,u.kI.maxLength(this.inputCharactersLimit)])),t.setControl("file",new u.NI("",[this.filesFormValidators.maxSize(this.maxSize),this.filesFormValidators.maxEntries(l.Bl),this.filesFormValidators.allowedTypes(this.allowedTypes)])),this.form=t}createTicketRequest(){this.attachment=this.form.get("file")?.value?.[0],this.form.invalid?(this.form.markAllAsTouched(),a.hfq.deepUpdateValueAndValidity(this.form)):this.subscription=this.customerTicketingFacade.createTicket(this.getCreateTicketPayload(this.form)).subscribe({next:t=>{t.id&&this.attachment&&t.ticketEvents?.[0].code&&this.customerTicketingFacade.uploadAttachment(this.attachment,t.ticketEvents?.[0].code,t.id)},complete:()=>{this.onComplete()},error:t=>{this.handleError(t)}})}handleError(t){t instanceof s.YPQ?(t.details??[]).forEach(n=>{n.message&&this.globalMessage.add({raw:n.message},s.xUg.MSG_TYPE_ERROR)}):this.translationService.translate("httpHandlers.unknownError").pipe((0,Y.P)()).subscribe(n=>{this.globalMessage.add({raw:n},s.xUg.MSG_TYPE_ERROR)}),this.onError()}onComplete(){this.close("Ticket created successfully")}onError(){this.close("Something went wrong")}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return i.\u0275fac=function(){let c;return function(n){return(c||(c=e.n5z(i)))(n||i)}}(),i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-create-dialog"]],inputs:{selectedCategory:"selectedCategory",selectedAssociatedObject:"selectedAssociatedObject"},features:[e.qOj],decls:51,vars:55,consts:[[1,"cx-customer-ticket-form-dialog",3,"cxFocus","esc"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],[1,"cx-customer-ticket-form-title","modal-title"],["type","button",1,"cx-customer-ticket-form-close","close",3,"click"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","subject","rows","1",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[4,"ngIf"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"formControl","accept"],[1,"cx-customer-ticket-file-upload-hint"],["prefix","formErrors.file",3,"control"],[1,"cx-customer-ticket-form-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["formControlName","ticketCategory",1,"form-control"],["value","","disabled","","selected",""],[3,"ngValue","selected",4,"ngFor","ngForOf"],[3,"ngValue","selected"],["formControlName","associatedTo",1,"form-control"],[1,"cx-message-footer-text"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.NdJ("esc",function(){return n.close("Escape clicked")}),e.TgZ(1,"form",1)(2,"div",2)(3,"div",3),e._uU(4),e.ALo(5,"cxTranslate"),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return n.close("Close Create Request Dialog")}),e.ALo(7,"cxTranslate"),e.TgZ(8,"span",5),e._UZ(9,"cx-icon",6),e.qZA()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"label")(13,"span",9),e._uU(14),e.ALo(15,"cxTranslate"),e.qZA(),e._UZ(16,"textarea",10)(17,"cx-form-errors",11),e.TgZ(18,"p",12),e._uU(19),e.ALo(20,"cxTranslate"),e.qZA()(),e.YNc(21,B,10,8,"label",13),e.ALo(22,"async"),e.YNc(23,X,2,1,"ng-container",13),e.ALo(24,"async"),e.TgZ(25,"label")(26,"span",9),e._uU(27),e.ALo(28,"cxTranslate"),e.qZA(),e._UZ(29,"textarea",14)(30,"cx-form-errors",11),e.TgZ(31,"p",12),e._uU(32),e.ALo(33,"cxTranslate"),e.qZA()(),e.TgZ(34,"div")(35,"cx-file-upload",15),e.YNc(36,W,4,4,"ng-template"),e.qZA(),e.TgZ(37,"p",16),e._uU(38),e.ALo(39,"cxTranslate"),e.qZA(),e.TgZ(40,"p",16),e._uU(41),e.ALo(42,"cxTranslate"),e.qZA(),e._UZ(43,"cx-form-errors",17),e.qZA()(),e.TgZ(44,"div",18)(45,"button",19),e.NdJ("click",function(){return n.close("Close Create Request Dialog")}),e._uU(46),e.ALo(47,"cxTranslate"),e.qZA(),e.TgZ(48,"button",20),e.NdJ("click",function(){return n.createTicketRequest()}),e._uU(49),e.ALo(50,"cxTranslate"),e.qZA()()()()()),2&t&&(e.Q6J("cxFocus",n.focusConfig),e.xp6(1),e.Q6J("formGroup",n.form),e.xp6(3),e.hij(" ",e.lcZ(5,22,"createCustomerTicket.addNewRequest")," "),e.xp6(2),e.uIk("aria-label",e.lcZ(7,24,"common.close")),e.xp6(3),e.Q6J("type",n.iconTypes.CLOSE),e.xp6(5),e.hij(" ",e.lcZ(15,26,"createCustomerTicket.subject")," "),e.xp6(2),e.Q6J("maxLength",n.inputCharactersForSubject),e.xp6(1),e.Q6J("control",n.form.get("subject")),e.xp6(2),e.hij(" ",e.xi3(20,28,"customerTicketing.charactersLeft",e.VKq(49,A,n.subjectCharacterLeft))," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(22,31,n.ticketCategories$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(24,33,n.ticketAssociatedObjects$)),e.xp6(4),e.hij(" ",e.lcZ(28,35,"customerTicketing.message")," "),e.xp6(2),e.Q6J("maxLength",n.inputCharactersLimit),e.xp6(1),e.Q6J("control",n.form.get("message")),e.xp6(2),e.hij(" ",e.xi3(33,37,"customerTicketing.charactersLeft",e.VKq(51,A,n.messagesCharacterLeft))," "),e.xp6(3),e.Q6J("formControl",n.form.get("file"))("accept",n.allowedTypes),e.xp6(3),e.hij(" ",e.xi3(39,40,"customerTicketing.fileSizeLimit",e.VKq(53,A,n.maxSize))," "),e.xp6(3),e.hij(" ",e.lcZ(42,43,"customerTicketing.maximumAttachment")," "),e.xp6(2),e.Q6J("control",n.form.get("file")),e.xp6(3),e.hij(" ",e.lcZ(47,45,"customerTicketing.cancel")," "),e.xp6(3),e.hij(" ",e.lcZ(50,47,"customerTicketing.submit")," "))},dependencies:[g.sg,g.O5,a.oJW,a.RRe,u._Y,u.YN,u.Kr,u.Fj,u.EJ,u.JJ,u.JL,u.oH,u.sg,u.u,a.Ahv,a.Yre,g.Ov,s.X$D],encapsulation:2}),i})(),_e=(()=>{class i{constructor(t,n){this.launchDialogService=t,this.vcr=n,this.subscription=new b.w}openCreateNewTicketDialog(){const t=this.launchDialogService.openDialog("CUSTOMER_TICKETING_CREATE",this.element,this.vcr);t&&this.subscription.add(t.pipe((0,_.q)(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.Q3W),e.Y36(e.s_b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-create"]],viewQuery:function(t,n){if(1&t&&e.Gf(M,5),2&t){let o;e.iGM(o=e.CRH())&&(n.element=o.first)}},decls:4,vars:3,consts:[[1,"btn","btn-primary","cx-customer-ticketing-create",3,"click"],["element",""]],template:function(t,n){1&t&&(e.TgZ(0,"button",0,1),e.NdJ("click",function(){return n.openCreateNewTicketDialog()}),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA()),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"createCustomerTicket.addRequest"),"\n"))},dependencies:[s.X$D],encapsulation:2}),i})(),F=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[g.ez,s.LUR,a.QX1,a.oPH,u.UX,a.Fym,a.Obx]}),i})();const ve={launch:{CUSTOMER_TICKETING_REOPEN:{inline:!0,component:(()=>{class i extends O{ngOnInit(){this.buildForm()}reopenRequest(){if(this.form.invalid)this.form.markAllAsTouched(),a.hfq.deepUpdateValueAndValidity(this.form);else{const t=this.form.get("file")?.value?.length>0;this.isDataLoading$.next(!0),this.subscription=this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent(),t).subscribe({next:n=>{this.form.get("file")?.value?.length&&n.code&&this.customerTicketingFacade.uploadAttachment(this.form.get("file")?.value?.item(0),n.code)},complete:()=>{this.onComplete()},error:()=>{this.onError()}})}}onComplete(){this.isDataLoading$.next(!1),this.close("Ticket reopened successfully")}onError(){this.isDataLoading$.next(!1),this.close("Something went wrong while reopening ticket")}prepareTicketEvent(){return{message:this.form?.get("message")?.value,toStatus:{id:"INPROCESS",name:"INPROCESS"}}}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return i.\u0275fac=function(){let c;return function(n){return(c||(c=e.n5z(i)))(n||i)}}(),i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-reopen-dialog"]],features:[e.qOj],decls:40,vars:41,consts:[[1,"cx-customer-ticket-form-dialog",3,"cxFocus","esc"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],[1,"cx-customer-ticket-form-title","modal-title"],["type","button",1,"cx-customer-ticket-form-close","close",3,"click"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[3,"formControl","accept"],[1,"cx-customer-ticket-file-upload-hint"],["prefix","formErrors.file",3,"control"],[1,"cx-customer-ticket-form-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["class","overlay",4,"ngIf"],[1,"cx-message-footer-text"],[1,"overlay"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.NdJ("esc",function(){return n.close("Escape clicked")}),e.TgZ(1,"form",1)(2,"div",2)(3,"div",3),e._uU(4),e.ALo(5,"cxTranslate"),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return n.close("Close Reopen Request Dialog")}),e.ALo(7,"cxTranslate"),e.TgZ(8,"span",5),e._UZ(9,"cx-icon",6),e.qZA()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"label")(13,"span",9),e._uU(14),e.ALo(15,"cxTranslate"),e.qZA(),e._UZ(16,"textarea",10)(17,"cx-form-errors",11),e.TgZ(18,"p",12),e._uU(19),e.ALo(20,"cxTranslate"),e.qZA()()(),e.TgZ(21,"div")(22,"cx-file-upload",13),e.YNc(23,ee,4,4,"ng-template"),e.qZA(),e.TgZ(24,"p",14),e._uU(25),e.ALo(26,"cxTranslate"),e.qZA(),e.TgZ(27,"p",14),e._uU(28),e.ALo(29,"cxTranslate"),e.qZA(),e._UZ(30,"cx-form-errors",15),e.qZA(),e.TgZ(31,"div",16)(32,"button",17),e.NdJ("click",function(){return n.close("Close Reopen Request Dialog")}),e._uU(33),e.ALo(34,"cxTranslate"),e.qZA(),e.TgZ(35,"button",18),e.NdJ("click",function(){return n.reopenRequest()}),e._uU(36),e.ALo(37,"cxTranslate"),e.qZA()()(),e.YNc(38,te,1,0,"cx-spinner",19),e.ALo(39,"async"),e.qZA()()),2&t&&(e.Q6J("cxFocus",n.focusConfig),e.xp6(1),e.Q6J("formGroup",n.form),e.xp6(3),e.hij(" ",e.lcZ(5,17,"customerTicketingDetails.reopenRequest")," "),e.xp6(2),e.uIk("aria-label",e.lcZ(7,19,"common.close")),e.xp6(3),e.Q6J("type",n.iconTypes.CLOSE),e.xp6(5),e.hij(" ",e.lcZ(15,21,"customerTicketing.message")," "),e.xp6(2),e.Q6J("maxLength",n.inputCharactersLimit),e.xp6(1),e.Q6J("control",n.form.get("message")),e.xp6(2),e.hij(" ",e.xi3(20,23,"customerTicketing.charactersLeft",e.VKq(37,A,n.messagesCharacterLeft))," "),e.xp6(3),e.Q6J("formControl",n.form.get("file"))("accept",n.allowedTypes),e.xp6(3),e.hij(" ",e.xi3(26,26,"customerTicketing.fileSizeLimit",e.VKq(39,A,n.maxSize))," "),e.xp6(3),e.hij(" ",e.lcZ(29,29,"customerTicketing.maximumAttachment")," "),e.xp6(2),e.Q6J("control",n.form.get("file")),e.xp6(3),e.hij(" ",e.lcZ(34,31,"customerTicketing.cancel")," "),e.xp6(3),e.hij(" ",e.lcZ(37,33,"customerTicketing.submit")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(39,35,n.isDataLoading$)))},dependencies:[g.O5,a.oJW,a.RRe,u._Y,u.Fj,u.JJ,u.JL,u.oH,u.sg,u.u,a.Ahv,a.Yre,a.ORR,g.Ov,s.X$D],encapsulation:2}),i})(),dialogType:a.Myk.DIALOG},CUSTOMER_TICKETING_CLOSE:{inline:!0,component:Ce,dialogType:a.Myk.DIALOG},CUSTOMER_TICKETING_CREATE:{inline:!0,component:xe,dialogType:a.Myk.DIALOG}}};let Ae=(()=>{class i{constructor(t,n,o,r){this.customerTicketingFacade=t,this.routingService=n,this.translationService=o,this.customerTicketingConfig=r,this.PAGE_SIZE=this.customerTicketingConfig.customerTicketing?.listViewPageSize||5,this.iconTypes=a.e1G,this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE).pipe((0,v.b)(p=>this.sortType=p?.pagination?.sort||"")),this.getStatusClass=p=>{switch(p){case"OPEN":case"INPROCESS":return"cx-text-green";case"CLOSED":return"cx-text-grey";default:return""}}}goToTicketDetail(t){this.routingService.go({cxRoute:"supportTicketDetails",params:{ticketCode:t}})}getSortLabels(){return(0,E.aj)([this.translationService.translate("customerTicketing.ticketId"),this.translationService.translate("customerTicketing.changedOn")]).pipe((0,T.U)(([t,n])=>({byTicketId:t,byDate:n})))}changeSortCode(t){this.sortType=t,this.pageChange(0)}pageChange(t){const n=this.createTicketListEvent(this.sortType,t);this.fetchTicketList(n)}createTicketListEvent(t,n){return{currentPage:n,sortCode:t}}fetchTicketList(t){this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE,t.currentPage,t.sortCode)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.kr),e.Y36(s.Znh),e.Y36(s.D7D),e.Y36(l.Yw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-list"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["spinner",""],[1,"cx-ticketing-list-title"],[1,"cx-ticketing-list-title-text"],["noCustomerTickets",""],[1,"cx-ticketing-list-sort","top"],[1,"cx-ticketing-list-form-group","form-group"],["ariaControls","ticketing-list-table",3,"sortOptions","sortLabels","selectedOption","placeholder","ariaLabel","sortListEvent"],["id","ticketing-list-table","aria-hidden","true",1,"table","cx-ticketing-list-table"],[1,"cx-ticketing-list-thead-mobile"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[1,"cx-ticketing-list-sort","bottom"],["class","cx-ticketing-list-pagination",4,"ngIf"],[3,"click"],[1,"cx-ticketing-list-data","cx-ticketing-list-id"],[1,"cx-ticketing-list-label"],[1,"cx-ticketing-list-value",3,"routerLink"],[1,"cx-ticketing-list-data"],[1,"cx-ticketing-list-value",3,"routerLink","ngClass"],[1,"cx-ticketing-list-pagination"],[3,"pagination","viewPageEvent"],[1,"text-center"]],template:function(t,n){if(1&t&&(e.YNc(0,se,8,6,"ng-container",0),e.ALo(1,"async"),e.YNc(2,re,1,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(3);e.Q6J("ngIf",e.lcZ(1,2,n.tickets$))("ngIfElse",o)}},dependencies:[_e,g.mk,g.sg,g.O5,a.iNG,a.QtL,D.rH,a.ORR,g.Ov,s.X$D,s.dgE,s.l2T],encapsulation:2}),i})(),ye=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[(0,s.i51)({cmsComponents:{SupportTicketHistoryComponent:{component:Ae,guards:[s.a1M]}}})],imports:[F,g.ez,s.LUR,s.bhT,a.dTQ,a.QX1,a.xuE,D.Bz,a.Fme]}),i})(),Ze=(()=>{class i{constructor(t,n,o,r){this.translation=t,this.customerTicketingFacade=n,this.routingService=o,this.eventService=r,this.dateFormat=l.zT,this.subscription=new b.w,this.ticketDetails$=this.customerTicketingFacade.getTicket(),this.reloadOnRedirection()}prepareCardContent(t,n,o){return this.translation.translate(n).pipe((0,G.h)(()=>Boolean(t)),(0,T.U)(r=>({title:r,text:[t||""],customClass:this.getStatusClass(o?.toUpperCase())})))}getStatusClass(t){return"OPEN"===t||"INPROCESS"===t?"cx-text-green":"CLOSED"===t?"cx-text-grey":""}reloadOnRedirection(){this.subscription=(0,E.aj)([this.ticketDetails$,this.routingService.getParams().pipe((0,T.U)(t=>t.ticketCode))]).pipe((0,_.q)(1),(0,v.b)(([t,n])=>{t&&n!==t?.id&&this.eventService.dispatch({},l.KP)})).subscribe()}ngOnDestroy(){this.subscription?.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(s.D7D),e.Y36(l.kr),e.Y36(s.Znh),e.Y36(s.POd))},i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-details"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["spinner",""],[1,"cx-ticket-details"],[1,"container"],[1,"cx-details-card"],[3,"content"]],template:function(t,n){if(1&t&&(e.YNc(0,ae,17,18,"ng-container",0),e.ALo(1,"async"),e.YNc(2,ue,1,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(3);e.Q6J("ngIf",e.lcZ(1,2,n.ticketDetails$))("ngIfElse",o)}},dependencies:[g.O5,a.AkF,a.ORR,g.Ov,s.dgE],encapsulation:2,changeDetection:0}),i})(),be=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[(0,s.i51)({cmsComponents:{SupportTicketDetailsComponent:{component:Ze,guards:[s.a1M]}}})],imports:[g.ez,s.LUR,s.bhT,a.dTQ,a.Fme]}),i})(),Le=(()=>{class i{constructor(t,n,o){this.customerTicketingFacade=t,this.launchDialogService=n,this.vcr=o,this.subscription=new b.w,this.enableReopenButton$=this.customerTicketingFacade.getTicket().pipe((0,T.U)(r=>"CLOSED"===r?.status?.id&&r.availableStatusTransitions?.some(p=>"INPROCESS"===p.id.toUpperCase()||"OPEN"===p.id.toUpperCase())))}openDialog(){const t=this.launchDialogService.openDialog("CUSTOMER_TICKETING_REOPEN",this.element,this.vcr);t&&this.subscription.add(t.pipe((0,_.q)(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.kr),e.Y36(a.Q3W),e.Y36(e.s_b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-reopen"]],viewQuery:function(t,n){if(1&t&&e.Gf(M,5),2&t){let o;e.iGM(o=e.CRH())&&(n.element=o.first)}},decls:2,vars:3,consts:[["class","col-xs-12 col-md-5 col-lg-4",4,"ngIf"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"],["element",""]],template:function(t,n){1&t&&(e.YNc(0,le,5,3,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.enableReopenButton$))},dependencies:[g.O5,g.Ov,s.X$D],encapsulation:2}),i})(),Ee=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[(0,s.i51)({cmsComponents:{SupportTicketReopenComponent:{component:Le,guards:[s.a1M]}}})],imports:[g.ez,s.LUR,a.QX1,a.oPH,u.UX,a.Fym,a.Obx,a.Fme]}),i})(),De=(()=>{class i{constructor(t,n,o){this.customerTicketingConfig=t,this.customerTicketingFacade=n,this.eventService=o,this.ticketDetails$=this.customerTicketingFacade.getTicket(),this.subscription=new b.w,this.messageEvents$=this.prepareMessageEvents(),this.messagingConfigs=this.prepareMessagingConfigs()}onSend(t){const n=(t.files instanceof FileList&&t.files?.length>0)??!1;this.subscription.add(this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent(t.message),n).subscribe(o=>{t.files&&t.files?.length&&o.code&&this.customerTicketingFacade.uploadAttachment(t.files.item(0),o.code),this.messagingComponent?.resetForm()}))}downloadAttachment(t){this.subscription.add(this.customerTicketingFacade.downloadAttachment(t.messageCode,t.attachmentId).subscribe(n=>{const o=window.URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=t.fileName??"",r.click()}))}prepareMessageEvents(){return this.ticketDetails$.pipe((0,T.U)(t=>t?.ticketEvents?.map(n=>({...n,text:n.message??"",rightAlign:n.addedByAgent||!1,attachments:n.ticketEventAttachments??[]}))??[]))}prepareMessagingConfigs(){return{attachmentRestrictions:this.customerTicketingConfig.customerTicketing?.attachmentRestrictions,charactersLimit:this.customerTicketingConfig.customerTicketing?.inputCharactersLimit,enableFileUploadOption:!0,displayAddMessageSection:this.ticketDetails$.pipe((0,T.U)(t=>"CLOSED"!==t?.status?.id))}}prepareTicketEvent(t){return{message:t}}ngOnDestroy(){this.subscription?.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.Yw),e.Y36(l.kr),e.Y36(s.POd))},i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-customer-ticketing-messages"]],viewQuery:function(t,n){if(1&t&&e.Gf(a.bHT,5),2&t){let o;e.iGM(o=e.CRH())&&(n.messagingComponent=o.first)}},decls:1,vars:2,consts:[[3,"messageEvents$","messagingConfigs","send","downloadAttachment"]],template:function(t,n){1&t&&(e.TgZ(0,"cx-messaging",0),e.NdJ("send",function(r){return n.onSend(r)})("downloadAttachment",function(r){return n.downloadAttachment(r)}),e.qZA()),2&t&&e.Q6J("messageEvents$",n.messageEvents$)("messagingConfigs",n.messagingConfigs)},dependencies:[a.bHT],encapsulation:2}),i})(),Me=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[(0,s.i51)({cmsComponents:{SupportTicketUpdateComponent:{component:De,guards:[s.a1M]}}})],imports:[g.ez,s.LUR,s.bhT,a.A9I,u.UX,u.u5]}),i})(),Oe=(()=>{class i{constructor(){this.PAGE_SIZE=1,this.customerTicketingFacade=(0,e.f3M)(l.kr),this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["cx-my-account-v2-customer-ticketing"]],decls:18,vars:20,consts:[[1,"cx-my-account-customer-ticket-header"],[1,"cx-my-account-customer-ticket-heading"],[1,"cx-my-account-customer-ticket-show-more"],["id","show-more-requests",1,"btn-link","cx-action-link",3,"routerLink"],[4,"ngIf","ngIfElse"],["noCustomerTickets",""],["spinner",""],[1,"cx-my-account-customer-ticket-body"],[4,"ngFor","ngForOf"],[1,"cx-my-account-customer-ticket-details"],[1,"cx-my-account-customer-ticket-subject"],[1,"cx-my-account-customer-ticket-details-light"],[1,"cx-my-account-no-ticket"]],template:function(t,n){if(1&t&&(e.ynx(0),e.TgZ(1,"div",0)(2,"div",1),e.ALo(3,"cxTranslate"),e._uU(4),e.ALo(5,"cxTranslate"),e.qZA(),e.TgZ(6,"div",2)(7,"a",3),e.ALo(8,"cxTranslate"),e.ALo(9,"cxUrl"),e._uU(10),e.ALo(11,"cxTranslate"),e.qZA()()(),e.YNc(12,pe,2,2,"ng-container",4),e.ALo(13,"async"),e.BQk(),e.YNc(14,de,4,6,"ng-template",null,5,e.W1O),e.YNc(16,Te,1,0,"ng-template",null,6,e.W1O)),2&t){const o=e.MAs(17);e.xp6(2),e.uIk("aria-label",e.lcZ(3,7,"myAccountV2CustomerTicketing.heading")),e.xp6(2),e.hij(" ",e.lcZ(5,9,"myAccountV2CustomerTicketing.heading")," "),e.xp6(3),e.Q6J("routerLink",e.lcZ(9,13,e.DdM(19,ke))),e.uIk("aria-label",e.lcZ(8,11,"myAccountV2CustomerTicketing.showMore")),e.xp6(3),e.hij(" ",e.lcZ(11,15,"myAccountV2CustomerTicketing.showMore")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,17,n.tickets$))("ngIfElse",o)}},dependencies:[g.sg,g.O5,a.ORR,D.rH,g.Ov,s.X$D,s.dgE,s.l2T],encapsulation:2}),i})(),Se=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[(0,s.i51)({cmsComponents:{MyAccountViewRequestsComponent:{component:Oe,guards:[s.a1M]}}})],imports:[g.ez,s.LUR,s.bhT,a.Fme,D.Bz]}),i})(),Re=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[(0,s.i51)(ve)],imports:[u.UX,a.Fym,be,fe,Ee,ye,Me,F,Se]}),i})();var h=m(1737),x=m(7545),Ue=m(5778),Ie=m(1406),Fe=m(6789);class w{}let q=(()=>{class i{constructor(t){this.adapter=t}getTicket(t,n){return this.adapter.getTicket(t,n)}getTickets(t,n,o,r){return this.adapter.getTickets(t,n,o,r)}getTicketCategories(){return this.adapter.getTicketCategories()}getTicketAssociatedObjects(t){return this.adapter.getTicketAssociatedObjects(t)}createTicket(t,n){return this.adapter.createTicket(t,n)}createTicketEvent(t,n,o){return this.adapter.createTicketEvent(t,n,o)}uploadAttachment(t,n,o,r){return this.adapter.uploadAttachment(t,n,o,r)}downloadAttachment(t,n,o,r){return this.adapter.downloadAttachment(t,n,o,r)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(w))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();const we=new e.OlP("CustomerTicketingDetailsNormalizer"),qe=new e.OlP("CustomerTicketingEventNormalizer"),j=new e.OlP("CustomerTicketingFileNormalizer"),je=new e.OlP("CustomerTicketingListNormalizer"),Ne=new e.OlP("CustomerTicketingCategoryNormalizer"),Qe=new e.OlP("CustomerTicketingAssociatedObjectsNormalizer"),Je=new e.OlP("CustomerTicketingCreateNormalizer");let N=(()=>{class i{getTicketCategoriesQueryReloadEvents(){return[l.Te]}getTicketCategoriesQueryResetEvents(){return[l.a]}getTicketAssociatedObjectsQueryReloadEvents(){return[l.SY]}getTicketAssociatedObjectsQueryResetEvents(){return[l.XE]}getTicketQueryReloadEvents(){return[l.KP]}getTicketQueryResetEvents(){return[l.iS]}getTicketsQueryReloadEvents(){return[l.zS]}getTicketsQueryResetEvents(){return[l.QB]}getTicketsQuery$(t,n,o){return this.queryService.create(()=>this.customerTicketingListPreConditions().pipe((0,x.w)(r=>this.customerTicketingConnector.getTickets(r,t,n,o))),{reloadOn:this.getTicketsQueryReloadEvents(),resetOn:this.getTicketsQueryResetEvents()})}customerTicketingPreConditions(){return(0,E.aj)([this.userIdService.getUserId(),this.routingService.getParams().pipe((0,T.U)(t=>t.ticketCode),(0,Ue.x)())]).pipe((0,_.q)(1),(0,T.U)(([t,n])=>{if(!t)throw new Error("Customer ticketing pre conditions not met");return[t,n]}))}customerTicketingListPreConditions(){return this.userIdService.getUserId().pipe((0,_.q)(1),(0,T.U)(t=>{if(!t)throw new Error("Customer ticketing list pre conditions not met");return t}))}constructor(t,n,o,r,p,C){this.queryService=t,this.commandService=n,this.userIdService=o,this.customerTicketingConnector=r,this.routingService=p,this.eventService=C,this.createTicketCommand=this.commandService.create(d=>this.customerTicketingPreConditions().pipe((0,x.w)(([f])=>this.customerTicketingConnector.createTicket(f,d)),(0,v.b)(()=>{this.eventService.dispatch({},l.h5)})),{strategy:s.flE.Queue}),this.createTicketEventCommand=this.commandService.create(d=>this.customerTicketingPreConditions().pipe((0,x.w)(([f,L])=>this.customerTicketingConnector.createTicketEvent(f,L,d.ticketEvent).pipe((0,v.b)(()=>{"CLOSED"===d.ticketEvent.toStatus?.id?this.eventService.dispatch({},l.xi):d.containsAttachment||this.eventService.dispatch({},"OPEN"===d.ticketEvent.toStatus?.id||"INPROCESS"===d.ticketEvent.toStatus?.id?l.EW:l.vl)})))),{strategy:s.flE.Queue}),this.uploadAttachmentCommand=this.commandService.create(d=>this.customerTicketingPreConditions().pipe((0,x.w)(([f,L])=>this.customerTicketingConnector.uploadAttachment(f,d.ticketId??L,d.eventCode,d.file).pipe((0,v.b)(()=>this.eventService.dispatch({},l.bZ))))),{strategy:s.flE.Queue}),this.downloadAttachmentCommand=this.commandService.create(d=>this.customerTicketingPreConditions().pipe((0,x.w)(([f,L])=>this.customerTicketingConnector.downloadAttachment(f,L,d.eventCode,d.attachmentId))),{strategy:s.flE.Queue}),this.getTicketQuery$=this.queryService.create(()=>this.customerTicketingPreConditions().pipe((0,x.w)(([d,f])=>this.customerTicketingConnector.getTicket(d,f))),{reloadOn:this.getTicketQueryReloadEvents(),resetOn:this.getTicketQueryResetEvents()}),this.getTicketCategoriesQuery=this.queryService.create(()=>this.customerTicketingConnector.getTicketCategories(),{reloadOn:this.getTicketCategoriesQueryReloadEvents(),resetOn:this.getTicketCategoriesQueryResetEvents()}),this.getTicketAssociatedObjectsQuery=this.queryService.create(()=>this.customerTicketingPreConditions().pipe((0,x.w)(([d])=>this.customerTicketingConnector.getTicketAssociatedObjects(d))),{reloadOn:this.getTicketAssociatedObjectsQueryReloadEvents(),resetOn:this.getTicketAssociatedObjectsQueryResetEvents()})}getTicketAssociatedObjectsState(){return this.getTicketAssociatedObjectsQuery.getState()}getTicketAssociatedObjects(){return this.getTicketAssociatedObjectsState().pipe((0,Ie.b)(t=>t?.error?(0,h._)(t.error):(0,U.of)(t)),(0,T.U)(t=>t.data??[]))}getTicketCategoriesState(){return this.getTicketCategoriesQuery.getState()}getTicketCategories(){return this.getTicketCategoriesState().pipe((0,T.U)(t=>t.data??[]))}getTicketState(){return this.getTicketQuery$.getState()}getTicket(){return this.getTicketState().pipe((0,T.U)(t=>t.data))}createTicket(t){return this.createTicketCommand.execute(t)}getTicketsState(t,n,o){return this.getTicketsQuery$(t,n,o).getState()}getTickets(t,n,o){return this.getTicketsState(t,n,o).pipe((0,T.U)(r=>r.data))}createTicketEvent(t,n=!1){return this.createTicketEventCommand.execute({ticketEvent:t,containsAttachment:n})}uploadAttachment(t,n,o){return this.uploadAttachmentCommand.execute({file:t,eventCode:n,ticketId:o})}downloadAttachment(t,n){return this.downloadAttachmentCommand.execute({eventCode:t,attachmentId:n})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(s._7J),e.LFG(s.VDr),e.LFG(s.XBV),e.LFG(q),e.LFG(s.Znh),e.LFG(s.POd))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();const Pe=[N,{provide:l.kr,useExisting:N}];function Q(i){return"notFound"===i.reason&&"NotFoundError"===i.type}let Ye=(()=>{class i extends s.kck{constructor(t,n,o){super(t,o),this.globalMessageService=t,this.routingService=n,this.platformId=o,this.responseStatus=s.sdw.NOT_FOUND}getPriority(){return 0}hasMatch(t){return super.hasMatch(t)&&this.isCustomerTicketingDetailsRoute()&&this.getErrors(t).some(Q)}handleError(t,n){this.handleTicketNotFoundError(t,n)}isCustomerTicketingDetailsRoute(){return"supportTicketDetails"===(0,s.P51)(this.routingService.getRouterState())?.state?.semanticRoute}handleTicketNotFoundError(t,n){this.getErrors(n).filter(o=>Q(o)).forEach(()=>{this.routingService.go({cxRoute:"supportTickets"}),this.globalMessageService.add({key:"customerTicketingDetails.ticketNotFound"},s.xUg.MSG_TYPE_ERROR)})}getErrors(t){return t.error?.errors||[]}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(s.IWp),e.LFG(s.Znh),e.LFG(e.Lbi))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),J=(()=>{class i extends s.FRf{constructor(t,n,o,r,p,C){super(),this.translationService=t,this.activeCartFacade=n,this.basePageMetaResolver=o,this.customerTicketingFacade=r,this.translation=p,this.semanticPath=C,this.CUSTOMER_SERVICE_TRANSLATION_KEY="customerTicketing.customerService",this.CUSTOMER_SERVICE_SEMANTIC_ROUTE="supportTickets",this.customerServiceBreadCrumb$=this.translation.translate(this.CUSTOMER_SERVICE_TRANSLATION_KEY).pipe((0,T.U)(d=>[{label:d,link:this.semanticPath.get(this.CUSTOMER_SERVICE_SEMANTIC_ROUTE)}])),this.pageType=s.GV4.CONTENT_PAGE,this.pageUid="support-ticket-details"}resolveTitle(){return this.basePageMetaResolver.resolveTitle()}resolveHeading(){return this.customerTicketingFacade.getTicket().pipe((0,T.U)(t=>t?.subject||""))}resolveDescription(){return this.basePageMetaResolver.resolveDescription()}resolveRobots(){return this.basePageMetaResolver.resolveRobots()}resolveBreadcrumbs(){return(0,E.aj)([this.customerServiceBreadCrumb$,this.basePageMetaResolver.resolveBreadcrumbs()]).pipe((0,T.U)(([t,n=[]])=>{const[o,...r]=n;return[o,...t,...r]}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(s.D7D),e.LFG(Fe.bu),e.LFG(s.MkU),e.LFG(l.kr),e.LFG(s.D7D),e.LFG(s.hCH))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Ge=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[...Pe,q,J,{provide:s.kck,useExisting:Ye,multi:!0},{provide:s.FRf,useExisting:J,multi:!0}]}),i})();var S=m(529);let Ve=(()=>{class i{constructor(t,n,o){this.http=t,this.occEndpoints=n,this.converter=o,this.logger=(0,e.f3M)(s.mQy)}getTicketAssociatedObjects(t){return this.http.get(this.getTicketAssociatedObjectsEndpoint(t)).pipe((0,k.K)(n=>(0,h._)((0,s.cxH)(n,this.logger))),(0,T.U)(n=>n.ticketAssociatedObjects??[]),this.converter.pipeableMany(Qe))}getTicketAssociatedObjectsEndpoint(t){return this.occEndpoints.buildUrl("getTicketAssociatedObjects",{urlParams:{customerId:t}})}getTicketCategories(){return this.http.get(this.getTicketCategoriesEndpoint()).pipe((0,k.K)(t=>(0,h._)((0,s.cxH)(t,this.logger))),(0,T.U)(t=>t.ticketCategories??[]),this.converter.pipeableMany(Ne))}getTicketCategoriesEndpoint(){return this.occEndpoints.buildUrl("getTicketCategories")}getTicket(t,n){return this.http.get(this.getTicketEndpoint(t,n)).pipe((0,k.K)(o=>(0,h._)((0,s.cxH)(o,this.logger))),(0,v.b)(o=>o.ticketEvents?.reverse()),this.converter.pipeable(we))}getTicketEndpoint(t,n){return this.occEndpoints.buildUrl("getTicket",{urlParams:{customerId:t,ticketId:n}})}createTicket(t,n){return this.http.post(this.getCreateTicketEndpoint(t),n,{headers:(new S.WM).set("Content-Type","application/json")}).pipe((0,k.K)(o=>(0,h._)((0,s.cxH)(o,this.logger))),this.converter.pipeable(Je))}getCreateTicketEndpoint(t){return this.occEndpoints.buildUrl("createTicket",{urlParams:{customerId:t}})}getTickets(t,n,o,r){return this.http.get(this.getTicketsEndpoint(t,n,o,r)).pipe((0,k.K)(p=>(0,h._)((0,s.cxH)(p,this.logger))),this.converter.pipeable(je))}getTicketsEndpoint(t,n,o,r){return this.occEndpoints.buildUrl("getTickets",{urlParams:{customerId:t},queryParams:{pageSize:n,currentPage:o,sort:r}})}createTicketEvent(t,n,o){return this.http.post(this.getCreateTicketEventEndpoint(t,n),o,{headers:(new S.WM).set("Content-Type","application/json")}).pipe((0,k.K)(r=>(0,h._)((0,s.cxH)(r,this.logger))),this.converter.pipeable(qe))}getCreateTicketEventEndpoint(t,n){return this.occEndpoints.buildUrl("createTicketEvent",{urlParams:{customerId:t,ticketId:n}})}uploadAttachment(t,n,o,r){const p=new FormData;return p.append("ticketEventAttachment",r),this.http.post(this.getUploadAttachmentEndpoint(t,n,o),p).pipe((0,k.K)(C=>(0,h._)((0,s.cxH)(C,this.logger))),this.converter.pipeable(j))}getUploadAttachmentEndpoint(t,n,o){return this.occEndpoints.buildUrl("uploadAttachment",{urlParams:{customerId:t,ticketId:n,eventCode:o}})}downloadAttachment(t,n,o,r){return this.http.get(this.getDownloadAttachmentEndpoint(t,n,o,r),{responseType:"blob"}).pipe((0,k.K)(C=>(0,h._)((0,s.cxH)(C,this.logger))),this.converter.pipeable(j))}getDownloadAttachmentEndpoint(t,n,o,r){return this.occEndpoints.buildUrl("downloadAttachment",{urlParams:{customerId:t,ticketId:n,eventCode:o,attachmentId:r}})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(S.eN),e.LFG(s.Lz0),e.LFG(s.IXI))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();const $e={backend:{occ:{endpoints:{getTicket:"users/${customerId}/tickets/${ticketId}",getTickets:"users/${customerId}/tickets",createTicketEvent:"users/${customerId}/tickets/${ticketId}/events",getTicketCategories:"/ticketCategories",getTicketAssociatedObjects:"users/${customerId}/ticketAssociatedObjects",createTicket:"users/${customerId}/tickets",uploadAttachment:"/users/${customerId}/tickets/${ticketId}/events/${eventCode}/attachments",downloadAttachment:"/users/${customerId}/tickets/${ticketId}/events/${eventCode}/attachments/${attachmentId}"}}}};let Ke=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[(0,s.i51)($e),{provide:w,useClass:Ve}],imports:[g.ez]}),i})(),Be=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Re,Ge,Ke]}),i})()}}]);