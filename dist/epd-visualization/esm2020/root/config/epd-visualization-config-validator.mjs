/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { getUrl, isHttpOrHttps } from '../util/url-utils';
export function epdVisualizationConfigValidator(epdVisualizationConfig) {
    const epdVisualization = epdVisualizationConfig.epdVisualization;
    if (!epdVisualization) {
        return unconfiguredPropertyMessage('epdVisualization');
    }
    if (invalidApis(epdVisualization)) {
        return invalidApis(epdVisualization);
    }
    if (invalidUi5(epdVisualization)) {
        return invalidUi5(epdVisualization);
    }
    if (invalidUsageIds(epdVisualization)) {
        return invalidUsageIds(epdVisualization);
    }
    if (invalidVisualPicking(epdVisualization)) {
        return invalidVisualPicking(epdVisualization);
    }
}
function unconfiguredPropertyMessage(propertyName) {
    return `No value configured for ${propertyName} in the EPD Visualization library configuration.`;
}
function invalidUrlMessage(propertyName, url) {
    return `URL value '${url}' configured for ${propertyName} in the EPD Visualization library configuration is not valid.`;
}
function invalidUrlProtocolMessage(propertyName) {
    return `URL for ${propertyName} must use HTTPS or HTTP protocol.`;
}
function invalidApis(epdVisualization) {
    if (!epdVisualization.apis) {
        return unconfiguredPropertyMessage('epdVisualization.apis');
    }
    const configApisBaseUrlProperty = 'epdVisualization.apis.baseUrl';
    if (!epdVisualization.apis.baseUrl) {
        return unconfiguredPropertyMessage(configApisBaseUrlProperty);
    }
    const apiBaseUrl = getUrl(epdVisualization.apis.baseUrl);
    if (!apiBaseUrl) {
        return invalidUrlMessage(configApisBaseUrlProperty, epdVisualization.apis.baseUrl);
    }
    if (!isHttpOrHttps(apiBaseUrl)) {
        return invalidUrlProtocolMessage(configApisBaseUrlProperty);
    }
    return undefined;
}
function invalidUi5(epdVisualization) {
    if (!epdVisualization.ui5) {
        return unconfiguredPropertyMessage('epdVisualization.ui5');
    }
    const configUi5BootstrapUrlProperty = 'epdVisualization.ui5.bootstrapUrl';
    if (!epdVisualization.ui5.bootstrapUrl) {
        return unconfiguredPropertyMessage(configUi5BootstrapUrlProperty);
    }
    const ui5BootStrapUrl = getUrl(epdVisualization.ui5.bootstrapUrl);
    if (!ui5BootStrapUrl) {
        return invalidUrlMessage(configUi5BootstrapUrlProperty, epdVisualization.ui5.bootstrapUrl);
    }
    if (!isHttpOrHttps(ui5BootStrapUrl)) {
        return invalidUrlProtocolMessage(configUi5BootstrapUrlProperty);
    }
    return undefined;
}
function invalidUsageIds(epdVisualization) {
    if (!epdVisualization.usageIds) {
        return unconfiguredPropertyMessage('epdVisualization.usageIds');
    }
    if (!epdVisualization.usageIds.folderUsageId.name) {
        return unconfiguredPropertyMessage('epdVisualization.usageIds.folderUsageId.name');
    }
    if (!epdVisualization.usageIds.folderUsageId.keys?.length) {
        return unconfiguredPropertyMessage('epdVisualization.usageIds.folderUsageId.keys');
    }
    for (let i = 0; i < epdVisualization.usageIds.folderUsageId.keys.length; i++) {
        if (!epdVisualization.usageIds.folderUsageId.keys[i].name) {
            return unconfiguredPropertyMessage(`epdVisualization.usageIds.folderUsageId.keys[${i}].name`);
        }
        if (!epdVisualization.usageIds.folderUsageId.keys[i].value) {
            return unconfiguredPropertyMessage(`epdVisualization.usageIds.folderUsageId.keys[${i}].value`);
        }
    }
    if (!epdVisualization.usageIds.productUsageId.source) {
        return unconfiguredPropertyMessage('epdVisualization.usageIds.productUsageId.source');
    }
    if (!epdVisualization.usageIds.productUsageId.category) {
        return unconfiguredPropertyMessage('epdVisualization.usageIds.productUsageId.category');
    }
    if (!epdVisualization.usageIds.productUsageId.keyName) {
        return unconfiguredPropertyMessage('epdVisualization.usageIds.productUsageId.keyName');
    }
    return undefined;
}
function invalidVisualPicking(epdVisualization) {
    if (!epdVisualization.visualPicking) {
        return unconfiguredPropertyMessage('epdVisualization.visualPicking');
    }
    if (!epdVisualization.visualPicking.productReferenceType) {
        return unconfiguredPropertyMessage('epdVisualization.visualPicking.productReferenceType');
    }
    return undefined;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXBkLXZpc3VhbGl6YXRpb24tY29uZmlnLXZhbGlkYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2ludGVncmF0aW9uLWxpYnMvZXBkLXZpc3VhbGl6YXRpb24vcm9vdC9jb25maWcvZXBkLXZpc3VhbGl6YXRpb24tY29uZmlnLXZhbGlkYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQU0xRCxNQUFNLFVBQVUsK0JBQStCLENBQzdDLHNCQUE4QztJQUU5QyxNQUFNLGdCQUFnQixHQUFHLHNCQUFzQixDQUFDLGdCQUFnQixDQUFDO0lBQ2pFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtRQUNyQixPQUFPLDJCQUEyQixDQUFDLGtCQUFrQixDQUFDLENBQUM7S0FDeEQ7SUFFRCxJQUFJLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFO1FBQ2pDLE9BQU8sV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUM7S0FDdEM7SUFFRCxJQUFJLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFO1FBQ2hDLE9BQU8sVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUM7S0FDckM7SUFFRCxJQUFJLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFO1FBQ3JDLE9BQU8sZUFBZSxDQUFDLGdCQUFnQixDQUFDLENBQUM7S0FDMUM7SUFFRCxJQUFJLG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLEVBQUU7UUFDMUMsT0FBTyxvQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0tBQy9DO0FBQ0gsQ0FBQztBQUVELFNBQVMsMkJBQTJCLENBQUMsWUFBb0I7SUFDdkQsT0FBTywyQkFBMkIsWUFBWSxrREFBa0QsQ0FBQztBQUNuRyxDQUFDO0FBRUQsU0FBUyxpQkFBaUIsQ0FBQyxZQUFvQixFQUFFLEdBQVc7SUFDMUQsT0FBTyxjQUFj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LElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUU7WUFDMUQsT0FBTywyQkFBMkIsQ0FDaEMsZ0RBQWdELENBQUMsU0FBUyxDQUMzRCxDQUFDO1NBQ0g7S0FDRjtJQUVELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRTtRQUNwRCxPQUFPLDJCQUEyQixDQUNoQyxpREFBaUQsQ0FDbEQsQ0FBQztLQUNIO0lBQ0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFO1FBQ3RELE9BQU8sMkJBQTJCLENBQ2hDLG1EQUFtRCxDQUNwRCxDQUFDO0tBQ0g7SUFDRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUU7UUFDckQsT0FBTywyQkFBMkIsQ0FDaEMsa0RBQWtELENBQ25ELENBQUM7S0FDSDtJQUVELE9BQU8sU0FBUyxDQUFDO0FBQ25CLENBQUM7QUFFRCxTQUFTLG9CQUFvQixDQUMzQixnQkFBNkM7SUFFN0MsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsRUFBRTtRQUNuQyxPQUFPLDJCQUEyQixDQUFDLGdDQUFnQyxDQUFDLENBQUM7S0FDdEU7SUFFRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLG9CQUFvQixFQUFFO1FBQ3hELE9BQU8sMkJBQTJCLENBQ2hDLHFEQUFxRCxDQUN0RCxDQUFDO0tBQ0g7SUFFRCxPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgZ2V0VXJsLCBpc0h0dHBPckh0dHBzIH0gZnJvbSAnLi4vdXRpbC91cmwtdXRpbHMnO1xuaW1wb3J0IHtcbiAgRXBkVmlzdWFsaXphdGlvbkNvbmZpZyxcbiAgRXBkVmlzdWFsaXphdGlvbklubmVyQ29uZmlnLFxufSBmcm9tICcuL2VwZC12aXN1YWxpemF0aW9uLWNvbmZpZyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBlcGRWaXN1YWxpemF0aW9uQ29uZmlnVmFsaWRhdG9yKFxuICBlcGRWaXN1YWxpemF0aW9uQ29uZmlnOiBFcGRWaXN1YWxpemF0aW9uQ29uZmlnXG4pOiBzdHJpbmcgfCB2b2lkIHtcbiAgY29uc3QgZXBkVmlzdWFsaXphdGlvbiA9IGVwZFZpc3VhbGl6YXRpb25Db25maWcuZXBkVmlzdWFsaXphdGlvbjtcbiAgaWYgKCFlcGRWaXN1YWxpemF0aW9uKSB7XG4gICAgcmV0dXJuIHVuY29uZmlndXJlZFByb3BlcnR5TWVzc2FnZSgnZXBkVmlzdWFsaXphdGlvbicpO1xuICB9XG5cbiAgaWYgKGludmFsaWRBcGlzKGVwZFZpc3VhbGl6YXRpb24pKSB7XG4gICAgcmV0dXJuIGludmFsaWRBcGlzKGVwZFZpc3VhbGl6YXRpb24pO1xuICB9XG5cbiAgaWYgKGludmFsaWRVaTUoZXBkVmlzdWFsaXphdGlvbikpIHtcbiAgICByZXR1cm4gaW52YWxpZFVpNShlcGRWaXN1YWxpemF0aW9uKTtcbiAgfVxuXG4gIGlmIChpbnZhbGlkVXNhZ2VJZHMoZXBkVmlzdWFsaXphdGlvbikpIHtcbiAgICByZXR1cm4gaW52YWxpZFVzYWdlSWRzKGVwZFZpc3VhbGl6YXRpb24pO1xuICB9XG5cbiAgaWYgKGludmFsaWRWaXN1YWxQaWNraW5nKGVwZFZpc3VhbGl6YXRpb24pKSB7XG4gICAgcmV0dXJuIGludmFsaWRWaXN1YWxQaWNraW5nKGVwZFZpc3VhbGl6YXRpb24pO1xuICB9XG59XG5cbmZ1bmN0aW9uIHVuY29uZmlndXJlZFByb3BlcnR5TWVzc2FnZShwcm9wZXJ0eU5hbWU6IHN0cmluZykge1xuICByZXR1cm4gYE5vIHZhbHVlIGNvbmZpZ3VyZWQgZm9yICR7cHJvcGVydHlOYW1lfSBpbiB0aGUgRVBEIFZpc3VhbGl6YXRpb24gbGlicmFyeSBjb25maWd1cmF0aW9uLmA7XG59XG5cbmZ1bmN0aW9uIGludmFsaWRVcmxNZXNzYWdlKHByb3BlcnR5TmFtZTogc3RyaW5nLCB1cmw6IHN0cmluZykge1xuICByZXR1cm4gYFVSTCB2YWx1ZSAnJHt1cmx9JyBjb25maWd1cmVkIGZvciAke3Byb3BlcnR5TmFtZX0gaW4gdGhlIEVQRCBWaXN1YWxpemF0aW9uIGxpYnJhcnkgY29uZmlndXJhdGlvbiBpcyBub3QgdmFsaWQuYDtcbn1cblxuZnVuY3Rpb24gaW52YWxpZFVybFByb3RvY29sTWVzc2FnZShwcm9wZXJ0eU5hbWU6IHN0cmluZykge1xuICByZXR1cm4gYFVSTCBmb3IgJHtwcm9wZXJ0eU5hbWV9IG11c3QgdXNlIEhUVFBTIG9yIEhUVFAgcHJvdG9jb2wuYDtcbn1cblxuZnVuY3Rpb24gaW52YWxpZEFwaXMoXG4gIGVwZFZpc3VhbGl6YXRpb246IEVwZFZpc3VhbGl6YXRpb25Jbm5lckNvbmZpZ1xuKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgaWYgKCFlcGRWaXN1YWxpemF0aW9uLmFwaXMpIHtcbiAgICByZXR1cm4gdW5jb25maWd1cmVkUHJvcGVydHlNZXNzYWdlKCdlcGRWaXN1YWxpemF0aW9uLmFwaXMnKTtcbiAgfVxuXG4gIGNvbnN0IGNvbmZpZ0FwaXNCYXNlVXJsUHJvcGVydHkgPSAnZXBkVmlzdWFsaXphdGlvbi5hcGlzLmJhc2VVcmwnO1xuICBpZiAoIWVwZFZpc3VhbGl6YXRpb24uYXBpcy5iYXNlVXJsKSB7XG4gICAgcmV0dXJuIHVuY29uZmlndXJlZFByb3BlcnR5TWVzc2FnZShjb25maWdBcGlzQmFzZVVybFByb3BlcnR5KTtcbiAgfVxuXG4gIGNvbnN0IGFwaUJhc2VVcmwgPSBnZXRVcmwoZXBkVmlzdWFsaXphdGlvbi5hcGlzLmJhc2VVcmwpO1xuICBpZiAoIWFwaUJhc2VVcmwpIHtcbiAgICByZXR1cm4gaW52YWxpZFVybE1lc3NhZ2UoXG4gICAgICBjb25maWdBcGlzQmFzZVVybFByb3BlcnR5LFxuICAgICAgZXBkVmlzdWFsaXphdGlvbi5hcGlzLmJhc2VVcmxcbiAgICApO1xuICB9XG4gIGlmICghaXNIdHRwT3JIdHRwcyhhcGlCYXNlVXJsKSkge1xuICAgIHJldHVybiBpbnZhbGlkVXJsUHJvdG9jb2xNZXNzYWdlKGNvbmZpZ0FwaXNCYXNlVXJsUHJvcGVydHkpO1xuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZnVuY3Rpb24gaW52YWxpZFVpNShcbiAgZXBkVmlzdWFsaXphdGlvbjogRXBkVmlzdWFsaXphdGlvbklubmVyQ29uZmlnXG4pOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBpZiAoIWVwZFZpc3VhbGl6YXRpb24udWk1KSB7XG4gICAgcmV0dXJuIHVuY29uZmlndXJlZFByb3BlcnR5TWVzc2FnZSgnZXBkVmlzdWFsaXphdGlvbi51aTUnKTtcbiAgfVxuXG4gIGNvbnN0IGNvbmZpZ1VpNUJvb3RzdHJhcFVybFByb3BlcnR5ID0gJ2VwZFZpc3VhbGl6YXRpb24udWk1LmJvb3RzdHJhcFVybCc7XG4gIGlmICghZXBkVmlzdWFsaXphdGlvbi51aTUuYm9vdHN0cmFwVXJsKSB7XG4gICAgcmV0dXJuIHVuY29uZmlndXJlZFByb3BlcnR5TWVzc2FnZShjb25maWdVaTVCb290c3RyYXBVcmxQcm9wZXJ0eSk7XG4gIH1cblxuICBjb25zdCB1aTVCb290U3RyYXBVcmwgPSBnZXRVcmwoZXBkVmlzdWFsaXphdGlvbi51aTUuYm9vdHN0cmFwVXJsKTtcbiAgaWYgKCF1aTVCb290U3RyYXBVcmwpIHtcbiAgICByZXR1cm4gaW52YWxpZFVybE1lc3NhZ2UoXG4gICAgICBjb25maWdVaTVCb290c3RyYXBVcmxQcm9wZXJ0eSxcbiAgICAgIGVwZFZpc3VhbGl6YXRpb24udWk1LmJvb3RzdHJhcFVybFxuICAgICk7XG4gIH1cblxuICBpZiAoIWlzSHR0cE9ySHR0cHModWk1Qm9vdFN0cmFwVXJsKSkge1xuICAgIHJldHVybiBpbnZhbGlkVXJsUHJvdG9jb2xNZXNzYWdlKGNvbmZpZ1VpNUJvb3RzdHJhcFVybFByb3BlcnR5KTtcbiAgfVxuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIGludmFsaWRVc2FnZUlkcyhcbiAgZXBkVmlzdWFsaXphdGlvbjogRXBkVmlzdWFsaXphdGlvbklubmVyQ29uZmlnXG4pOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBpZiAoIWVwZFZpc3VhbGl6YXRpb24udXNhZ2VJZHMpIHtcbiAgICByZXR1cm4gdW5jb25maWd1cmVkUHJvcGVydHlNZXNzYWdlKCdlcGRWaXN1YWxpemF0aW9uLnVzYWdlSWRzJyk7XG4gIH1cbiAgaWYgKCFlcGRWaXN1YWxpemF0aW9uLnVzYWdlSWRzLmZvbGRlclVzYWdlSWQubmFtZSkge1xuICAgIHJldHVybiB1bmNvbmZpZ3VyZWRQcm9wZXJ0eU1lc3NhZ2UoXG4gICAgICAnZXBkVmlzdWFsaXphdGlvbi51c2FnZUlkcy5mb2xkZXJVc2FnZUlkLm5hbWUnXG4gICAgKTtcbiAgfVxuICBpZiAoIWVwZFZpc3VhbGl6YXRpb24udXNhZ2VJZHMuZm9sZGVyVXNhZ2VJZC5rZXlzPy5sZW5ndGgpIHtcbiAgICByZXR1cm4gdW5jb25maWd1cmVkUHJvcGVydHlNZXNzYWdlKFxuICAgICAgJ2VwZFZpc3VhbGl6YXRpb24udXNhZ2VJZHMuZm9sZGVyVXNhZ2VJZC5rZXlzJ1xuICAgICk7XG4gIH1cbiAgZm9yIChcbiAgICBsZXQgaSA9IDA7XG4gICAgaSA8IGVwZFZpc3VhbGl6YXRpb24udXNhZ2VJZHMuZm9sZGVyVXNhZ2VJZC5rZXlzLmxlbmd0aDtcbiAgICBpKytcbiAgKSB7XG4gICAgaWYgKCFlcGRWaXN1YWxpemF0aW9uLnVzYWdlSWRzLmZvbGRlclVzYWdlSWQua2V5c1tpXS5uYW1lKSB7XG4gICAgICByZXR1cm4gdW5jb25maWd1cmVkUHJvcGVydHlNZXNzYWdlKFxuICAgICAgICBgZXBkVmlzdWFsaXphdGlvbi51c2FnZUlkcy5mb2xkZXJVc2FnZUlkLmtleXNbJHtpfV0ubmFtZWBcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICghZXBkVmlzdWFsaXphdGlvbi51c2FnZUlkcy5mb2xkZXJVc2FnZUlkLmtleXNbaV0udmFsdWUpIHtcbiAgICAgIHJldHVybiB1bmNvbmZpZ3VyZWRQcm9wZXJ0eU1lc3NhZ2UoXG4gICAgICAgIGBlcGRWaXN1YWxpemF0aW9uLnVzYWdlSWRzLmZvbGRlclVzYWdlSWQua2V5c1ske2l9XS52YWx1ZWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFlcGRWaXN1YWxpemF0aW9uLnVzYWdlSWRzLnByb2R1Y3RVc2FnZUlkLnNvdXJjZSkge1xuICAgIHJldHVybiB1bmNvbmZpZ3VyZWRQcm9wZXJ0eU1lc3NhZ2UoXG4gICAgICAnZXBkVmlzdWFsaXphdGlvbi51c2FnZUlkcy5wcm9kdWN0VXNhZ2VJZC5zb3VyY2UnXG4gICAgKTtcbiAgfVxuICBpZiAoIWVwZFZpc3VhbGl6YXRpb24udXNhZ2VJZHMucHJvZHVjdFVzYWdlSWQuY2F0ZWdvcnkpIHtcbiAgICByZXR1cm4gdW5jb25maWd1cmVkUHJvcGVydHlNZXNzYWdlKFxuICAgICAgJ2VwZFZpc3VhbGl6YXRpb24udXNhZ2VJZHMucHJvZHVjdFVzYWdlSWQuY2F0ZWdvcnknXG4gICAgKTtcbiAgfVxuICBpZiAoIWVwZFZpc3VhbGl6YXRpb24udXNhZ2VJZHMucHJvZHVjdFVzYWdlSWQua2V5TmFtZSkge1xuICAgIHJldHVybiB1bmNvbmZpZ3VyZWRQcm9wZXJ0eU1lc3NhZ2UoXG4gICAgICAnZXBkVmlzdWFsaXphdGlvbi51c2FnZUlkcy5wcm9kdWN0VXNhZ2VJZC5rZXlOYW1lJ1xuICAgICk7XG4gIH1cblxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBpbnZhbGlkVmlzdWFsUGlja2luZyhcbiAgZXBkVmlzdWFsaXphdGlvbjogRXBkVmlzdWFsaXphdGlvbklubmVyQ29uZmlnXG4pOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBpZiAoIWVwZFZpc3VhbGl6YXRpb24udmlzdWFsUGlja2luZykge1xuICAgIHJldHVybiB1bmNvbmZpZ3VyZWRQcm9wZXJ0eU1lc3NhZ2UoJ2VwZFZpc3VhbGl6YXRpb24udmlzdWFsUGlja2luZycpO1xuICB9XG5cbiAgaWYgKCFlcGRWaXN1YWxpemF0aW9uLnZpc3VhbFBpY2tpbmcucHJvZHVjdFJlZmVyZW5jZVR5cGUpIHtcbiAgICByZXR1cm4gdW5jb25maWd1cmVkUHJvcGVydHlNZXNzYWdlKFxuICAgICAgJ2VwZFZpc3VhbGl6YXRpb24udmlzdWFsUGlja2luZy5wcm9kdWN0UmVmZXJlbmNlVHlwZSdcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cbiJdfQ==