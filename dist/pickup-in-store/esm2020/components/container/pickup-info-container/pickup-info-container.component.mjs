/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Component } from '@angular/core';
import { combineLatest } from 'rxjs';
import { filter, map, mergeMap, take, tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/cart/base/root";
import * as i2 from "@spartacus/pickup-in-store/root";
import * as i3 from "@angular/common";
import * as i4 from "../../presentational/pickup-info/pickup-info.component";
export class PickupInfoContainerComponent {
    constructor(activeCartService, storeDetails) {
        this.activeCartService = activeCartService;
        this.storeDetails = storeDetails;
    }
    ngOnInit() {
        this.activeCartService
            .getActive()
            .pipe(map((cart) => cart.entries), filter((entries) => !!entries), map((entries) => entries
            .map((entry) => entry.deliveryPointOfService?.name)
            .filter((name) => !!name)), tap((storeNames) => storeNames.forEach((storeName) => this.storeDetails.loadStoreDetails(storeName))), mergeMap((storeNames) => combineLatest(storeNames.map((storeName) => this.storeDetails
            .getStoreDetails(storeName)
            .pipe(filter((details) => !!details))))), map((pointOfService) => pointOfService.map(({ address, displayName, openingHours }) => ({
            address,
            displayName,
            openingHours,
        }))), tap((storesDetailsData) => (this.storesDetailsData = storesDetailsData)), take(1))
            .subscribe();
    }
}
PickupInfoContainerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PickupInfoContainerComponent, deps: [{ token: i1.ActiveCartFacade }, { token: i2.PickupLocationsSearchFacade }], target: i0.ɵɵFactoryTarget.Component });
PickupInfoContainerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: PickupInfoContainerComponent, selector: "cx-pickup-info-container", ngImport: i0, template: "<cx-pickup-info\n  *ngFor=\"let storeDetailsData of storesDetailsData\"\n  [storeDetails]=\"storeDetailsData\"\n></cx-pickup-info>\n", dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "component", type: i4.PickupInfoComponent, selector: "cx-pickup-info", inputs: ["storeDetails"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PickupInfoContainerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-pickup-info-container', template: "<cx-pickup-info\n  *ngFor=\"let storeDetailsData of storesDetailsData\"\n  [storeDetails]=\"storeDetailsData\"\n></cx-pickup-info>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ActiveCartFacade }, { type: i2.PickupLocationsSearchFacade }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlja3VwLWluZm8tY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9waWNrdXAtaW4tc3RvcmUvY29tcG9uZW50cy9jb250YWluZXIvcGlja3VwLWluZm8tY29udGFpbmVyL3BpY2t1cC1pbmZvLWNvbnRhaW5lci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcGlja3VwLWluLXN0b3JlL2NvbXBvbmVudHMvY29udGFpbmVyL3BpY2t1cC1pbmZvLWNvbnRhaW5lci9waWNrdXAtaW5mby1jb250YWluZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFJbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7QUFNbEUsTUFBTSxPQUFPLDRCQUE0QjtJQUd2QyxZQUNZLGlCQUFtQyxFQUNuQyxZQUF5QztRQUR6QyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQWtCO1FBQ25DLGlCQUFZLEdBQVosWUFBWSxDQUE2QjtJQUNsRCxDQUFDO0lBRUosUUFBUTtRQUNOLElBQUksQ0FBQyxpQkFBaUI7YUFDbkIsU0FBUyxFQUFFO2FBQ1gsSUFBSSxDQUNILEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUMzQixNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQTJCLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQ3ZELEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQ2QsT0FBTzthQUNKLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLHNCQUFzQixFQUFFLElBQUksQ0FBQzthQUNsRCxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQWtCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQzVDLEVBQ0QsR0FBRyxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FDakIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQy9CLElBQUksQ0FBQyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQzlDLENBQ0YsRUFDRCxRQUFRLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUN0QixhQUFhLENBQ1gsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQzNCLElBQUksQ0FBQyxZQUFZO2FBQ2QsZUFBZSxDQUFDLFNBQVMsQ0FBQzthQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FDeEMsQ0FDRixDQUNGLEVBQ0QsR0FBRyxDQUFDLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FDckIsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM5RCxPQUFPO1lBQ1AsV0FBVztZQUNYLFlBQVk7U0FDYixDQUFDLENBQUMsQ0FDSixFQUNELEdBQUcsQ0FDRCxDQUFDLGlCQUFpQixFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQyxDQUNwRSxFQUNELElBQUksQ0FBQyxDQUFDLENBQUMsQ0FDUjthQUNBLFNBQVMsRUFBRSxDQUFDO0lBQ2pCLENBQUM7O3lIQTlDVSw0QkFBNEI7NkdBQTVCLDRCQUE0QixnRUNqQnpDLHNJQUlBOzJGRGFhLDRCQUE0QjtrQkFKeEMsU0FBUzsrQkFDRSwwQkFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMyBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aXZlQ2FydEZhY2FkZSwgT3JkZXJFbnRyeSB9IGZyb20gJ0BzcGFydGFjdXMvY2FydC9iYXNlL3Jvb3QnO1xuaW1wb3J0IHsgUG9pbnRPZlNlcnZpY2UgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgUGlja3VwTG9jYXRpb25zU2VhcmNoRmFjYWRlIH0gZnJvbSAnQHNwYXJ0YWN1cy9waWNrdXAtaW4tc3RvcmUvcm9vdCc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCwgbWVyZ2VNYXAsIHRha2UsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtcGlja3VwLWluZm8tY29udGFpbmVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BpY2t1cC1pbmZvLWNvbnRhaW5lci5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIFBpY2t1cEluZm9Db250YWluZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBzdG9yZXNEZXRhaWxzRGF0YTogUGFydGlhbDxQb2ludE9mU2VydmljZT5bXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgYWN0aXZlQ2FydFNlcnZpY2U6IEFjdGl2ZUNhcnRGYWNhZGUsXG4gICAgcHJvdGVjdGVkIHN0b3JlRGV0YWlsczogUGlja3VwTG9jYXRpb25zU2VhcmNoRmFjYWRlXG4gICkge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmFjdGl2ZUNhcnRTZXJ2aWNlXG4gICAgICAuZ2V0QWN0aXZlKClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKGNhcnQpID0+IGNhcnQuZW50cmllcyksXG4gICAgICAgIGZpbHRlcigoZW50cmllcyk6IGVudHJpZXMgaXMgT3JkZXJFbnRyeVtdID0+ICEhZW50cmllcyksXG4gICAgICAgIG1hcCgoZW50cmllcykgPT5cbiAgICAgICAgICBlbnRyaWVzXG4gICAgICAgICAgICAubWFwKChlbnRyeSkgPT4gZW50cnkuZGVsaXZlcnlQb2ludE9mU2VydmljZT8ubmFtZSlcbiAgICAgICAgICAgIC5maWx0ZXIoKG5hbWUpOiBuYW1lIGlzIHN0cmluZyA9PiAhIW5hbWUpXG4gICAgICAgICksXG4gICAgICAgIHRhcCgoc3RvcmVOYW1lcykgPT5cbiAgICAgICAgICBzdG9yZU5hbWVzLmZvckVhY2goKHN0b3JlTmFtZSkgPT5cbiAgICAgICAgICAgIHRoaXMuc3RvcmVEZXRhaWxzLmxvYWRTdG9yZURldGFpbHMoc3RvcmVOYW1lKVxuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgbWVyZ2VNYXAoKHN0b3JlTmFtZXMpID0+XG4gICAgICAgICAgY29tYmluZUxhdGVzdChcbiAgICAgICAgICAgIHN0b3JlTmFtZXMubWFwKChzdG9yZU5hbWUpID0+XG4gICAgICAgICAgICAgIHRoaXMuc3RvcmVEZXRhaWxzXG4gICAgICAgICAgICAgICAgLmdldFN0b3JlRGV0YWlscyhzdG9yZU5hbWUpXG4gICAgICAgICAgICAgICAgLnBpcGUoZmlsdGVyKChkZXRhaWxzKSA9PiAhIWRldGFpbHMpKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgbWFwKChwb2ludE9mU2VydmljZSkgPT5cbiAgICAgICAgICBwb2ludE9mU2VydmljZS5tYXAoKHsgYWRkcmVzcywgZGlzcGxheU5hbWUsIG9wZW5pbmdIb3VycyB9KSA9PiAoe1xuICAgICAgICAgICAgYWRkcmVzcyxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lLFxuICAgICAgICAgICAgb3BlbmluZ0hvdXJzLFxuICAgICAgICAgIH0pKVxuICAgICAgICApLFxuICAgICAgICB0YXAoXG4gICAgICAgICAgKHN0b3Jlc0RldGFpbHNEYXRhKSA9PiAodGhpcy5zdG9yZXNEZXRhaWxzRGF0YSA9IHN0b3Jlc0RldGFpbHNEYXRhKVxuICAgICAgICApLFxuICAgICAgICB0YWtlKDEpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gIH1cbn1cbiIsIjxjeC1waWNrdXAtaW5mb1xuICAqbmdGb3I9XCJsZXQgc3RvcmVEZXRhaWxzRGF0YSBvZiBzdG9yZXNEZXRhaWxzRGF0YVwiXG4gIFtzdG9yZURldGFpbHNdPVwic3RvcmVEZXRhaWxzRGF0YVwiXG4+PC9jeC1waWNrdXAtaW5mbz5cbiJdfQ==