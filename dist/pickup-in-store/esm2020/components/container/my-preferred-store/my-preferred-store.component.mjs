/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { ICON_TYPE } from '@spartacus/storefront';
import { filter, map, switchMap, take, tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/pickup-in-store/root";
import * as i2 from "@spartacus/core";
import * as i3 from "@spartacus/storefinder/root";
import * as i4 from "@spartacus/storefront";
import * as i5 from "../../presentational/store/store-schedule/store-schedule.component";
import * as i6 from "../../presentational/store/store-address/store-address.component";
import * as i7 from "@angular/common";
export class MyPreferredStoreComponent {
    constructor(preferredStoreFacade, pickupLocationsSearchService, routingService, storeFinderService, cmsService) {
        this.preferredStoreFacade = preferredStoreFacade;
        this.pickupLocationsSearchService = pickupLocationsSearchService;
        this.routingService = routingService;
        this.storeFinderService = storeFinderService;
        this.cmsService = cmsService;
        this.content = {
            header: 'My Store',
            actions: [
                { event: 'send', name: 'Get Directions' },
                { event: 'edit', name: 'Change Store' },
            ],
        };
        this.openHoursOpen = false;
        this.ICON_TYPE = ICON_TYPE;
        this.isStoreFinder = false;
        this.preferredStore$ = this.preferredStoreFacade.getPreferredStore$().pipe(filter((preferredStore) => preferredStore !== null), map((preferredStore) => preferredStore), filter((preferredStore) => !!preferredStore.name), map((preferredStore) => preferredStore.name), tap((preferredStoreName) => this.pickupLocationsSearchService.loadStoreDetails(preferredStoreName)), switchMap((preferredStoreName) => this.pickupLocationsSearchService.getStoreDetails(preferredStoreName)), tap((store) => {
            this.pointOfService = store;
        }));
    }
    ngOnInit() {
        this.cmsService
            .getCurrentPage()
            .pipe(filter(Boolean), take(1), tap((cmsPage) => (this.isStoreFinder = cmsPage.pageId === 'storefinderPage')), filter(() => this.isStoreFinder), tap(() => {
            this.content = {
                header: '',
                actions: [{ event: 'send', name: 'Get Directions' }],
            };
        }))
            .subscribe();
    }
    /**
     * Toggle whether the store's opening hours are visible.
     */
    toggleOpenHours() {
        this.openHoursOpen = !this.openHoursOpen;
        return false;
    }
    changeStore() {
        this.routingService.go(['/store-finder']);
    }
    getDirectionsToStore() {
        const linkToDirections = this.storeFinderService.getDirections(this.pointOfService);
        window.open(linkToDirections, '_blank', 'noopener,noreferrer');
    }
}
MyPreferredStoreComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: MyPreferredStoreComponent, deps: [{ token: i1.PreferredStoreFacade }, { token: i1.PickupLocationsSearchFacade }, { token: i2.RoutingService }, { token: i3.StoreFinderFacade }, { token: i2.CmsService }], target: i0.ɵɵFactoryTarget.Component });
MyPreferredStoreComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: MyPreferredStoreComponent, selector: "cx-my-preferred-store", ngImport: i0, template: "<div [ngClass]=\"{ container: isStoreFinder }\">\n  <div class=\"row\">\n    <div class=\"col-md-12\">\n      <h2\n        class=\"cx-my-preferred-store-heading\"\n        [attr.data-test-id]=\"'preferredStoreHeading'\"\n      >\n        {{\n          isStoreFinder\n            ? ('storeFinderPickupInStore.heading' | cxTranslate)\n            : ('addressBookPickupInStore.heading' | cxTranslate)\n        }}\n      </h2>\n    </div>\n  </div>\n  <div class=\"row\" [attr.data-test-id]=\"'preferredStoreAddressBook'\">\n    <div\n      [ngClass]=\"{\n        'col-md-6': !isStoreFinder,\n        'col-md-4': isStoreFinder,\n        'cx-address-card': true\n      }\"\n    >\n      <cx-card\n        [border]=\"!isStoreFinder\"\n        [fitToContainer]=\"true\"\n        [content]=\"content\"\n        (sendCard)=\"getDirectionsToStore()\"\n        (editCard)=\"changeStore()\"\n      >\n        <div label_container_bottom>\n          <div class=\"info-location\">\n            <cx-store-address\n              [storeDetails]=\"preferredStore$ | async\"\n            ></cx-store-address>\n          </div>\n          <div *ngIf=\"!isStoreFinder\">\n            <button\n              (click)=\"toggleOpenHours()\"\n              class=\"cx-store-opening-hours-toggle\"\n            >\n              {{ 'store.viewHours' | cxTranslate }}\n              <span class=\"cx-store-opening-hours-icon\"\n                ><cx-icon\n                  [type]=\"\n                    openHoursOpen ? ICON_TYPE.CARET_UP : ICON_TYPE.CARET_DOWN\n                  \"\n                ></cx-icon\n              ></span>\n            </button>\n          </div>\n          <div class=\"store-hours\" *ngIf=\"!isStoreFinder\">\n            <cx-store-schedule\n              *ngIf=\"openHoursOpen\"\n              [storeDetails]=\"preferredStore$ | async\"\n            ></cx-store-schedule>\n          </div>\n        </div>\n      </cx-card>\n    </div>\n  </div>\n</div>\n", dependencies: [{ kind: "component", type: i4.CardComponent, selector: "cx-card", inputs: ["border", "editMode", "isDefault", "content", "fitToContainer", "truncateText", "charactersLimit", "index"], outputs: ["deleteCard", "setDefaultCard", "sendCard", "editCard", "cancelCard"] }, { kind: "component", type: i5.StoreScheduleComponent, selector: "cx-store-schedule", inputs: ["storeDetails"] }, { kind: "component", type: i6.StoreAddressComponent, selector: "cx-store-address", inputs: ["storeDetails"] }, { kind: "directive", type: i7.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "pipe", type: i7.AsyncPipe, name: "async" }, { kind: "pipe", type: i2.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: MyPreferredStoreComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-my-preferred-store', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div [ngClass]=\"{ container: isStoreFinder }\">\n  <div class=\"row\">\n    <div class=\"col-md-12\">\n      <h2\n        class=\"cx-my-preferred-store-heading\"\n        [attr.data-test-id]=\"'preferredStoreHeading'\"\n      >\n        {{\n          isStoreFinder\n            ? ('storeFinderPickupInStore.heading' | cxTranslate)\n            : ('addressBookPickupInStore.heading' | cxTranslate)\n        }}\n      </h2>\n    </div>\n  </div>\n  <div class=\"row\" [attr.data-test-id]=\"'preferredStoreAddressBook'\">\n    <div\n      [ngClass]=\"{\n        'col-md-6': !isStoreFinder,\n        'col-md-4': isStoreFinder,\n        'cx-address-card': true\n      }\"\n    >\n      <cx-card\n        [border]=\"!isStoreFinder\"\n        [fitToContainer]=\"true\"\n        [content]=\"content\"\n        (sendCard)=\"getDirectionsToStore()\"\n        (editCard)=\"changeStore()\"\n      >\n        <div label_container_bottom>\n          <div class=\"info-location\">\n            <cx-store-address\n              [storeDetails]=\"preferredStore$ | async\"\n            ></cx-store-address>\n          </div>\n          <div *ngIf=\"!isStoreFinder\">\n            <button\n              (click)=\"toggleOpenHours()\"\n              class=\"cx-store-opening-hours-toggle\"\n            >\n              {{ 'store.viewHours' | cxTranslate }}\n              <span class=\"cx-store-opening-hours-icon\"\n                ><cx-icon\n                  [type]=\"\n                    openHoursOpen ? ICON_TYPE.CARET_UP : ICON_TYPE.CARET_DOWN\n                  \"\n                ></cx-icon\n              ></span>\n            </button>\n          </div>\n          <div class=\"store-hours\" *ngIf=\"!isStoreFinder\">\n            <cx-store-schedule\n              *ngIf=\"openHoursOpen\"\n              [storeDetails]=\"preferredStore$ | async\"\n            ></cx-store-schedule>\n          </div>\n        </div>\n      </cx-card>\n    </div>\n  </div>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.PreferredStoreFacade }, { type: i1.PickupLocationsSearchFacade }, { type: i2.RoutingService }, { type: i3.StoreFinderFacade }, { type: i2.CmsService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXktcHJlZmVycmVkLXN0b3JlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9waWNrdXAtaW4tc3RvcmUvY29tcG9uZW50cy9jb250YWluZXIvbXktcHJlZmVycmVkLXN0b3JlL215LXByZWZlcnJlZC1zdG9yZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcGlja3VwLWluLXN0b3JlL2NvbXBvbmVudHMvY29udGFpbmVyL215LXByZWZlcnJlZC1zdG9yZS9teS1wcmVmZXJyZWQtc3RvcmUuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFhM0UsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRWxELE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7OztBQU9uRSxNQUFNLE9BQU8seUJBQXlCO0lBY3BDLFlBQ1Usb0JBQTBDLEVBQ3hDLDRCQUF5RCxFQUN6RCxjQUE4QixFQUM5QixrQkFBcUMsRUFDckMsVUFBc0I7UUFKeEIseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQUN4QyxpQ0FBNEIsR0FBNUIsNEJBQTRCLENBQTZCO1FBQ3pELG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5Qix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW1CO1FBQ3JDLGVBQVUsR0FBVixVQUFVLENBQVk7UUFqQmxDLFlBQU8sR0FBRztZQUNSLE1BQU0sRUFBRSxVQUFVO1lBQ2xCLE9BQU8sRUFBRTtnQkFDUCxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFO2dCQUN6QyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRTthQUN4QztTQUNGLENBQUM7UUFDRixrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUNiLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFFL0Isa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFTcEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxJQUFJLENBQ3hFLE1BQU0sQ0FBQyxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsY0FBYyxLQUFLLElBQUksQ0FBQyxFQUNuRCxHQUFHLENBQUMsQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLGNBQXFDLENBQUMsRUFDOUQsTUFBTSxDQUFDLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxFQUNqRCxHQUFHLENBQUMsQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFDNUMsR0FBRyxDQUFDLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxDQUN6QixJQUFJLENBQUMsNEJBQTRCLENBQUMsZ0JBQWdCLENBQ2hELGtCQUE0QixDQUM3QixDQUNGLEVBQ0QsU0FBUyxDQUFDLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxDQUMvQixJQUFJLENBQUMsNEJBQTRCLENBQUMsZUFBZSxDQUMvQyxrQkFBNEIsQ0FDN0IsQ0FDRixFQUNELEdBQUcsQ0FBQyxDQUFDLEtBQXFCLEVBQUUsRUFBRTtZQUM1QixJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsVUFBVTthQUNaLGNBQWMsRUFBRTthQUNoQixJQUFJLENBQ0gsTUFBTSxDQUFPLE9BQU8sQ0FBQyxFQUNyQixJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsR0FBRyxDQUNELENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FDVixDQUFDLElBQUksQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLE1BQU0sS0FBSyxpQkFBaUIsQ0FBQyxDQUM5RCxFQUNELE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQ2hDLEdBQUcsQ0FBQyxHQUFHLEVBQUU7WUFDUCxJQUFJLENBQUMsT0FBTyxHQUFHO2dCQUNiLE1BQU0sRUFBRSxFQUFFO2dCQUNWLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQzthQUNyRCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQ0g7YUFDQSxTQUFTLEVBQUUsQ0FBQztJQUNqQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxlQUFlO1FBQ2IsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDekMsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRUQsb0JBQW9CO1FBQ2xCLE1BQU0sZ0JBQWdCLEdBQVcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FDcEUsSUFBSSxDQUFDLGNBQWMsQ0FDcEIsQ0FBQztRQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsUUFBUSxFQUFFLHFCQUFxQixDQUFDLENBQUM7SUFDakUsQ0FBQzs7c0hBaEZVLHlCQUF5QjswR0FBekIseUJBQXlCLDZEQzVCdEMseTZEQThEQTsyRkRsQ2EseUJBQXlCO2tCQUxyQyxTQUFTOytCQUNFLHVCQUF1QixtQkFFaEIsdUJBQXVCLENBQUMsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQ21zU2VydmljZSxcbiAgUGFnZSxcbiAgUG9pbnRPZlNlcnZpY2UsXG4gIFJvdXRpbmdTZXJ2aWNlLFxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHtcbiAgUGlja3VwTG9jYXRpb25zU2VhcmNoRmFjYWRlLFxuICBQb2ludE9mU2VydmljZU5hbWVzLFxuICBQcmVmZXJyZWRTdG9yZUZhY2FkZSxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9waWNrdXAtaW4tc3RvcmUvcm9vdCc7XG5pbXBvcnQgeyBTdG9yZUZpbmRlckZhY2FkZSB9IGZyb20gJ0BzcGFydGFjdXMvc3RvcmVmaW5kZXIvcm9vdCc7XG5pbXBvcnQgeyBJQ09OX1RZUEUgfSBmcm9tICdAc3BhcnRhY3VzL3N0b3JlZnJvbnQnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCwgdGFrZSwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1teS1wcmVmZXJyZWQtc3RvcmUnLFxuICB0ZW1wbGF0ZVVybDogJ215LXByZWZlcnJlZC1zdG9yZS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBNeVByZWZlcnJlZFN0b3JlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgcHJlZmVycmVkU3RvcmUkOiBPYnNlcnZhYmxlPFBvaW50T2ZTZXJ2aWNlPjtcbiAgY29udGVudCA9IHtcbiAgICBoZWFkZXI6ICdNeSBTdG9yZScsXG4gICAgYWN0aW9uczogW1xuICAgICAgeyBldmVudDogJ3NlbmQnLCBuYW1lOiAnR2V0IERpcmVjdGlvbnMnIH0sXG4gICAgICB7IGV2ZW50OiAnZWRpdCcsIG5hbWU6ICdDaGFuZ2UgU3RvcmUnIH0sXG4gICAgXSxcbiAgfTtcbiAgb3BlbkhvdXJzT3BlbiA9IGZhbHNlO1xuICByZWFkb25seSBJQ09OX1RZUEUgPSBJQ09OX1RZUEU7XG4gIHBvaW50T2ZTZXJ2aWNlOiBQb2ludE9mU2VydmljZTtcbiAgaXNTdG9yZUZpbmRlciA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcHJlZmVycmVkU3RvcmVGYWNhZGU6IFByZWZlcnJlZFN0b3JlRmFjYWRlLFxuICAgIHByb3RlY3RlZCBwaWNrdXBMb2NhdGlvbnNTZWFyY2hTZXJ2aWNlOiBQaWNrdXBMb2NhdGlvbnNTZWFyY2hGYWNhZGUsXG4gICAgcHJvdGVjdGVkIHJvdXRpbmdTZXJ2aWNlOiBSb3V0aW5nU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgc3RvcmVGaW5kZXJTZXJ2aWNlOiBTdG9yZUZpbmRlckZhY2FkZSxcbiAgICBwcm90ZWN0ZWQgY21zU2VydmljZTogQ21zU2VydmljZVxuICApIHtcbiAgICB0aGlzLnByZWZlcnJlZFN0b3JlJCA9IHRoaXMucHJlZmVycmVkU3RvcmVGYWNhZGUuZ2V0UHJlZmVycmVkU3RvcmUkKCkucGlwZShcbiAgICAgIGZpbHRlcigocHJlZmVycmVkU3RvcmUpID0+IHByZWZlcnJlZFN0b3JlICE9PSBudWxsKSxcbiAgICAgIG1hcCgocHJlZmVycmVkU3RvcmUpID0+IHByZWZlcnJlZFN0b3JlIGFzIFBvaW50T2ZTZXJ2aWNlTmFtZXMpLFxuICAgICAgZmlsdGVyKChwcmVmZXJyZWRTdG9yZSkgPT4gISFwcmVmZXJyZWRTdG9yZS5uYW1lKSxcbiAgICAgIG1hcCgocHJlZmVycmVkU3RvcmUpID0+IHByZWZlcnJlZFN0b3JlLm5hbWUpLFxuICAgICAgdGFwKChwcmVmZXJyZWRTdG9yZU5hbWUpID0+XG4gICAgICAgIHRoaXMucGlja3VwTG9jYXRpb25zU2VhcmNoU2VydmljZS5sb2FkU3RvcmVEZXRhaWxzKFxuICAgICAgICAgIHByZWZlcnJlZFN0b3JlTmFtZSBhcyBzdHJpbmdcbiAgICAgICAgKVxuICAgICAgKSxcbiAgICAgIHN3aXRjaE1hcCgocHJlZmVycmVkU3RvcmVOYW1lKSA9PlxuICAgICAgICB0aGlzLnBpY2t1cExvY2F0aW9uc1NlYXJjaFNlcnZpY2UuZ2V0U3RvcmVEZXRhaWxzKFxuICAgICAgICAgIHByZWZlcnJlZFN0b3JlTmFtZSBhcyBzdHJpbmdcbiAgICAgICAgKVxuICAgICAgKSxcbiAgICAgIHRhcCgoc3RvcmU6IFBvaW50T2ZTZXJ2aWNlKSA9PiB7XG4gICAgICAgIHRoaXMucG9pbnRPZlNlcnZpY2UgPSBzdG9yZTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuY21zU2VydmljZVxuICAgICAgLmdldEN1cnJlbnRQYWdlKClcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXI8UGFnZT4oQm9vbGVhbiksXG4gICAgICAgIHRha2UoMSksXG4gICAgICAgIHRhcChcbiAgICAgICAgICAoY21zUGFnZSkgPT5cbiAgICAgICAgICAgICh0aGlzLmlzU3RvcmVGaW5kZXIgPSBjbXNQYWdlLnBhZ2VJZCA9PT0gJ3N0b3JlZmluZGVyUGFnZScpXG4gICAgICAgICksXG4gICAgICAgIGZpbHRlcigoKSA9PiB0aGlzLmlzU3RvcmVGaW5kZXIpLFxuICAgICAgICB0YXAoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuY29udGVudCA9IHtcbiAgICAgICAgICAgIGhlYWRlcjogJycsXG4gICAgICAgICAgICBhY3Rpb25zOiBbeyBldmVudDogJ3NlbmQnLCBuYW1lOiAnR2V0IERpcmVjdGlvbnMnIH1dLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gIH1cblxuICAvKipcbiAgICogVG9nZ2xlIHdoZXRoZXIgdGhlIHN0b3JlJ3Mgb3BlbmluZyBob3VycyBhcmUgdmlzaWJsZS5cbiAgICovXG4gIHRvZ2dsZU9wZW5Ib3VycygpOiBib29sZWFuIHtcbiAgICB0aGlzLm9wZW5Ib3Vyc09wZW4gPSAhdGhpcy5vcGVuSG91cnNPcGVuO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNoYW5nZVN0b3JlKCk6IHZvaWQge1xuICAgIHRoaXMucm91dGluZ1NlcnZpY2UuZ28oWycvc3RvcmUtZmluZGVyJ10pO1xuICB9XG5cbiAgZ2V0RGlyZWN0aW9uc1RvU3RvcmUoKTogdm9pZCB7XG4gICAgY29uc3QgbGlua1RvRGlyZWN0aW9uczogc3RyaW5nID0gdGhpcy5zdG9yZUZpbmRlclNlcnZpY2UuZ2V0RGlyZWN0aW9ucyhcbiAgICAgIHRoaXMucG9pbnRPZlNlcnZpY2VcbiAgICApO1xuICAgIHdpbmRvdy5vcGVuKGxpbmtUb0RpcmVjdGlvbnMsICdfYmxhbmsnLCAnbm9vcGVuZXIsbm9yZWZlcnJlcicpO1xuICB9XG59XG4iLCI8ZGl2IFtuZ0NsYXNzXT1cInsgY29udGFpbmVyOiBpc1N0b3JlRmluZGVyIH1cIj5cbiAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtMTJcIj5cbiAgICAgIDxoMlxuICAgICAgICBjbGFzcz1cImN4LW15LXByZWZlcnJlZC1zdG9yZS1oZWFkaW5nXCJcbiAgICAgICAgW2F0dHIuZGF0YS10ZXN0LWlkXT1cIidwcmVmZXJyZWRTdG9yZUhlYWRpbmcnXCJcbiAgICAgID5cbiAgICAgICAge3tcbiAgICAgICAgICBpc1N0b3JlRmluZGVyXG4gICAgICAgICAgICA/ICgnc3RvcmVGaW5kZXJQaWNrdXBJblN0b3JlLmhlYWRpbmcnIHwgY3hUcmFuc2xhdGUpXG4gICAgICAgICAgICA6ICgnYWRkcmVzc0Jvb2tQaWNrdXBJblN0b3JlLmhlYWRpbmcnIHwgY3hUcmFuc2xhdGUpXG4gICAgICAgIH19XG4gICAgICA8L2gyPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbiAgPGRpdiBjbGFzcz1cInJvd1wiIFthdHRyLmRhdGEtdGVzdC1pZF09XCIncHJlZmVycmVkU3RvcmVBZGRyZXNzQm9vaydcIj5cbiAgICA8ZGl2XG4gICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICdjb2wtbWQtNic6ICFpc1N0b3JlRmluZGVyLFxuICAgICAgICAnY29sLW1kLTQnOiBpc1N0b3JlRmluZGVyLFxuICAgICAgICAnY3gtYWRkcmVzcy1jYXJkJzogdHJ1ZVxuICAgICAgfVwiXG4gICAgPlxuICAgICAgPGN4LWNhcmRcbiAgICAgICAgW2JvcmRlcl09XCIhaXNTdG9yZUZpbmRlclwiXG4gICAgICAgIFtmaXRUb0NvbnRhaW5lcl09XCJ0cnVlXCJcbiAgICAgICAgW2NvbnRlbnRdPVwiY29udGVudFwiXG4gICAgICAgIChzZW5kQ2FyZCk9XCJnZXREaXJlY3Rpb25zVG9TdG9yZSgpXCJcbiAgICAgICAgKGVkaXRDYXJkKT1cImNoYW5nZVN0b3JlKClcIlxuICAgICAgPlxuICAgICAgICA8ZGl2IGxhYmVsX2NvbnRhaW5lcl9ib3R0b20+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImluZm8tbG9jYXRpb25cIj5cbiAgICAgICAgICAgIDxjeC1zdG9yZS1hZGRyZXNzXG4gICAgICAgICAgICAgIFtzdG9yZURldGFpbHNdPVwicHJlZmVycmVkU3RvcmUkIHwgYXN5bmNcIlxuICAgICAgICAgICAgPjwvY3gtc3RvcmUtYWRkcmVzcz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2ICpuZ0lmPVwiIWlzU3RvcmVGaW5kZXJcIj5cbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgKGNsaWNrKT1cInRvZ2dsZU9wZW5Ib3VycygpXCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJjeC1zdG9yZS1vcGVuaW5nLWhvdXJzLXRvZ2dsZVwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHt7ICdzdG9yZS52aWV3SG91cnMnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJjeC1zdG9yZS1vcGVuaW5nLWhvdXJzLWljb25cIlxuICAgICAgICAgICAgICAgID48Y3gtaWNvblxuICAgICAgICAgICAgICAgICAgW3R5cGVdPVwiXG4gICAgICAgICAgICAgICAgICAgIG9wZW5Ib3Vyc09wZW4gPyBJQ09OX1RZUEUuQ0FSRVRfVVAgOiBJQ09OX1RZUEUuQ0FSRVRfRE9XTlxuICAgICAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgICAgICA+PC9jeC1pY29uXG4gICAgICAgICAgICAgID48L3NwYW4+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwic3RvcmUtaG91cnNcIiAqbmdJZj1cIiFpc1N0b3JlRmluZGVyXCI+XG4gICAgICAgICAgICA8Y3gtc3RvcmUtc2NoZWR1bGVcbiAgICAgICAgICAgICAgKm5nSWY9XCJvcGVuSG91cnNPcGVuXCJcbiAgICAgICAgICAgICAgW3N0b3JlRGV0YWlsc109XCJwcmVmZXJyZWRTdG9yZSQgfCBhc3luY1wiXG4gICAgICAgICAgICA+PC9jeC1zdG9yZS1zY2hlZHVsZT5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2N4LWNhcmQ+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=