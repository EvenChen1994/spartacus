/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Injectable } from '@angular/core';
import { OccConfigurator } from '../variant-configurator-occ.models';
import { Configurator } from './../../../core/model/configurator.model';
import * as i0 from "@angular/core";
export class OccConfiguratorVariantSerializer {
    convert(source, target) {
        const resultGroups = [];
        source.groups.forEach((group) => this.convertGroup(group, resultGroups));
        const resultTarget = {
            ...target,
            configId: source.configId,
            rootProduct: source.productCode,
            complete: source.complete,
            groups: resultGroups,
        };
        return resultTarget;
    }
    convertGroup(source, occGroups) {
        const resultSubGroups = [];
        const resultAttributes = [];
        if (source.attributes) {
            source.attributes.forEach((attribute) => this.convertAttribute(attribute, resultAttributes));
        }
        if (source.subGroups) {
            source.subGroups.forEach((subGroup) => this.convertGroup(subGroup, resultSubGroups));
        }
        const group = {
            name: source.name,
            id: source.id,
            configurable: source.configurable,
            groupType: this.convertGroupType(source.groupType ?? Configurator.GroupType.ATTRIBUTE_GROUP),
            description: source.description,
            attributes: resultAttributes,
            subGroups: resultSubGroups,
        };
        occGroups.push(group);
    }
    isRetractValue(attribute) {
        return attribute.selectedSingleValue === Configurator.RetractValueCode;
    }
    getRetractedValue(attribute) {
        return attribute.values?.find((value) => value.selected)?.valueCode;
    }
    retractValue(attribute, targetAttribute) {
        if (!this.isRetractValue(attribute)) {
            targetAttribute.value = attribute.selectedSingleValue;
        }
        else {
            targetAttribute.value = this.getRetractedValue(attribute);
            targetAttribute.retractTriggered = true;
        }
    }
    convertAttribute(attribute, occAttributes) {
        const targetAttribute = {
            key: attribute.name,
            name: attribute.name,
            langDepName: attribute.label,
            required: attribute.required,
            retractTriggered: attribute.retractTriggered,
            type: this.convertCharacteristicType(attribute.uiType ?? Configurator.UiType.NOT_IMPLEMENTED),
        };
        if (attribute.uiType === Configurator.UiType.DROPDOWN ||
            attribute.uiType === Configurator.UiType.DROPDOWN_ADDITIONAL_INPUT ||
            attribute.uiType === Configurator.UiType.RADIOBUTTON ||
            attribute.uiType === Configurator.UiType.RADIOBUTTON_ADDITIONAL_INPUT ||
            attribute.uiType === Configurator.UiType.SINGLE_SELECTION_IMAGE) {
            this.retractValue(attribute, targetAttribute);
        }
        else if (attribute.uiType === Configurator.UiType.STRING) {
            targetAttribute.value = attribute.userInput;
        }
        else if (attribute.uiType === Configurator.UiType.NUMERIC) {
            targetAttribute.formattedValue = attribute.userInput;
        }
        else if (attribute.uiType === Configurator.UiType.CHECKBOXLIST ||
            attribute.uiType === Configurator.UiType.CHECKBOX ||
            attribute.uiType === Configurator.UiType.MULTI_SELECTION_IMAGE) {
            const domainValues = [];
            if (attribute.values) {
                attribute.values.forEach((value) => {
                    this.convertValue(value, domainValues);
                });
            }
            targetAttribute.domainValues = domainValues;
        }
        occAttributes.push(targetAttribute);
    }
    convertValue(value, values) {
        values.push({
            key: value.valueCode,
            langDepName: value.valueDisplay,
            name: value.name,
            selected: value.selected,
        });
    }
    convertCharacteristicType(type) {
        let uiType;
        switch (type) {
            case Configurator.UiType.RADIOBUTTON: {
                uiType = OccConfigurator.UiType.RADIO_BUTTON;
                break;
            }
            case Configurator.UiType.RADIOBUTTON_ADDITIONAL_INPUT: {
                uiType = OccConfigurator.UiType.RADIO_BUTTON_ADDITIONAL_INPUT;
                break;
            }
            case Configurator.UiType.DROPDOWN: {
                uiType = OccConfigurator.UiType.DROPDOWN;
                break;
            }
            case Configurator.UiType.DROPDOWN_ADDITIONAL_INPUT: {
                uiType = OccConfigurator.UiType.DROPDOWN_ADDITIONAL_INPUT;
                break;
            }
            case Configurator.UiType.STRING: {
                uiType = OccConfigurator.UiType.STRING;
                break;
            }
            case Configurator.UiType.NUMERIC: {
                uiType = OccConfigurator.UiType.NUMERIC;
                break;
            }
            case Configurator.UiType.CHECKBOX: {
                uiType = OccConfigurator.UiType.CHECK_BOX;
                break;
            }
            case Configurator.UiType.CHECKBOXLIST: {
                uiType = OccConfigurator.UiType.CHECK_BOX_LIST;
                break;
            }
            case Configurator.UiType.MULTI_SELECTION_IMAGE: {
                uiType = OccConfigurator.UiType.MULTI_SELECTION_IMAGE;
                break;
            }
            case Configurator.UiType.SINGLE_SELECTION_IMAGE: {
                uiType = OccConfigurator.UiType.SINGLE_SELECTION_IMAGE;
                break;
            }
            default: {
                uiType = OccConfigurator.UiType.NOT_IMPLEMENTED;
            }
        }
        return uiType;
    }
    convertGroupType(groupType) {
        switch (groupType) {
            case Configurator.GroupType.ATTRIBUTE_GROUP:
                return OccConfigurator.GroupType.CSTIC_GROUP;
            case Configurator.GroupType.SUB_ITEM_GROUP:
                return OccConfigurator.GroupType.INSTANCE;
            case Configurator.GroupType.CONFLICT_GROUP:
                return OccConfigurator.GroupType.CONFLICT;
            case Configurator.GroupType.CONFLICT_HEADER_GROUP:
                return OccConfigurator.GroupType.CONFLICT_HEADER;
        }
    }
}
/**
 * @deprecated since 6.2
 */
OccConfiguratorVariantSerializer.RETRACT_VALUE_CODE = '###RETRACT_VALUE_CODE###';
OccConfiguratorVariantSerializer.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: OccConfiguratorVariantSerializer, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
OccConfiguratorVariantSerializer.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: OccConfiguratorVariantSerializer, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: OccConfiguratorVariantSerializer, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2NjLWNvbmZpZ3VyYXRvci12YXJpYW50LXNlcmlhbGl6ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcHJvZHVjdC1jb25maWd1cmF0b3IvcnVsZWJhc2VkL29jYy92YXJpYW50L2NvbnZlcnRlcnMvb2NjLWNvbmZpZ3VyYXRvci12YXJpYW50LXNlcmlhbGl6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQzs7QUFHeEUsTUFBTSxPQUFPLGdDQUFnQztJQVMzQyxPQUFPLENBQ0wsTUFBa0MsRUFDbEMsTUFBc0M7UUFFdEMsTUFBTSxZQUFZLEdBQTRCLEVBQUUsQ0FBQztRQUNqRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUV6RSxNQUFNLFlBQVksR0FBa0M7WUFDbEQsR0FBRyxNQUFNO1lBQ1QsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRO1lBQ3pCLFdBQVcsRUFBRSxNQUFNLENBQUMsV0FBVztZQUMvQixRQUFRLEVBQUUsTUFBTSxDQUFDLFFBQVE7WUFDekIsTUFBTSxFQUFFLFlBQVk7U0FDckIsQ0FBQztRQUVGLE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFFRCxZQUFZLENBQUMsTUFBMEIsRUFBRSxTQUFrQztRQUN6RSxNQUFNLGVBQWUsR0FBNEIsRUFBRSxDQUFDO1FBQ3BELE1BQU0sZ0JBQWdCLEdBQWdDLEVBQUUsQ0FBQztRQUV6RCxJQUFJLE1BQU0sQ0FBQyxVQUFVLEVB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cUJBQXFCLENBQUMsQ0FBQztnQkFDOUMsTUFBTSxHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUM7Z0JBQ3RELE1BQU07YUFDUDtZQUNELEtBQUssWUFBWSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2dCQUMvQyxNQUFNLEdBQUcsZUFBZSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQztnQkFDdkQsTUFBTTthQUNQO1lBQ0QsT0FBTyxDQUFDLENBQUM7Z0JBQ1AsTUFBTSxHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDO2FBQ2pEO1NBQ0Y7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQsZ0JBQWdCLENBQ2QsU0FBaUM7UUFFakMsUUFBUSxTQUFTLEVBQUU7WUFDakIsS0FBSyxZQUFZLENBQUMsU0FBUyxDQUFDLGVBQWU7Z0JBQ3pDLE9BQU8sZUFBZSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUM7WUFDL0MsS0FBSyxZQUFZLENBQUMsU0FBUyxDQUFDLGNBQWM7Z0JBQ3hDLE9BQU8sZUFBZSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUM7WUFDNUMsS0FBSyxZQUFZLENBQUMsU0FBUyxDQUFDLGNBQWM7Z0JBQ3hDLE9BQU8sZUFBZSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUM7WUFDNUMsS0FBSyxZQUFZLENBQUMsU0FBUyxDQUFDLHFCQUFxQjtnQkFDL0MsT0FBTyxlQUFlLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQztTQUNwRDtJQUNILENBQUM7O0FBL0xEOztHQUVHO0FBQ2EsbURBQWtCLEdBQUcsMEJBQTBCLENBQUM7NkhBUHJELGdDQUFnQztpSUFBaEMsZ0NBQWdDLGNBRG5CLE1BQU07MkZBQ25CLGdDQUFnQztrQkFENUMsVUFBVTttQkFBQyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMyBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb252ZXJ0ZXIgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgT2NjQ29uZmlndXJhdG9yIH0gZnJvbSAnLi4vdmFyaWFudC1jb25maWd1cmF0b3Itb2NjLm1vZGVscyc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3IgfSBmcm9tICcuLy4uLy4uLy4uL2NvcmUvbW9kZWwvY29uZmlndXJhdG9yLm1vZGVsJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBPY2NDb25maWd1cmF0b3JWYXJpYW50U2VyaWFsaXplclxuICBpbXBsZW1lbnRzXG4gICAgQ29udmVydGVyPENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uLCBPY2NDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbj5cbntcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkIHNpbmNlIDYuMlxuICAgKi9cbiAgc3RhdGljIHJlYWRvbmx5IFJFVFJBQ1RfVkFMVUVfQ09ERSA9ICcjIyNSRVRSQUNUX1ZBTFVFX0NPREUjIyMnO1xuXG4gIGNvbnZlcnQoXG4gICAgc291cmNlOiBDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbixcbiAgICB0YXJnZXQ/OiBPY2NDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvblxuICApOiBPY2NDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbiB7XG4gICAgY29uc3QgcmVzdWx0R3JvdXBzOiBPY2NDb25maWd1cmF0b3IuR3JvdXBbXSA9IFtdO1xuICAgIHNvdXJjZS5ncm91cHMuZm9yRWFjaCgoZ3JvdXApID0+IHRoaXMuY29udmVydEdyb3VwKGdyb3VwLCByZXN1bHRHcm91cHMpKTtcblxuICAgIGNvbnN0IHJlc3VsdFRhcmdldDogT2NjQ29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAuLi50YXJnZXQsXG4gICAgICBjb25maWdJZDogc291cmNlLmNvbmZpZ0lkLFxuICAgICAgcm9vdFByb2R1Y3Q6IHNvdXJjZS5wcm9kdWN0Q29kZSxcbiAgICAgIGNvbXBsZXRlOiBzb3VyY2UuY29tcGxldGUsXG4gICAgICBncm91cHM6IHJlc3VsdEdyb3VwcyxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHJlc3VsdFRhcmdldDtcbiAgfVxuXG4gIGNvbnZlcnRHcm91cChzb3VyY2U6IENvbmZpZ3VyYXRvci5Hcm91cCwgb2NjR3JvdXBzOiBPY2NDb25maWd1cmF0b3IuR3JvdXBbXSkge1xuICAgIGNvbnN0IHJlc3VsdFN1Ykdyb3VwczogT2NjQ29uZmlndXJhdG9yLkdyb3VwW10gPSBbXTtcbiAgICBjb25zdCByZXN1bHRBdHRyaWJ1dGVzOiBPY2NDb25maWd1cmF0b3IuQXR0cmlidXRlW10gPSBbXTtcblxuICAgIGlmIChzb3VyY2UuYXR0cmlidXRlcykge1xuICAgICAgc291cmNlLmF0dHJpYnV0ZXMuZm9yRWFjaCgoYXR0cmlidXRlKSA9PlxuICAgICAgICB0aGlzLmNvbnZlcnRBdHRyaWJ1dGUoYXR0cmlidXRlLCByZXN1bHRBdHRyaWJ1dGVzKVxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKHNvdXJjZS5zdWJHcm91cHMpIHtcbiAgICAgIHNvdXJjZS5zdWJHcm91cHMuZm9yRWFjaCgoc3ViR3JvdXApID0+XG4gICAgICAgIHRoaXMuY29udmVydEdyb3VwKHN1Ykdyb3VwLCByZXN1bHRTdWJHcm91cHMpXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGdyb3VwOiBPY2NDb25maWd1cmF0b3IuR3JvdXAgPSB7XG4gICAgICBuYW1lOiBzb3VyY2UubmFtZSxcbiAgICAgIGlkOiBzb3VyY2UuaWQsXG4gICAgICBjb25maWd1cmFibGU6IHNvdXJjZS5jb25maWd1cmFibGUsXG4gICAgICBncm91cFR5cGU6IHRoaXMuY29udmVydEdyb3VwVHlwZShcbiAgICAgICAgc291cmNlLmdyb3VwVHlwZSA/PyBDb25maWd1cmF0b3IuR3JvdXBUeXBlLkFUVFJJQlVURV9HUk9VUFxuICAgICAgKSxcbiAgICAgIGRlc2NyaXB0aW9uOiBzb3VyY2UuZGVzY3JpcHRpb24sXG4gICAgICBhdHRyaWJ1dGVzOiByZXN1bHRBdHRyaWJ1dGVzLFxuICAgICAgc3ViR3JvdXBzOiByZXN1bHRTdWJHcm91cHMsXG4gICAgfTtcblxuICAgIG9jY0dyb3Vwcy5wdXNoKGdyb3VwKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBpc1JldHJhY3RWYWx1ZShhdHRyaWJ1dGU6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gYXR0cmlidXRlLnNlbGVjdGVkU2luZ2xlVmFsdWUgPT09IENvbmZpZ3VyYXRvci5SZXRyYWN0VmFsdWVDb2RlO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFJldHJhY3RlZFZhbHVlKFxuICAgIGF0dHJpYnV0ZTogQ29uZmlndXJhdG9yLkF0dHJpYnV0ZVxuICApOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBhdHRyaWJ1dGUudmFsdWVzPy5maW5kKCh2YWx1ZSkgPT4gdmFsdWUuc2VsZWN0ZWQpPy52YWx1ZUNvZGU7XG4gIH1cblxuICBwcm90ZWN0ZWQgcmV0cmFjdFZhbHVlKFxuICAgIGF0dHJpYnV0ZTogQ29uZmlndXJhdG9yLkF0dHJpYnV0ZSxcbiAgICB0YXJnZXRBdHRyaWJ1dGU6IE9jY0NvbmZpZ3VyYXRvci5BdHRyaWJ1dGVcbiAgKSB7XG4gICAgaWYgKCF0aGlzLmlzUmV0cmFjdFZhbHVlKGF0dHJpYnV0ZSkpIHtcbiAgICAgIHRhcmdldEF0dHJpYnV0ZS52YWx1ZSA9IGF0dHJpYnV0ZS5zZWxlY3RlZFNpbmdsZVZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0YXJnZXRBdHRyaWJ1dGUudmFsdWUgPSB0aGlzLmdldFJldHJhY3RlZFZhbHVlKGF0dHJpYnV0ZSk7XG4gICAgICB0YXJnZXRBdHRyaWJ1dGUucmV0cmFjdFRyaWdnZXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgY29udmVydEF0dHJpYnV0ZShcbiAgICBhdHRyaWJ1dGU6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGUsXG4gICAgb2NjQXR0cmlidXRlczogT2NjQ29uZmlndXJhdG9yLkF0dHJpYnV0ZVtdXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IHRhcmdldEF0dHJpYnV0ZTogT2NjQ29uZmlndXJhdG9yLkF0dHJpYnV0ZSA9IHtcbiAgICAgIGtleTogYXR0cmlidXRlLm5hbWUsXG4gICAgICBuYW1lOiBhdHRyaWJ1dGUubmFtZSxcbiAgICAgIGxhbmdEZXBOYW1lOiBhdHRyaWJ1dGUubGFiZWwsXG4gICAgICByZXF1aXJlZDogYXR0cmlidXRlLnJlcXVpcmVkLFxuICAgICAgcmV0cmFjdFRyaWdnZXJlZDogYXR0cmlidXRlLnJldHJhY3RUcmlnZ2VyZWQsXG4gICAgICB0eXBlOiB0aGlzLmNvbnZlcnRDaGFyYWN0ZXJpc3RpY1R5cGUoXG4gICAgICAgIGF0dHJpYnV0ZS51aVR5cGUgPz8gQ29uZmlndXJhdG9yLlVpVHlwZS5OT1RfSU1QTEVNRU5URURcbiAgICAgICksXG4gICAgfTtcblxuICAgIGlmIChcbiAgICAgIGF0dHJpYnV0ZS51aVR5cGUgPT09IENvbmZpZ3VyYXRvci5VaVR5cGUuRFJPUERPV04gfHxcbiAgICAgIGF0dHJpYnV0ZS51aVR5cGUgPT09IENvbmZpZ3VyYXRvci5VaVR5cGUuRFJPUERPV05fQURESVRJT05BTF9JTlBVVCB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5SQURJT0JVVFRPTiB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5SQURJT0JVVFRPTl9BRERJVElPTkFMX0lOUFVUIHx8XG4gICAgICBhdHRyaWJ1dGUudWlUeXBlID09PSBDb25maWd1cmF0b3IuVWlUeXBlLlNJTkdMRV9TRUxFQ1RJT05fSU1BR0VcbiAgICApIHtcbiAgICAgIHRoaXMucmV0cmFjdFZhbHVlKGF0dHJpYnV0ZSwgdGFyZ2V0QXR0cmlidXRlKTtcbiAgICB9IGVsc2UgaWYgKGF0dHJpYnV0ZS51aVR5cGUgPT09IENvbmZpZ3VyYXRvci5VaVR5cGUuU1RSSU5HKSB7XG4gICAgICB0YXJnZXRBdHRyaWJ1dGUudmFsdWUgPSBhdHRyaWJ1dGUudXNlcklucHV0O1xuICAgIH0gZWxzZSBpZiAoYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5OVU1FUklDKSB7XG4gICAgICB0YXJnZXRBdHRyaWJ1dGUuZm9ybWF0dGVkVmFsdWUgPSBhdHRyaWJ1dGUudXNlcklucHV0O1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBhdHRyaWJ1dGUudWlUeXBlID09PSBDb25maWd1cmF0b3IuVWlUeXBlLkNIRUNLQk9YTElTVCB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5DSEVDS0JPWCB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5NVUxUSV9TRUxFQ1RJT05fSU1BR0VcbiAgICApIHtcbiAgICAgIGNvbnN0IGRvbWFpblZhbHVlczogT2NjQ29uZmlndXJhdG9yLlZhbHVlW10gPSBbXTtcbiAgICAgIGlmIChhdHRyaWJ1dGUudmFsdWVzKSB7XG4gICAgICAgIGF0dHJpYnV0ZS52YWx1ZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLmNvbnZlcnRWYWx1ZSh2YWx1ZSwgZG9tYWluVmFsdWVzKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0YXJnZXRBdHRyaWJ1dGUuZG9tYWluVmFsdWVzID0gZG9tYWluVmFsdWVzO1xuICAgIH1cblxuICAgIG9jY0F0dHJpYnV0ZXMucHVzaCh0YXJnZXRBdHRyaWJ1dGUpO1xuICB9XG5cbiAgY29udmVydFZhbHVlKHZhbHVlOiBDb25maWd1cmF0b3IuVmFsdWUsIHZhbHVlczogT2NjQ29uZmlndXJhdG9yLlZhbHVlW10pIHtcbiAgICB2YWx1ZXMucHVzaCh7XG4gICAgICBrZXk6IHZhbHVlLnZhbHVlQ29kZSxcbiAgICAgIGxhbmdEZXBOYW1lOiB2YWx1ZS52YWx1ZURpc3BsYXksXG4gICAgICBuYW1lOiB2YWx1ZS5uYW1lLFxuICAgICAgc2VsZWN0ZWQ6IHZhbHVlLnNlbGVjdGVkLFxuICAgIH0pO1xuICB9XG5cbiAgY29udmVydENoYXJhY3RlcmlzdGljVHlwZSh0eXBlOiBDb25maWd1cmF0b3IuVWlUeXBlKTogT2NjQ29uZmlndXJhdG9yLlVpVHlwZSB7XG4gICAgbGV0IHVpVHlwZTogT2NjQ29uZmlndXJhdG9yLlVpVHlwZTtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgQ29uZmlndXJhdG9yLlVpVHlwZS5SQURJT0JVVFRPTjoge1xuICAgICAgICB1aVR5cGUgPSBPY2NDb25maWd1cmF0b3IuVWlUeXBlLlJBRElPX0JVVFRPTjtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIENvbmZpZ3VyYXRvci5VaVR5cGUuUkFESU9CVVRUT05fQURESVRJT05BTF9JTlBVVDoge1xuICAgICAgICB1aVR5cGUgPSBPY2NDb25maWd1cmF0b3IuVWlUeXBlLlJBRElPX0JVVFRPTl9BRERJVElPTkFMX0lOUFVUO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgQ29uZmlndXJhdG9yLlVpVHlwZS5EUk9QRE9XTjoge1xuICAgICAgICB1aVR5cGUgPSBPY2NDb25maWd1cmF0b3IuVWlUeXBlLkRST1BET1dOO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgQ29uZmlndXJhdG9yLlVpVHlwZS5EUk9QRE9XTl9BRERJVElPTkFMX0lOUFVUOiB7XG4gICAgICAgIHVpVHlwZSA9IE9jY0NvbmZpZ3VyYXRvci5VaVR5cGUuRFJPUERPV05fQURESVRJT05BTF9JTlBVVDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIENvbmZpZ3VyYXRvci5VaVR5cGUuU1RSSU5HOiB7XG4gICAgICAgIHVpVHlwZSA9IE9jY0NvbmZpZ3VyYXRvci5VaVR5cGUuU1RSSU5HO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgQ29uZmlndXJhdG9yLlVpVHlwZS5OVU1FUklDOiB7XG4gICAgICAgIHVpVHlwZSA9IE9jY0NvbmZpZ3VyYXRvci5VaVR5cGUuTlVNRVJJQztcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIENvbmZpZ3VyYXRvci5VaVR5cGUuQ0hFQ0tCT1g6IHtcbiAgICAgICAgdWlUeXBlID0gT2NjQ29uZmlndXJhdG9yLlVpVHlwZS5DSEVDS19CT1g7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBDb25maWd1cmF0b3IuVWlUeXBlLkNIRUNLQk9YTElTVDoge1xuICAgICAgICB1aVR5cGUgPSBPY2NDb25maWd1cmF0b3IuVWlUeXBlLkNIRUNLX0JPWF9MSVNUO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgQ29uZmlndXJhdG9yLlVpVHlwZS5NVUxUSV9TRUxFQ1RJT05fSU1BR0U6IHtcbiAgICAgICAgdWlUeXBlID0gT2NjQ29uZmlndXJhdG9yLlVpVHlwZS5NVUxUSV9TRUxFQ1RJT05fSU1BR0U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBDb25maWd1cmF0b3IuVWlUeXBlLlNJTkdMRV9TRUxFQ1RJT05fSU1BR0U6IHtcbiAgICAgICAgdWlUeXBlID0gT2NjQ29uZmlndXJhdG9yLlVpVHlwZS5TSU5HTEVfU0VMRUNUSU9OX0lNQUdFO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdWlUeXBlID0gT2NjQ29uZmlndXJhdG9yLlVpVHlwZS5OT1RfSU1QTEVNRU5URUQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1aVR5cGU7XG4gIH1cblxuICBjb252ZXJ0R3JvdXBUeXBlKFxuICAgIGdyb3VwVHlwZTogQ29uZmlndXJhdG9yLkdyb3VwVHlwZVxuICApOiBPY2NDb25maWd1cmF0b3IuR3JvdXBUeXBlIHtcbiAgICBzd2l0Y2ggKGdyb3VwVHlwZSkge1xuICAgICAgY2FzZSBDb25maWd1cmF0b3IuR3JvdXBUeXBlLkFUVFJJQlVURV9HUk9VUDpcbiAgICAgICAgcmV0dXJuIE9jY0NvbmZpZ3VyYXRvci5Hcm91cFR5cGUuQ1NUSUNfR1JPVVA7XG4gICAgICBjYXNlIENvbmZpZ3VyYXRvci5Hcm91cFR5cGUuU1VCX0lURU1fR1JPVVA6XG4gICAgICAgIHJldHVybiBPY2NDb25maWd1cmF0b3IuR3JvdXBUeXBlLklOU1RBTkNFO1xuICAgICAgY2FzZSBDb25maWd1cmF0b3IuR3JvdXBUeXBlLkNPTkZMSUNUX0dST1VQOlxuICAgICAgICByZXR1cm4gT2NjQ29uZmlndXJhdG9yLkdyb3VwVHlwZS5DT05GTElDVDtcbiAgICAgIGNhc2UgQ29uZmlndXJhdG9yLkdyb3VwVHlwZS5DT05GTElDVF9IRUFERVJfR1JPVVA6XG4gICAgICAgIHJldHVybiBPY2NDb25maWd1cmF0b3IuR3JvdXBUeXBlLkNPTkZMSUNUX0hFQURFUjtcbiAgICB9XG4gIH1cbn1cbiJdfQ==