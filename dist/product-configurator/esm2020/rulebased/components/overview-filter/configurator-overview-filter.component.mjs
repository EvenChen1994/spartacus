/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Component, Input } from '@angular/core';
import { UntypedFormControl } from '@angular/forms';
import { Configurator } from '../../core/model/configurator.model';
import * as i0 from "@angular/core";
import * as i1 from "../../core/facade/configurator-commons.service";
import * as i2 from "@angular/common";
import * as i3 from "@angular/forms";
import * as i4 from "../overview-filter-bar/configurator-overview-filter-bar.component";
import * as i5 from "@spartacus/core";
export class ConfiguratorOverviewFilterComponent {
    constructor(configuratorCommonsService) {
        this.configuratorCommonsService = configuratorCommonsService;
        this.showFilterBar = true;
        this.priceFilter = new UntypedFormControl('');
        this.mySelectionsFilter = new UntypedFormControl('');
        this.groupFilters = new Array();
    }
    ngOnChanges() {
        this.extractAttrFilterState(this.config);
        this.extractGroupFilterState(this.config);
    }
    /**
     * Updates the overview based on the filters currently selected in the UI
     *
     * @param {Configurator.ConfigurationWithOverview} config - current configuration with overview data
     */
    onFilter(config) {
        const inputConfig = this.createInputConfig(config, this.collectAttrFilters(), this.collectGroupFilters(config.overview));
        this.configuratorCommonsService.updateConfigurationOverview(inputConfig);
    }
    extractGroupFilterState(configuration) {
        this.groupFilters = [];
        configuration.overview.possibleGroups?.forEach((group) => {
            let isSelected = false;
            if (configuration.overview.groupFilters) {
                isSelected = configuration.overview.groupFilters.indexOf(group.id) >= 0;
            }
            this.groupFilters.push(new UntypedFormControl(isSelected));
        });
    }
    extractAttrFilterState(configuration) {
        if (configuration.overview.attributeFilters) {
            const isPriceFilterSelected = configuration.overview.attributeFilters.indexOf(Configurator.OverviewFilter.PRICE_RELEVANT) >= 0;
            this.priceFilter.setValue(isPriceFilterSelected);
            const isMySelectionsFilterSelected = configuration.overview.attributeFilters.indexOf(Configurator.OverviewFilter.USER_INPUT) >= 0;
            this.mySelectionsFilter.setValue(isMySelectionsFilterSelected);
        }
    }
    collectGroupFilters(overview) {
        const filters = [];
        let idx = 0;
        this.groupFilters.forEach((groupFilter) => {
            if (groupFilter.value && overview?.possibleGroups) {
                filters.push(overview.possibleGroups[idx].id);
            }
            idx++;
        });
        return filters;
    }
    collectAttrFilters() {
        const filters = [];
        if (this.priceFilter.value) {
            filters.push(Configurator.OverviewFilter.PRICE_RELEVANT);
        }
        if (this.mySelectionsFilter.value) {
            filters.push(Configurator.OverviewFilter.USER_INPUT);
        }
        return filters;
    }
    createInputConfig(config, attrFilters, groupFilers) {
        return {
            ...config,
            overview: {
                configId: config.configId,
                productCode: config.productCode,
                attributeFilters: attrFilters,
                groupFilters: groupFilers,
                possibleGroups: config.overview?.possibleGroups,
            },
        };
    }
}
ConfiguratorOverviewFilterComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorOverviewFilterComponent, deps: [{ token: i1.ConfiguratorCommonsService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorOverviewFilterComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorOverviewFilterComponent, selector: "cx-configurator-overview-filter", inputs: { showFilterBar: "showFilterBar", config: "config" }, usesOnChanges: true, ngImport: i0, template: "<ng-container *ngIf=\"showFilterBar\">\n  <cx-configurator-overview-filter-bar\n    [config]=\"config\"\n  ></cx-configurator-overview-filter-bar>\n</ng-container>\n<div class=\"cx-overview-filter-header\">\n  {{ 'configurator.overviewFilter.byOption' | cxTranslate }}\n</div>\n\n<div class=\"cx-overview-filter-option\">\n  <div class=\"form-check\">\n    <input\n      id=\"cx-configurator-overview-filter-option-price\"\n      type=\"checkbox\"\n      class=\"form-check-input\"\n      [formControl]=\"priceFilter\"\n      (change)=\"onFilter(config)\"\n      name=\"config-overview-price-filter\"\n      [attr.aria-label]=\"\n        'configurator.a11y.filterOverviewByPrice' | cxTranslate\n      \"\n    />\n    <label\n      class=\"form-check-label\"\n      for=\"cx-configurator-overview-filter-option-price\"\n    >\n      {{ 'configurator.overviewFilter.byPrice' | cxTranslate }}</label\n    >\n  </div>\n</div>\n\n<div class=\"cx-overview-filter-option\">\n  <div class=\"form-check\">\n    <input\n      id=\"cx-configurator-overview-filter-option-mySelections\"\n      type=\"checkbox\"\n      class=\"form-check-input\"\n      [formControl]=\"mySelectionsFilter\"\n      (change)=\"onFilter(config)\"\n      name=\"config-overview-my-selection-filter\"\n      [attr.aria-label]=\"\n        'configurator.a11y.filterOverviewByMySelections' | cxTranslate\n      \"\n    />\n    <label\n      class=\"form-check-label\"\n      for=\"cx-configurator-overview-filter-option-mySelections\"\n    >\n      {{ 'configurator.overviewFilter.mySelections' | cxTranslate }}</label\n    >\n  </div>\n</div>\n<ng-container *ngIf=\"config.overview.possibleGroups\">\n  <div class=\"cx-overview-filter-header\">\n    {{ 'configurator.overviewFilter.byGroup' | cxTranslate }}\n  </div>\n  <ng-container\n    *ngFor=\"let group of config.overview.possibleGroups; let i = index\"\n  >\n    <div class=\"cx-overview-filter-option\">\n      <div class=\"form-check\">\n        <input\n          id=\"{{ 'cx-configurator-overview-filter-option-group-' + group.id }}\"\n          type=\"checkbox\"\n          class=\"form-check-input\"\n          [formControl]=\"groupFilters[i]\"\n          (change)=\"onFilter(config)\"\n          name=\"{{ 'config-overview-group-filter-' + group.id }}\"\n          [attr.aria-label]=\"\n            'configurator.a11y.filterOverviewByGroup'\n              | cxTranslate: { groupName: group.groupDescription }\n          \"\n        />\n        <label\n          class=\"form-check-label\"\n          for=\"{{ 'cx-configurator-overview-filter-option-group-' + group.id }}\"\n          >{{ group.groupDescription }}</label\n        >\n      </div>\n    </div>\n  </ng-container>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "component", type: i4.ConfiguratorOverviewFilterBarComponent, selector: "cx-configurator-overview-filter-bar", inputs: ["config"] }, { kind: "pipe", type: i5.TranslatePipe, name: "cxTranslate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorOverviewFilterComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-overview-filter', template: "<ng-container *ngIf=\"showFilterBar\">\n  <cx-configurator-overview-filter-bar\n    [config]=\"config\"\n  ></cx-configurator-overview-filter-bar>\n</ng-container>\n<div class=\"cx-overview-filter-header\">\n  {{ 'configurator.overviewFilter.byOption' | cxTranslate }}\n</div>\n\n<div class=\"cx-overview-filter-option\">\n  <div class=\"form-check\">\n    <input\n      id=\"cx-configurator-overview-filter-option-price\"\n      type=\"checkbox\"\n      class=\"form-check-input\"\n      [formControl]=\"priceFilter\"\n      (change)=\"onFilter(config)\"\n      name=\"config-overview-price-filter\"\n      [attr.aria-label]=\"\n        'configurator.a11y.filterOverviewByPrice' | cxTranslate\n      \"\n    />\n    <label\n      class=\"form-check-label\"\n      for=\"cx-configurator-overview-filter-option-price\"\n    >\n      {{ 'configurator.overviewFilter.byPrice' | cxTranslate }}</label\n    >\n  </div>\n</div>\n\n<div class=\"cx-overview-filter-option\">\n  <div class=\"form-check\">\n    <input\n      id=\"cx-configurator-overview-filter-option-mySelections\"\n      type=\"checkbox\"\n      class=\"form-check-input\"\n      [formControl]=\"mySelectionsFilter\"\n      (change)=\"onFilter(config)\"\n      name=\"config-overview-my-selection-filter\"\n      [attr.aria-label]=\"\n        'configurator.a11y.filterOverviewByMySelections' | cxTranslate\n      \"\n    />\n    <label\n      class=\"form-check-label\"\n      for=\"cx-configurator-overview-filter-option-mySelections\"\n    >\n      {{ 'configurator.overviewFilter.mySelections' | cxTranslate }}</label\n    >\n  </div>\n</div>\n<ng-container *ngIf=\"config.overview.possibleGroups\">\n  <div class=\"cx-overview-filter-header\">\n    {{ 'configurator.overviewFilter.byGroup' | cxTranslate }}\n  </div>\n  <ng-container\n    *ngFor=\"let group of config.overview.possibleGroups; let i = index\"\n  >\n    <div class=\"cx-overview-filter-option\">\n      <div class=\"form-check\">\n        <input\n          id=\"{{ 'cx-configurator-overview-filter-option-group-' + group.id }}\"\n          type=\"checkbox\"\n          class=\"form-check-input\"\n          [formControl]=\"groupFilters[i]\"\n          (change)=\"onFilter(config)\"\n          name=\"{{ 'config-overview-group-filter-' + group.id }}\"\n          [attr.aria-label]=\"\n            'configurator.a11y.filterOverviewByGroup'\n              | cxTranslate: { groupName: group.groupDescription }\n          \"\n        />\n        <label\n          class=\"form-check-label\"\n          for=\"{{ 'cx-configurator-overview-filter-option-group-' + group.id }}\"\n          >{{ group.groupDescription }}</label\n        >\n      </div>\n    </div>\n  </ng-container>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorCommonsService }]; }, propDecorators: { showFilterBar: [{
                type: Input
            }], config: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcHJvZHVjdC1jb25maWd1cmF0b3IvcnVsZWJhc2VkL2NvbXBvbmVudHMvb3ZlcnZpZXctZmlsdGVyL2NvbmZpZ3VyYXRvci1vdmVydmlldy1maWx0ZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL292ZXJ2aWV3LWZpbHRlci9jb25maWd1cmF0b3Itb3ZlcnZpZXctZmlsdGVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUM1RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUNBQXFDLENBQUM7Ozs7Ozs7QUFNbkUsTUFBTSxPQUFPLG1DQUFtQztJQUM5QyxZQUNZLDBCQUFzRDtRQUF0RCwrQkFBMEIsR0FBMUIsMEJBQTBCLENBQTRCO1FBR3pELGtCQUFhLEdBQVksSUFBSSxDQUFDO1FBR3ZDLGdCQUFXLEdBQUcsSUFBSSxrQkFBa0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN6Qyx1QkFBa0IsR0FBRyxJQUFJLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2hELGlCQUFZLEdBQUcsSUFBSSxLQUFLLEVBQXNCLENBQUM7SUFQNUMsQ0FBQztJQVNKLFdBQVc7UUFDVCxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENB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QUFFLE1BQU0sQ0FBQyxRQUFRO2dCQUN6QixXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVc7Z0JBQy9CLGdCQUFnQixFQUFFLFdBQVc7Z0JBQzdCLFlBQVksRUFBRSxXQUFXO2dCQUN6QixjQUFjLEVBQUUsTUFBTSxDQUFDLFFBQVEsRUFBRSxjQUFjO2FBQ2hEO1NBQ0YsQ0FBQztJQUNKLENBQUM7O2dJQXBHVSxtQ0FBbUM7b0hBQW5DLG1DQUFtQywwSkNmaEQsb3FGQWtGQTsyRkRuRWEsbUNBQW1DO2tCQUovQyxTQUFTOytCQUNFLGlDQUFpQztpSEFRbEMsYUFBYTtzQkFBckIsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMyBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFVudHlwZWRGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9mYWNhZGUvY29uZmlndXJhdG9yLWNvbW1vbnMuc2VydmljZSc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3IgfSBmcm9tICcuLi8uLi9jb3JlL21vZGVsL2NvbmZpZ3VyYXRvci5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LWNvbmZpZ3VyYXRvci1vdmVydmlldy1maWx0ZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZpbHRlci5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIENvbmZpZ3VyYXRvck92ZXJ2aWV3RmlsdGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlOiBDb25maWd1cmF0b3JDb21tb25zU2VydmljZVxuICApIHt9XG5cbiAgQElucHV0KCkgc2hvd0ZpbHRlckJhcjogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIGNvbmZpZzogQ29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb25XaXRoT3ZlcnZpZXc7XG5cbiAgcHJpY2VGaWx0ZXIgPSBuZXcgVW50eXBlZEZvcm1Db250cm9sKCcnKTtcbiAgbXlTZWxlY3Rpb25zRmlsdGVyID0gbmV3IFVudHlwZWRGb3JtQ29udHJvbCgnJyk7XG4gIGdyb3VwRmlsdGVycyA9IG5ldyBBcnJheTxVbnR5cGVkRm9ybUNvbnRyb2w+KCk7XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgdGhpcy5leHRyYWN0QXR0ckZpbHRlclN0YXRlKHRoaXMuY29uZmlnKTtcbiAgICB0aGlzLmV4dHJhY3RHcm91cEZpbHRlclN0YXRlKHRoaXMuY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBvdmVydmlldyBiYXNlZCBvbiB0aGUgZmlsdGVycyBjdXJyZW50bHkgc2VsZWN0ZWQgaW4gdGhlIFVJXG4gICAqXG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb25XaXRoT3ZlcnZpZXd9IGNvbmZpZyAtIGN1cnJlbnQgY29uZmlndXJhdGlvbiB3aXRoIG92ZXJ2aWV3IGRhdGFcbiAgICovXG4gIG9uRmlsdGVyKGNvbmZpZzogQ29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb25XaXRoT3ZlcnZpZXcpIHtcbiAgICBjb25zdCBpbnB1dENvbmZpZyA9IHRoaXMuY3JlYXRlSW5wdXRDb25maWcoXG4gICAgICBjb25maWcsXG4gICAgICB0aGlzLmNvbGxlY3RBdHRyRmlsdGVycygpLFxuICAgICAgdGhpcy5jb2xsZWN0R3JvdXBGaWx0ZXJzKGNvbmZpZy5vdmVydmlldylcbiAgICApO1xuICAgIHRoaXMuY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2UudXBkYXRlQ29uZmlndXJhdGlvbk92ZXJ2aWV3KGlucHV0Q29uZmlnKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBleHRyYWN0R3JvdXBGaWx0ZXJTdGF0ZShcbiAgICBjb25maWd1cmF0aW9uOiBDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbldpdGhPdmVydmlld1xuICApIHtcbiAgICB0aGlzLmdyb3VwRmlsdGVycyA9IFtdO1xuICAgIGNvbmZpZ3VyYXRpb24ub3ZlcnZpZXcucG9zc2libGVHcm91cHM/LmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICBsZXQgaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgaWYgKGNvbmZpZ3VyYXRpb24ub3ZlcnZpZXcuZ3JvdXBGaWx0ZXJzKSB7XG4gICAgICAgIGlzU2VsZWN0ZWQgPSBjb25maWd1cmF0aW9uLm92ZXJ2aWV3Lmdyb3VwRmlsdGVycy5pbmRleE9mKGdyb3VwLmlkKSA+PSAwO1xuICAgICAgfVxuICAgICAgdGhpcy5ncm91cEZpbHRlcnMucHVzaChuZXcgVW50eXBlZEZvcm1Db250cm9sKGlzU2VsZWN0ZWQpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBleHRyYWN0QXR0ckZpbHRlclN0YXRlKFxuICAgIGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uV2l0aE92ZXJ2aWV3XG4gICkge1xuICAgIGlmIChjb25maWd1cmF0aW9uLm92ZXJ2aWV3LmF0dHJpYnV0ZUZpbHRlcnMpIHtcbiAgICAgIGNvbnN0IGlzUHJpY2VGaWx0ZXJTZWxlY3RlZCA9XG4gICAgICAgIGNvbmZpZ3VyYXRpb24ub3ZlcnZpZXcuYXR0cmlidXRlRmlsdGVycy5pbmRleE9mKFxuICAgICAgICAgIENvbmZpZ3VyYXRvci5PdmVydmlld0ZpbHRlci5QUklDRV9SRUxFVkFOVFxuICAgICAgICApID49IDA7XG4gICAgICB0aGlzLnByaWNlRmlsdGVyLnNldFZhbHVlKGlzUHJpY2VGaWx0ZXJTZWxlY3RlZCk7XG5cbiAgICAgIGNvbnN0IGlzTXlTZWxlY3Rpb25zRmlsdGVyU2VsZWN0ZWQgPVxuICAgICAgICBjb25maWd1cmF0aW9uLm92ZXJ2aWV3LmF0dHJpYnV0ZUZpbHRlcnMuaW5kZXhPZihcbiAgICAgICAgICBDb25maWd1cmF0b3IuT3ZlcnZpZXdGaWx0ZXIuVVNFUl9JTlBVVFxuICAgICAgICApID49IDA7XG4gICAgICB0aGlzLm15U2VsZWN0aW9uc0ZpbHRlci5zZXRWYWx1ZShpc015U2VsZWN0aW9uc0ZpbHRlclNlbGVjdGVkKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgY29sbGVjdEdyb3VwRmlsdGVycyhvdmVydmlldzogQ29uZmlndXJhdG9yLk92ZXJ2aWV3KTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGZpbHRlcnM6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IGlkeCA9IDA7XG4gICAgdGhpcy5ncm91cEZpbHRlcnMuZm9yRWFjaCgoZ3JvdXBGaWx0ZXIpID0+IHtcbiAgICAgIGlmIChncm91cEZpbHRlci52YWx1ZSAmJiBvdmVydmlldz8ucG9zc2libGVHcm91cHMpIHtcbiAgICAgICAgZmlsdGVycy5wdXNoKG92ZXJ2aWV3LnBvc3NpYmxlR3JvdXBzW2lkeF0uaWQpO1xuICAgICAgfVxuICAgICAgaWR4Kys7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZpbHRlcnM7XG4gIH1cblxuICBwcm90ZWN0ZWQgY29sbGVjdEF0dHJGaWx0ZXJzKCk6IENvbmZpZ3VyYXRvci5PdmVydmlld0ZpbHRlcltdIHtcbiAgICBjb25zdCBmaWx0ZXJzOiBDb25maWd1cmF0b3IuT3ZlcnZpZXdGaWx0ZXJbXSA9IFtdO1xuICAgIGlmICh0aGlzLnByaWNlRmlsdGVyLnZhbHVlKSB7XG4gICAgICBmaWx0ZXJzLnB1c2goQ29uZmlndXJhdG9yLk92ZXJ2aWV3RmlsdGVyLlBSSUNFX1JFTEVWQU5UKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubXlTZWxlY3Rpb25zRmlsdGVyLnZhbHVlKSB7XG4gICAgICBmaWx0ZXJzLnB1c2goQ29uZmlndXJhdG9yLk92ZXJ2aWV3RmlsdGVyLlVTRVJfSU5QVVQpO1xuICAgIH1cbiAgICByZXR1cm4gZmlsdGVycztcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVJbnB1dENvbmZpZyhcbiAgICBjb25maWc6IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uV2l0aE92ZXJ2aWV3LFxuICAgIGF0dHJGaWx0ZXJzOiBDb25maWd1cmF0b3IuT3ZlcnZpZXdGaWx0ZXJbXSxcbiAgICBncm91cEZpbGVyczogc3RyaW5nW11cbiAgKTogQ29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb25XaXRoT3ZlcnZpZXcge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBvdmVydmlldzoge1xuICAgICAgICBjb25maWdJZDogY29uZmlnLmNvbmZpZ0lkLFxuICAgICAgICBwcm9kdWN0Q29kZTogY29uZmlnLnByb2R1Y3RDb2RlLFxuICAgICAgICBhdHRyaWJ1dGVGaWx0ZXJzOiBhdHRyRmlsdGVycyxcbiAgICAgICAgZ3JvdXBGaWx0ZXJzOiBncm91cEZpbGVycyxcbiAgICAgICAgcG9zc2libGVHcm91cHM6IGNvbmZpZy5vdmVydmlldz8ucG9zc2libGVHcm91cHMsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXIgKm5nSWY9XCJzaG93RmlsdGVyQmFyXCI+XG4gIDxjeC1jb25maWd1cmF0b3Itb3ZlcnZpZXctZmlsdGVyLWJhclxuICAgIFtjb25maWddPVwiY29uZmlnXCJcbiAgPjwvY3gtY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZpbHRlci1iYXI+XG48L25nLWNvbnRhaW5lcj5cbjxkaXYgY2xhc3M9XCJjeC1vdmVydmlldy1maWx0ZXItaGVhZGVyXCI+XG4gIHt7ICdjb25maWd1cmF0b3Iub3ZlcnZpZXdGaWx0ZXIuYnlPcHRpb24nIHwgY3hUcmFuc2xhdGUgfX1cbjwvZGl2PlxuXG48ZGl2IGNsYXNzPVwiY3gtb3ZlcnZpZXctZmlsdGVyLW9wdGlvblwiPlxuICA8ZGl2IGNsYXNzPVwiZm9ybS1jaGVja1wiPlxuICAgIDxpbnB1dFxuICAgICAgaWQ9XCJjeC1jb25maWd1cmF0b3Itb3ZlcnZpZXctZmlsdGVyLW9wdGlvbi1wcmljZVwiXG4gICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgY2xhc3M9XCJmb3JtLWNoZWNrLWlucHV0XCJcbiAgICAgIFtmb3JtQ29udHJvbF09XCJwcmljZUZpbHRlclwiXG4gICAgICAoY2hhbmdlKT1cIm9uRmlsdGVyKGNvbmZpZylcIlxuICAgICAgbmFtZT1cImNvbmZpZy1vdmVydmlldy1wcmljZS1maWx0ZXJcIlxuICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJcbiAgICAgICAgJ2NvbmZpZ3VyYXRvci5hMTF5LmZpbHRlck92ZXJ2aWV3QnlQcmljZScgfCBjeFRyYW5zbGF0ZVxuICAgICAgXCJcbiAgICAvPlxuICAgIDxsYWJlbFxuICAgICAgY2xhc3M9XCJmb3JtLWNoZWNrLWxhYmVsXCJcbiAgICAgIGZvcj1cImN4LWNvbmZpZ3VyYXRvci1vdmVydmlldy1maWx0ZXItb3B0aW9uLXByaWNlXCJcbiAgICA+XG4gICAgICB7eyAnY29uZmlndXJhdG9yLm92ZXJ2aWV3RmlsdGVyLmJ5UHJpY2UnIHwgY3hUcmFuc2xhdGUgfX08L2xhYmVsXG4gICAgPlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48ZGl2IGNsYXNzPVwiY3gtb3ZlcnZpZXctZmlsdGVyLW9wdGlvblwiPlxuICA8ZGl2IGNsYXNzPVwiZm9ybS1jaGVja1wiPlxuICAgIDxpbnB1dFxuICAgICAgaWQ9XCJjeC1jb25maWd1cmF0b3Itb3ZlcnZpZXctZmlsdGVyLW9wdGlvbi1teVNlbGVjdGlvbnNcIlxuICAgICAgdHlwZT1cImNoZWNrYm94XCJcbiAgICAgIGNsYXNzPVwiZm9ybS1jaGVjay1pbnB1dFwiXG4gICAgICBbZm9ybUNvbnRyb2xdPVwibXlTZWxlY3Rpb25zRmlsdGVyXCJcbiAgICAgIChjaGFuZ2UpPVwib25GaWx0ZXIoY29uZmlnKVwiXG4gICAgICBuYW1lPVwiY29uZmlnLW92ZXJ2aWV3LW15LXNlbGVjdGlvbi1maWx0ZXJcIlxuICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJcbiAgICAgICAgJ2NvbmZpZ3VyYXRvci5hMTF5LmZpbHRlck92ZXJ2aWV3QnlNeVNlbGVjdGlvbnMnIHwgY3hUcmFuc2xhdGVcbiAgICAgIFwiXG4gICAgLz5cbiAgICA8bGFiZWxcbiAgICAgIGNsYXNzPVwiZm9ybS1jaGVjay1sYWJlbFwiXG4gICAgICBmb3I9XCJjeC1jb25maWd1cmF0b3Itb3ZlcnZpZXctZmlsdGVyLW9wdGlvbi1teVNlbGVjdGlvbnNcIlxuICAgID5cbiAgICAgIHt7ICdjb25maWd1cmF0b3Iub3ZlcnZpZXdGaWx0ZXIubXlTZWxlY3Rpb25zJyB8IGN4VHJhbnNsYXRlIH19PC9sYWJlbFxuICAgID5cbiAgPC9kaXY+XG48L2Rpdj5cbjxuZy1jb250YWluZXIgKm5nSWY9XCJjb25maWcub3ZlcnZpZXcucG9zc2libGVHcm91cHNcIj5cbiAgPGRpdiBjbGFzcz1cImN4LW92ZXJ2aWV3LWZpbHRlci1oZWFkZXJcIj5cbiAgICB7eyAnY29uZmlndXJhdG9yLm92ZXJ2aWV3RmlsdGVyLmJ5R3JvdXAnIHwgY3hUcmFuc2xhdGUgfX1cbiAgPC9kaXY+XG4gIDxuZy1jb250YWluZXJcbiAgICAqbmdGb3I9XCJsZXQgZ3JvdXAgb2YgY29uZmlnLm92ZXJ2aWV3LnBvc3NpYmxlR3JvdXBzOyBsZXQgaSA9IGluZGV4XCJcbiAgPlxuICAgIDxkaXYgY2xhc3M9XCJjeC1vdmVydmlldy1maWx0ZXItb3B0aW9uXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1jaGVja1wiPlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICBpZD1cInt7ICdjeC1jb25maWd1cmF0b3Itb3ZlcnZpZXctZmlsdGVyLW9wdGlvbi1ncm91cC0nICsgZ3JvdXAuaWQgfX1cIlxuICAgICAgICAgIHR5cGU9XCJjaGVja2JveFwiXG4gICAgICAgICAgY2xhc3M9XCJmb3JtLWNoZWNrLWlucHV0XCJcbiAgICAgICAgICBbZm9ybUNvbnRyb2xdPVwiZ3JvdXBGaWx0ZXJzW2ldXCJcbiAgICAgICAgICAoY2hhbmdlKT1cIm9uRmlsdGVyKGNvbmZpZylcIlxuICAgICAgICAgIG5hbWU9XCJ7eyAnY29uZmlnLW92ZXJ2aWV3LWdyb3VwLWZpbHRlci0nICsgZ3JvdXAuaWQgfX1cIlxuICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiXG4gICAgICAgICAgICAnY29uZmlndXJhdG9yLmExMXkuZmlsdGVyT3ZlcnZpZXdCeUdyb3VwJ1xuICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlOiB7IGdyb3VwTmFtZTogZ3JvdXAuZ3JvdXBEZXNjcmlwdGlvbiB9XG4gICAgICAgICAgXCJcbiAgICAgICAgLz5cbiAgICAgICAgPGxhYmVsXG4gICAgICAgICAgY2xhc3M9XCJmb3JtLWNoZWNrLWxhYmVsXCJcbiAgICAgICAgICBmb3I9XCJ7eyAnY3gtY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZpbHRlci1vcHRpb24tZ3JvdXAtJyArIGdyb3VwLmlkIH19XCJcbiAgICAgICAgICA+e3sgZ3JvdXAuZ3JvdXBEZXNjcmlwdGlvbiB9fTwvbGFiZWxcbiAgICAgICAgPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvbmctY29udGFpbmVyPlxuPC9uZy1jb250YWluZXI+XG4iXX0=