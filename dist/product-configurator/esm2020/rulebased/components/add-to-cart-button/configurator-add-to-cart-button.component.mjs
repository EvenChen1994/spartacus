/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, Optional, } from '@angular/core';
import { GlobalMessageType, } from '@spartacus/core';
import { CommonConfigurator, ConfiguratorModelUtils, ConfiguratorRouter, } from '@spartacus/product-configurator/common';
import { ICON_TYPE, } from '@spartacus/storefront';
import { of, Subscription } from 'rxjs';
import { delay, distinctUntilChanged, filter, map, switchMap, take, } from 'rxjs/operators';
import { UntypedFormControl } from '@angular/forms';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/core";
import * as i2 from "../../core/facade/configurator-commons.service";
import * as i3 from "../../core/facade/configurator-cart.service";
import * as i4 from "../../core/facade/configurator-groups.service";
import * as i5 from "@spartacus/product-configurator/common";
import * as i6 from "@spartacus/order/root";
import * as i7 from "../service/configurator-storefront-utils.service";
import * as i8 from "@spartacus/storefront";
import * as i9 from "../../core/services/configurator-quantity.service";
import * as i10 from "@angular/common";
const CX_SELECTOR = 'cx-configurator-add-to-cart-button';
export class ConfiguratorAddToCartButtonComponent {
    constructor(routingService, configuratorCommonsService, configuratorCartService, configuratorGroupsService, configRouterExtractorService, globalMessageService, orderHistoryFacade, commonConfiguratorUtilsService, configUtils, intersectionService, configuratorQuantityService) {
        this.routingService = routingService;
        this.configuratorCommonsService = configuratorCommonsService;
        this.configuratorCartService = configuratorCartService;
        this.configuratorGroupsService = configuratorGroupsService;
        this.configRouterExtractorService = configRouterExtractorService;
        this.globalMessageService = globalMessageService;
        this.orderHistoryFacade = orderHistoryFacade;
        this.commonConfiguratorUtilsService = commonConfiguratorUtilsService;
        this.configUtils = configUtils;
        this.intersectionService = intersectionService;
        this.configuratorQuantityService = configuratorQuantityService;
        this.subscription = new Subscription();
        this.quantityControl = new UntypedFormControl(1);
        this.iconType = ICON_TYPE;
        this.container$ = this.configRouterExtractorService.extractRouterData().pipe(switchMap((routerData) => this.configuratorCommonsService
            .getConfiguration(routerData.owner)
            .pipe(map((configuration) => ({ routerData, configuration })))
            .pipe(switchMap((cont) => this.configuratorCommonsService
            .hasPendingChanges(cont.configuration.owner)
            .pipe(map((hasPendingChanges) => ({
            routerData: cont.routerData,
            configuration: cont.configuration,
            hasPendingChanges,
        })))))));
    }
    ngOnInit() {
        this.makeAddToCartButtonSticky();
        if (this.configuratorQuantityService) {
            this.configuratorQuantityService
                .getQuantity()
                .pipe(take(1))
                .subscribe((quantity) => {
                this.quantityControl.setValue(quantity);
            });
        }
        this.subscription.add(this.quantityControl.valueChanges
            .pipe(distinctUntilChanged())
            .subscribe(() => this.configuratorQuantityService?.setQuantity(this.quantityControl.value)));
    }
    navigateToCart() {
        this.routingService.go('cart');
    }
    navigateToOverview(configuratorType, owner) {
        this.routingService.go({
            cxRoute: 'configureOverview' + configuratorType,
            params: { ownerType: 'cartEntry', entityKey: owner.id },
        });
    }
    displayConfirmationMessage(key) {
        this.globalMessageService.add({ key: key }, GlobalMessageType.MSG_TYPE_CONFIRMATION);
    }
    /**
     * Performs the navigation to the corresponding location (cart or overview pages).
     *
     * @param {string} configuratorType - Configurator type
     * @param {CommonConfigurator.Owner} owner - Owner
     * @param {boolean} isAdd - Is add to cart
     * @param {boolean} isOverview - Is overview page
     * @param {boolean} showMessage - Show message
     */
    performNavigation(configuratorType, owner, isAdd, isOverview, showMessage) {
        const messageKey = isAdd
            ? 'configurator.addToCart.confirmation'
            : 'configurator.addToCart.confirmationUpdate';
        if (isOverview) {
            this.navigateToCart();
        }
        else {
            this.navigateToOverview(configuratorType, owner);
        }
        if (showMessage) {
            this.displayConfirmationMessage(messageKey);
        }
    }
    /**
     * Decides on the resource key for the button. Depending on the business process (owner of the configuration) and the
     * need for a cart update, the text will differ.
     *
     * @param {ConfiguratorRouter.Data} routerData - Reflects the current router state
     * @param {Configurator.Configuration} configuration - Configuration
     * @returns {string} The resource key that controls the button description
     */
    getButtonResourceKey(routerData, configuration) {
        if (routerData.isOwnerCartEntry &&
            configuration.isCartEntryUpdateRequired) {
            return 'configurator.addToCart.buttonUpdateCart';
        }
        else if (routerData.isOwnerCartEntry &&
            !configuration.isCartEntryUpdateRequired) {
            return 'configurator.addToCart.buttonAfterAddToCart';
        }
        else {
            return 'configurator.addToCart.button';
        }
    }
    /**
     * Verifies whether it is a cart entry.
     *
     * @param {ConfiguratorRouter.Data} routerData - Reflects the current router state
     * @returns {boolean} - 'true' if it is a cart entry, otherwise 'false'
     */
    isCartEntry(routerData) {
        return routerData.isOwnerCartEntry ? routerData.isOwnerCartEntry : false;
    }
    /**
     * Triggers action and navigation, both depending on the context. Might result in an addToCart, updateCartEntry,
     * just a cart navigation or a browser back navigation
     * @param {Configurator.Configuration} configuration - Configuration
     * @param {ConfiguratorRouter.Data} routerData - Reflects the current router state
     */
    onAddToCart(configuration, routerData) {
        const pageType = routerData.pageType;
        const configuratorType = configuration.owner.configuratorType;
        const isOverview = pageType === ConfiguratorRouter.PageType.OVERVIEW;
        const isOwnerCartEntry = routerData.owner.type === CommonConfigurator.OwnerType.CART_ENTRY;
        const owner = configuration.owner;
        const currentGroup = configuration.interactionState.currentGroup;
        if (currentGroup) {
            this.configuratorGroupsService.setGroupStatusVisited(configuration.owner, currentGroup);
        }
        this.container$
            .pipe(filter((cont) => !cont.hasPendingChanges), take(1))
            .subscribe(() => {
            if (isOwnerCartEntry) {
                this.onUpdateCart(configuration, configuratorType, owner, isOverview);
            }
            else {
                this.onAddToCartForProduct(owner, configuration, configuratorType, isOverview);
            }
        });
    }
    onAddToCartForProduct(owner, configuration, configuratorType, isOverview) {
        const quantity = this.quantityControl.value;
        this.configuratorCartService.addToCart(owner.id, configuration.configId, owner, quantity);
        this.configuratorCommonsService
            .getConfiguration(owner)
            .pipe(filter((configWithNextOwner) => configWithNextOwner.nextOwner !== undefined), take(1))
            .subscribe((configWithNextOwner) => {
            //See preceding filter operator: configWithNextOwner.nextOwner is always defined here
            this.navigateForProductBound(configWithNextOwner, configuratorType, isOverview);
        });
    }
    navigateForProductBound(configWithNextOwner, configuratorType, isOverview) {
        const nextOwner = configWithNextOwner.nextOwner ??
            ConfiguratorModelUtils.createInitialOwner();
        this.performNavigation(configuratorType, nextOwner, true, isOverview, true);
        // we clean up the cart entry related configuration, as we might have a
        // configuration for the same cart entry number stored already.
        // (Cart entries might have been deleted)
        // Needs to happen only if we are on configuration page, navigation to
        // cart will anyhow delete.
        // We do not clean up the product bound configuration yet, as existing
        // observables would instantly trigger a re-create.
        // Cleaning up this obsolete product bound configuration (with link to the cart) will
        // only happen on leaving the configurator pages, see ConfiguratorRouterListener
        if (!isOverview) {
            this.configuratorCommonsService.removeConfiguration(nextOwner);
        }
    }
    onUpdateCart(configuration, configuratorType, owner, isOverview) {
        if (configuration.isCartEntryUpdateRequired) {
            this.configuratorCartService.updateCartEntry(configuration);
        }
        this.performNavigation(configuratorType, owner, false, isOverview, configuration.isCartEntryUpdateRequired ?? false);
        //Only remove if we are on configuration page, because on final cart navigation,
        //the configuration will anyhow be removed
        if (configuration.isCartEntryUpdateRequired && !isOverview) {
            this.configuratorCommonsService.removeConfiguration(owner);
        }
    }
    leaveConfigurationOverview() {
        this.container$.pipe(take(1)).subscribe((container) => {
            if (container.routerData.owner.type ===
                CommonConfigurator.OwnerType.ORDER_ENTRY) {
                this.goToOrderDetails(container.routerData.owner);
            }
            else {
                this.routingService.go({ cxRoute: 'checkoutReviewOrder' });
            }
        });
    }
    goToOrderDetails(owner) {
        this.orderHistoryFacade.loadOrderDetails(this.commonConfiguratorUtilsService.decomposeOwnerId(owner.id).documentId);
        this.orderHistoryFacade
            .getOrderDetails()
            .pipe(filter((order) => order !== undefined), take(1))
            .subscribe((order) => this.routingService.go({ cxRoute: 'orderDetails', params: order }));
    }
    extractConfigPrices(configuration) {
        const priceSummary = configuration.priceSummary;
        const basePrice = priceSummary?.basePrice?.formattedValue;
        const selectedOptions = priceSummary?.selectedOptions?.formattedValue;
        const totalPrice = priceSummary?.currentTotal?.formattedValue;
        const prices = {
            basePrice: basePrice,
            selectedOptions: selectedOptions,
            totalPrice: totalPrice,
        };
        if (!basePrice || basePrice === '-') {
            prices.basePrice = '0';
        }
        if (!selectedOptions || selectedOptions === '-') {
            prices.selectedOptions = '0';
        }
        if (!totalPrice || totalPrice === '-') {
            prices.totalPrice = '0';
        }
        return prices;
    }
    makeAddToCartButtonSticky() {
        // The add-to-cart button has to be shown at the bottom of the configuration view
        // and scrolled out together with the configuration view when it is moved to the top out from the viewport.
        // From the technical point of view it is controlled by checking whether the add-to-cart button intersects the price-summary or not:
        // the add-to-cart button has to be shown sticky, if intersects, and fixed, if not.
        // To avoid the situation where the add-to-cart button is shown fixed below the footer view
        // when the configuration view is scrolled out to the top on small mobile screens, we use the rootMargin parameter.
        // The first field of the rootMargin controls the delay in pixel after them the add-to-cart button has to be shown fixed again.
        // We set this value very high, so the add-to-cart button will never appear below the footer view even in case of small screens.
        const options = {
            rootMargin: '9999px 0px -100px 0px',
        };
        this.subscription.add(this.container$
            .pipe(take(1), delay(0), map(() => this.configUtils.getElement('cx-configurator-price-summary')), switchMap((priceSummary) => priceSummary
            ? this.intersectionService.isIntersecting(priceSummary, options)
            : of(undefined)), filter((isIntersecting) => isIntersecting !== undefined))
            .subscribe((isIntersecting) => {
            if (isIntersecting) {
                this.configUtils.changeStyling(CX_SELECTOR, 'position', 'sticky');
            }
            else {
                this.configUtils.changeStyling(CX_SELECTOR, 'position', 'fixed');
            }
        }));
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
}
ConfiguratorAddToCartButtonComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAddToCartButtonComponent, deps: [{ token: i1.RoutingService }, { token: i2.ConfiguratorCommonsService }, { token: i3.ConfiguratorCartService }, { token: i4.ConfiguratorGroupsService }, { token: i5.ConfiguratorRouterExtractorService }, { token: i1.GlobalMessageService }, { token: i6.OrderHistoryFacade }, { token: i5.CommonConfiguratorUtilsService }, { token: i7.ConfiguratorStorefrontUtilsService }, { token: i8.IntersectionService }, { token: i9.ConfiguratorQuantityService, optional: true }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorAddToCartButtonComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorAddToCartButtonComponent, selector: "cx-configurator-add-to-cart-button", ngImport: i0, template: "<ng-container *ngIf=\"container$ | async as container\">\n  <ng-container *ngIf=\"!container.routerData.displayOnly; else displayOnly\">\n    <div class=\"cx-add-to-cart-btn-container\">\n      <ng-container *cxFeatureLevel=\"'!6.1'\">\n        <button\n          class=\"cx-btn btn btn-block btn-primary cx-add-to-cart-btn\"\n          (click)=\"onAddToCart(container.configuration, container.routerData)\"\n          [attr.aria-label]=\"\n            (getButtonResourceKey(container.routerData, container.configuration)\n              | cxTranslate) +\n            ' ' +\n            ('configurator.a11y.addToCartPrices'\n              | cxTranslate: extractConfigPrices(container.configuration))\n          \"\n        >\n          {{\n            getButtonResourceKey(container.routerData, container.configuration)\n              | cxTranslate\n          }}\n        </button>\n      </ng-container>\n      <ng-container *cxFeatureLevel=\"'6.1'\">\n        <ng-container *ngIf=\"!isCartEntry(container.routerData)\">\n          <div class=\"cx-quantity-add-to-cart-container\">\n            <div class=\"cx-quantity-add-to-cart-row\">\n              <div class=\"cx-quantity\">\n                <label>{{\n                  'configurator.addToCart.quantity' | cxTranslate\n                }}</label>\n                <cx-item-counter [control]=\"quantityControl\"></cx-item-counter>\n              </div>\n              <button\n                class=\"cx-btn btn btn-block btn-primary cx-add-to-cart-btn\"\n                (click)=\"\n                  onAddToCart(container.configuration, container.routerData)\n                \"\n                [attr.aria-label]=\"\n                  (getButtonResourceKey(\n                    container.routerData,\n                    container.configuration\n                  ) | cxTranslate) +\n                  ' ' +\n                  ('configurator.a11y.addToCartPrices'\n                    | cxTranslate: extractConfigPrices(container.configuration))\n                \"\n                title=\"{{\n                  getButtonResourceKey(\n                    container.routerData,\n                    container.configuration\n                  ) | cxTranslate\n                }}\"\n              >\n                <cx-icon [type]=\"iconType.CART_PLUS\"></cx-icon>\n              </button>\n            </div>\n          </div>\n        </ng-container>\n        <ng-container *ngIf=\"isCartEntry(container.routerData)\">\n          <button\n            class=\"cx-btn btn btn-block btn-primary cx-add-to-cart-btn\"\n            (click)=\"onAddToCart(container.configuration, container.routerData)\"\n            [attr.aria-label]=\"\n              (getButtonResourceKey(\n                container.routerData,\n                container.configuration\n              ) | cxTranslate) +\n              ' ' +\n              ('configurator.a11y.addToCartPrices'\n                | cxTranslate: extractConfigPrices(container.configuration))\n            \"\n          >\n            {{\n              getButtonResourceKey(\n                container.routerData,\n                container.configuration\n              ) | cxTranslate\n            }}\n          </button>\n        </ng-container>\n      </ng-container>\n    </div>\n  </ng-container>\n  <ng-template #displayOnly>\n    <div class=\"cx-display-only-btn-container\">\n      <ng-container *cxFeatureLevel=\"'!6.1'\">\n        <button\n          class=\"cx-btn btn btn-block btn-primary cx-display-only-btn\"\n          (click)=\"leaveConfigurationOverview()\"\n        >\n          {{ 'configurator.addToCart.buttonDisplayOnly' | cxTranslate }}\n        </button>\n      </ng-container>\n      <ng-container *cxFeatureLevel=\"'6.1'\">\n        <button\n          class=\"cx-btn btn btn-block btn-secondary cx-display-only-btn\"\n          (click)=\"leaveConfigurationOverview()\"\n        >\n          {{ 'configurator.addToCart.buttonClose' | cxTranslate }}\n        </button>\n      </ng-container>\n    </div>\n  </ng-template>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i10.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i8.ItemCounterComponent, selector: "cx-item-counter", inputs: ["control", "min", "max", "step", "allowZero", "readonly"] }, { kind: "component", type: i8.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "directive", type: i1.FeatureLevelDirective, selector: "[cxFeatureLevel]", inputs: ["cxFeatureLevel"] }, { kind: "pipe", type: i10.AsyncPipe, name: "async" }, { kind: "pipe", type: i1.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAddToCartButtonComponent, decorators: [{
            type: Component,
            args: [{ selector: CX_SELECTOR, changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-container *ngIf=\"container$ | async as container\">\n  <ng-container *ngIf=\"!container.routerData.displayOnly; else displayOnly\">\n    <div class=\"cx-add-to-cart-btn-container\">\n      <ng-container *cxFeatureLevel=\"'!6.1'\">\n        <button\n          class=\"cx-btn btn btn-block btn-primary cx-add-to-cart-btn\"\n          (click)=\"onAddToCart(container.configuration, container.routerData)\"\n          [attr.aria-label]=\"\n            (getButtonResourceKey(container.routerData, container.configuration)\n              | cxTranslate) +\n            ' ' +\n            ('configurator.a11y.addToCartPrices'\n              | cxTranslate: extractConfigPrices(container.configuration))\n          \"\n        >\n          {{\n            getButtonResourceKey(container.routerData, container.configuration)\n              | cxTranslate\n          }}\n        </button>\n      </ng-container>\n      <ng-container *cxFeatureLevel=\"'6.1'\">\n        <ng-container *ngIf=\"!isCartEntry(container.routerData)\">\n          <div class=\"cx-quantity-add-to-cart-container\">\n            <div class=\"cx-quantity-add-to-cart-row\">\n              <div class=\"cx-quantity\">\n                <label>{{\n                  'configurator.addToCart.quantity' | cxTranslate\n                }}</label>\n                <cx-item-counter [control]=\"quantityControl\"></cx-item-counter>\n              </div>\n              <button\n                class=\"cx-btn btn btn-block btn-primary cx-add-to-cart-btn\"\n                (click)=\"\n                  onAddToCart(container.configuration, container.routerData)\n                \"\n                [attr.aria-label]=\"\n                  (getButtonResourceKey(\n                    container.routerData,\n                    container.configuration\n                  ) | cxTranslate) +\n                  ' ' +\n                  ('configurator.a11y.addToCartPrices'\n                    | cxTranslate: extractConfigPrices(container.configuration))\n                \"\n                title=\"{{\n                  getButtonResourceKey(\n                    container.routerData,\n                    container.configuration\n                  ) | cxTranslate\n                }}\"\n              >\n                <cx-icon [type]=\"iconType.CART_PLUS\"></cx-icon>\n              </button>\n            </div>\n          </div>\n        </ng-container>\n        <ng-container *ngIf=\"isCartEntry(container.routerData)\">\n          <button\n            class=\"cx-btn btn btn-block btn-primary cx-add-to-cart-btn\"\n            (click)=\"onAddToCart(container.configuration, container.routerData)\"\n            [attr.aria-label]=\"\n              (getButtonResourceKey(\n                container.routerData,\n                container.configuration\n              ) | cxTranslate) +\n              ' ' +\n              ('configurator.a11y.addToCartPrices'\n                | cxTranslate: extractConfigPrices(container.configuration))\n            \"\n          >\n            {{\n              getButtonResourceKey(\n                container.routerData,\n                container.configuration\n              ) | cxTranslate\n            }}\n          </button>\n        </ng-container>\n      </ng-container>\n    </div>\n  </ng-container>\n  <ng-template #displayOnly>\n    <div class=\"cx-display-only-btn-container\">\n      <ng-container *cxFeatureLevel=\"'!6.1'\">\n        <button\n          class=\"cx-btn btn btn-block btn-primary cx-display-only-btn\"\n          (click)=\"leaveConfigurationOverview()\"\n        >\n          {{ 'configurator.addToCart.buttonDisplayOnly' | cxTranslate }}\n        </button>\n      </ng-container>\n      <ng-container *cxFeatureLevel=\"'6.1'\">\n        <button\n          class=\"cx-btn btn btn-block btn-secondary cx-display-only-btn\"\n          (click)=\"leaveConfigurationOverview()\"\n        >\n          {{ 'configurator.addToCart.buttonClose' | cxTranslate }}\n        </button>\n      </ng-container>\n    </div>\n  </ng-template>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.RoutingService }, { type: i2.ConfiguratorCommonsService }, { type: i3.ConfiguratorCartService }, { type: i4.ConfiguratorGroupsService }, { type: i5.ConfiguratorRouterExtractorService }, { type: i1.GlobalMessageService }, { type: i6.OrderHistoryFacade }, { type: i5.CommonConfiguratorUtilsService }, { type: i7.ConfiguratorStorefrontUtilsService }, { type: i8.IntersectionService }, { type: i9.ConfiguratorQuantityService, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLWFkZC10by1jYXJ0LWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcHJvZHVjdC1jb25maWd1cmF0b3IvcnVsZWJhc2VkL2NvbXBvbmVudHMvYWRkLXRvLWNhcnQtYnV0dG9uL2NvbmZpZ3VyYXRvci1hZGQtdG8tY2FydC1idXR0b24uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2FkZC10by1jYXJ0LWJ1dHRvbi9jb25maWd1cmF0b3ItYWRkLXRvLWNhcnQtYnV0dG9uLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFHVCxRQUFRLEdBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUVMLGlCQUFpQixHQUVsQixNQUFNLGlCQUFpQixDQUFDO0FBRXpCLE9BQU8sRUFDTCxrQkFBa0IsRUFFbEIsc0JBQXNCLEVBQ3RCLGtCQUFrQixHQUVuQixNQUFNLHdDQUF3QyxDQUFDO0FBQ2hELE9BQU8sRUFHTCxTQUFTLEdBQ1YsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLEVBQWMsRUFBRSxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwRCxPQUFPLEVBQ0wsS0FBSyxFQUNMLG9CQUFvQixFQUNwQixNQUFNLEVBQ04sR0FBRyxFQUNILFNBQVMsRUFDVCxJQUFJLEdBQ0wsTUFBTSxnQkFBZ0IsQ0FBQztBQU14QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7O0FBR3BELE1BQU0sV0FBVyxHQUFHLG9DQUFvQyxDQUFDO0FBT3pELE1BQU0sT0FBTyxvQ0FBb0M7SUE4RC9D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QUFFLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQzthQUNsRTtRQUNILENBQUMsQ0FBQyxDQUNMLENBQUM7SUFDSixDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDbEMsQ0FBQzs7aUlBalpVLG9DQUFvQztxSEFBcEMsb0NBQW9DLDBFQ3ZEakQsbytIQXVHQTsyRkRoRGEsb0NBQW9DO2tCQUxoRCxTQUFTOytCQUNFLFdBQVcsbUJBRUosdUJBQXVCLENBQUMsTUFBTTs7MEJBMkU1QyxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE9wdGlvbmFsLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEdsb2JhbE1lc3NhZ2VTZXJ2aWNlLFxuICBHbG9iYWxNZXNzYWdlVHlwZSxcbiAgUm91dGluZ1NlcnZpY2UsXG59IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQgeyBPcmRlciwgT3JkZXJIaXN0b3J5RmFjYWRlIH0gZnJvbSAnQHNwYXJ0YWN1cy9vcmRlci9yb290JztcbmltcG9ydCB7XG4gIENvbW1vbkNvbmZpZ3VyYXRvcixcbiAgQ29tbW9uQ29uZmlndXJhdG9yVXRpbHNTZXJ2aWNlLFxuICBDb25maWd1cmF0b3JNb2RlbFV0aWxzLFxuICBDb25maWd1cmF0b3JSb3V0ZXIsXG4gIENvbmZpZ3VyYXRvclJvdXRlckV4dHJhY3RvclNlcnZpY2UsXG59IGZyb20gJ0BzcGFydGFjdXMvcHJvZHVjdC1jb25maWd1cmF0b3IvY29tbW9uJztcbmltcG9ydCB7XG4gIEludGVyc2VjdGlvbk9wdGlvbnMsXG4gIEludGVyc2VjdGlvblNlcnZpY2UsXG4gIElDT05fVFlQRSxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9zdG9yZWZyb250JztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGRlbGF5LFxuICBkaXN0aW5jdFVudGlsQ2hhbmdlZCxcbiAgZmlsdGVyLFxuICBtYXAsXG4gIHN3aXRjaE1hcCxcbiAgdGFrZSxcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yQ2FydFNlcnZpY2UgfSBmcm9tICcuLi8uLi9jb3JlL2ZhY2FkZS9jb25maWd1cmF0b3ItY2FydC5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9mYWNhZGUvY29uZmlndXJhdG9yLWNvbW1vbnMuc2VydmljZSc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JHcm91cHNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9mYWNhZGUvY29uZmlndXJhdG9yLWdyb3Vwcy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvciB9IGZyb20gJy4uLy4uL2NvcmUvbW9kZWwvY29uZmlndXJhdG9yLm1vZGVsJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvclN0b3JlZnJvbnRVdGlsc1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2NvbmZpZ3VyYXRvci1zdG9yZWZyb250LXV0aWxzLnNlcnZpY2UnO1xuaW1wb3J0IHsgVW50eXBlZEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yUXVhbnRpdHlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9zZXJ2aWNlcy9jb25maWd1cmF0b3ItcXVhbnRpdHkuc2VydmljZSc7XG5cbmNvbnN0IENYX1NFTEVDVE9SID0gJ2N4LWNvbmZpZ3VyYXRvci1hZGQtdG8tY2FydC1idXR0b24nO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IENYX1NFTEVDVE9SLFxuICB0ZW1wbGF0ZVVybDogJy4vY29uZmlndXJhdG9yLWFkZC10by1jYXJ0LWJ1dHRvbi5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBDb25maWd1cmF0b3JBZGRUb0NhcnRCdXR0b25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHByb3RlY3RlZCBzdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gIHF1YW50aXR5Q29udHJvbCA9IG5ldyBVbnR5cGVkRm9ybUNvbnRyb2woMSk7XG4gIGljb25UeXBlID0gSUNPTl9UWVBFO1xuXG4gIGNvbnRhaW5lciQ6IE9ic2VydmFibGU8e1xuICAgIHJvdXRlckRhdGE6IENvbmZpZ3VyYXRvclJvdXRlci5EYXRhO1xuICAgIGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uO1xuICAgIGhhc1BlbmRpbmdDaGFuZ2VzOiBib29sZWFuO1xuICB9PiA9IHRoaXMuY29uZmlnUm91dGVyRXh0cmFjdG9yU2VydmljZS5leHRyYWN0Um91dGVyRGF0YSgpLnBpcGUoXG4gICAgc3dpdGNoTWFwKChyb3V0ZXJEYXRhKSA9PlxuICAgICAgdGhpcy5jb25maWd1cmF0b3JDb21tb25zU2VydmljZVxuICAgICAgICAuZ2V0Q29uZmlndXJhdGlvbihyb3V0ZXJEYXRhLm93bmVyKVxuICAgICAgICAucGlwZShtYXAoKGNvbmZpZ3VyYXRpb24pID0+ICh7IHJvdXRlckRhdGEsIGNvbmZpZ3VyYXRpb24gfSkpKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKGNvbnQpID0+XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlXG4gICAgICAgICAgICAgIC5oYXNQZW5kaW5nQ2hhbmdlcyhjb250LmNvbmZpZ3VyYXRpb24ub3duZXIpXG4gICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgoaGFzUGVuZGluZ0NoYW5nZXMpID0+ICh7XG4gICAgICAgICAgICAgICAgICByb3V0ZXJEYXRhOiBjb250LnJvdXRlckRhdGEsXG4gICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uOiBjb250LmNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgICAgICAgICBoYXNQZW5kaW5nQ2hhbmdlcyxcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgKTtcblxuICAvLyBUT0RPIChDWFNQQS0zMzkyKTogbWFrZSBjb25maWd1cmF0b3JRdWFudGl0eVNlcnZpY2UgYSByZXF1aXJlZCBkZXBlbmRlbmN5XG4gIGNvbnN0cnVjdG9yKFxuICAgIHJvdXRpbmdTZXJ2aWNlOiBSb3V0aW5nU2VydmljZSxcbiAgICBjb25maWd1cmF0b3JDb21tb25zU2VydmljZTogQ29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2UsXG4gICAgY29uZmlndXJhdG9yQ2FydFNlcnZpY2U6IENvbmZpZ3VyYXRvckNhcnRTZXJ2aWNlLFxuICAgIGNvbmZpZ3VyYXRvckdyb3Vwc1NlcnZpY2U6IENvbmZpZ3VyYXRvckdyb3Vwc1NlcnZpY2UsXG4gICAgY29uZmlnUm91dGVyRXh0cmFjdG9yU2VydmljZTogQ29uZmlndXJhdG9yUm91dGVyRXh0cmFjdG9yU2VydmljZSxcbiAgICBnbG9iYWxNZXNzYWdlU2VydmljZTogR2xvYmFsTWVzc2FnZVNlcnZpY2UsXG4gICAgb3JkZXJIaXN0b3J5RmFjYWRlOiBPcmRlckhpc3RvcnlGYWNhZGUsXG4gICAgY29tbW9uQ29uZmlndXJhdG9yVXRpbHNTZXJ2aWNlOiBDb21tb25Db25maWd1cmF0b3JVdGlsc1NlcnZpY2UsXG4gICAgY29uZmlnVXRpbHM6IENvbmZpZ3VyYXRvclN0b3JlZnJvbnRVdGlsc1NlcnZpY2UsXG4gICAgaW50ZXJzZWN0aW9uU2VydmljZTogSW50ZXJzZWN0aW9uU2VydmljZSxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuaWZpZWQtc2lnbmF0dXJlc1xuICAgIGNvbmZpZ3VyYXRvclF1YW50aXR5U2VydmljZTogQ29uZmlndXJhdG9yUXVhbnRpdHlTZXJ2aWNlXG4gICk7XG5cbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkIHNpbmNlIDYuMVxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcm91dGluZ1NlcnZpY2U6IFJvdXRpbmdTZXJ2aWNlLFxuICAgIGNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlOiBDb25maWd1cmF0b3JDb21tb25zU2VydmljZSxcbiAgICBjb25maWd1cmF0b3JDYXJ0U2VydmljZTogQ29uZmlndXJhdG9yQ2FydFNlcnZpY2UsXG4gICAgY29uZmlndXJhdG9yR3JvdXBzU2VydmljZTogQ29uZmlndXJhdG9yR3JvdXBzU2VydmljZSxcbiAgICBjb25maWdSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlOiBDb25maWd1cmF0b3JSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlLFxuICAgIGdsb2JhbE1lc3NhZ2VTZXJ2aWNlOiBHbG9iYWxNZXNzYWdlU2VydmljZSxcbiAgICBvcmRlckhpc3RvcnlGYWNhZGU6IE9yZGVySGlzdG9yeUZhY2FkZSxcbiAgICBjb21tb25Db25maWd1cmF0b3JVdGlsc1NlcnZpY2U6IENvbW1vbkNvbmZpZ3VyYXRvclV0aWxzU2VydmljZSxcbiAgICBjb25maWdVdGlsczogQ29uZmlndXJhdG9yU3RvcmVmcm9udFV0aWxzU2VydmljZSxcbiAgICBpbnRlcnNlY3Rpb25TZXJ2aWNlOiBJbnRlcnNlY3Rpb25TZXJ2aWNlXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIHJvdXRpbmdTZXJ2aWNlOiBSb3V0aW5nU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2U6IENvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBjb25maWd1cmF0b3JDYXJ0U2VydmljZTogQ29uZmlndXJhdG9yQ2FydFNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNvbmZpZ3VyYXRvckdyb3Vwc1NlcnZpY2U6IENvbmZpZ3VyYXRvckdyb3Vwc1NlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNvbmZpZ1JvdXRlckV4dHJhY3RvclNlcnZpY2U6IENvbmZpZ3VyYXRvclJvdXRlckV4dHJhY3RvclNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGdsb2JhbE1lc3NhZ2VTZXJ2aWNlOiBHbG9iYWxNZXNzYWdlU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgb3JkZXJIaXN0b3J5RmFjYWRlOiBPcmRlckhpc3RvcnlGYWNhZGUsXG4gICAgcHJvdGVjdGVkIGNvbW1vbkNvbmZpZ3VyYXRvclV0aWxzU2VydmljZTogQ29tbW9uQ29uZmlndXJhdG9yVXRpbHNTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBjb25maWdVdGlsczogQ29uZmlndXJhdG9yU3RvcmVmcm9udFV0aWxzU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgaW50ZXJzZWN0aW9uU2VydmljZTogSW50ZXJzZWN0aW9uU2VydmljZSxcbiAgICBAT3B0aW9uYWwoKVxuICAgIHByb3RlY3RlZCBjb25maWd1cmF0b3JRdWFudGl0eVNlcnZpY2U/OiBDb25maWd1cmF0b3JRdWFudGl0eVNlcnZpY2VcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMubWFrZUFkZFRvQ2FydEJ1dHRvblN0aWNreSgpO1xuXG4gICAgaWYgKHRoaXMuY29uZmlndXJhdG9yUXVhbnRpdHlTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyYXRvclF1YW50aXR5U2VydmljZVxuICAgICAgICAuZ2V0UXVhbnRpdHkoKVxuICAgICAgICAucGlwZSh0YWtlKDEpKVxuICAgICAgICAuc3Vic2NyaWJlKChxdWFudGl0eSkgPT4ge1xuICAgICAgICAgIHRoaXMucXVhbnRpdHlDb250cm9sLnNldFZhbHVlKHF1YW50aXR5KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKFxuICAgICAgdGhpcy5xdWFudGl0eUNvbnRyb2wudmFsdWVDaGFuZ2VzXG4gICAgICAgIC5waXBlKGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkpXG4gICAgICAgIC5zdWJzY3JpYmUoKCkgPT5cbiAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvclF1YW50aXR5U2VydmljZT8uc2V0UXVhbnRpdHkoXG4gICAgICAgICAgICB0aGlzLnF1YW50aXR5Q29udHJvbC52YWx1ZVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgbmF2aWdhdGVUb0NhcnQoKTogdm9pZCB7XG4gICAgdGhpcy5yb3V0aW5nU2VydmljZS5nbygnY2FydCcpO1xuICB9XG5cbiAgcHJvdGVjdGVkIG5hdmlnYXRlVG9PdmVydmlldyhcbiAgICBjb25maWd1cmF0b3JUeXBlOiBzdHJpbmcsXG4gICAgb3duZXI6IENvbW1vbkNvbmZpZ3VyYXRvci5Pd25lclxuICApOiB2b2lkIHtcbiAgICB0aGlzLnJvdXRpbmdTZXJ2aWNlLmdvKHtcbiAgICAgIGN4Um91dGU6ICdjb25maWd1cmVPdmVydmlldycgKyBjb25maWd1cmF0b3JUeXBlLFxuICAgICAgcGFyYW1zOiB7IG93bmVyVHlwZTogJ2NhcnRFbnRyeScsIGVudGl0eUtleTogb3duZXIuaWQgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBkaXNwbGF5Q29uZmlybWF0aW9uTWVzc2FnZShrZXk6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuZ2xvYmFsTWVzc2FnZVNlcnZpY2UuYWRkKFxuICAgICAgeyBrZXk6IGtleSB9LFxuICAgICAgR2xvYmFsTWVzc2FnZVR5cGUuTVNHX1RZUEVfQ09ORklSTUFUSU9OXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtcyB0aGUgbmF2aWdhdGlvbiB0byB0aGUgY29ycmVzcG9uZGluZyBsb2NhdGlvbiAoY2FydCBvciBvdmVydmlldyBwYWdlcykuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb25maWd1cmF0b3JUeXBlIC0gQ29uZmlndXJhdG9yIHR5cGVcbiAgICogQHBhcmFtIHtDb21tb25Db25maWd1cmF0b3IuT3duZXJ9IG93bmVyIC0gT3duZXJcbiAgICogQHBhcmFtIHtib29sZWFufSBpc0FkZCAtIElzIGFkZCB0byBjYXJ0XG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNPdmVydmlldyAtIElzIG92ZXJ2aWV3IHBhZ2VcbiAgICogQHBhcmFtIHtib29sZWFufSBzaG93TWVzc2FnZSAtIFNob3cgbWVzc2FnZVxuICAgKi9cbiAgcGVyZm9ybU5hdmlnYXRpb24oXG4gICAgY29uZmlndXJhdG9yVHlwZTogc3RyaW5nLFxuICAgIG93bmVyOiBDb21tb25Db25maWd1cmF0b3IuT3duZXIsXG4gICAgaXNBZGQ6IGJvb2xlYW4sXG4gICAgaXNPdmVydmlldzogYm9vbGVhbixcbiAgICBzaG93TWVzc2FnZTogYm9vbGVhblxuICApOiB2b2lkIHtcbiAgICBjb25zdCBtZXNzYWdlS2V5ID0gaXNBZGRcbiAgICAgID8gJ2NvbmZpZ3VyYXRvci5hZGRUb0NhcnQuY29uZmlybWF0aW9uJ1xuICAgICAgOiAnY29uZmlndXJhdG9yLmFkZFRvQ2FydC5jb25maXJtYXRpb25VcGRhdGUnO1xuICAgIGlmIChpc092ZXJ2aWV3KSB7XG4gICAgICB0aGlzLm5hdmlnYXRlVG9DYXJ0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmF2aWdhdGVUb092ZXJ2aWV3KGNvbmZpZ3VyYXRvclR5cGUsIG93bmVyKTtcbiAgICB9XG4gICAgaWYgKHNob3dNZXNzYWdlKSB7XG4gICAgICB0aGlzLmRpc3BsYXlDb25maXJtYXRpb25NZXNzYWdlKG1lc3NhZ2VLZXkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNpZGVzIG9uIHRoZSByZXNvdXJjZSBrZXkgZm9yIHRoZSBidXR0b24uIERlcGVuZGluZyBvbiB0aGUgYnVzaW5lc3MgcHJvY2VzcyAob3duZXIgb2YgdGhlIGNvbmZpZ3VyYXRpb24pIGFuZCB0aGVcbiAgICogbmVlZCBmb3IgYSBjYXJ0IHVwZGF0ZSwgdGhlIHRleHQgd2lsbCBkaWZmZXIuXG4gICAqXG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdG9yUm91dGVyLkRhdGF9IHJvdXRlckRhdGEgLSBSZWZsZWN0cyB0aGUgY3VycmVudCByb3V0ZXIgc3RhdGVcbiAgICogQHBhcmFtIHtDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbn0gY29uZmlndXJhdGlvbiAtIENvbmZpZ3VyYXRpb25cbiAgICogQHJldHVybnMge3N0cmluZ30gVGhlIHJlc291cmNlIGtleSB0aGF0IGNvbnRyb2xzIHRoZSBidXR0b24gZGVzY3JpcHRpb25cbiAgICovXG4gIGdldEJ1dHRvblJlc291cmNlS2V5KFxuICAgIHJvdXRlckRhdGE6IENvbmZpZ3VyYXRvclJvdXRlci5EYXRhLFxuICAgIGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uXG4gICk6IHN0cmluZyB7XG4gICAgaWYgKFxuICAgICAgcm91dGVyRGF0YS5pc093bmVyQ2FydEVudHJ5ICYmXG4gICAgICBjb25maWd1cmF0aW9uLmlzQ2FydEVudHJ5VXBkYXRlUmVxdWlyZWRcbiAgICApIHtcbiAgICAgIHJldHVybiAnY29uZmlndXJhdG9yLmFkZFRvQ2FydC5idXR0b25VcGRhdGVDYXJ0JztcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgcm91dGVyRGF0YS5pc093bmVyQ2FydEVudHJ5ICYmXG4gICAgICAhY29uZmlndXJhdGlvbi5pc0NhcnRFbnRyeVVwZGF0ZVJlcXVpcmVkXG4gICAgKSB7XG4gICAgICByZXR1cm4gJ2NvbmZpZ3VyYXRvci5hZGRUb0NhcnQuYnV0dG9uQWZ0ZXJBZGRUb0NhcnQnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJ2NvbmZpZ3VyYXRvci5hZGRUb0NhcnQuYnV0dG9uJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpZXMgd2hldGhlciBpdCBpcyBhIGNhcnQgZW50cnkuXG4gICAqXG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdG9yUm91dGVyLkRhdGF9IHJvdXRlckRhdGEgLSBSZWZsZWN0cyB0aGUgY3VycmVudCByb3V0ZXIgc3RhdGVcbiAgICogQHJldHVybnMge2Jvb2xlYW59IC0gJ3RydWUnIGlmIGl0IGlzIGEgY2FydCBlbnRyeSwgb3RoZXJ3aXNlICdmYWxzZSdcbiAgICovXG4gIGlzQ2FydEVudHJ5KHJvdXRlckRhdGE6IENvbmZpZ3VyYXRvclJvdXRlci5EYXRhKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHJvdXRlckRhdGEuaXNPd25lckNhcnRFbnRyeSA/IHJvdXRlckRhdGEuaXNPd25lckNhcnRFbnRyeSA6IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyaWdnZXJzIGFjdGlvbiBhbmQgbmF2aWdhdGlvbiwgYm90aCBkZXBlbmRpbmcgb24gdGhlIGNvbnRleHQuIE1pZ2h0IHJlc3VsdCBpbiBhbiBhZGRUb0NhcnQsIHVwZGF0ZUNhcnRFbnRyeSxcbiAgICoganVzdCBhIGNhcnQgbmF2aWdhdGlvbiBvciBhIGJyb3dzZXIgYmFjayBuYXZpZ2F0aW9uXG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb259IGNvbmZpZ3VyYXRpb24gLSBDb25maWd1cmF0aW9uXG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdG9yUm91dGVyLkRhdGF9IHJvdXRlckRhdGEgLSBSZWZsZWN0cyB0aGUgY3VycmVudCByb3V0ZXIgc3RhdGVcbiAgICovXG4gIG9uQWRkVG9DYXJ0KFxuICAgIGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uLFxuICAgIHJvdXRlckRhdGE6IENvbmZpZ3VyYXRvclJvdXRlci5EYXRhXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IHBhZ2VUeXBlID0gcm91dGVyRGF0YS5wYWdlVHlwZTtcbiAgICBjb25zdCBjb25maWd1cmF0b3JUeXBlID0gY29uZmlndXJhdGlvbi5vd25lci5jb25maWd1cmF0b3JUeXBlO1xuICAgIGNvbnN0IGlzT3ZlcnZpZXcgPSBwYWdlVHlwZSA9PT0gQ29uZmlndXJhdG9yUm91dGVyLlBhZ2VUeXBlLk9WRVJWSUVXO1xuICAgIGNvbnN0IGlzT3duZXJDYXJ0RW50cnkgPVxuICAgICAgcm91dGVyRGF0YS5vd25lci50eXBlID09PSBDb21tb25Db25maWd1cmF0b3IuT3duZXJUeXBlLkNBUlRfRU5UUlk7XG4gICAgY29uc3Qgb3duZXIgPSBjb25maWd1cmF0aW9uLm93bmVyO1xuXG4gICAgY29uc3QgY3VycmVudEdyb3VwID0gY29uZmlndXJhdGlvbi5pbnRlcmFjdGlvblN0YXRlLmN1cnJlbnRHcm91cDtcbiAgICBpZiAoY3VycmVudEdyb3VwKSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyYXRvckdyb3Vwc1NlcnZpY2Uuc2V0R3JvdXBTdGF0dXNWaXNpdGVkKFxuICAgICAgICBjb25maWd1cmF0aW9uLm93bmVyLFxuICAgICAgICBjdXJyZW50R3JvdXBcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuY29udGFpbmVyJFxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcigoY29udCkgPT4gIWNvbnQuaGFzUGVuZGluZ0NoYW5nZXMpLFxuICAgICAgICB0YWtlKDEpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgaWYgKGlzT3duZXJDYXJ0RW50cnkpIHtcbiAgICAgICAgICB0aGlzLm9uVXBkYXRlQ2FydChjb25maWd1cmF0aW9uLCBjb25maWd1cmF0b3JUeXBlLCBvd25lciwgaXNPdmVydmlldyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5vbkFkZFRvQ2FydEZvclByb2R1Y3QoXG4gICAgICAgICAgICBvd25lcixcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgICBjb25maWd1cmF0b3JUeXBlLFxuICAgICAgICAgICAgaXNPdmVydmlld1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIG9uQWRkVG9DYXJ0Rm9yUHJvZHVjdChcbiAgICBvd25lcjogQ29tbW9uQ29uZmlndXJhdG9yLk93bmVyLFxuICAgIGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uLFxuICAgIGNvbmZpZ3VyYXRvclR5cGU6IHN0cmluZyxcbiAgICBpc092ZXJ2aWV3OiBib29sZWFuXG4gICkge1xuICAgIGNvbnN0IHF1YW50aXR5ID0gdGhpcy5xdWFudGl0eUNvbnRyb2wudmFsdWU7XG4gICAgdGhpcy5jb25maWd1cmF0b3JDYXJ0U2VydmljZS5hZGRUb0NhcnQoXG4gICAgICBvd25lci5pZCxcbiAgICAgIGNvbmZpZ3VyYXRpb24uY29uZmlnSWQsXG4gICAgICBvd25lcixcbiAgICAgIHF1YW50aXR5XG4gICAgKTtcblxuICAgIHRoaXMuY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2VcbiAgICAgIC5nZXRDb25maWd1cmF0aW9uKG93bmVyKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcihcbiAgICAgICAgICAoY29uZmlnV2l0aE5leHRPd25lcikgPT4gY29uZmlnV2l0aE5leHRPd25lci5uZXh0T3duZXIgIT09IHVuZGVmaW5lZFxuICAgICAgICApLFxuICAgICAgICB0YWtlKDEpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKChjb25maWdXaXRoTmV4dE93bmVyKSA9PiB7XG4gICAgICAgIC8vU2VlIHByZWNlZGluZyBmaWx0ZXIgb3BlcmF0b3I6IGNvbmZpZ1dpdGhOZXh0T3duZXIubmV4dE93bmVyIGlzIGFsd2F5cyBkZWZpbmVkIGhlcmVcbiAgICAgICAgdGhpcy5uYXZpZ2F0ZUZvclByb2R1Y3RCb3VuZChcbiAgICAgICAgICBjb25maWdXaXRoTmV4dE93bmVyLFxuICAgICAgICAgIGNvbmZpZ3VyYXRvclR5cGUsXG4gICAgICAgICAgaXNPdmVydmlld1xuICAgICAgICApO1xuICAgICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgbmF2aWdhdGVGb3JQcm9kdWN0Qm91bmQoXG4gICAgY29uZmlnV2l0aE5leHRPd25lcjogQ29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb24sXG4gICAgY29uZmlndXJhdG9yVHlwZTogc3RyaW5nLFxuICAgIGlzT3ZlcnZpZXc6IGJvb2xlYW5cbiAgKSB7XG4gICAgY29uc3QgbmV4dE93bmVyID1cbiAgICAgIGNvbmZpZ1dpdGhOZXh0T3duZXIubmV4dE93bmVyID8/XG4gICAgICBDb25maWd1cmF0b3JNb2RlbFV0aWxzLmNyZWF0ZUluaXRpYWxPd25lcigpO1xuXG4gICAgdGhpcy5wZXJmb3JtTmF2aWdhdGlvbihjb25maWd1cmF0b3JUeXBlLCBuZXh0T3duZXIsIHRydWUsIGlzT3ZlcnZpZXcsIHRydWUpO1xuXG4gICAgLy8gd2UgY2xlYW4gdXAgdGhlIGNhcnQgZW50cnkgcmVsYXRlZCBjb25maWd1cmF0aW9uLCBhcyB3ZSBtaWdodCBoYXZlIGFcbiAgICAvLyBjb25maWd1cmF0aW9uIGZvciB0aGUgc2FtZSBjYXJ0IGVudHJ5IG51bWJlciBzdG9yZWQgYWxyZWFkeS5cbiAgICAvLyAoQ2FydCBlbnRyaWVzIG1pZ2h0IGhhdmUgYmVlbiBkZWxldGVkKVxuICAgIC8vIE5lZWRzIHRvIGhhcHBlbiBvbmx5IGlmIHdlIGFyZSBvbiBjb25maWd1cmF0aW9uIHBhZ2UsIG5hdmlnYXRpb24gdG9cbiAgICAvLyBjYXJ0IHdpbGwgYW55aG93IGRlbGV0ZS5cbiAgICAvLyBXZSBkbyBub3QgY2xlYW4gdXAgdGhlIHByb2R1Y3QgYm91bmQgY29uZmlndXJhdGlvbiB5ZXQsIGFzIGV4aXN0aW5nXG4gICAgLy8gb2JzZXJ2YWJsZXMgd291bGQgaW5zdGFudGx5IHRyaWdnZXIgYSByZS1jcmVhdGUuXG4gICAgLy8gQ2xlYW5pbmcgdXAgdGhpcyBvYnNvbGV0ZSBwcm9kdWN0IGJvdW5kIGNvbmZpZ3VyYXRpb24gKHdpdGggbGluayB0byB0aGUgY2FydCkgd2lsbFxuICAgIC8vIG9ubHkgaGFwcGVuIG9uIGxlYXZpbmcgdGhlIGNvbmZpZ3VyYXRvciBwYWdlcywgc2VlIENvbmZpZ3VyYXRvclJvdXRlckxpc3RlbmVyXG4gICAgaWYgKCFpc092ZXJ2aWV3KSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLnJlbW92ZUNvbmZpZ3VyYXRpb24obmV4dE93bmVyKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgb25VcGRhdGVDYXJ0KFxuICAgIGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uLFxuICAgIGNvbmZpZ3VyYXRvclR5cGU6IHN0cmluZyxcbiAgICBvd25lcjogQ29tbW9uQ29uZmlndXJhdG9yLk93bmVyLFxuICAgIGlzT3ZlcnZpZXc6IGJvb2xlYW5cbiAgKSB7XG4gICAgaWYgKGNvbmZpZ3VyYXRpb24uaXNDYXJ0RW50cnlVcGRhdGVSZXF1aXJlZCkge1xuICAgICAgdGhpcy5jb25maWd1cmF0b3JDYXJ0U2VydmljZS51cGRhdGVDYXJ0RW50cnkoY29uZmlndXJhdGlvbik7XG4gICAgfVxuXG4gICAgdGhpcy5wZXJmb3JtTmF2aWdhdGlvbihcbiAgICAgIGNvbmZpZ3VyYXRvclR5cGUsXG4gICAgICBvd25lcixcbiAgICAgIGZhbHNlLFxuICAgICAgaXNPdmVydmlldyxcbiAgICAgIGNvbmZpZ3VyYXRpb24uaXNDYXJ0RW50cnlVcGRhdGVSZXF1aXJlZCA/PyBmYWxzZVxuICAgICk7XG4gICAgLy9Pbmx5IHJlbW92ZSBpZiB3ZSBhcmUgb24gY29uZmlndXJhdGlvbiBwYWdlLCBiZWNhdXNlIG9uIGZpbmFsIGNhcnQgbmF2aWdhdGlvbixcbiAgICAvL3RoZSBjb25maWd1cmF0aW9uIHdpbGwgYW55aG93IGJlIHJlbW92ZWRcbiAgICBpZiAoY29uZmlndXJhdGlvbi5pc0NhcnRFbnRyeVVwZGF0ZVJlcXVpcmVkICYmICFpc092ZXJ2aWV3KSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLnJlbW92ZUNvbmZpZ3VyYXRpb24ob3duZXIpO1xuICAgIH1cbiAgfVxuXG4gIGxlYXZlQ29uZmlndXJhdGlvbk92ZXJ2aWV3KCk6IHZvaWQge1xuICAgIHRoaXMuY29udGFpbmVyJC5waXBlKHRha2UoMSkpLnN1YnNjcmliZSgoY29udGFpbmVyKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGNvbnRhaW5lci5yb3V0ZXJEYXRhLm93bmVyLnR5cGUgPT09XG4gICAgICAgIENvbW1vbkNvbmZpZ3VyYXRvci5Pd25lclR5cGUuT1JERVJfRU5UUllcbiAgICAgICkge1xuICAgICAgICB0aGlzLmdvVG9PcmRlckRldGFpbHMoY29udGFpbmVyLnJvdXRlckRhdGEub3duZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yb3V0aW5nU2VydmljZS5nbyh7IGN4Um91dGU6ICdjaGVja291dFJldmlld09yZGVyJyB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnb1RvT3JkZXJEZXRhaWxzKG93bmVyOiBDb21tb25Db25maWd1cmF0b3IuT3duZXIpOiB2b2lkIHtcbiAgICB0aGlzLm9yZGVySGlzdG9yeUZhY2FkZS5sb2FkT3JkZXJEZXRhaWxzKFxuICAgICAgdGhpcy5jb21tb25Db25maWd1cmF0b3JVdGlsc1NlcnZpY2UuZGVjb21wb3NlT3duZXJJZChvd25lci5pZCkuZG9jdW1lbnRJZFxuICAgICk7XG4gICAgdGhpcy5vcmRlckhpc3RvcnlGYWNhZGVcbiAgICAgIC5nZXRPcmRlckRldGFpbHMoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcigob3JkZXI6IE9yZGVyKSA9PiBvcmRlciAhPT0gdW5kZWZpbmVkKSxcbiAgICAgICAgdGFrZSgxKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgob3JkZXI6IE9yZGVyKSA9PlxuICAgICAgICB0aGlzLnJvdXRpbmdTZXJ2aWNlLmdvKHsgY3hSb3V0ZTogJ29yZGVyRGV0YWlscycsIHBhcmFtczogb3JkZXIgfSlcbiAgICAgICk7XG4gIH1cblxuICBleHRyYWN0Q29uZmlnUHJpY2VzKGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uKSB7XG4gICAgY29uc3QgcHJpY2VTdW1tYXJ5ID0gY29uZmlndXJhdGlvbi5wcmljZVN1bW1hcnk7XG4gICAgY29uc3QgYmFzZVByaWNlID0gcHJpY2VTdW1tYXJ5Py5iYXNlUHJpY2U/LmZvcm1hdHRlZFZhbHVlO1xuICAgIGNvbnN0IHNlbGVjdGVkT3B0aW9ucyA9IHByaWNlU3VtbWFyeT8uc2VsZWN0ZWRPcHRpb25zPy5mb3JtYXR0ZWRWYWx1ZTtcbiAgICBjb25zdCB0b3RhbFByaWNlID0gcHJpY2VTdW1tYXJ5Py5jdXJyZW50VG90YWw/LmZvcm1hdHRlZFZhbHVlO1xuICAgIGNvbnN0IHByaWNlcyA9IHtcbiAgICAgIGJhc2VQcmljZTogYmFzZVByaWNlLFxuICAgICAgc2VsZWN0ZWRPcHRpb25zOiBzZWxlY3RlZE9wdGlvbnMsXG4gICAgICB0b3RhbFByaWNlOiB0b3RhbFByaWNlLFxuICAgIH07XG4gICAgaWYgKCFiYXNlUHJpY2UgfHwgYmFzZVByaWNlID09PSAnLScpIHtcbiAgICAgIHByaWNlcy5iYXNlUHJpY2UgPSAnMCc7XG4gICAgfVxuICAgIGlmICghc2VsZWN0ZWRPcHRpb25zIHx8IHNlbGVjdGVkT3B0aW9ucyA9PT0gJy0nKSB7XG4gICAgICBwcmljZXMuc2VsZWN0ZWRPcHRpb25zID0gJzAnO1xuICAgIH1cbiAgICBpZiAoIXRvdGFsUHJpY2UgfHwgdG90YWxQcmljZSA9PT0gJy0nKSB7XG4gICAgICBwcmljZXMudG90YWxQcmljZSA9ICcwJztcbiAgICB9XG4gICAgcmV0dXJuIHByaWNlcztcbiAgfVxuXG4gIHByb3RlY3RlZCBtYWtlQWRkVG9DYXJ0QnV0dG9uU3RpY2t5KCk6IHZvaWQge1xuICAgIC8vIFRoZSBhZGQtdG8tY2FydCBidXR0b24gaGFzIHRvIGJlIHNob3duIGF0IHRoZSBib3R0b20gb2YgdGhlIGNvbmZpZ3VyYXRpb24gdmlld1xuICAgIC8vIGFuZCBzY3JvbGxlZCBvdXQgdG9nZXRoZXIgd2l0aCB0aGUgY29uZmlndXJhdGlvbiB2aWV3IHdoZW4gaXQgaXMgbW92ZWQgdG8gdGhlIHRvcCBvdXQgZnJvbSB0aGUgdmlld3BvcnQuXG4gICAgLy8gRnJvbSB0aGUgdGVjaG5pY2FsIHBvaW50IG9mIHZpZXcgaXQgaXMgY29udHJvbGxlZCBieSBjaGVja2luZyB3aGV0aGVyIHRoZSBhZGQtdG8tY2FydCBidXR0b24gaW50ZXJzZWN0cyB0aGUgcHJpY2Utc3VtbWFyeSBvciBub3Q6XG4gICAgLy8gdGhlIGFkZC10by1jYXJ0IGJ1dHRvbiBoYXMgdG8gYmUgc2hvd24gc3RpY2t5LCBpZiBpbnRlcnNlY3RzLCBhbmQgZml4ZWQsIGlmIG5vdC5cbiAgICAvLyBUbyBhdm9pZCB0aGUgc2l0dWF0aW9uIHdoZXJlIHRoZSBhZGQtdG8tY2FydCBidXR0b24gaXMgc2hvd24gZml4ZWQgYmVsb3cgdGhlIGZvb3RlciB2aWV3XG4gICAgLy8gd2hlbiB0aGUgY29uZmlndXJhdGlvbiB2aWV3IGlzIHNjcm9sbGVkIG91dCB0byB0aGUgdG9wIG9uIHNtYWxsIG1vYmlsZSBzY3JlZW5zLCB3ZSB1c2UgdGhlIHJvb3RNYXJnaW4gcGFyYW1ldGVyLlxuICAgIC8vIFRoZSBmaXJzdCBmaWVsZCBvZiB0aGUgcm9vdE1hcmdpbiBjb250cm9scyB0aGUgZGVsYXkgaW4gcGl4ZWwgYWZ0ZXIgdGhlbSB0aGUgYWRkLXRvLWNhcnQgYnV0dG9uIGhhcyB0byBiZSBzaG93biBmaXhlZCBhZ2Fpbi5cbiAgICAvLyBXZSBzZXQgdGhpcyB2YWx1ZSB2ZXJ5IGhpZ2gsIHNvIHRoZSBhZGQtdG8tY2FydCBidXR0b24gd2lsbCBuZXZlciBhcHBlYXIgYmVsb3cgdGhlIGZvb3RlciB2aWV3IGV2ZW4gaW4gY2FzZSBvZiBzbWFsbCBzY3JlZW5zLlxuICAgIGNvbnN0IG9wdGlvbnM6IEludGVyc2VjdGlvbk9wdGlvbnMgPSB7XG4gICAgICByb290TWFyZ2luOiAnOTk5OXB4IDBweCAtMTAwcHggMHB4JyxcbiAgICB9O1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKFxuICAgICAgdGhpcy5jb250YWluZXIkXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHRha2UoMSksXG4gICAgICAgICAgZGVsYXkoMCksXG4gICAgICAgICAgbWFwKCgpID0+XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ1V0aWxzLmdldEVsZW1lbnQoJ2N4LWNvbmZpZ3VyYXRvci1wcmljZS1zdW1tYXJ5JylcbiAgICAgICAgICApLFxuICAgICAgICAgIHN3aXRjaE1hcCgocHJpY2VTdW1tYXJ5KSA9PlxuICAgICAgICAgICAgcHJpY2VTdW1tYXJ5XG4gICAgICAgICAgICAgID8gdGhpcy5pbnRlcnNlY3Rpb25TZXJ2aWNlLmlzSW50ZXJzZWN0aW5nKHByaWNlU3VtbWFyeSwgb3B0aW9ucylcbiAgICAgICAgICAgICAgOiBvZih1bmRlZmluZWQpXG4gICAgICAgICAgKSxcbiAgICAgICAgICBmaWx0ZXIoKGlzSW50ZXJzZWN0aW5nKSA9PiBpc0ludGVyc2VjdGluZyAhPT0gdW5kZWZpbmVkKVxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKGlzSW50ZXJzZWN0aW5nKSA9PiB7XG4gICAgICAgICAgaWYgKGlzSW50ZXJzZWN0aW5nKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ1V0aWxzLmNoYW5nZVN0eWxpbmcoQ1hfU0VMRUNUT1IsICdwb3NpdGlvbicsICdzdGlja3knKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jb25maWdVdGlscy5jaGFuZ2VTdHlsaW5nKENYX1NFTEVDVE9SLCAncG9zaXRpb24nLCAnZml4ZWQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXIgKm5nSWY9XCJjb250YWluZXIkIHwgYXN5bmMgYXMgY29udGFpbmVyXCI+XG4gIDxuZy1jb250YWluZXIgKm5nSWY9XCIhY29udGFpbmVyLnJvdXRlckRhdGEuZGlzcGxheU9ubHk7IGVsc2UgZGlzcGxheU9ubHlcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY3gtYWRkLXRvLWNhcnQtYnRuLWNvbnRhaW5lclwiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqY3hGZWF0dXJlTGV2ZWw9XCInITYuMSdcIj5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIGNsYXNzPVwiY3gtYnRuIGJ0biBidG4tYmxvY2sgYnRuLXByaW1hcnkgY3gtYWRkLXRvLWNhcnQtYnRuXCJcbiAgICAgICAgICAoY2xpY2spPVwib25BZGRUb0NhcnQoY29udGFpbmVyLmNvbmZpZ3VyYXRpb24sIGNvbnRhaW5lci5yb3V0ZXJEYXRhKVwiXG4gICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJcbiAgICAgICAgICAgIChnZXRCdXR0b25SZXNvdXJjZUtleShjb250YWluZXIucm91dGVyRGF0YSwgY29udGFpbmVyLmNvbmZpZ3VyYXRpb24pXG4gICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGUpICtcbiAgICAgICAgICAgICcgJyArXG4gICAgICAgICAgICAoJ2NvbmZpZ3VyYXRvci5hMTF5LmFkZFRvQ2FydFByaWNlcydcbiAgICAgICAgICAgICAgfCBjeFRyYW5zbGF0ZTogZXh0cmFjdENvbmZpZ1ByaWNlcyhjb250YWluZXIuY29uZmlndXJhdGlvbikpXG4gICAgICAgICAgXCJcbiAgICAgICAgPlxuICAgICAgICAgIHt7XG4gICAgICAgICAgICBnZXRCdXR0b25SZXNvdXJjZUtleShjb250YWluZXIucm91dGVyRGF0YSwgY29udGFpbmVyLmNvbmZpZ3VyYXRpb24pXG4gICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICB9fVxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPG5nLWNvbnRhaW5lciAqY3hGZWF0dXJlTGV2ZWw9XCInNi4xJ1wiPlxuICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWlzQ2FydEVudHJ5KGNvbnRhaW5lci5yb3V0ZXJEYXRhKVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1xdWFudGl0eS1hZGQtdG8tY2FydC1jb250YWluZXJcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1xdWFudGl0eS1hZGQtdG8tY2FydC1yb3dcIj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImN4LXF1YW50aXR5XCI+XG4gICAgICAgICAgICAgICAgPGxhYmVsPnt7XG4gICAgICAgICAgICAgICAgICAnY29uZmlndXJhdG9yLmFkZFRvQ2FydC5xdWFudGl0eScgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgICAgICAgIH19PC9sYWJlbD5cbiAgICAgICAgICAgICAgICA8Y3gtaXRlbS1jb3VudGVyIFtjb250cm9sXT1cInF1YW50aXR5Q29udHJvbFwiPjwvY3gtaXRlbS1jb3VudGVyPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgICAgIGNsYXNzPVwiY3gtYnRuIGJ0biBidG4tYmxvY2sgYnRuLXByaW1hcnkgY3gtYWRkLXRvLWNhcnQtYnRuXCJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwiXG4gICAgICAgICAgICAgICAgICBvbkFkZFRvQ2FydChjb250YWluZXIuY29uZmlndXJhdGlvbiwgY29udGFpbmVyLnJvdXRlckRhdGEpXG4gICAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgICAgICAgKGdldEJ1dHRvblJlc291cmNlS2V5KFxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIucm91dGVyRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICAgICkgfCBjeFRyYW5zbGF0ZSkgK1xuICAgICAgICAgICAgICAgICAgJyAnICtcbiAgICAgICAgICAgICAgICAgICgnY29uZmlndXJhdG9yLmExMXkuYWRkVG9DYXJ0UHJpY2VzJ1xuICAgICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlOiBleHRyYWN0Q29uZmlnUHJpY2VzKGNvbnRhaW5lci5jb25maWd1cmF0aW9uKSlcbiAgICAgICAgICAgICAgICBcIlxuICAgICAgICAgICAgICAgIHRpdGxlPVwie3tcbiAgICAgICAgICAgICAgICAgIGdldEJ1dHRvblJlc291cmNlS2V5KFxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIucm91dGVyRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICAgICkgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgICAgICAgIH19XCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxjeC1pY29uIFt0eXBlXT1cImljb25UeXBlLkNBUlRfUExVU1wiPjwvY3gtaWNvbj5cbiAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJpc0NhcnRFbnRyeShjb250YWluZXIucm91dGVyRGF0YSlcIj5cbiAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICBjbGFzcz1cImN4LWJ0biBidG4gYnRuLWJsb2NrIGJ0bi1wcmltYXJ5IGN4LWFkZC10by1jYXJ0LWJ0blwiXG4gICAgICAgICAgICAoY2xpY2spPVwib25BZGRUb0NhcnQoY29udGFpbmVyLmNvbmZpZ3VyYXRpb24sIGNvbnRhaW5lci5yb3V0ZXJEYXRhKVwiXG4gICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgICAoZ2V0QnV0dG9uUmVzb3VyY2VLZXkoXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnJvdXRlckRhdGEsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgKSB8IGN4VHJhbnNsYXRlKSArXG4gICAgICAgICAgICAgICcgJyArXG4gICAgICAgICAgICAgICgnY29uZmlndXJhdG9yLmExMXkuYWRkVG9DYXJ0UHJpY2VzJ1xuICAgICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGU6IGV4dHJhY3RDb25maWdQcmljZXMoY29udGFpbmVyLmNvbmZpZ3VyYXRpb24pKVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7e1xuICAgICAgICAgICAgICBnZXRCdXR0b25SZXNvdXJjZUtleShcbiAgICAgICAgICAgICAgICBjb250YWluZXIucm91dGVyRGF0YSxcbiAgICAgICAgICAgICAgICBjb250YWluZXIuY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICApIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9kaXY+XG4gIDwvbmctY29udGFpbmVyPlxuICA8bmctdGVtcGxhdGUgI2Rpc3BsYXlPbmx5PlxuICAgIDxkaXYgY2xhc3M9XCJjeC1kaXNwbGF5LW9ubHktYnRuLWNvbnRhaW5lclwiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqY3hGZWF0dXJlTGV2ZWw9XCInITYuMSdcIj5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIGNsYXNzPVwiY3gtYnRuIGJ0biBidG4tYmxvY2sgYnRuLXByaW1hcnkgY3gtZGlzcGxheS1vbmx5LWJ0blwiXG4gICAgICAgICAgKGNsaWNrKT1cImxlYXZlQ29uZmlndXJhdGlvbk92ZXJ2aWV3KClcIlxuICAgICAgICA+XG4gICAgICAgICAge3sgJ2NvbmZpZ3VyYXRvci5hZGRUb0NhcnQuYnV0dG9uRGlzcGxheU9ubHknIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDxuZy1jb250YWluZXIgKmN4RmVhdHVyZUxldmVsPVwiJzYuMSdcIj5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIGNsYXNzPVwiY3gtYnRuIGJ0biBidG4tYmxvY2sgYnRuLXNlY29uZGFyeSBjeC1kaXNwbGF5LW9ubHktYnRuXCJcbiAgICAgICAgICAoY2xpY2spPVwibGVhdmVDb25maWd1cmF0aW9uT3ZlcnZpZXcoKVwiXG4gICAgICAgID5cbiAgICAgICAgICB7eyAnY29uZmlndXJhdG9yLmFkZFRvQ2FydC5idXR0b25DbG9zZScgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvZGl2PlxuICA8L25nLXRlbXBsYXRlPlxuPC9uZy1jb250YWluZXI+XG4iXX0=