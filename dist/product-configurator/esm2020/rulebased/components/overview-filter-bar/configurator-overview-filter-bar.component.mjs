/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Component, Input } from '@angular/core';
import { ICON_TYPE } from '@spartacus/storefront';
import { Configurator } from '../../core/model/configurator.model';
import * as i0 from "@angular/core";
import * as i1 from "../../core/facade/configurator-commons.service";
import * as i2 from "@angular/common";
import * as i3 from "@spartacus/storefront";
import * as i4 from "@spartacus/core";
export class ConfiguratorOverviewFilterBarComponent {
    constructor(configuratorCommonsService) {
        this.configuratorCommonsService = configuratorCommonsService;
        this.iconTypes = ICON_TYPE;
        this.attributeFilterTypes = Configurator.OverviewFilter;
    }
    /**
     * gets the description for the given group id
     *
     * @param {string} groupId groupId
     * @param {Configurator.ConfigurationWithOverview} config - current configuration with overview data
     */
    getGroupFilterDescription(overview, groupId) {
        return (overview.possibleGroups?.find((group) => group.id === groupId)
            ?.groupDescription ?? '');
    }
    /**
     * removes the given attribute filter and updates the configuration overview accordingly
     *
     * @param {Configurator.OverviewFilter} attrToRemove attribute filter to remove
     * @param {Configurator.ConfigurationWithOverview} config - current configuration with overview data
     */
    onAttrFilterRemove(config, attrToRemove) {
        let [attrFilters, groupFilters] = this.getInputFilters(config.overview);
        attrFilters = attrFilters.filter((attrFilterName) => attrToRemove !== attrFilterName);
        this.configuratorCommonsService.updateConfigurationOverview(this.createInputConfig(config, attrFilters, groupFilters));
    }
    /**
     * removes the given group filter and updates the configuration overview accordingly
     *
     * @param {string} groupIdToRemove id of the group to be removed from filtering
     * @param {Configurator.ConfigurationWithOverview} config - current configuration with overview data
     */
    onGroupFilterRemove(config, groupIdToRemove) {
        let [attrFilters, groupFilters] = this.getInputFilters(config.overview);
        groupFilters = groupFilters.filter((groupId) => groupIdToRemove !== groupId);
        this.configuratorCommonsService.updateConfigurationOverview(this.createInputConfig(config, attrFilters, groupFilters));
    }
    /**
     * check whether the button to remove all filters should be shown
     *
     * @param {Configurator.Overview} overview - current configuration overview data
     * @returns {boolean} - 'true' only if the button to remove all filters should be shown
     */
    isShowRemoveAll(overview) {
        const numFilters = (overview.attributeFilters?.length ?? 0) +
            (overview.groupFilters?.length ?? 0);
        return numFilters > 1;
    }
    /**
     * removes all filters and updates the configuration overview accordingly
     *
     * @param {Configurator.ConfigurationWithOverview} config - current configuration with overview data
     */
    onRemoveAll(config) {
        this.configuratorCommonsService.updateConfigurationOverview(this.createInputConfig(config, [], []));
    }
    getInputFilters(overview) {
        return [overview.attributeFilters ?? [], overview.groupFilters ?? []];
    }
    createInputConfig(config, attrFilters, groupFilers) {
        return {
            ...config,
            overview: {
                configId: config.configId,
                productCode: config.productCode,
                attributeFilters: attrFilters,
                groupFilters: groupFilers,
                possibleGroups: config.overview?.possibleGroups,
            },
        };
    }
}
ConfiguratorOverviewFilterBarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorOverviewFilterBarComponent, deps: [{ token: i1.ConfiguratorCommonsService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorOverviewFilterBarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorOverviewFilterBarComponent, selector: "cx-configurator-overview-filter-bar", inputs: { config: "config" }, ngImport: i0, template: "<ng-container\n  *ngFor=\"let filter of config.overview.attributeFilters; let i = index\"\n>\n  <button\n    class=\"cx-overview-filter-applied\"\n    title=\"{{\n      (filter === attributeFilterTypes.PRICE_RELEVANT\n        ? 'configurator.overviewFilter.removeByPrice'\n        : 'configurator.overviewFilter.removeMySelections'\n      ) | cxTranslate\n    }}\"\n    (click)=\"onAttrFilterRemove(config, filter)\"\n  >\n    {{\n      (filter === attributeFilterTypes.PRICE_RELEVANT\n        ? 'configurator.overviewFilter.byPrice'\n        : 'configurator.overviewFilter.mySelections'\n      ) | cxTranslate\n    }}\n    <span aria-hidden=\"true\">\n      <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n    </span>\n  </button>\n</ng-container>\n\n<ng-container\n  *ngFor=\"let groupId of config.overview.groupFilters; let i = index\"\n>\n  <button\n    class=\"cx-overview-filter-applied\"\n    title=\"{{\n      'configurator.overviewFilter.removeByGroup'\n        | cxTranslate\n          : { group: getGroupFilterDescription(config.overview, groupId) }\n    }}\"\n    (click)=\"onGroupFilterRemove(config, groupId)\"\n  >\n    {{ getGroupFilterDescription(config.overview, groupId) }}\n    <span aria-hidden=\"true\">\n      <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n    </span>\n  </button>\n</ng-container>\n\n<ng-container *ngIf=\"isShowRemoveAll(config.overview)\">\n  <button\n    class=\"cx-overview-filter-applied\"\n    title=\"{{ 'configurator.overviewFilter.removeAllFilters' | cxTranslate }}\"\n    (click)=\"onRemoveAll(config)\"\n  >\n    {{ 'configurator.overviewFilter.removeAll' | cxTranslate }}\n    <span aria-hidden=\"true\">\n      <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n    </span>\n  </button>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i3.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "pipe", type: i4.TranslatePipe, name: "cxTranslate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorOverviewFilterBarComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-overview-filter-bar', template: "<ng-container\n  *ngFor=\"let filter of config.overview.attributeFilters; let i = index\"\n>\n  <button\n    class=\"cx-overview-filter-applied\"\n    title=\"{{\n      (filter === attributeFilterTypes.PRICE_RELEVANT\n        ? 'configurator.overviewFilter.removeByPrice'\n        : 'configurator.overviewFilter.removeMySelections'\n      ) | cxTranslate\n    }}\"\n    (click)=\"onAttrFilterRemove(config, filter)\"\n  >\n    {{\n      (filter === attributeFilterTypes.PRICE_RELEVANT\n        ? 'configurator.overviewFilter.byPrice'\n        : 'configurator.overviewFilter.mySelections'\n      ) | cxTranslate\n    }}\n    <span aria-hidden=\"true\">\n      <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n    </span>\n  </button>\n</ng-container>\n\n<ng-container\n  *ngFor=\"let groupId of config.overview.groupFilters; let i = index\"\n>\n  <button\n    class=\"cx-overview-filter-applied\"\n    title=\"{{\n      'configurator.overviewFilter.removeByGroup'\n        | cxTranslate\n          : { group: getGroupFilterDescription(config.overview, groupId) }\n    }}\"\n    (click)=\"onGroupFilterRemove(config, groupId)\"\n  >\n    {{ getGroupFilterDescription(config.overview, groupId) }}\n    <span aria-hidden=\"true\">\n      <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n    </span>\n  </button>\n</ng-container>\n\n<ng-container *ngIf=\"isShowRemoveAll(config.overview)\">\n  <button\n    class=\"cx-overview-filter-applied\"\n    title=\"{{ 'configurator.overviewFilter.removeAllFilters' | cxTranslate }}\"\n    (click)=\"onRemoveAll(config)\"\n  >\n    {{ 'configurator.overviewFilter.removeAll' | cxTranslate }}\n    <span aria-hidden=\"true\">\n      <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n    </span>\n  </button>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorCommonsService }]; }, propDecorators: { config: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZpbHRlci1iYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL292ZXJ2aWV3LWZpbHRlci1iYXIvY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZpbHRlci1iYXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL292ZXJ2aWV3LWZpbHRlci1iYXIvY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZpbHRlci1iYXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVsRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUNBQXFDLENBQUM7Ozs7OztBQU1uRSxNQUFNLE9BQU8sc0NBQXNDO0lBQ2pELFlBQ1ksMEJBQXNEO1FBQXRELCtCQUEwQixHQUExQiwwQkFBMEIsQ0FBNEI7UUFLbEUsY0FBUyxHQUFHLFNBQVMsQ0FBQztRQUN0Qix5QkFBb0IsR0FBRyxZQUFZLENBQUMsY0FBYyxDQUFDO0lBTGhELENBQUM7SUFPSjs7Ozs7T0FLRztJQUNILHlCQUF5QixDQUN2QixRQUErQixFQUMvQixPQUFlO1FBRWYsT0FBTyxDQUNMLFFBQVEsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLE9BQU8sQ0FBQztZQUM1RCxFQUFFLGdCQUFnQixJQUFJLEVBQUUsQ0FDM0IsQ0FBQztJQUNKLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILGtCQUFrQixDQUNoQixNQUE4QyxFQUM5QyxZQUF5QztRQUV6QyxJQUFJLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3hFLFdBQVcsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUM5QixDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsWUFBWSxLQUFLLGNBQWMsQ0FDcEQsQ0FBQztRQUVGLElBQUksQ0FBQywwQkFBMEIsQ0FBQywyQkFBMkIsQ0FDekQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUUsWUFBWSxDQUFDLENBQzFELENBQUM7SUFDSixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxtQkFBbUIsQ0FDakIsTUFBOEMsRUFDOUMsZUFBdUI7UUFFdkIsSUFBSSxDQUFDLFdBQVcsRUFBRSxZQUFZLENBQUMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4RSxZQUFZLEdBQUcsWUFBWSxDQUFDLE1BQU0sQ0FDaEMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLGVBQWUsS0FBSyxPQUFPLENBQ3pDLENBQUM7UUFFRixJQUFJLENBQUMsMEJBQTBCLENBQUMsMkJBQTJCLENBQ3pELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUMxRCxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsZUFBZSxDQUFDLFFBQStCO1FBQzdDLE1BQU0sVUFBVSxHQUNkLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFLE1BQU0sSUFBSSxDQUFDLENBQUM7WUFDeEMsQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN2QyxPQUFPLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxXQUFXLENBQUMsTUFBOEM7UUFDeEQsSUFBSSxDQUFDLDBCQUEwQixDQUFDLDJCQUEyQixDQUN6RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FDdkMsQ0FBQztJQUNKLENBQUM7SUFFUyxlQUFlLENBQ3ZCLFFBQStCO1FBRS9CLE9BQU8sQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLElBQUksRUFBRSxFQUFFLFFBQVEsQ0FBQyxZQUFZLElBQUksRUFBRSxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVTLGlCQUFpQixDQUN6QixNQUE4QyxFQUM5QyxXQUEwQyxFQUMxQyxXQUFxQjtRQUVyQixPQUFPO1lBQ0wsR0FBRyxNQUFNO1lBQ1QsUUFBUSxFQUFFO2dCQUNSLFFBQVEsRUFBRSxNQUFNLENBQUMsUUFBUTtnQkFDekIsV0FBVyxFQUFFLE1BQU0sQ0FBQyxXQUFXO2dCQUMvQixnQkFBZ0IsRUFBRSxXQUFXO2dCQUM3QixZQUFZLEVBQUUsV0FBVztnQkFDekIsY0FBYyxFQUFFLE1BQU0sQ0FBQyxRQUFRLEVBQUUsY0FBYzthQUNoRDtTQUNGLENBQUM7SUFDSixDQUFDOzttSUEvR1Usc0NBQXNDO3VIQUF0QyxzQ0FBc0MseUdDZm5ELCt0REF3REE7MkZEekNhLHNDQUFzQztrQkFKbEQsU0FBUzsrQkFDRSxxQ0FBcUM7aUhBUXRDLE1BQU07c0JBQWQsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IElDT05fVFlQRSB9IGZyb20gJ0BzcGFydGFjdXMvc3RvcmVmcm9udCc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JDb21tb25zU2VydmljZSB9IGZyb20gJy4uLy4uL2NvcmUvZmFjYWRlL2NvbmZpZ3VyYXRvci1jb21tb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yIH0gZnJvbSAnLi4vLi4vY29yZS9tb2RlbC9jb25maWd1cmF0b3IubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1jb25maWd1cmF0b3Itb3ZlcnZpZXctZmlsdGVyLWJhcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0b3Itb3ZlcnZpZXctZmlsdGVyLWJhci5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIENvbmZpZ3VyYXRvck92ZXJ2aWV3RmlsdGVyQmFyQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlOiBDb25maWd1cmF0b3JDb21tb25zU2VydmljZVxuICApIHt9XG5cbiAgQElucHV0KCkgY29uZmlnOiBDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbldpdGhPdmVydmlldztcblxuICBpY29uVHlwZXMgPSBJQ09OX1RZUEU7XG4gIGF0dHJpYnV0ZUZpbHRlclR5cGVzID0gQ29uZmlndXJhdG9yLk92ZXJ2aWV3RmlsdGVyO1xuXG4gIC8qKlxuICAgKiBnZXRzIHRoZSBkZXNjcmlwdGlvbiBmb3IgdGhlIGdpdmVuIGdyb3VwIGlkXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBncm91cElkIGdyb3VwSWRcbiAgICogQHBhcmFtIHtDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbldpdGhPdmVydmlld30gY29uZmlnIC0gY3VycmVudCBjb25maWd1cmF0aW9uIHdpdGggb3ZlcnZpZXcgZGF0YVxuICAgKi9cbiAgZ2V0R3JvdXBGaWx0ZXJEZXNjcmlwdGlvbihcbiAgICBvdmVydmlldzogQ29uZmlndXJhdG9yLk92ZXJ2aWV3LFxuICAgIGdyb3VwSWQ6IHN0cmluZ1xuICApOiBzdHJpbmcge1xuICAgIHJldHVybiAoXG4gICAgICBvdmVydmlldy5wb3NzaWJsZUdyb3Vwcz8uZmluZCgoZ3JvdXApID0+IGdyb3VwLmlkID09PSBncm91cElkKVxuICAgICAgICA/Lmdyb3VwRGVzY3JpcHRpb24gPz8gJydcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIHJlbW92ZXMgdGhlIGdpdmVuIGF0dHJpYnV0ZSBmaWx0ZXIgYW5kIHVwZGF0ZXMgdGhlIGNvbmZpZ3VyYXRpb24gb3ZlcnZpZXcgYWNjb3JkaW5nbHlcbiAgICpcbiAgICogQHBhcmFtIHtDb25maWd1cmF0b3IuT3ZlcnZpZXdGaWx0ZXJ9IGF0dHJUb1JlbW92ZSBhdHRyaWJ1dGUgZmlsdGVyIHRvIHJlbW92ZVxuICAgKiBAcGFyYW0ge0NvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uV2l0aE92ZXJ2aWV3fSBjb25maWcgLSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gd2l0aCBvdmVydmlldyBkYXRhXG4gICAqL1xuICBvbkF0dHJGaWx0ZXJSZW1vdmUoXG4gICAgY29uZmlnOiBDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbldpdGhPdmVydmlldyxcbiAgICBhdHRyVG9SZW1vdmU6IENvbmZpZ3VyYXRvci5PdmVydmlld0ZpbHRlclxuICApIHtcbiAgICBsZXQgW2F0dHJGaWx0ZXJzLCBncm91cEZpbHRlcnNdID0gdGhpcy5nZXRJbnB1dEZpbHRlcnMoY29uZmlnLm92ZXJ2aWV3KTtcbiAgICBhdHRyRmlsdGVycyA9IGF0dHJGaWx0ZXJzLmZpbHRlcihcbiAgICAgIChhdHRyRmlsdGVyTmFtZSkgPT4gYXR0clRvUmVtb3ZlICE9PSBhdHRyRmlsdGVyTmFtZVxuICAgICk7XG5cbiAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLnVwZGF0ZUNvbmZpZ3VyYXRpb25PdmVydmlldyhcbiAgICAgIHRoaXMuY3JlYXRlSW5wdXRDb25maWcoY29uZmlnLCBhdHRyRmlsdGVycywgZ3JvdXBGaWx0ZXJzKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogcmVtb3ZlcyB0aGUgZ2l2ZW4gZ3JvdXAgZmlsdGVyIGFuZCB1cGRhdGVzIHRoZSBjb25maWd1cmF0aW9uIG92ZXJ2aWV3IGFjY29yZGluZ2x5XG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBncm91cElkVG9SZW1vdmUgaWQgb2YgdGhlIGdyb3VwIHRvIGJlIHJlbW92ZWQgZnJvbSBmaWx0ZXJpbmdcbiAgICogQHBhcmFtIHtDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbldpdGhPdmVydmlld30gY29uZmlnIC0gY3VycmVudCBjb25maWd1cmF0aW9uIHdpdGggb3ZlcnZpZXcgZGF0YVxuICAgKi9cbiAgb25Hcm91cEZpbHRlclJlbW92ZShcbiAgICBjb25maWc6IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uV2l0aE92ZXJ2aWV3LFxuICAgIGdyb3VwSWRUb1JlbW92ZTogc3RyaW5nXG4gICkge1xuICAgIGxldCBbYXR0ckZpbHRlcnMsIGdyb3VwRmlsdGVyc10gPSB0aGlzLmdldElucHV0RmlsdGVycyhjb25maWcub3ZlcnZpZXcpO1xuICAgIGdyb3VwRmlsdGVycyA9IGdyb3VwRmlsdGVycy5maWx0ZXIoXG4gICAgICAoZ3JvdXBJZCkgPT4gZ3JvdXBJZFRvUmVtb3ZlICE9PSBncm91cElkXG4gICAgKTtcblxuICAgIHRoaXMuY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2UudXBkYXRlQ29uZmlndXJhdGlvbk92ZXJ2aWV3KFxuICAgICAgdGhpcy5jcmVhdGVJbnB1dENvbmZpZyhjb25maWcsIGF0dHJGaWx0ZXJzLCBncm91cEZpbHRlcnMpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBjaGVjayB3aGV0aGVyIHRoZSBidXR0b24gdG8gcmVtb3ZlIGFsbCBmaWx0ZXJzIHNob3VsZCBiZSBzaG93blxuICAgKlxuICAgKiBAcGFyYW0ge0NvbmZpZ3VyYXRvci5PdmVydmlld30gb3ZlcnZpZXcgLSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gb3ZlcnZpZXcgZGF0YVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSAndHJ1ZScgb25seSBpZiB0aGUgYnV0dG9uIHRvIHJlbW92ZSBhbGwgZmlsdGVycyBzaG91bGQgYmUgc2hvd25cbiAgICovXG4gIGlzU2hvd1JlbW92ZUFsbChvdmVydmlldzogQ29uZmlndXJhdG9yLk92ZXJ2aWV3KTogYm9vbGVhbiB7XG4gICAgY29uc3QgbnVtRmlsdGVycyA9XG4gICAgICAob3ZlcnZpZXcuYXR0cmlidXRlRmlsdGVycz8ubGVuZ3RoID8/IDApICtcbiAgICAgIChvdmVydmlldy5ncm91cEZpbHRlcnM/Lmxlbmd0aCA/PyAwKTtcbiAgICByZXR1cm4gbnVtRmlsdGVycyA+IDE7XG4gIH1cblxuICAvKipcbiAgICogcmVtb3ZlcyBhbGwgZmlsdGVycyBhbmQgdXBkYXRlcyB0aGUgY29uZmlndXJhdGlvbiBvdmVydmlldyBhY2NvcmRpbmdseVxuICAgKlxuICAgKiBAcGFyYW0ge0NvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uV2l0aE92ZXJ2aWV3fSBjb25maWcgLSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gd2l0aCBvdmVydmlldyBkYXRhXG4gICAqL1xuICBvblJlbW92ZUFsbChjb25maWc6IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uV2l0aE92ZXJ2aWV3KSB7XG4gICAgdGhpcy5jb25maWd1cmF0b3JDb21tb25zU2VydmljZS51cGRhdGVDb25maWd1cmF0aW9uT3ZlcnZpZXcoXG4gICAgICB0aGlzLmNyZWF0ZUlucHV0Q29uZmlnKGNvbmZpZywgW10sIFtdKVxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0SW5wdXRGaWx0ZXJzKFxuICAgIG92ZXJ2aWV3OiBDb25maWd1cmF0b3IuT3ZlcnZpZXdcbiAgKTogW0NvbmZpZ3VyYXRvci5PdmVydmlld0ZpbHRlcltdLCBzdHJpbmdbXV0ge1xuICAgIHJldHVybiBbb3ZlcnZpZXcuYXR0cmlidXRlRmlsdGVycyA/PyBbXSwgb3ZlcnZpZXcuZ3JvdXBGaWx0ZXJzID8/IFtdXTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVJbnB1dENvbmZpZyhcbiAgICBjb25maWc6IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uV2l0aE92ZXJ2aWV3LFxuICAgIGF0dHJGaWx0ZXJzOiBDb25maWd1cmF0b3IuT3ZlcnZpZXdGaWx0ZXJbXSxcbiAgICBncm91cEZpbGVyczogc3RyaW5nW11cbiAgKTogQ29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb25XaXRoT3ZlcnZpZXcge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBvdmVydmlldzoge1xuICAgICAgICBjb25maWdJZDogY29uZmlnLmNvbmZpZ0lkLFxuICAgICAgICBwcm9kdWN0Q29kZTogY29uZmlnLnByb2R1Y3RDb2RlLFxuICAgICAgICBhdHRyaWJ1dGVGaWx0ZXJzOiBhdHRyRmlsdGVycyxcbiAgICAgICAgZ3JvdXBGaWx0ZXJzOiBncm91cEZpbGVycyxcbiAgICAgICAgcG9zc2libGVHcm91cHM6IGNvbmZpZy5vdmVydmlldz8ucG9zc2libGVHcm91cHMsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXJcbiAgKm5nRm9yPVwibGV0IGZpbHRlciBvZiBjb25maWcub3ZlcnZpZXcuYXR0cmlidXRlRmlsdGVyczsgbGV0IGkgPSBpbmRleFwiXG4+XG4gIDxidXR0b25cbiAgICBjbGFzcz1cImN4LW92ZXJ2aWV3LWZpbHRlci1hcHBsaWVkXCJcbiAgICB0aXRsZT1cInt7XG4gICAgICAoZmlsdGVyID09PSBhdHRyaWJ1dGVGaWx0ZXJUeXBlcy5QUklDRV9SRUxFVkFOVFxuICAgICAgICA/ICdjb25maWd1cmF0b3Iub3ZlcnZpZXdGaWx0ZXIucmVtb3ZlQnlQcmljZSdcbiAgICAgICAgOiAnY29uZmlndXJhdG9yLm92ZXJ2aWV3RmlsdGVyLnJlbW92ZU15U2VsZWN0aW9ucydcbiAgICAgICkgfCBjeFRyYW5zbGF0ZVxuICAgIH19XCJcbiAgICAoY2xpY2spPVwib25BdHRyRmlsdGVyUmVtb3ZlKGNvbmZpZywgZmlsdGVyKVwiXG4gID5cbiAgICB7e1xuICAgICAgKGZpbHRlciA9PT0gYXR0cmlidXRlRmlsdGVyVHlwZXMuUFJJQ0VfUkVMRVZBTlRcbiAgICAgICAgPyAnY29uZmlndXJhdG9yLm92ZXJ2aWV3RmlsdGVyLmJ5UHJpY2UnXG4gICAgICAgIDogJ2NvbmZpZ3VyYXRvci5vdmVydmlld0ZpbHRlci5teVNlbGVjdGlvbnMnXG4gICAgICApIHwgY3hUcmFuc2xhdGVcbiAgICB9fVxuICAgIDxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPlxuICAgICAgPGN4LWljb24gW3R5cGVdPVwiaWNvblR5cGVzLkNMT1NFXCI+PC9jeC1pY29uPlxuICAgIDwvc3Bhbj5cbiAgPC9idXR0b24+XG48L25nLWNvbnRhaW5lcj5cblxuPG5nLWNvbnRhaW5lclxuICAqbmdGb3I9XCJsZXQgZ3JvdXBJZCBvZiBjb25maWcub3ZlcnZpZXcuZ3JvdXBGaWx0ZXJzOyBsZXQgaSA9IGluZGV4XCJcbj5cbiAgPGJ1dHRvblxuICAgIGNsYXNzPVwiY3gtb3ZlcnZpZXctZmlsdGVyLWFwcGxpZWRcIlxuICAgIHRpdGxlPVwie3tcbiAgICAgICdjb25maWd1cmF0b3Iub3ZlcnZpZXdGaWx0ZXIucmVtb3ZlQnlHcm91cCdcbiAgICAgICAgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgIDogeyBncm91cDogZ2V0R3JvdXBGaWx0ZXJEZXNjcmlwdGlvbihjb25maWcub3ZlcnZpZXcsIGdyb3VwSWQpIH1cbiAgICB9fVwiXG4gICAgKGNsaWNrKT1cIm9uR3JvdXBGaWx0ZXJSZW1vdmUoY29uZmlnLCBncm91cElkKVwiXG4gID5cbiAgICB7eyBnZXRHcm91cEZpbHRlckRlc2NyaXB0aW9uKGNvbmZpZy5vdmVydmlldywgZ3JvdXBJZCkgfX1cbiAgICA8c3BhbiBhcmlhLWhpZGRlbj1cInRydWVcIj5cbiAgICAgIDxjeC1pY29uIFt0eXBlXT1cImljb25UeXBlcy5DTE9TRVwiPjwvY3gtaWNvbj5cbiAgICA8L3NwYW4+XG4gIDwvYnV0dG9uPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy1jb250YWluZXIgKm5nSWY9XCJpc1Nob3dSZW1vdmVBbGwoY29uZmlnLm92ZXJ2aWV3KVwiPlxuICA8YnV0dG9uXG4gICAgY2xhc3M9XCJjeC1vdmVydmlldy1maWx0ZXItYXBwbGllZFwiXG4gICAgdGl0bGU9XCJ7eyAnY29uZmlndXJhdG9yLm92ZXJ2aWV3RmlsdGVyLnJlbW92ZUFsbEZpbHRlcnMnIHwgY3hUcmFuc2xhdGUgfX1cIlxuICAgIChjbGljayk9XCJvblJlbW92ZUFsbChjb25maWcpXCJcbiAgPlxuICAgIHt7ICdjb25maWd1cmF0b3Iub3ZlcnZpZXdGaWx0ZXIucmVtb3ZlQWxsJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgPHNwYW4gYXJpYS1oaWRkZW49XCJ0cnVlXCI+XG4gICAgICA8Y3gtaWNvbiBbdHlwZV09XCJpY29uVHlwZXMuQ0xPU0VcIj48L2N4LWljb24+XG4gICAgPC9zcGFuPlxuICA8L2J1dHRvbj5cbjwvbmctY29udGFpbmVyPlxuIl19