/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, HostBinding } from '@angular/core';
import { CommonConfigurator, } from '@spartacus/product-configurator/common';
import { ICON_TYPE } from '@spartacus/storefront';
import { EMPTY } from 'rxjs';
import { map, switchMap, tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../../core/facade/configurator-commons.service";
import * as i2 from "@spartacus/product-configurator/common";
import * as i3 from "@spartacus/core";
import * as i4 from "../../core/services/configurator-expert-mode.service";
import * as i5 from "@angular/common";
import * as i6 from "@spartacus/storefront";
export class ConfiguratorProductTitleComponent {
    constructor(configuratorCommonsService, configRouterExtractorService, productService, configExpertModeService) {
        this.configuratorCommonsService = configuratorCommonsService;
        this.configRouterExtractorService = configRouterExtractorService;
        this.productService = productService;
        this.configExpertModeService = configExpertModeService;
        this.ghostStyle = true;
        this.configuration$ = this.configRouterExtractorService.extractRouterData().pipe(switchMap((routerData) => {
            return this.configuratorCommonsService.getConfiguration(routerData.owner);
        }));
        this.product$ = this.configuration$
            .pipe(map((configuration) => {
            switch (configuration.owner.type) {
                case CommonConfigurator.OwnerType.PRODUCT:
                case CommonConfigurator.OwnerType.CART_ENTRY:
                    return configuration.productCode;
                case CommonConfigurator.OwnerType.ORDER_ENTRY:
                    return configuration.overview?.productCode;
            }
        }), switchMap((productCode) => productCode
            ? this.productService.get(productCode, "list" /* ProductScope.LIST */)
            : EMPTY))
            .pipe(tap(() => {
            this.ghostStyle = false;
        }));
        this.showMore = false;
        this.iconTypes = ICON_TYPE;
    }
    triggerDetails() {
        this.showMore = !this.showMore;
    }
    get expMode() {
        return this.configExpertModeService.getExpModeActive();
    }
}
ConfiguratorProductTitleComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorProductTitleComponent, deps: [{ token: i1.ConfiguratorCommonsService }, { token: i2.ConfiguratorRouterExtractorService }, { token: i3.ProductService }, { token: i4.ConfiguratorExpertModeService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorProductTitleComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorProductTitleComponent, selector: "cx-configurator-product-title", host: { properties: { "class.ghost": "this.ghostStyle" } }, ngImport: i0, template: "<ng-container *ngIf=\"product$ | async as product; else ghostProductTitle\">\n  <div class=\"cx-general-product-info\">\n    <div class=\"cx-title\">\n      <span> {{ product.name }} </span>\n    </div>\n    <button (click)=\"triggerDetails()\" [attr.aria-expanded]=\"showMore\">\n      <ng-container *ngIf=\"!showMore\">\n        <div\n          class=\"cx-toggle-details-link-text\"\n          [attr.aria-label]=\"\n            'configurator.a11y.showMoreProductInfo'\n              | cxTranslate: { product: product.name }\n          \"\n        >\n          <span aria-hidden=\"true\">{{\n            'configurator.header.showMore' | cxTranslate\n          }}</span>\n        </div>\n        <cx-icon [type]=\"iconTypes.CARET_DOWN\"></cx-icon>\n      </ng-container>\n\n      <ng-container *ngIf=\"showMore\">\n        <div\n          class=\"cx-toggle-details-link-text\"\n          [attr.aria-label]=\"\n            'configurator.a11y.showLessProductInfo'\n              | cxTranslate: { product: product.name }\n          \"\n        >\n          {{ 'configurator.header.showLess' | cxTranslate }}\n        </div>\n        <cx-icon [type]=\"iconTypes.CARET_UP\"></cx-icon>\n      </ng-container>\n    </button>\n    <div class=\"cx-details\" [class.open]=\"showMore\">\n      <div class=\"cx-details-image\" aria-hidden=\"true\">\n        <cx-media\n          [container]=\"product?.images?.PRIMARY\"\n          format=\"product\"\n        ></cx-media>\n      </div>\n      <div\n        class=\"cx-details-content\"\n        [attr.aria-hidden]=\"showMore ? false : true\"\n      >\n        <div class=\"cx-detail-title\">\n          <span\n            *ngIf=\"product.name\"\n            [attr.aria-label]=\"'configurator.a11y.productName' | cxTranslate\"\n          >\n            {{ product.name }}\n          </span>\n        </div>\n        <div class=\"cx-code\">\n          <span\n            *ngIf=\"product.code\"\n            [attr.aria-label]=\"'configurator.a11y.productCode' | cxTranslate\"\n          >\n            {{ product.code }}\n          </span>\n        </div>\n        <div class=\"cx-description\">\n          <span\n            *ngIf=\"product.description\"\n            [attr.aria-label]=\"\n              'configurator.a11y.productDescription' | cxTranslate\n            \"\n          >\n            {{ product.description }}\n          </span>\n        </div>\n\n        <ng-container *ngIf=\"expMode | async\">\n          <ng-container *ngIf=\"configuration$ | async as configuration\">\n            <ng-container *ngIf=\"configuration.kbKey\">\n              <div class=\"cx-kb-key-details\">\n                <ng-container *ngIf=\"configuration.kbKey.kbName\">\n                  <div class=\"cx-kb-pair\">\n                    <span\n                      class=\"cx-label\"\n                      [attr.aria-label]=\"\n                        'configurator.a11y.kbKeyName'\n                          | cxTranslate: { name: configuration.kbKey.kbName }\n                      \"\n                    >\n                      {{ 'configurator.header.kbKeyName' | cxTranslate }}\n                    </span>\n                    <span class=\"cx-value\">\n                      {{ configuration.kbKey.kbName }}\n                    </span>\n                  </div>\n                </ng-container>\n                <ng-container *ngIf=\"configuration.kbKey.kbLogsys\">\n                  <div class=\"cx-kb-pair\">\n                    <span\n                      class=\"cx-label\"\n                      [attr.aria-label]=\"\n                        'configurator.a11y.kbKeyLogsys'\n                          | cxTranslate\n                            : { logsys: configuration.kbKey.kbLogsys }\n                      \"\n                    >\n                      {{ 'configurator.header.kbKeyLogsys' | cxTranslate }}\n                    </span>\n                    <span class=\"cx-value\">\n                      {{ configuration.kbKey.kbLogsys }}\n                    </span>\n                  </div>\n                </ng-container>\n                <ng-container *ngIf=\"configuration.kbKey.kbVersion\">\n                  <div class=\"cx-kb-pair\">\n                    <span\n                      class=\"cx-label\"\n                      [attr.aria-label]=\"\n                        'configurator.a11y.kbKeyVersion'\n                          | cxTranslate\n                            : { version: configuration.kbKey.kbVersion }\n                      \"\n                    >\n                      {{ 'configurator.header.kbKeyVersion' | cxTranslate }}\n                    </span>\n                    <span class=\"cx-value\">\n                      {{ configuration.kbKey.kbVersion }}\n                    </span>\n                  </div>\n                </ng-container>\n                <ng-container *ngIf=\"configuration.kbKey.kbBuildNumber\">\n                  <div class=\"cx-kb-pair\">\n                    <span\n                      class=\"cx-label\"\n                      [attr.aria-label]=\"\n                        'configurator.a11y.kbKeyBuildNr'\n                          | cxTranslate\n                            : { number: configuration.kbKey.kbBuildNumber }\n                      \"\n                    >\n                      {{ 'configurator.header.kbKeyBuildNr' | cxTranslate }}\n                    </span>\n                    <span class=\"cx-value\">\n                      {{ configuration.kbKey.kbBuildNumber }}\n                    </span>\n                  </div>\n                </ng-container>\n              </div>\n            </ng-container>\n          </ng-container>\n        </ng-container>\n      </div>\n    </div>\n  </div>\n</ng-container>\n<ng-template #ghostProductTitle>\n  <div class=\"cx-ghost-general-product-info\"></div>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i6.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "component", type: i6.MediaComponent, selector: "cx-media", inputs: ["container", "format", "alt", "role", "loading"], outputs: ["loaded"] }, { kind: "pipe", type: i5.AsyncPipe, name: "async" }, { kind: "pipe", type: i3.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorProductTitleComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-product-title', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-container *ngIf=\"product$ | async as product; else ghostProductTitle\">\n  <div class=\"cx-general-product-info\">\n    <div class=\"cx-title\">\n      <span> {{ product.name }} </span>\n    </div>\n    <button (click)=\"triggerDetails()\" [attr.aria-expanded]=\"showMore\">\n      <ng-container *ngIf=\"!showMore\">\n        <div\n          class=\"cx-toggle-details-link-text\"\n          [attr.aria-label]=\"\n            'configurator.a11y.showMoreProductInfo'\n              | cxTranslate: { product: product.name }\n          \"\n        >\n          <span aria-hidden=\"true\">{{\n            'configurator.header.showMore' | cxTranslate\n          }}</span>\n        </div>\n        <cx-icon [type]=\"iconTypes.CARET_DOWN\"></cx-icon>\n      </ng-container>\n\n      <ng-container *ngIf=\"showMore\">\n        <div\n          class=\"cx-toggle-details-link-text\"\n          [attr.aria-label]=\"\n            'configurator.a11y.showLessProductInfo'\n              | cxTranslate: { product: product.name }\n          \"\n        >\n          {{ 'configurator.header.showLess' | cxTranslate }}\n        </div>\n        <cx-icon [type]=\"iconTypes.CARET_UP\"></cx-icon>\n      </ng-container>\n    </button>\n    <div class=\"cx-details\" [class.open]=\"showMore\">\n      <div class=\"cx-details-image\" aria-hidden=\"true\">\n        <cx-media\n          [container]=\"product?.images?.PRIMARY\"\n          format=\"product\"\n        ></cx-media>\n      </div>\n      <div\n        class=\"cx-details-content\"\n        [attr.aria-hidden]=\"showMore ? false : true\"\n      >\n        <div class=\"cx-detail-title\">\n          <span\n            *ngIf=\"product.name\"\n            [attr.aria-label]=\"'configurator.a11y.productName' | cxTranslate\"\n          >\n            {{ product.name }}\n          </span>\n        </div>\n        <div class=\"cx-code\">\n          <span\n            *ngIf=\"product.code\"\n            [attr.aria-label]=\"'configurator.a11y.productCode' | cxTranslate\"\n          >\n            {{ product.code }}\n          </span>\n        </div>\n        <div class=\"cx-description\">\n          <span\n            *ngIf=\"product.description\"\n            [attr.aria-label]=\"\n              'configurator.a11y.productDescription' | cxTranslate\n            \"\n          >\n            {{ product.description }}\n          </span>\n        </div>\n\n        <ng-container *ngIf=\"expMode | async\">\n          <ng-container *ngIf=\"configuration$ | async as configuration\">\n            <ng-container *ngIf=\"configuration.kbKey\">\n              <div class=\"cx-kb-key-details\">\n                <ng-container *ngIf=\"configuration.kbKey.kbName\">\n                  <div class=\"cx-kb-pair\">\n                    <span\n                      class=\"cx-label\"\n                      [attr.aria-label]=\"\n                        'configurator.a11y.kbKeyName'\n                          | cxTranslate: { name: configuration.kbKey.kbName }\n                      \"\n                    >\n                      {{ 'configurator.header.kbKeyName' | cxTranslate }}\n                    </span>\n                    <span class=\"cx-value\">\n                      {{ configuration.kbKey.kbName }}\n                    </span>\n                  </div>\n                </ng-container>\n                <ng-container *ngIf=\"configuration.kbKey.kbLogsys\">\n                  <div class=\"cx-kb-pair\">\n                    <span\n                      class=\"cx-label\"\n                      [attr.aria-label]=\"\n                        'configurator.a11y.kbKeyLogsys'\n                          | cxTranslate\n                            : { logsys: configuration.kbKey.kbLogsys }\n                      \"\n                    >\n                      {{ 'configurator.header.kbKeyLogsys' | cxTranslate }}\n                    </span>\n                    <span class=\"cx-value\">\n                      {{ configuration.kbKey.kbLogsys }}\n                    </span>\n                  </div>\n                </ng-container>\n                <ng-container *ngIf=\"configuration.kbKey.kbVersion\">\n                  <div class=\"cx-kb-pair\">\n                    <span\n                      class=\"cx-label\"\n                      [attr.aria-label]=\"\n                        'configurator.a11y.kbKeyVersion'\n                          | cxTranslate\n                            : { version: configuration.kbKey.kbVersion }\n                      \"\n                    >\n                      {{ 'configurator.header.kbKeyVersion' | cxTranslate }}\n                    </span>\n                    <span class=\"cx-value\">\n                      {{ configuration.kbKey.kbVersion }}\n                    </span>\n                  </div>\n                </ng-container>\n                <ng-container *ngIf=\"configuration.kbKey.kbBuildNumber\">\n                  <div class=\"cx-kb-pair\">\n                    <span\n                      class=\"cx-label\"\n                      [attr.aria-label]=\"\n                        'configurator.a11y.kbKeyBuildNr'\n                          | cxTranslate\n                            : { number: configuration.kbKey.kbBuildNumber }\n                      \"\n                    >\n                      {{ 'configurator.header.kbKeyBuildNr' | cxTranslate }}\n                    </span>\n                    <span class=\"cx-value\">\n                      {{ configuration.kbKey.kbBuildNumber }}\n                    </span>\n                  </div>\n                </ng-container>\n              </div>\n            </ng-container>\n          </ng-container>\n        </ng-container>\n      </div>\n    </div>\n  </div>\n</ng-container>\n<ng-template #ghostProductTitle>\n  <div class=\"cx-ghost-general-product-info\"></div>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorCommonsService }, { type: i2.ConfiguratorRouterExtractorService }, { type: i3.ProductService }, { type: i4.ConfiguratorExpertModeService }]; }, propDecorators: { ghostStyle: [{
                type: HostBinding,
                args: ['class.ghost']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLXByb2R1Y3QtdGl0bGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL3Byb2R1Y3QtdGl0bGUvY29uZmlndXJhdG9yLXByb2R1Y3QtdGl0bGUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL3Byb2R1Y3QtdGl0bGUvY29uZmlndXJhdG9yLXByb2R1Y3QtdGl0bGUuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWhGLE9BQU8sRUFDTCxrQkFBa0IsR0FFbkIsTUFBTSx3Q0FBd0MsQ0FBQztBQUNoRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDbEQsT0FBTyxFQUFFLEtBQUssRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN6QyxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7QUFVckQsTUFBTSxPQUFPLGlDQUFpQztJQXFDNUMsWUFDWSwwQkFBc0QsRUFDdEQsNEJBQWdFLEVBQ2hFLGNBQThCLEVBQzlCLHVCQUFzRDtRQUh0RCwrQkFBMEIsR0FBMUIsMEJBQTBCLENBQTRCO1FBQ3RELGlDQUE0QixHQUE1Qiw0QkFBNEIsQ0FBb0M7UUFDaEUsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBK0I7UUF4Q3RDLGVBQVUsR0FBRyxJQUFJLENBQUM7UUFFOUMsbUJBQWMsR0FDWixJQUFJLENBQUMsNEJBQTRCLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxJQUFJLENBQ3hELFNBQVMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDLDBCQUEwQixDQUFDLGdCQUFnQixDQUNyRCxVQUFVLENBQUMsS0FBSyxDQUNqQixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQ0gsQ0FBQztRQUVKLGFBQVEsR0FBb0MsSUFBSSxDQUFDLGNBQWM7YUFDNUQsSUFBSSxDQUNILEdBQUcsQ0FBQyxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQ3BCLFFBQVEsYUFBYSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUU7Z0JBQ2hDLEtBQUssa0JBQWtCLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQztnQkFDMUMsS0FBSyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsVUFBVTtvQkFDMUMsT0FBTyxhQUFhLENBQUMsV0FBVyxDQUFDO2dCQUNuQyxLQUFLLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxXQUFXO29CQUMzQyxPQUFPLGFBQWEsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDO2FBQzlDO1FBQ0gsQ0FBQyxDQUFDLEVBQ0YsU0FBUyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FDeEIsV0FBVztZQUNULENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxXQUFXLGlDQUFvQjtZQUN6RCxDQUFDLENBQUMsS0FBSyxDQUNWLENBQ0Y7YUFDQSxJQUFJLENBQ0gsR0FBRyxDQUFDLEdBQUcsRUFBRTtZQUNQLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUNILENBQUM7UUFDSixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLGNBQVMsR0FBRyxTQUFTLENBQUM7SUFPbkIsQ0FBQztJQUVKLGNBQWM7UUFDWixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUNqQyxDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsdUJBQXVCLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUN6RCxDQUFDOzs4SEFsRFUsaUNBQWlDO2tIQUFqQyxpQ0FBaUMsaUlDeEI5Qyw0dUxBMEpBOzJGRGxJYSxpQ0FBaUM7a0JBTDdDLFNBQVM7K0JBQ0UsK0JBQStCLG1CQUV4Qix1QkFBdUIsQ0FBQyxNQUFNOzJPQUduQixVQUFVO3NCQUFyQyxXQUFXO3VCQUFDLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMyBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBIb3N0QmluZGluZyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUHJvZHVjdCwgUHJvZHVjdFNjb3BlLCBQcm9kdWN0U2VydmljZSB9IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQge1xuICBDb21tb25Db25maWd1cmF0b3IsXG4gIENvbmZpZ3VyYXRvclJvdXRlckV4dHJhY3RvclNlcnZpY2UsXG59IGZyb20gJ0BzcGFydGFjdXMvcHJvZHVjdC1jb25maWd1cmF0b3IvY29tbW9uJztcbmltcG9ydCB7IElDT05fVFlQRSB9IGZyb20gJ0BzcGFydGFjdXMvc3RvcmVmcm9udCc7XG5pbXBvcnQgeyBFTVBUWSwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9mYWNhZGUvY29uZmlndXJhdG9yLWNvbW1vbnMuc2VydmljZSc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JFeHBlcnRNb2RlU2VydmljZSB9IGZyb20gJy4uLy4uL2NvcmUvc2VydmljZXMvY29uZmlndXJhdG9yLWV4cGVydC1tb2RlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yIH0gZnJvbSAnLi4vLi4vY29yZS9tb2RlbC9jb25maWd1cmF0b3IubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1jb25maWd1cmF0b3ItcHJvZHVjdC10aXRsZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0b3ItcHJvZHVjdC10aXRsZS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBDb25maWd1cmF0b3JQcm9kdWN0VGl0bGVDb21wb25lbnQge1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmdob3N0JykgZ2hvc3RTdHlsZSA9IHRydWU7XG5cbiAgY29uZmlndXJhdGlvbiQ6IE9ic2VydmFibGU8Q29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb24+ID1cbiAgICB0aGlzLmNvbmZpZ1JvdXRlckV4dHJhY3RvclNlcnZpY2UuZXh0cmFjdFJvdXRlckRhdGEoKS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChyb3V0ZXJEYXRhKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLmdldENvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgcm91dGVyRGF0YS5vd25lclxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApO1xuXG4gIHByb2R1Y3QkOiBPYnNlcnZhYmxlPFByb2R1Y3QgfCB1bmRlZmluZWQ+ID0gdGhpcy5jb25maWd1cmF0aW9uJFxuICAgIC5waXBlKFxuICAgICAgbWFwKChjb25maWd1cmF0aW9uKSA9PiB7XG4gICAgICAgIHN3aXRjaCAoY29uZmlndXJhdGlvbi5vd25lci50eXBlKSB7XG4gICAgICAgICAgY2FzZSBDb21tb25Db25maWd1cmF0b3IuT3duZXJUeXBlLlBST0RVQ1Q6XG4gICAgICAgICAgY2FzZSBDb21tb25Db25maWd1cmF0b3IuT3duZXJUeXBlLkNBUlRfRU5UUlk6XG4gICAgICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvbi5wcm9kdWN0Q29kZTtcbiAgICAgICAgICBjYXNlIENvbW1vbkNvbmZpZ3VyYXRvci5Pd25lclR5cGUuT1JERVJfRU5UUlk6XG4gICAgICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvbi5vdmVydmlldz8ucHJvZHVjdENvZGU7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgc3dpdGNoTWFwKChwcm9kdWN0Q29kZSkgPT5cbiAgICAgICAgcHJvZHVjdENvZGVcbiAgICAgICAgICA/IHRoaXMucHJvZHVjdFNlcnZpY2UuZ2V0KHByb2R1Y3RDb2RlLCBQcm9kdWN0U2NvcGUuTElTVClcbiAgICAgICAgICA6IEVNUFRZXG4gICAgICApXG4gICAgKVxuICAgIC5waXBlKFxuICAgICAgdGFwKCgpID0+IHtcbiAgICAgICAgdGhpcy5naG9zdFN0eWxlID0gZmFsc2U7XG4gICAgICB9KVxuICAgICk7XG4gIHNob3dNb3JlID0gZmFsc2U7XG4gIGljb25UeXBlcyA9IElDT05fVFlQRTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2U6IENvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBjb25maWdSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlOiBDb25maWd1cmF0b3JSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBwcm9kdWN0U2VydmljZTogUHJvZHVjdFNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNvbmZpZ0V4cGVydE1vZGVTZXJ2aWNlOiBDb25maWd1cmF0b3JFeHBlcnRNb2RlU2VydmljZVxuICApIHt9XG5cbiAgdHJpZ2dlckRldGFpbHMoKTogdm9pZCB7XG4gICAgdGhpcy5zaG93TW9yZSA9ICF0aGlzLnNob3dNb3JlO1xuICB9XG5cbiAgZ2V0IGV4cE1vZGUoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnRXhwZXJ0TW9kZVNlcnZpY2UuZ2V0RXhwTW9kZUFjdGl2ZSgpO1xuICB9XG59XG4iLCI8bmctY29udGFpbmVyICpuZ0lmPVwicHJvZHVjdCQgfCBhc3luYyBhcyBwcm9kdWN0OyBlbHNlIGdob3N0UHJvZHVjdFRpdGxlXCI+XG4gIDxkaXYgY2xhc3M9XCJjeC1nZW5lcmFsLXByb2R1Y3QtaW5mb1wiPlxuICAgIDxkaXYgY2xhc3M9XCJjeC10aXRsZVwiPlxuICAgICAgPHNwYW4+IHt7IHByb2R1Y3QubmFtZSB9fSA8L3NwYW4+XG4gICAgPC9kaXY+XG4gICAgPGJ1dHRvbiAoY2xpY2spPVwidHJpZ2dlckRldGFpbHMoKVwiIFthdHRyLmFyaWEtZXhwYW5kZWRdPVwic2hvd01vcmVcIj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhc2hvd01vcmVcIj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzPVwiY3gtdG9nZ2xlLWRldGFpbHMtbGluay10ZXh0XCJcbiAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgJ2NvbmZpZ3VyYXRvci5hMTF5LnNob3dNb3JlUHJvZHVjdEluZm8nXG4gICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGU6IHsgcHJvZHVjdDogcHJvZHVjdC5uYW1lIH1cbiAgICAgICAgICBcIlxuICAgICAgICA+XG4gICAgICAgICAgPHNwYW4gYXJpYS1oaWRkZW49XCJ0cnVlXCI+e3tcbiAgICAgICAgICAgICdjb25maWd1cmF0b3IuaGVhZGVyLnNob3dNb3JlJyB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgfX08L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8Y3gtaWNvbiBbdHlwZV09XCJpY29uVHlwZXMuQ0FSRVRfRE9XTlwiPjwvY3gtaWNvbj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwic2hvd01vcmVcIj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzPVwiY3gtdG9nZ2xlLWRldGFpbHMtbGluay10ZXh0XCJcbiAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgJ2NvbmZpZ3VyYXRvci5hMTF5LnNob3dMZXNzUHJvZHVjdEluZm8nXG4gICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGU6IHsgcHJvZHVjdDogcHJvZHVjdC5uYW1lIH1cbiAgICAgICAgICBcIlxuICAgICAgICA+XG4gICAgICAgICAge3sgJ2NvbmZpZ3VyYXRvci5oZWFkZXIuc2hvd0xlc3MnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxjeC1pY29uIFt0eXBlXT1cImljb25UeXBlcy5DQVJFVF9VUFwiPjwvY3gtaWNvbj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvYnV0dG9uPlxuICAgIDxkaXYgY2xhc3M9XCJjeC1kZXRhaWxzXCIgW2NsYXNzLm9wZW5dPVwic2hvd01vcmVcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjeC1kZXRhaWxzLWltYWdlXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+XG4gICAgICAgIDxjeC1tZWRpYVxuICAgICAgICAgIFtjb250YWluZXJdPVwicHJvZHVjdD8uaW1hZ2VzPy5QUklNQVJZXCJcbiAgICAgICAgICBmb3JtYXQ9XCJwcm9kdWN0XCJcbiAgICAgICAgPjwvY3gtbWVkaWE+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9XCJjeC1kZXRhaWxzLWNvbnRlbnRcIlxuICAgICAgICBbYXR0ci5hcmlhLWhpZGRlbl09XCJzaG93TW9yZSA/IGZhbHNlIDogdHJ1ZVwiXG4gICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC1kZXRhaWwtdGl0bGVcIj5cbiAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgKm5nSWY9XCJwcm9kdWN0Lm5hbWVcIlxuICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCInY29uZmlndXJhdG9yLmExMXkucHJvZHVjdE5hbWUnIHwgY3hUcmFuc2xhdGVcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt7IHByb2R1Y3QubmFtZSB9fVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC1jb2RlXCI+XG4gICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICpuZ0lmPVwicHJvZHVjdC5jb2RlXCJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiJ2NvbmZpZ3VyYXRvci5hMTF5LnByb2R1Y3RDb2RlJyB8IGN4VHJhbnNsYXRlXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7eyBwcm9kdWN0LmNvZGUgfX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY3gtZGVzY3JpcHRpb25cIj5cbiAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgKm5nSWY9XCJwcm9kdWN0LmRlc2NyaXB0aW9uXCJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiXG4gICAgICAgICAgICAgICdjb25maWd1cmF0b3IuYTExeS5wcm9kdWN0RGVzY3JpcHRpb24nIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgIFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAge3sgcHJvZHVjdC5kZXNjcmlwdGlvbiB9fVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImV4cE1vZGUgfCBhc3luY1wiPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjb25maWd1cmF0aW9uJCB8IGFzeW5jIGFzIGNvbmZpZ3VyYXRpb25cIj5cbiAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjb25maWd1cmF0aW9uLmtiS2V5XCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1rYi1rZXktZGV0YWlsc1wiPlxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjb25maWd1cmF0aW9uLmtiS2V5LmtiTmFtZVwiPlxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImN4LWtiLXBhaXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImN4LWxhYmVsXCJcbiAgICAgICAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbmZpZ3VyYXRvci5hMTF5LmtiS2V5TmFtZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfCBjeFRyYW5zbGF0ZTogeyBuYW1lOiBjb25maWd1cmF0aW9uLmtiS2V5LmtiTmFtZSB9XG4gICAgICAgICAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIHt7ICdjb25maWd1cmF0b3IuaGVhZGVyLmtiS2V5TmFtZScgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiY3gtdmFsdWVcIj5cbiAgICAgICAgICAgICAgICAgICAgICB7eyBjb25maWd1cmF0aW9uLmtiS2V5LmtiTmFtZSB9fVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiY29uZmlndXJhdGlvbi5rYktleS5rYkxvZ3N5c1wiPlxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImN4LWtiLXBhaXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImN4LWxhYmVsXCJcbiAgICAgICAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbmZpZ3VyYXRvci5hMTF5LmtiS2V5TG9nc3lzJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB7IGxvZ3N5czogY29uZmlndXJhdGlvbi5rYktleS5rYkxvZ3N5cyB9XG4gICAgICAgICAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIHt7ICdjb25maWd1cmF0b3IuaGVhZGVyLmtiS2V5TG9nc3lzJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJjeC12YWx1ZVwiPlxuICAgICAgICAgICAgICAgICAgICAgIHt7IGNvbmZpZ3VyYXRpb24ua2JLZXkua2JMb2dzeXMgfX1cbiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImNvbmZpZ3VyYXRpb24ua2JLZXkua2JWZXJzaW9uXCI+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY3gta2ItcGFpclwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiY3gtbGFiZWxcIlxuICAgICAgICAgICAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAnY29uZmlndXJhdG9yLmExMXkua2JLZXlWZXJzaW9uJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB7IHZlcnNpb246IGNvbmZpZ3VyYXRpb24ua2JLZXkua2JWZXJzaW9uIH1cbiAgICAgICAgICAgICAgICAgICAgICBcIlxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAge3sgJ2NvbmZpZ3VyYXRvci5oZWFkZXIua2JLZXlWZXJzaW9uJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJjeC12YWx1ZVwiPlxuICAgICAgICAgICAgICAgICAgICAgIHt7IGNvbmZpZ3VyYXRpb24ua2JLZXkua2JWZXJzaW9uIH19XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjb25maWd1cmF0aW9uLmtiS2V5LmtiQnVpbGROdW1iZXJcIj5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1rYi1wYWlyXCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJjeC1sYWJlbFwiXG4gICAgICAgICAgICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICdjb25maWd1cmF0b3IuYTExeS5rYktleUJ1aWxkTnInXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHsgbnVtYmVyOiBjb25maWd1cmF0aW9uLmtiS2V5LmtiQnVpbGROdW1iZXIgfVxuICAgICAgICAgICAgICAgICAgICAgIFwiXG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICB7eyAnY29uZmlndXJhdG9yLmhlYWRlci5rYktleUJ1aWxkTnInIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImN4LXZhbHVlXCI+XG4gICAgICAgICAgICAgICAgICAgICAge3sgY29uZmlndXJhdGlvbi5rYktleS5rYkJ1aWxkTnVtYmVyIH19XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctY29udGFpbmVyPlxuPG5nLXRlbXBsYXRlICNnaG9zdFByb2R1Y3RUaXRsZT5cbiAgPGRpdiBjbGFzcz1cImN4LWdob3N0LWdlbmVyYWwtcHJvZHVjdC1pbmZvXCI+PC9kaXY+XG48L25nLXRlbXBsYXRlPlxuIl19