/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, Optional, } from '@angular/core';
import { ICON_TYPE } from '@spartacus/storefront';
import { map } from 'rxjs/operators';
import { Configurator } from '../../../core/model/configurator.model';
import { ConfiguratorAttributeBaseComponent } from '../types/base/configurator-attribute-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../service/configurator-storefront-utils.service";
import * as i2 from "../composition/configurator-attribute-composition.model";
import * as i3 from "@spartacus/core";
import * as i4 from "@angular/common";
import * as i5 from "@spartacus/storefront";
export class ConfiguratorAttributeFooterComponent extends ConfiguratorAttributeBaseComponent {
    constructor(configUtils, attributeComponentContext, 
    // TODO (CXSPA-3392): for next major release remove featureConfigService
    featureConfigService) {
        super();
        this.configUtils = configUtils;
        this.attributeComponentContext = attributeComponentContext;
        this.featureConfigService = featureConfigService;
        this.iconType = ICON_TYPE;
        this.attribute = attributeComponentContext.attribute;
        this.owner = attributeComponentContext.owner;
        this.groupId = attributeComponentContext.group.id;
    }
    ngOnInit() {
        /**
         * Show message that indicates that attribute is required in case attribute is a
         * free input field or a drop-dow list
         */
        this.showRequiredMessageForUserInput$ = this.configUtils
            .isCartEntryOrGroupVisited(this.owner, this.groupId)
            .pipe(map((result) => result ? this.needsRequiredAttributeErrorMsg() : false));
    }
    // TODO (CXSPA-3392): for next major release remove featureConfigService
    needsRequiredAttributeErrorMsg() {
        if (this.featureConfigService?.isLevel('6.2')) {
            // TODO: for next major release only these requirements should be proved
            return this.needsUserInputMsg() || this.needsDropDownMsg();
        }
        else {
            return this.needsUserInputMsg();
        }
    }
    needsDropDownMsg() {
        return (this.isRequiredErrorMsg(this.attribute) &&
            this.isDropDown(this.attribute) &&
            this.isNoValueSelected(this.attribute));
    }
    /**
     * Checks if attribute is a user input typed attribute with empty value.
     * Method will return false for domain based attributes
     * @param {string} input - user input
     */
    isUserInputEmpty(input) {
        return input !== undefined && (!input.trim() || 0 === input.length);
    }
    needsUserInputMsg() {
        return (this.isRequiredErrorMsg(this.attribute) &&
            this.isUserInput(this.attribute) &&
            this.isUserInputEmpty(this.attribute.userInput));
    }
    /**
     * @deprecated since 6.2
     *
     * `needsUserInputMsg` method will be called instead.
     */
    needsUserInputMessage() {
        const uiType = this.attribute.uiType;
        const needsMessage = this.attribute.required &&
            this.attribute.incomplete &&
            (uiType === Configurator.UiType.STRING ||
                uiType === Configurator.UiType.NUMERIC) &&
            this.isUserInputEmpty(this.attribute.userInput);
        return needsMessage ?? false;
    }
}
ConfiguratorAttributeFooterComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeFooterComponent, deps: [{ token: i1.ConfiguratorStorefrontUtilsService }, { token: i2.ConfiguratorAttributeCompositionContext }, { token: i3.FeatureConfigService, optional: true }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorAttributeFooterComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorAttributeFooterComponent, selector: "cx-configurator-attribute-footer", usesInheritance: true, ngImport: i0, template: "<ng-container *cxFeatureLevel=\"'!6.2'\">\n  <div\n    *ngIf=\"showRequiredMessageForUserInput$ | async\"\n    class=\"cx-required-error-msg\"\n    id=\"{{ createAttributeUiKey('attribute-msg', attribute.name) }}\"\n    [attr.aria-label]=\"\n      'configurator.attribute.defaultRequiredMessage' | cxTranslate\n    \"\n    aria-live=\"assertive\"\n    aria-atomic=\"true\"\n    role=\"alert\"\n  >\n    <cx-icon [type]=\"iconType.ERROR\"></cx-icon>\n    {{ 'configurator.attribute.defaultRequiredMessage' | cxTranslate }}\n  </div>\n</ng-container>\n<ng-container *cxFeatureLevel=\"'6.2'\">\n  <div\n    *ngIf=\"showRequiredMessageForUserInput$ | async\"\n    class=\"cx-required-error-msg\"\n    id=\"{{ createAttributeUiKey('attribute-msg', attribute.name) }}\"\n    [attr.aria-label]=\"\n      isUserInput(attribute)\n        ? ('configurator.attribute.defaultRequiredMessage' | cxTranslate)\n        : ('configurator.attribute.singleSelectRequiredMessage' | cxTranslate)\n    \"\n    aria-live=\"assertive\"\n    aria-atomic=\"true\"\n    role=\"alert\"\n  >\n    <cx-icon [type]=\"iconType.ERROR\"></cx-icon>\n    <ng-container *ngIf=\"isUserInput(attribute)\">\n      {{ 'configurator.attribute.defaultRequiredMessage' | cxTranslate }}\n    </ng-container>\n    <ng-container *ngIf=\"isDropDown(attribute)\">\n      {{ 'configurator.attribute.singleSelectRequiredMessage' | cxTranslate }}\n    </ng-container>\n  </div>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i5.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "directive", type: i3.FeatureLevelDirective, selector: "[cxFeatureLevel]", inputs: ["cxFeatureLevel"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }, { kind: "pipe", type: i3.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeFooterComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-attribute-footer', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-container *cxFeatureLevel=\"'!6.2'\">\n  <div\n    *ngIf=\"showRequiredMessageForUserInput$ | async\"\n    class=\"cx-required-error-msg\"\n    id=\"{{ createAttributeUiKey('attribute-msg', attribute.name) }}\"\n    [attr.aria-label]=\"\n      'configurator.attribute.defaultRequiredMessage' | cxTranslate\n    \"\n    aria-live=\"assertive\"\n    aria-atomic=\"true\"\n    role=\"alert\"\n  >\n    <cx-icon [type]=\"iconType.ERROR\"></cx-icon>\n    {{ 'configurator.attribute.defaultRequiredMessage' | cxTranslate }}\n  </div>\n</ng-container>\n<ng-container *cxFeatureLevel=\"'6.2'\">\n  <div\n    *ngIf=\"showRequiredMessageForUserInput$ | async\"\n    class=\"cx-required-error-msg\"\n    id=\"{{ createAttributeUiKey('attribute-msg', attribute.name) }}\"\n    [attr.aria-label]=\"\n      isUserInput(attribute)\n        ? ('configurator.attribute.defaultRequiredMessage' | cxTranslate)\n        : ('configurator.attribute.singleSelectRequiredMessage' | cxTranslate)\n    \"\n    aria-live=\"assertive\"\n    aria-atomic=\"true\"\n    role=\"alert\"\n  >\n    <cx-icon [type]=\"iconType.ERROR\"></cx-icon>\n    <ng-container *ngIf=\"isUserInput(attribute)\">\n      {{ 'configurator.attribute.defaultRequiredMessage' | cxTranslate }}\n    </ng-container>\n    <ng-container *ngIf=\"isDropDown(attribute)\">\n      {{ 'configurator.attribute.singleSelectRequiredMessage' | cxTranslate }}\n    </ng-container>\n  </div>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorStorefrontUtilsService }, { type: i2.ConfiguratorAttributeCompositionContext }, { type: i3.FeatureConfigService, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1mb290ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS9mb290ZXIvY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1mb290ZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS9mb290ZXIvY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1mb290ZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFFBQVEsR0FDVCxNQUFNLGVBQWUsQ0FBQztBQUd2QixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFbEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUd0RSxPQUFPLEVBQUUsa0NBQWtDLEVBQUUsTUFBTSxxREFBcUQsQ0FBQzs7Ozs7OztBQU96RyxNQUFNLE9BQU8sb0NBQ1gsU0FBUSxrQ0FBa0M7SUFzQjFDLFlBQ1ksV0FBK0MsRUFDL0MseUJBQWtFO0lBQzVFLHdFQUF3RTtJQUNsRCxvQkFBMkM7UUFFakUsS0FBSyxFQUFFLENBQUM7UUFMRSxnQkFBVyxHQUFYLFdBQVcsQ0FBb0M7UUFDL0MsOEJBQXlCLEdBQXpCLHlCQUF5QixDQUF5QztRQUV0RCx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXVCO1FBUW5FLGFBQVEsR0FBRyxTQUFTLENBQUM7UUFMbkIsSUFBSSxDQUFDLFNBQVMsR0FBRyx5QkFBeUIsQ0FBQyxTQUFTLENBQUM7UUFDckQsSUFBSSxDQUFDLEtBQUssR0FBRyx5QkFBeUIsQ0FBQyxLQUFLLENBQUM7UUFDN0MsSUFBSSxDQUFDLE9BQU8sR0FBRyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO0lBQ3BELENBQUM7SUFLRCxRQUFRO1FBQ047OztXQUdHO1FBQ0gsSUFBSSxDQUFDLGdDQUFnQyxHQUFHLElBQUksQ0FBQyxXQUFXO2FBQ3JELHlCQUF5QixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUNuRCxJQUFJLENBQ0gsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FDYixNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyw4QkFBOEIsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQ3ZELENBQ0YsQ0FBQztJQUNOLENBQUM7SUFFRCx3RUFBd0U7SUFDOUQsOEJBQThCO1FBQ3RDLElBQUksSUFBSSxDQUFDLG9CQUFvQixFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUM3Qyx3RUFBd0U7WUFDeEUsT0FBTyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztTQUM1RDthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztTQUNqQztJQUNILENBQUM7SUFFUyxnQkFBZ0I7UUFDeEIsT0FBTyxDQUNMLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUMvQixJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUN2QyxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxnQkFBZ0IsQ0FBQyxLQUFjO1FBQzdCLE9BQU8sS0FBSyxLQUFLLFNBQVMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVTLGlCQUFpQjtRQUN6QixPQUFPLENBQ0wsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDdkMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUNoRCxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7O09BSUc7SUFDTyxxQkFBcUI7UUFDN0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7UUFDckMsTUFBTSxZQUFZLEdBQ2hCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUTtZQUN2QixJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVU7WUFDekIsQ0FBQyxNQUFNLEtBQUssWUFBWSxDQUFDLE1BQU0sQ0FBQyxNQUFNO2dCQUNwQyxNQUFNLEtBQUssWUFBWSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7WUFDekMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbEQsT0FBTyxZQUFZLElBQUksS0FBSyxDQUFDO0lBQy9CLENBQUM7O2lJQXJHVSxvQ0FBb0M7cUhBQXBDLG9DQUFvQywrRkMzQmpELHM2Q0F1Q0E7MkZEWmEsb0NBQW9DO2tCQUxoRCxTQUFTOytCQUNFLGtDQUFrQyxtQkFFM0IsdUJBQXVCLENBQUMsTUFBTTs7MEJBNkI1QyxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBPcHRpb25hbCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGZWF0dXJlQ29uZmlnU2VydmljZSB9IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQgeyBDb21tb25Db25maWd1cmF0b3IgfSBmcm9tICdAc3BhcnRhY3VzL3Byb2R1Y3QtY29uZmlndXJhdG9yL2NvbW1vbic7XG5pbXBvcnQgeyBJQ09OX1RZUEUgfSBmcm9tICdAc3BhcnRhY3VzL3N0b3JlZnJvbnQnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9tb2RlbC9jb25maWd1cmF0b3IubW9kZWwnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yQXR0cmlidXRlQ29tcG9zaXRpb25Db250ZXh0IH0gZnJvbSAnLi4vY29tcG9zaXRpb24vY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1jb21wb3NpdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JTdG9yZWZyb250VXRpbHNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9jb25maWd1cmF0b3Itc3RvcmVmcm9udC11dGlscy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckF0dHJpYnV0ZUJhc2VDb21wb25lbnQgfSBmcm9tICcuLi90eXBlcy9iYXNlL2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtYmFzZS5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1jb25maWd1cmF0b3ItYXR0cmlidXRlLWZvb3RlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0b3ItYXR0cmlidXRlLWZvb3Rlci5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBDb25maWd1cmF0b3JBdHRyaWJ1dGVGb290ZXJDb21wb25lbnRcbiAgZXh0ZW5kcyBDb25maWd1cmF0b3JBdHRyaWJ1dGVCYXNlQ29tcG9uZW50XG4gIGltcGxlbWVudHMgT25Jbml0XG57XG4gIGF0dHJpYnV0ZTogQ29uZmlndXJhdG9yLkF0dHJpYnV0ZTtcbiAgb3duZXI6IENvbW1vbkNvbmZpZ3VyYXRvci5Pd25lcjtcbiAgZ3JvdXBJZDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGNvbmZpZ1V0aWxzOiBDb25maWd1cmF0b3JTdG9yZWZyb250VXRpbHNTZXJ2aWNlLFxuICAgIGF0dHJpYnV0ZUNvbXBvbmVudENvbnRleHQ6IENvbmZpZ3VyYXRvckF0dHJpYnV0ZUNvbXBvc2l0aW9uQ29udGV4dCxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuaWZpZWQtc2lnbmF0dXJlc1xuICAgIGZlYXR1cmVDb25maWdTZXJ2aWNlPzogRmVhdHVyZUNvbmZpZ1NlcnZpY2VcbiAgKTtcblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWQgc2luY2UgNi4yXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBjb25maWdVdGlsczogQ29uZmlndXJhdG9yU3RvcmVmcm9udFV0aWxzU2VydmljZSxcbiAgICBhdHRyaWJ1dGVDb21wb25lbnRDb250ZXh0OiBDb25maWd1cmF0b3JBdHRyaWJ1dGVDb21wb3NpdGlvbkNvbnRleHRcbiAgKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY29uZmlnVXRpbHM6IENvbmZpZ3VyYXRvclN0b3JlZnJvbnRVdGlsc1NlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGF0dHJpYnV0ZUNvbXBvbmVudENvbnRleHQ6IENvbmZpZ3VyYXRvckF0dHJpYnV0ZUNvbXBvc2l0aW9uQ29udGV4dCxcbiAgICAvLyBUT0RPIChDWFNQQS0zMzkyKTogZm9yIG5leHQgbWFqb3IgcmVsZWFzZSByZW1vdmUgZmVhdHVyZUNvbmZpZ1NlcnZpY2VcbiAgICBAT3B0aW9uYWwoKSBwcm90ZWN0ZWQgZmVhdHVyZUNvbmZpZ1NlcnZpY2U/OiBGZWF0dXJlQ29uZmlnU2VydmljZVxuICApIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuYXR0cmlidXRlID0gYXR0cmlidXRlQ29tcG9uZW50Q29udGV4dC5hdHRyaWJ1dGU7XG4gICAgdGhpcy5vd25lciA9IGF0dHJpYnV0ZUNvbXBvbmVudENvbnRleHQub3duZXI7XG4gICAgdGhpcy5ncm91cElkID0gYXR0cmlidXRlQ29tcG9uZW50Q29udGV4dC5ncm91cC5pZDtcbiAgfVxuXG4gIGljb25UeXBlID0gSUNPTl9UWVBFO1xuICBzaG93UmVxdWlyZWRNZXNzYWdlRm9yVXNlcklucHV0JDogT2JzZXJ2YWJsZTxib29sZWFuPjtcblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAvKipcbiAgICAgKiBTaG93IG1lc3NhZ2UgdGhhdCBpbmRpY2F0ZXMgdGhhdCBhdHRyaWJ1dGUgaXMgcmVxdWlyZWQgaW4gY2FzZSBhdHRyaWJ1dGUgaXMgYVxuICAgICAqIGZyZWUgaW5wdXQgZmllbGQgb3IgYSBkcm9wLWRvdyBsaXN0XG4gICAgICovXG4gICAgdGhpcy5zaG93UmVxdWlyZWRNZXNzYWdlRm9yVXNlcklucHV0JCA9IHRoaXMuY29uZmlnVXRpbHNcbiAgICAgIC5pc0NhcnRFbnRyeU9yR3JvdXBWaXNpdGVkKHRoaXMub3duZXIsIHRoaXMuZ3JvdXBJZClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKHJlc3VsdCkgPT5cbiAgICAgICAgICByZXN1bHQgPyB0aGlzLm5lZWRzUmVxdWlyZWRBdHRyaWJ1dGVFcnJvck1zZygpIDogZmFsc2VcbiAgICAgICAgKVxuICAgICAgKTtcbiAgfVxuXG4gIC8vIFRPRE8gKENYU1BBLTMzOTIpOiBmb3IgbmV4dCBtYWpvciByZWxlYXNlIHJlbW92ZSBmZWF0dXJlQ29uZmlnU2VydmljZVxuICBwcm90ZWN0ZWQgbmVlZHNSZXF1aXJlZEF0dHJpYnV0ZUVycm9yTXNnKCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmZlYXR1cmVDb25maWdTZXJ2aWNlPy5pc0xldmVsKCc2LjInKSkge1xuICAgICAgLy8gVE9ETzogZm9yIG5leHQgbWFqb3IgcmVsZWFzZSBvbmx5IHRoZXNlIHJlcXVpcmVtZW50cyBzaG91bGQgYmUgcHJvdmVkXG4gICAgICByZXR1cm4gdGhpcy5uZWVkc1VzZXJJbnB1dE1zZygpIHx8IHRoaXMubmVlZHNEcm9wRG93bk1zZygpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5uZWVkc1VzZXJJbnB1dE1zZygpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBuZWVkc0Ryb3BEb3duTXNnKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLmlzUmVxdWlyZWRFcnJvck1zZyh0aGlzLmF0dHJpYnV0ZSkgJiZcbiAgICAgIHRoaXMuaXNEcm9wRG93bih0aGlzLmF0dHJpYnV0ZSkgJiZcbiAgICAgIHRoaXMuaXNOb1ZhbHVlU2VsZWN0ZWQodGhpcy5hdHRyaWJ1dGUpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYXR0cmlidXRlIGlzIGEgdXNlciBpbnB1dCB0eXBlZCBhdHRyaWJ1dGUgd2l0aCBlbXB0eSB2YWx1ZS5cbiAgICogTWV0aG9kIHdpbGwgcmV0dXJuIGZhbHNlIGZvciBkb21haW4gYmFzZWQgYXR0cmlidXRlc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gaW5wdXQgLSB1c2VyIGlucHV0XG4gICAqL1xuICBpc1VzZXJJbnB1dEVtcHR5KGlucHV0Pzogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGlucHV0ICE9PSB1bmRlZmluZWQgJiYgKCFpbnB1dC50cmltKCkgfHwgMCA9PT0gaW5wdXQubGVuZ3RoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBuZWVkc1VzZXJJbnB1dE1zZygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5pc1JlcXVpcmVkRXJyb3JNc2codGhpcy5hdHRyaWJ1dGUpICYmXG4gICAgICB0aGlzLmlzVXNlcklucHV0KHRoaXMuYXR0cmlidXRlKSAmJlxuICAgICAgdGhpcy5pc1VzZXJJbnB1dEVtcHR5KHRoaXMuYXR0cmlidXRlLnVzZXJJbnB1dClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkIHNpbmNlIDYuMlxuICAgKlxuICAgKiBgbmVlZHNVc2VySW5wdXRNc2dgIG1ldGhvZCB3aWxsIGJlIGNhbGxlZCBpbnN0ZWFkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG5lZWRzVXNlcklucHV0TWVzc2FnZSgpOiBib29sZWFuIHtcbiAgICBjb25zdCB1aVR5cGUgPSB0aGlzLmF0dHJpYnV0ZS51aVR5cGU7XG4gICAgY29uc3QgbmVlZHNNZXNzYWdlID1cbiAgICAgIHRoaXMuYXR0cmlidXRlLnJlcXVpcmVkICYmXG4gICAgICB0aGlzLmF0dHJpYnV0ZS5pbmNvbXBsZXRlICYmXG4gICAgICAodWlUeXBlID09PSBDb25maWd1cmF0b3IuVWlUeXBlLlNUUklORyB8fFxuICAgICAgICB1aVR5cGUgPT09IENvbmZpZ3VyYXRvci5VaVR5cGUuTlVNRVJJQykgJiZcbiAgICAgIHRoaXMuaXNVc2VySW5wdXRFbXB0eSh0aGlzLmF0dHJpYnV0ZS51c2VySW5wdXQpO1xuICAgIHJldHVybiBuZWVkc01lc3NhZ2UgPz8gZmFsc2U7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXIgKmN4RmVhdHVyZUxldmVsPVwiJyE2LjInXCI+XG4gIDxkaXZcbiAgICAqbmdJZj1cInNob3dSZXF1aXJlZE1lc3NhZ2VGb3JVc2VySW5wdXQkIHwgYXN5bmNcIlxuICAgIGNsYXNzPVwiY3gtcmVxdWlyZWQtZXJyb3ItbXNnXCJcbiAgICBpZD1cInt7IGNyZWF0ZUF0dHJpYnV0ZVVpS2V5KCdhdHRyaWJ1dGUtbXNnJywgYXR0cmlidXRlLm5hbWUpIH19XCJcbiAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgJ2NvbmZpZ3VyYXRvci5hdHRyaWJ1dGUuZGVmYXVsdFJlcXVpcmVkTWVzc2FnZScgfCBjeFRyYW5zbGF0ZVxuICAgIFwiXG4gICAgYXJpYS1saXZlPVwiYXNzZXJ0aXZlXCJcbiAgICBhcmlhLWF0b21pYz1cInRydWVcIlxuICAgIHJvbGU9XCJhbGVydFwiXG4gID5cbiAgICA8Y3gtaWNvbiBbdHlwZV09XCJpY29uVHlwZS5FUlJPUlwiPjwvY3gtaWNvbj5cbiAgICB7eyAnY29uZmlndXJhdG9yLmF0dHJpYnV0ZS5kZWZhdWx0UmVxdWlyZWRNZXNzYWdlJyB8IGN4VHJhbnNsYXRlIH19XG4gIDwvZGl2PlxuPC9uZy1jb250YWluZXI+XG48bmctY29udGFpbmVyICpjeEZlYXR1cmVMZXZlbD1cIic2LjInXCI+XG4gIDxkaXZcbiAgICAqbmdJZj1cInNob3dSZXF1aXJlZE1lc3NhZ2VGb3JVc2VySW5wdXQkIHwgYXN5bmNcIlxuICAgIGNsYXNzPVwiY3gtcmVxdWlyZWQtZXJyb3ItbXNnXCJcbiAgICBpZD1cInt7IGNyZWF0ZUF0dHJpYnV0ZVVpS2V5KCdhdHRyaWJ1dGUtbXNnJywgYXR0cmlidXRlLm5hbWUpIH19XCJcbiAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgaXNVc2VySW5wdXQoYXR0cmlidXRlKVxuICAgICAgICA/ICgnY29uZmlndXJhdG9yLmF0dHJpYnV0ZS5kZWZhdWx0UmVxdWlyZWRNZXNzYWdlJyB8IGN4VHJhbnNsYXRlKVxuICAgICAgICA6ICgnY29uZmlndXJhdG9yLmF0dHJpYnV0ZS5zaW5nbGVTZWxlY3RSZXF1aXJlZE1lc3NhZ2UnIHwgY3hUcmFuc2xhdGUpXG4gICAgXCJcbiAgICBhcmlhLWxpdmU9XCJhc3NlcnRpdmVcIlxuICAgIGFyaWEtYXRvbWljPVwidHJ1ZVwiXG4gICAgcm9sZT1cImFsZXJ0XCJcbiAgPlxuICAgIDxjeC1pY29uIFt0eXBlXT1cImljb25UeXBlLkVSUk9SXCI+PC9jeC1pY29uPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJpc1VzZXJJbnB1dChhdHRyaWJ1dGUpXCI+XG4gICAgICB7eyAnY29uZmlndXJhdG9yLmF0dHJpYnV0ZS5kZWZhdWx0UmVxdWlyZWRNZXNzYWdlJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImlzRHJvcERvd24oYXR0cmlidXRlKVwiPlxuICAgICAge3sgJ2NvbmZpZ3VyYXRvci5hdHRyaWJ1dGUuc2luZ2xlU2VsZWN0UmVxdWlyZWRNZXNzYWdlJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvZGl2PlxuPC9uZy1jb250YWluZXI+XG4iXX0=