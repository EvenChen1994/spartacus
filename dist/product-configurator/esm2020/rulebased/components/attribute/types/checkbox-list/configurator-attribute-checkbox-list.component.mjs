/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, inject, isDevMode, } from '@angular/core';
import { UntypedFormControl } from '@angular/forms';
import { LoggerService } from '@spartacus/core';
import { Configurator } from '../../../../core/model/configurator.model';
import { ConfiguratorAttributeMultiSelectionBaseComponent } from '../base/configurator-attribute-multi-selection-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../../service/configurator-storefront-utils.service";
import * as i2 from "../../quantity/configurator-attribute-quantity.service";
import * as i3 from "../../composition/configurator-attribute-composition.model";
import * as i4 from "../../../../core/facade/configurator-commons.service";
import * as i5 from "@spartacus/storefront";
import * as i6 from "@angular/forms";
import * as i7 from "@angular/common";
import * as i8 from "../../quantity/configurator-attribute-quantity.component";
import * as i9 from "../../../price/configurator-price.component";
import * as i10 from "@spartacus/core";
export class ConfiguratorAttributeCheckBoxListComponent extends ConfiguratorAttributeMultiSelectionBaseComponent {
    constructor(configUtilsService, quantityService, attributeComponentContext, configuratorCommonsService) {
        super(quantityService, attributeComponentContext, configuratorCommonsService);
        this.configUtilsService = configUtilsService;
        this.quantityService = quantityService;
        this.attributeComponentContext = attributeComponentContext;
        this.configuratorCommonsService = configuratorCommonsService;
        this.attributeCheckBoxForms = new Array();
        this.logger = inject(LoggerService);
        this.group = attributeComponentContext.group.id;
    }
    ngOnInit() {
        const disabled = !this.allowZeroValueQuantity;
        for (const value of this.attribute.values ?? []) {
            let attributeCheckBoxForm;
            if (value.selected) {
                attributeCheckBoxForm = new UntypedFormControl({
                    value: true,
                    disabled: disabled,
                });
            }
            else {
                attributeCheckBoxForm = new UntypedFormControl(false);
            }
            this.attributeCheckBoxForms.push(attributeCheckBoxForm);
        }
    }
    get allowZeroValueQuantity() {
        return this.quantityService.allowZeroValueQuantity(this.attribute);
    }
    onSelect() {
        const selectedValues = this.configUtilsService.assembleValuesForMultiSelectAttributes(this.attributeCheckBoxForms, this.attribute);
        this.configuratorCommonsService.updateConfiguration(this.ownerKey, {
            ...this.attribute,
            values: selectedValues,
        }, Configurator.UpdateType.ATTRIBUTE);
    }
    onChangeValueQuantity(eventObject, valueCode, formIndex) {
        if (eventObject === 0) {
            this.attributeCheckBoxForms[formIndex].setValue(false);
            this.onSelect();
            return;
        }
        const value = this.configUtilsService
            .assembleValuesForMultiSelectAttributes(this.attributeCheckBoxForms, this.attribute)
            .find((item) => item.valueCode === valueCode);
        if (!value) {
            if (isDevMode()) {
                this.logger.warn('no value for event:', eventObject);
            }
            return;
        }
        value.quantity = eventObject;
        this.configuratorCommonsService.updateConfiguration(this.ownerKey, {
            ...this.attribute,
            values: [value],
        }, Configurator.UpdateType.VALUE_QUANTITY);
    }
    onChangeQuantity(eventObject) {
        if (!eventObject) {
            this.attributeCheckBoxForms.forEach((_, index) => this.attributeCheckBoxForms[index].setValue(false));
            this.onSelect();
        }
        else {
            this.onHandleAttributeQuantity(eventObject);
        }
    }
}
ConfiguratorAttributeCheckBoxListComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeCheckBoxListComponent, deps: [{ token: i1.ConfiguratorStorefrontUtilsService }, { token: i2.ConfiguratorAttributeQuantityService }, { token: i3.ConfiguratorAttributeCompositionContext }, { token: i4.ConfiguratorCommonsService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorAttributeCheckBoxListComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorAttributeCheckBoxListComponent, selector: "cx-configurator-attribute-checkbox-list", usesInheritance: true, ngImport: i0, template: "<fieldset>\n  <legend style=\"display: none\">{{ attribute.label }}</legend>\n  <div id=\"{{ createAttributeIdForConfigurator(attribute) }}\">\n    <div\n      *ngIf=\"withQuantityOnAttributeLevel\"\n      class=\"cx-attribute-level-quantity-price\"\n    >\n      <cx-configurator-attribute-quantity\n        (changeQuantity)=\"onChangeQuantity($event)\"\n        [quantityOptions]=\"\n          extractQuantityParameters(attribute.quantity, !attribute.required)\n        \"\n      ></cx-configurator-attribute-quantity>\n      <cx-configurator-price\n        [formula]=\"extractPriceFormulaParameters()\"\n      ></cx-configurator-price>\n    </div>\n    <ng-container *ngFor=\"let value of attribute.values; let i = index\">\n      <div class=\"form-check\">\n        <div class=\"cx-value-label-pair\">\n          <input\n            id=\"{{\n              createAttributeValueIdForConfigurator(attribute, value.valueCode)\n            }}\"\n            type=\"checkbox\"\n            class=\"form-check-input\"\n            [cxFocus]=\"{ key: attribute.name + '-' + value.name }\"\n            [value]=\"value.valueCode\"\n            (change)=\"onSelect()\"\n            [formControl]=\"attributeCheckBoxForms[i]\"\n            name=\"{{ createAttributeIdForConfigurator(attribute) }}\"\n            [attr.aria-label]=\"\n              value.valuePrice && value.valuePrice?.value !== 0\n                ? value.valuePriceTotal && value.valuePriceTotal?.value !== 0\n                  ? ('configurator.a11y.valueOfAttributeFullWithPrice'\n                    | cxTranslate\n                      : {\n                          value: value.valueDisplay,\n                          attribute: attribute.label,\n                          price: value.valuePriceTotal.formattedValue\n                        })\n                  : ('configurator.a11y.valueOfAttributeFullWithPrice'\n                    | cxTranslate\n                      : {\n                          value: value.valueDisplay,\n                          attribute: attribute.label,\n                          price: value.valuePrice.formattedValue\n                        })\n                : ('configurator.a11y.valueOfAttributeFull'\n                  | cxTranslate\n                    : { value: value.valueDisplay, attribute: attribute.label })\n            \"\n            [attr.aria-describedby]=\"\n              createAttributeUiKey('label', attribute.name)\n            \"\n          />\n          <label\n            id=\"{{\n              createValueUiKey('label', attribute.name, value.valueCode)\n            }}\"\n            for=\"{{\n              createAttributeValueIdForConfigurator(attribute, value.valueCode)\n            }}\"\n            aria-hidden=\"true\"\n            class=\"cx-configurator-attribute-value-label form-check-label\"\n            >{{ getLabel(expMode, value.valueDisplay, value.valueCode) }}</label\n          >\n        </div>\n        <div class=\"cx-value-price\">\n          <cx-configurator-price\n            [formula]=\"extractValuePriceFormulaParameters(value)\"\n          ></cx-configurator-price>\n        </div>\n      </div>\n      <cx-configurator-attribute-quantity\n        *ngIf=\"value.selected && withQuantity && !withQuantityOnAttributeLevel\"\n        (changeQuantity)=\"onChangeValueQuantity($event, value.valueCode, i)\"\n        [quantityOptions]=\"\n          extractQuantityParameters(value.quantity, allowZeroValueQuantity)\n        \"\n      ></cx-configurator-attribute-quantity>\n    </ng-container>\n  </div>\n</fieldset>\n", dependencies: [{ kind: "directive", type: i5.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "directive", type: i6.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i6.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i6.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "directive", type: i7.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i8.ConfiguratorAttributeQuantityComponent, selector: "cx-configurator-attribute-quantity", inputs: ["quantityOptions"], outputs: ["changeQuantity"] }, { kind: "component", type: i9.ConfiguratorPriceComponent, selector: "cx-configurator-price", inputs: ["formula"] }, { kind: "pipe", type: i10.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeCheckBoxListComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-attribute-checkbox-list', changeDetection: ChangeDetectionStrategy.OnPush, template: "<fieldset>\n  <legend style=\"display: none\">{{ attribute.label }}</legend>\n  <div id=\"{{ createAttributeIdForConfigurator(attribute) }}\">\n    <div\n      *ngIf=\"withQuantityOnAttributeLevel\"\n      class=\"cx-attribute-level-quantity-price\"\n    >\n      <cx-configurator-attribute-quantity\n        (changeQuantity)=\"onChangeQuantity($event)\"\n        [quantityOptions]=\"\n          extractQuantityParameters(attribute.quantity, !attribute.required)\n        \"\n      ></cx-configurator-attribute-quantity>\n      <cx-configurator-price\n        [formula]=\"extractPriceFormulaParameters()\"\n      ></cx-configurator-price>\n    </div>\n    <ng-container *ngFor=\"let value of attribute.values; let i = index\">\n      <div class=\"form-check\">\n        <div class=\"cx-value-label-pair\">\n          <input\n            id=\"{{\n              createAttributeValueIdForConfigurator(attribute, value.valueCode)\n            }}\"\n            type=\"checkbox\"\n            class=\"form-check-input\"\n            [cxFocus]=\"{ key: attribute.name + '-' + value.name }\"\n            [value]=\"value.valueCode\"\n            (change)=\"onSelect()\"\n            [formControl]=\"attributeCheckBoxForms[i]\"\n            name=\"{{ createAttributeIdForConfigurator(attribute) }}\"\n            [attr.aria-label]=\"\n              value.valuePrice && value.valuePrice?.value !== 0\n                ? value.valuePriceTotal && value.valuePriceTotal?.value !== 0\n                  ? ('configurator.a11y.valueOfAttributeFullWithPrice'\n                    | cxTranslate\n                      : {\n                          value: value.valueDisplay,\n                          attribute: attribute.label,\n                          price: value.valuePriceTotal.formattedValue\n                        })\n                  : ('configurator.a11y.valueOfAttributeFullWithPrice'\n                    | cxTranslate\n                      : {\n                          value: value.valueDisplay,\n                          attribute: attribute.label,\n                          price: value.valuePrice.formattedValue\n                        })\n                : ('configurator.a11y.valueOfAttributeFull'\n                  | cxTranslate\n                    : { value: value.valueDisplay, attribute: attribute.label })\n            \"\n            [attr.aria-describedby]=\"\n              createAttributeUiKey('label', attribute.name)\n            \"\n          />\n          <label\n            id=\"{{\n              createValueUiKey('label', attribute.name, value.valueCode)\n            }}\"\n            for=\"{{\n              createAttributeValueIdForConfigurator(attribute, value.valueCode)\n            }}\"\n            aria-hidden=\"true\"\n            class=\"cx-configurator-attribute-value-label form-check-label\"\n            >{{ getLabel(expMode, value.valueDisplay, value.valueCode) }}</label\n          >\n        </div>\n        <div class=\"cx-value-price\">\n          <cx-configurator-price\n            [formula]=\"extractValuePriceFormulaParameters(value)\"\n          ></cx-configurator-price>\n        </div>\n      </div>\n      <cx-configurator-attribute-quantity\n        *ngIf=\"value.selected && withQuantity && !withQuantityOnAttributeLevel\"\n        (changeQuantity)=\"onChangeValueQuantity($event, value.valueCode, i)\"\n        [quantityOptions]=\"\n          extractQuantityParameters(value.quantity, allowZeroValueQuantity)\n        \"\n      ></cx-configurator-attribute-quantity>\n    </ng-container>\n  </div>\n</fieldset>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorStorefrontUtilsService }, { type: i2.ConfiguratorAttributeQuantityService }, { type: i3.ConfiguratorAttributeCompositionContext }, { type: i4.ConfiguratorCommonsService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1jaGVja2JveC1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9wcm9kdWN0LWNvbmZpZ3VyYXRvci9ydWxlYmFzZWQvY29tcG9uZW50cy9hdHRyaWJ1dGUvdHlwZXMvY2hlY2tib3gtbGlzdC9jb25maWd1cmF0b3ItYXR0cmlidXRlLWNoZWNrYm94LWxpc3QuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS90eXBlcy9jaGVja2JveC1saXN0L2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtY2hlY2tib3gtbGlzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsTUFBTSxFQUNOLFNBQVMsR0FFVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFaEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBSXpFLE9BQU8sRUFBRSxnREFBZ0QsRUFBRSxNQUFNLCtEQUErRCxDQUFDOzs7Ozs7Ozs7Ozs7QUFPakksTUFBTSxPQUFPLDBDQUNYLFNBQVEsZ0RBQWdEO0lBU3hELFlBQ1ksa0JBQXNELEVBQ3RELGVBQXFELEVBQ3JELHlCQUFrRSxFQUNsRSwwQkFBc0Q7UUFFaEUsS0FBSyxDQUNILGVBQWUsRUFDZix5QkFBeUIsRUFDekIsMEJBQTBCLENBQzNCLENBQUM7UUFUUSx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9DO1FB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c0JBQXNCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQy9DLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQ25ELENBQUM7WUFDRixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7U0FDakI7YUFBTTtZQUNMLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUM3QztJQUNILENBQUM7O3VJQTlHVSwwQ0FBMEM7MkhBQTFDLDBDQUEwQyxzR0MzQnZELHUvR0FvRkE7MkZEekRhLDBDQUEwQztrQkFMdEQsU0FBUzsrQkFDRSx5Q0FBeUMsbUJBRWxDLHVCQUF1QixDQUFDLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMyBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBpbmplY3QsXG4gIGlzRGV2TW9kZSxcbiAgT25Jbml0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFVudHlwZWRGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IExvZ2dlclNlcnZpY2UgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9jb3JlL2ZhY2FkZS9jb25maWd1cmF0b3ItY29tbW9ucy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvciB9IGZyb20gJy4uLy4uLy4uLy4uL2NvcmUvbW9kZWwvY29uZmlndXJhdG9yLm1vZGVsJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvclN0b3JlZnJvbnRVdGlsc1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlL2NvbmZpZ3VyYXRvci1zdG9yZWZyb250LXV0aWxzLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yQXR0cmlidXRlQ29tcG9zaXRpb25Db250ZXh0IH0gZnJvbSAnLi4vLi4vY29tcG9zaXRpb24vY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1jb21wb3NpdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JBdHRyaWJ1dGVRdWFudGl0eVNlcnZpY2UgfSBmcm9tICcuLi8uLi9xdWFudGl0eS9jb25maWd1cmF0b3ItYXR0cmlidXRlLXF1YW50aXR5LnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yQXR0cmlidXRlTXVsdGlTZWxlY3Rpb25CYXNlQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzZS9jb25maWd1cmF0b3ItYXR0cmlidXRlLW11bHRpLXNlbGVjdGlvbi1iYXNlLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LWNvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtY2hlY2tib3gtbGlzdCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0b3ItYXR0cmlidXRlLWNoZWNrYm94LWxpc3QuY29tcG9uZW50Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgQ29uZmlndXJhdG9yQXR0cmlidXRlQ2hlY2tCb3hMaXN0Q29tcG9uZW50XG4gIGV4dGVuZHMgQ29uZmlndXJhdG9yQXR0cmlidXRlTXVsdGlTZWxlY3Rpb25CYXNlQ29tcG9uZW50XG4gIGltcGxlbWVudHMgT25Jbml0XG57XG4gIGF0dHJpYnV0ZUNoZWNrQm94Rm9ybXMgPSBuZXcgQXJyYXk8VW50eXBlZEZvcm1Db250cm9sPigpO1xuXG4gIGdyb3VwOiBzdHJpbmc7XG5cbiAgcHJvdGVjdGVkIGxvZ2dlciA9IGluamVjdChMb2dnZXJTZXJ2aWNlKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY29uZmlnVXRpbHNTZXJ2aWNlOiBDb25maWd1cmF0b3JTdG9yZWZyb250VXRpbHNTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBxdWFudGl0eVNlcnZpY2U6IENvbmZpZ3VyYXRvckF0dHJpYnV0ZVF1YW50aXR5U2VydmljZSxcbiAgICBwcm90ZWN0ZWQgYXR0cmlidXRlQ29tcG9uZW50Q29udGV4dDogQ29uZmlndXJhdG9yQXR0cmlidXRlQ29tcG9zaXRpb25Db250ZXh0LFxuICAgIHByb3RlY3RlZCBjb25maWd1cmF0b3JDb21tb25zU2VydmljZTogQ29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIoXG4gICAgICBxdWFudGl0eVNlcnZpY2UsXG4gICAgICBhdHRyaWJ1dGVDb21wb25lbnRDb250ZXh0LFxuICAgICAgY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2VcbiAgICApO1xuICAgIHRoaXMuZ3JvdXAgPSBhdHRyaWJ1dGVDb21wb25lbnRDb250ZXh0Lmdyb3VwLmlkO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgZGlzYWJsZWQgPSAhdGhpcy5hbGxvd1plcm9WYWx1ZVF1YW50aXR5O1xuXG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0aGlzLmF0dHJpYnV0ZS52YWx1ZXMgPz8gW10pIHtcbiAgICAgIGxldCBhdHRyaWJ1dGVDaGVja0JveEZvcm07XG5cbiAgICAgIGlmICh2YWx1ZS5zZWxlY3RlZCkge1xuICAgICAgICBhdHRyaWJ1dGVDaGVja0JveEZvcm0gPSBuZXcgVW50eXBlZEZvcm1Db250cm9sKHtcbiAgICAgICAgICB2YWx1ZTogdHJ1ZSxcbiAgICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXR0cmlidXRlQ2hlY2tCb3hGb3JtID0gbmV3IFVudHlwZWRGb3JtQ29udHJvbChmYWxzZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmF0dHJpYnV0ZUNoZWNrQm94Rm9ybXMucHVzaChhdHRyaWJ1dGVDaGVja0JveEZvcm0pO1xuICAgIH1cbiAgfVxuXG4gIGdldCBhbGxvd1plcm9WYWx1ZVF1YW50aXR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnF1YW50aXR5U2VydmljZS5hbGxvd1plcm9WYWx1ZVF1YW50aXR5KHRoaXMuYXR0cmlidXRlKTtcbiAgfVxuXG4gIG9uU2VsZWN0KCk6IHZvaWQge1xuICAgIGNvbnN0IHNlbGVjdGVkVmFsdWVzID1cbiAgICAgIHRoaXMuY29uZmlnVXRpbHNTZXJ2aWNlLmFzc2VtYmxlVmFsdWVzRm9yTXVsdGlTZWxlY3RBdHRyaWJ1dGVzKFxuICAgICAgICB0aGlzLmF0dHJpYnV0ZUNoZWNrQm94Rm9ybXMsXG4gICAgICAgIHRoaXMuYXR0cmlidXRlXG4gICAgICApO1xuXG4gICAgdGhpcy5jb25maWd1cmF0b3JDb21tb25zU2VydmljZS51cGRhdGVDb25maWd1cmF0aW9uKFxuICAgICAgdGhpcy5vd25lcktleSxcbiAgICAgIHtcbiAgICAgICAgLi4udGhpcy5hdHRyaWJ1dGUsXG4gICAgICAgIHZhbHVlczogc2VsZWN0ZWRWYWx1ZXMsXG4gICAgICB9LFxuICAgICAgQ29uZmlndXJhdG9yLlVwZGF0ZVR5cGUuQVRUUklCVVRFXG4gICAgKTtcbiAgfVxuXG4gIG9uQ2hhbmdlVmFsdWVRdWFudGl0eShcbiAgICBldmVudE9iamVjdDogYW55LFxuICAgIHZhbHVlQ29kZTogc3RyaW5nLFxuICAgIGZvcm1JbmRleDogbnVtYmVyXG4gICk6IHZvaWQge1xuICAgIGlmIChldmVudE9iamVjdCA9PT0gMCkge1xuICAgICAgdGhpcy5hdHRyaWJ1dGVDaGVja0JveEZvcm1zW2Zvcm1JbmRleF0uc2V0VmFsdWUoZmFsc2UpO1xuICAgICAgdGhpcy5vblNlbGVjdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHZhbHVlOiBDb25maWd1cmF0b3IuVmFsdWUgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ1V0aWxzU2VydmljZVxuICAgICAgLmFzc2VtYmxlVmFsdWVzRm9yTXVsdGlTZWxlY3RBdHRyaWJ1dGVzKFxuICAgICAgICB0aGlzLmF0dHJpYnV0ZUNoZWNrQm94Rm9ybXMsXG4gICAgICAgIHRoaXMuYXR0cmlidXRlXG4gICAgICApXG4gICAgICAuZmluZCgoaXRlbSkgPT4gaXRlbS52YWx1ZUNvZGUgPT09IHZhbHVlQ29kZSk7XG5cbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICBpZiAoaXNEZXZNb2RlKCkpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2Fybignbm8gdmFsdWUgZm9yIGV2ZW50OicsIGV2ZW50T2JqZWN0KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhbHVlLnF1YW50aXR5ID0gZXZlbnRPYmplY3Q7XG5cbiAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLnVwZGF0ZUNvbmZpZ3VyYXRpb24oXG4gICAgICB0aGlzLm93bmVyS2V5LFxuICAgICAge1xuICAgICAgICAuLi50aGlzLmF0dHJpYnV0ZSxcbiAgICAgICAgdmFsdWVzOiBbdmFsdWVdLFxuICAgICAgfSxcbiAgICAgIENvbmZpZ3VyYXRvci5VcGRhdGVUeXBlLlZBTFVFX1FVQU5USVRZXG4gICAgKTtcbiAgfVxuXG4gIG9uQ2hhbmdlUXVhbnRpdHkoZXZlbnRPYmplY3Q6IGFueSk6IHZvaWQge1xuICAgIGlmICghZXZlbnRPYmplY3QpIHtcbiAgICAgIHRoaXMuYXR0cmlidXRlQ2hlY2tCb3hGb3Jtcy5mb3JFYWNoKChfLCBpbmRleCkgPT5cbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVDaGVja0JveEZvcm1zW2luZGV4XS5zZXRWYWx1ZShmYWxzZSlcbiAgICAgICk7XG4gICAgICB0aGlzLm9uU2VsZWN0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub25IYW5kbGVBdHRyaWJ1dGVRdWFudGl0eShldmVudE9iamVjdCk7XG4gICAgfVxuICB9XG59XG4iLCI8ZmllbGRzZXQ+XG4gIDxsZWdlbmQgc3R5bGU9XCJkaXNwbGF5OiBub25lXCI+e3sgYXR0cmlidXRlLmxhYmVsIH19PC9sZWdlbmQ+XG4gIDxkaXYgaWQ9XCJ7eyBjcmVhdGVBdHRyaWJ1dGVJZEZvckNvbmZpZ3VyYXRvcihhdHRyaWJ1dGUpIH19XCI+XG4gICAgPGRpdlxuICAgICAgKm5nSWY9XCJ3aXRoUXVhbnRpdHlPbkF0dHJpYnV0ZUxldmVsXCJcbiAgICAgIGNsYXNzPVwiY3gtYXR0cmlidXRlLWxldmVsLXF1YW50aXR5LXByaWNlXCJcbiAgICA+XG4gICAgICA8Y3gtY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1xdWFudGl0eVxuICAgICAgICAoY2hhbmdlUXVhbnRpdHkpPVwib25DaGFuZ2VRdWFudGl0eSgkZXZlbnQpXCJcbiAgICAgICAgW3F1YW50aXR5T3B0aW9uc109XCJcbiAgICAgICAgICBleHRyYWN0UXVhbnRpdHlQYXJhbWV0ZXJzKGF0dHJpYnV0ZS5xdWFudGl0eSwgIWF0dHJpYnV0ZS5yZXF1aXJlZClcbiAgICAgICAgXCJcbiAgICAgID48L2N4LWNvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtcXVhbnRpdHk+XG4gICAgICA8Y3gtY29uZmlndXJhdG9yLXByaWNlXG4gICAgICAgIFtmb3JtdWxhXT1cImV4dHJhY3RQcmljZUZvcm11bGFQYXJhbWV0ZXJzKClcIlxuICAgICAgPjwvY3gtY29uZmlndXJhdG9yLXByaWNlPlxuICAgIDwvZGl2PlxuICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IHZhbHVlIG9mIGF0dHJpYnV0ZS52YWx1ZXM7IGxldCBpID0gaW5kZXhcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWNoZWNrXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC12YWx1ZS1sYWJlbC1wYWlyXCI+XG4gICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICBpZD1cInt7XG4gICAgICAgICAgICAgIGNyZWF0ZUF0dHJpYnV0ZVZhbHVlSWRGb3JDb25maWd1cmF0b3IoYXR0cmlidXRlLCB2YWx1ZS52YWx1ZUNvZGUpXG4gICAgICAgICAgICB9fVwiXG4gICAgICAgICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNoZWNrLWlucHV0XCJcbiAgICAgICAgICAgIFtjeEZvY3VzXT1cInsga2V5OiBhdHRyaWJ1dGUubmFtZSArICctJyArIHZhbHVlLm5hbWUgfVwiXG4gICAgICAgICAgICBbdmFsdWVdPVwidmFsdWUudmFsdWVDb2RlXCJcbiAgICAgICAgICAgIChjaGFuZ2UpPVwib25TZWxlY3QoKVwiXG4gICAgICAgICAgICBbZm9ybUNvbnRyb2xdPVwiYXR0cmlidXRlQ2hlY2tCb3hGb3Jtc1tpXVwiXG4gICAgICAgICAgICBuYW1lPVwie3sgY3JlYXRlQXR0cmlidXRlSWRGb3JDb25maWd1cmF0b3IoYXR0cmlidXRlKSB9fVwiXG4gICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgICB2YWx1ZS52YWx1ZVByaWNlICYmIHZhbHVlLnZhbHVlUHJpY2U/LnZhbHVlICE9PSAwXG4gICAgICAgICAgICAgICAgPyB2YWx1ZS52YWx1ZVByaWNlVG90YWwgJiYgdmFsdWUudmFsdWVQcmljZVRvdGFsPy52YWx1ZSAhPT0gMFxuICAgICAgICAgICAgICAgICAgPyAoJ2NvbmZpZ3VyYXRvci5hMTF5LnZhbHVlT2ZBdHRyaWJ1dGVGdWxsV2l0aFByaWNlJ1xuICAgICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS52YWx1ZURpc3BsYXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZTogdmFsdWUudmFsdWVQcmljZVRvdGFsLmZvcm1hdHRlZFZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgOiAoJ2NvbmZpZ3VyYXRvci5hMTF5LnZhbHVlT2ZBdHRyaWJ1dGVGdWxsV2l0aFByaWNlJ1xuICAgICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS52YWx1ZURpc3BsYXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZTogdmFsdWUudmFsdWVQcmljZS5mb3JtYXR0ZWRWYWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA6ICgnY29uZmlndXJhdG9yLmExMXkudmFsdWVPZkF0dHJpYnV0ZUZ1bGwnXG4gICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgIDogeyB2YWx1ZTogdmFsdWUudmFsdWVEaXNwbGF5LCBhdHRyaWJ1dGU6IGF0dHJpYnV0ZS5sYWJlbCB9KVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtZGVzY3JpYmVkYnldPVwiXG4gICAgICAgICAgICAgIGNyZWF0ZUF0dHJpYnV0ZVVpS2V5KCdsYWJlbCcsIGF0dHJpYnV0ZS5uYW1lKVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICAvPlxuICAgICAgICAgIDxsYWJlbFxuICAgICAgICAgICAgaWQ9XCJ7e1xuICAgICAgICAgICAgICBjcmVhdGVWYWx1ZVVpS2V5KCdsYWJlbCcsIGF0dHJpYnV0ZS5uYW1lLCB2YWx1ZS52YWx1ZUNvZGUpXG4gICAgICAgICAgICB9fVwiXG4gICAgICAgICAgICBmb3I9XCJ7e1xuICAgICAgICAgICAgICBjcmVhdGVBdHRyaWJ1dGVWYWx1ZUlkRm9yQ29uZmlndXJhdG9yKGF0dHJpYnV0ZSwgdmFsdWUudmFsdWVDb2RlKVxuICAgICAgICAgICAgfX1cIlxuICAgICAgICAgICAgYXJpYS1oaWRkZW49XCJ0cnVlXCJcbiAgICAgICAgICAgIGNsYXNzPVwiY3gtY29uZmlndXJhdG9yLWF0dHJpYnV0ZS12YWx1ZS1sYWJlbCBmb3JtLWNoZWNrLWxhYmVsXCJcbiAgICAgICAgICAgID57eyBnZXRMYWJlbChleHBNb2RlLCB2YWx1ZS52YWx1ZURpc3BsYXksIHZhbHVlLnZhbHVlQ29kZSkgfX08L2xhYmVsXG4gICAgICAgICAgPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LXZhbHVlLXByaWNlXCI+XG4gICAgICAgICAgPGN4LWNvbmZpZ3VyYXRvci1wcmljZVxuICAgICAgICAgICAgW2Zvcm11bGFdPVwiZXh0cmFjdFZhbHVlUHJpY2VGb3JtdWxhUGFyYW1ldGVycyh2YWx1ZSlcIlxuICAgICAgICAgID48L2N4LWNvbmZpZ3VyYXRvci1wcmljZT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxjeC1jb25maWd1cmF0b3ItYXR0cmlidXRlLXF1YW50aXR5XG4gICAgICAgICpuZ0lmPVwidmFsdWUuc2VsZWN0ZWQgJiYgd2l0aFF1YW50aXR5ICYmICF3aXRoUXVhbnRpdHlPbkF0dHJpYnV0ZUxldmVsXCJcbiAgICAgICAgKGNoYW5nZVF1YW50aXR5KT1cIm9uQ2hhbmdlVmFsdWVRdWFudGl0eSgkZXZlbnQsIHZhbHVlLnZhbHVlQ29kZSwgaSlcIlxuICAgICAgICBbcXVhbnRpdHlPcHRpb25zXT1cIlxuICAgICAgICAgIGV4dHJhY3RRdWFudGl0eVBhcmFtZXRlcnModmFsdWUucXVhbnRpdHksIGFsbG93WmVyb1ZhbHVlUXVhbnRpdHkpXG4gICAgICAgIFwiXG4gICAgICA+PC9jeC1jb25maWd1cmF0b3ItYXR0cmlidXRlLXF1YW50aXR5PlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L2Rpdj5cbjwvZmllbGRzZXQ+XG4iXX0=