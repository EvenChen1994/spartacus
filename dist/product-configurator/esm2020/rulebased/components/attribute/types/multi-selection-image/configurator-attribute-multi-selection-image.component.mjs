/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { UntypedFormControl } from '@angular/forms';
import { Configurator } from '../../../../core/model/configurator.model';
import { ConfiguratorAttributeBaseComponent } from '../base/configurator-attribute-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../../service/configurator-storefront-utils.service";
import * as i2 from "../../composition/configurator-attribute-composition.model";
import * as i3 from "../../../../core/facade/configurator-commons.service";
import * as i4 from "@spartacus/storefront";
import * as i5 from "@angular/forms";
import * as i6 from "@angular/common";
import * as i7 from "../../../price/configurator-price.component";
import * as i8 from "@spartacus/core";
export class ConfiguratorAttributeMultiSelectionImageComponent extends ConfiguratorAttributeBaseComponent {
    constructor(configUtilsService, attributeComponentContext, configuratorCommonsService) {
        super();
        this.configUtilsService = configUtilsService;
        this.attributeComponentContext = attributeComponentContext;
        this.configuratorCommonsService = configuratorCommonsService;
        this.attributeCheckBoxForms = new Array();
        this.attribute = attributeComponentContext.attribute;
        this.ownerKey = attributeComponentContext.owner.key;
        this.expMode = attributeComponentContext.expMode;
    }
    ngOnInit() {
        const values = this.attribute.values;
        if (values) {
            for (const value of values) {
                let attributeCheckBoxForm;
                if (value.selected) {
                    attributeCheckBoxForm = new UntypedFormControl(true);
                }
                else {
                    attributeCheckBoxForm = new UntypedFormControl(false);
                }
                this.attributeCheckBoxForms.push(attributeCheckBoxForm);
            }
        }
    }
    /**
     * Fired when a value has been selected
     * @param index Index of selected value
     */
    onSelect(index) {
        this.attributeCheckBoxForms[index].setValue(!this.attributeCheckBoxForms[index].value);
        const selectedValues = this.configUtilsService.assembleValuesForMultiSelectAttributes(this.attributeCheckBoxForms, this.attribute);
        this.configuratorCommonsService.updateConfiguration(this.ownerKey, {
            ...this.attribute,
            values: selectedValues,
        }, Configurator.UpdateType.ATTRIBUTE);
    }
    extractValuePriceFormulaParameters(value) {
        return {
            quantity: value.quantity,
            price: value.valuePrice,
            priceTotal: value.valuePriceTotal,
            isLightedUp: value.selected,
        };
    }
}
ConfiguratorAttributeMultiSelectionImageComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeMultiSelectionImageComponent, deps: [{ token: i1.ConfiguratorStorefrontUtilsService }, { token: i2.ConfiguratorAttributeCompositionContext }, { token: i3.ConfiguratorCommonsService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorAttributeMultiSelectionImageComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorAttributeMultiSelectionImageComponent, selector: "cx-configurator-attribute-multi-selection-image", usesInheritance: true, ngImport: i0, template: "<div id=\"{{ createAttributeIdForConfigurator(attribute) }}\" class=\"cx-row\">\n  <div\n    *ngFor=\"let value of attribute.values; let i = index\"\n    id=\"{{ createAttributeValueIdForConfigurator(attribute, value.valueCode) }}\"\n    class=\"cx-configurator-select\"\n  >\n    <input\n      id=\"{{\n        createAttributeValueIdForConfigurator(attribute, value.valueCode) +\n          '-input'\n      }}\"\n      type=\"checkbox\"\n      class=\"form-input\"\n      [value]=\"value.valueCode\"\n      [formControl]=\"attributeCheckBoxForms[i]\"\n      name=\"{{ createAttributeIdForConfigurator(attribute) }}\"\n      (click)=\"onSelect(i)\"\n      [attr.aria-label]=\"\n        value.valuePrice && value.valuePrice?.value !== 0\n          ? ('configurator.a11y.valueOfAttributeFullWithPrice'\n            | cxTranslate\n              : {\n                  value: value.valueDisplay,\n                  attribute: attribute.label,\n                  price: value.valuePrice.formattedValue\n                })\n          : ('configurator.a11y.valueOfAttributeFull'\n            | cxTranslate\n              : { value: value.valueDisplay, attribute: attribute.label })\n      \"\n      [attr.aria-describedby]=\"createAttributeUiKey('label', attribute.name)\"\n      [attr.checked]=\"attributeCheckBoxForms[i].value ? 'checked' : null\"\n      [cxFocus]=\"{ key: attribute.name + '-' + value.name }\"\n    />\n    <div class=\"cx-label-container\">\n      <label\n        id=\"{{ createValueUiKey('label', attribute.name, value.valueCode) }}\"\n        for=\"{{\n          createAttributeValueIdForConfigurator(attribute, value.valueCode) +\n            '-input'\n        }}\"\n        aria-hidden=\"true\"\n        class=\"form-check-label\"\n      >\n        <img\n          *ngIf=\"getImage(value) as image\"\n          class=\"cx-img\"\n          src=\"{{ image?.url }}\"\n          alt=\"{{ image?.altText }}\"\n        />\n        <div *ngIf=\"!getImage(value)\" class=\"cx-img-dummy\"></div>\n        {{ getLabel(expMode, value.valueDisplay, value.valueCode) }}\n        <cx-configurator-price\n          [formula]=\"extractValuePriceFormulaParameters(value)\"\n        ></cx-configurator-price>\n      </label>\n    </div>\n  </div>\n</div>\n", dependencies: [{ kind: "directive", type: i4.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "directive", type: i5.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i5.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i5.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "directive", type: i6.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i6.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i7.ConfiguratorPriceComponent, selector: "cx-configurator-price", inputs: ["formula"] }, { kind: "pipe", type: i8.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeMultiSelectionImageComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-attribute-multi-selection-image', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div id=\"{{ createAttributeIdForConfigurator(attribute) }}\" class=\"cx-row\">\n  <div\n    *ngFor=\"let value of attribute.values; let i = index\"\n    id=\"{{ createAttributeValueIdForConfigurator(attribute, value.valueCode) }}\"\n    class=\"cx-configurator-select\"\n  >\n    <input\n      id=\"{{\n        createAttributeValueIdForConfigurator(attribute, value.valueCode) +\n          '-input'\n      }}\"\n      type=\"checkbox\"\n      class=\"form-input\"\n      [value]=\"value.valueCode\"\n      [formControl]=\"attributeCheckBoxForms[i]\"\n      name=\"{{ createAttributeIdForConfigurator(attribute) }}\"\n      (click)=\"onSelect(i)\"\n      [attr.aria-label]=\"\n        value.valuePrice && value.valuePrice?.value !== 0\n          ? ('configurator.a11y.valueOfAttributeFullWithPrice'\n            | cxTranslate\n              : {\n                  value: value.valueDisplay,\n                  attribute: attribute.label,\n                  price: value.valuePrice.formattedValue\n                })\n          : ('configurator.a11y.valueOfAttributeFull'\n            | cxTranslate\n              : { value: value.valueDisplay, attribute: attribute.label })\n      \"\n      [attr.aria-describedby]=\"createAttributeUiKey('label', attribute.name)\"\n      [attr.checked]=\"attributeCheckBoxForms[i].value ? 'checked' : null\"\n      [cxFocus]=\"{ key: attribute.name + '-' + value.name }\"\n    />\n    <div class=\"cx-label-container\">\n      <label\n        id=\"{{ createValueUiKey('label', attribute.name, value.valueCode) }}\"\n        for=\"{{\n          createAttributeValueIdForConfigurator(attribute, value.valueCode) +\n            '-input'\n        }}\"\n        aria-hidden=\"true\"\n        class=\"form-check-label\"\n      >\n        <img\n          *ngIf=\"getImage(value) as image\"\n          class=\"cx-img\"\n          src=\"{{ image?.url }}\"\n          alt=\"{{ image?.altText }}\"\n        />\n        <div *ngIf=\"!getImage(value)\" class=\"cx-img-dummy\"></div>\n        {{ getLabel(expMode, value.valueDisplay, value.valueCode) }}\n        <cx-configurator-price\n          [formula]=\"extractValuePriceFormulaParameters(value)\"\n        ></cx-configurator-price>\n      </label>\n    </div>\n  </div>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorStorefrontUtilsService }, { type: i2.ConfiguratorAttributeCompositionContext }, { type: i3.ConfiguratorCommonsService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1tdWx0aS1zZWxlY3Rpb24taW1hZ2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS90eXBlcy9tdWx0aS1zZWxlY3Rpb24taW1hZ2UvY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1tdWx0aS1zZWxlY3Rpb24taW1hZ2UuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS90eXBlcy9tdWx0aS1zZWxlY3Rpb24taW1hZ2UvY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1tdWx0aS1zZWxlY3Rpb24taW1hZ2UuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDM0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBR3pFLE9BQU8sRUFBRSxrQ0FBa0MsRUFBRSxNQUFNLCtDQUErQyxDQUFDOzs7Ozs7Ozs7O0FBU25HLE1BQU0sT0FBTyxpREFDWCxTQUFRLGtDQUFrQztJQU8xQyxZQUNZLGtCQUFzRCxFQUN0RCx5QkFBa0UsRUFDbEUsMEJBQXNEO1FBRWhFLEtBQUssRUFBRSxDQUFDO1FBSkUsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQztRQUN0RCw4QkFBeUIsR0FBekIseUJBQXlCLENBQXlDO1FBQ2xFLCtCQUEwQixHQUExQiwwQkFBMEIsQ0FBNEI7UUFTbEUsMkJBQXNCLEdBQUcsSUFBSSxLQUFLLEVBQXNCLENBQUM7UUFMdkQsSUFBSSxDQUFDLFNBQVMsR0FBRyx5QkFBeUIsQ0FBQyxTQUFTLENBQUM7UUFDckQsSUFBSSxDQUFDLFFBQVEsR0FBRyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO1FBQ3BELElBQUksQ0FBQyxPQUFPLEdBQUcseUJBQXlCLENBQUMsT0FBTyxDQUFDO0lBQ25ELENBQUM7SUFJRCxRQUFRO1FBQ04sTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7UUFDckMsSUFBSSxNQUFNLEVBQUU7WUFDVixLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sRUFBRTtnQkFDMUIsSUFBSSxxQkFBeUMsQ0FBQztnQkFDOUMsSUFBSSxLQUFLLENBQUMsUUFBUSxFQUFFO29CQUNsQixxQkFBcUIsR0FBRyxJQUFJLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUN0RDtxQkFBTTtvQkFDTCxxQkFBcUIsR0FBRyxJQUFJLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUN2RDtnQkFDRCxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7YUFDekQ7U0FDRjtJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSCxRQUFRLENBQUMsS0FBYTtRQUNwQixJQUFJLENBQUMsc0JBQXNCLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxDQUN6QyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQzFDLENBQUM7UUFFRixNQUFNLGNBQWMsR0FDbEIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLHNDQUFzQyxDQUM1RCxJQUFJLENBQUMsc0JBQXNCLEVBQzNCLElBQUksQ0FBQyxTQUFTLENBQ2YsQ0FBQztRQUVKLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxtQkFBbUIsQ0FDakQsSUFBSSxDQUFDLFFBQVEsRUFDYjtZQUNFLEdBQUcsSUFBSSxDQUFDLFNBQVM7WUFDakIsTUFBTSxFQUFFLGNBQWM7U0FDdkIsRUFDRCxZQUFZLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FDbEMsQ0FBQztJQUNKLENBQUM7SUFFRCxrQ0FBa0MsQ0FDaEMsS0FBeUI7UUFFekIsT0FBTztZQUNMLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTtZQUN4QixLQUFLLEVBQUUsS0FBSyxDQUFDLFVBQVU7WUFDdkIsVUFBVSxFQUFFLEtBQUssQ0FBQyxlQUFlO1lBQ2pDLFdBQVcsRUFBRSxLQUFLLENBQUMsUUFBUTtTQUM1QixDQUFDO0lBQ0osQ0FBQzs7OElBdkVVLGlEQUFpRDtrSUFBakQsaURBQWlELDhHQ3BCOUQsaXRFQTJEQTsyRkR2Q2EsaURBQWlEO2tCQUw3RCxTQUFTOytCQUNFLGlEQUFpRCxtQkFFMUMsdUJBQXVCLENBQUMsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVW50eXBlZEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29yZS9tb2RlbC9jb25maWd1cmF0b3IubW9kZWwnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yUHJpY2VDb21wb25lbnRPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcHJpY2UvY29uZmlndXJhdG9yLXByaWNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JTdG9yZWZyb250VXRpbHNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZS9jb25maWd1cmF0b3Itc3RvcmVmcm9udC11dGlscy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckF0dHJpYnV0ZUJhc2VDb21wb25lbnQgfSBmcm9tICcuLi9iYXNlL2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yQXR0cmlidXRlQ29tcG9zaXRpb25Db250ZXh0IH0gZnJvbSAnLi4vLi4vY29tcG9zaXRpb24vY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1jb21wb3NpdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JDb21tb25zU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL2NvcmUvZmFjYWRlL2NvbmZpZ3VyYXRvci1jb21tb25zLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1jb25maWd1cmF0b3ItYXR0cmlidXRlLW11bHRpLXNlbGVjdGlvbi1pbWFnZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0b3ItYXR0cmlidXRlLW11bHRpLXNlbGVjdGlvbi1pbWFnZS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBDb25maWd1cmF0b3JBdHRyaWJ1dGVNdWx0aVNlbGVjdGlvbkltYWdlQ29tcG9uZW50XG4gIGV4dGVuZHMgQ29uZmlndXJhdG9yQXR0cmlidXRlQmFzZUNvbXBvbmVudFxuICBpbXBsZW1lbnRzIE9uSW5pdFxue1xuICBhdHRyaWJ1dGU6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGU7XG4gIG93bmVyS2V5OiBzdHJpbmc7XG4gIGV4cE1vZGU6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGNvbmZpZ1V0aWxzU2VydmljZTogQ29uZmlndXJhdG9yU3RvcmVmcm9udFV0aWxzU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgYXR0cmlidXRlQ29tcG9uZW50Q29udGV4dDogQ29uZmlndXJhdG9yQXR0cmlidXRlQ29tcG9zaXRpb25Db250ZXh0LFxuICAgIHByb3RlY3RlZCBjb25maWd1cmF0b3JDb21tb25zU2VydmljZTogQ29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMuYXR0cmlidXRlID0gYXR0cmlidXRlQ29tcG9uZW50Q29udGV4dC5hdHRyaWJ1dGU7XG4gICAgdGhpcy5vd25lcktleSA9IGF0dHJpYnV0ZUNvbXBvbmVudENvbnRleHQub3duZXIua2V5O1xuICAgIHRoaXMuZXhwTW9kZSA9IGF0dHJpYnV0ZUNvbXBvbmVudENvbnRleHQuZXhwTW9kZTtcbiAgfVxuXG4gIGF0dHJpYnV0ZUNoZWNrQm94Rm9ybXMgPSBuZXcgQXJyYXk8VW50eXBlZEZvcm1Db250cm9sPigpO1xuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbnN0IHZhbHVlcyA9IHRoaXMuYXR0cmlidXRlLnZhbHVlcztcbiAgICBpZiAodmFsdWVzKSB7XG4gICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZhbHVlcykge1xuICAgICAgICBsZXQgYXR0cmlidXRlQ2hlY2tCb3hGb3JtOiBVbnR5cGVkRm9ybUNvbnRyb2w7XG4gICAgICAgIGlmICh2YWx1ZS5zZWxlY3RlZCkge1xuICAgICAgICAgIGF0dHJpYnV0ZUNoZWNrQm94Rm9ybSA9IG5ldyBVbnR5cGVkRm9ybUNvbnRyb2wodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXR0cmlidXRlQ2hlY2tCb3hGb3JtID0gbmV3IFVudHlwZWRGb3JtQ29udHJvbChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVDaGVja0JveEZvcm1zLnB1c2goYXR0cmlidXRlQ2hlY2tCb3hGb3JtKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmlyZWQgd2hlbiBhIHZhbHVlIGhhcyBiZWVuIHNlbGVjdGVkXG4gICAqIEBwYXJhbSBpbmRleCBJbmRleCBvZiBzZWxlY3RlZCB2YWx1ZVxuICAgKi9cbiAgb25TZWxlY3QoaW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuYXR0cmlidXRlQ2hlY2tCb3hGb3Jtc1tpbmRleF0uc2V0VmFsdWUoXG4gICAgICAhdGhpcy5hdHRyaWJ1dGVDaGVja0JveEZvcm1zW2luZGV4XS52YWx1ZVxuICAgICk7XG5cbiAgICBjb25zdCBzZWxlY3RlZFZhbHVlcyA9XG4gICAgICB0aGlzLmNvbmZpZ1V0aWxzU2VydmljZS5hc3NlbWJsZVZhbHVlc0Zvck11bHRpU2VsZWN0QXR0cmlidXRlcyhcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVDaGVja0JveEZvcm1zLFxuICAgICAgICB0aGlzLmF0dHJpYnV0ZVxuICAgICAgKTtcblxuICAgIHRoaXMuY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2UudXBkYXRlQ29uZmlndXJhdGlvbihcbiAgICAgIHRoaXMub3duZXJLZXksXG4gICAgICB7XG4gICAgICAgIC4uLnRoaXMuYXR0cmlidXRlLFxuICAgICAgICB2YWx1ZXM6IHNlbGVjdGVkVmFsdWVzLFxuICAgICAgfSxcbiAgICAgIENvbmZpZ3VyYXRvci5VcGRhdGVUeXBlLkFUVFJJQlVURVxuICAgICk7XG4gIH1cblxuICBleHRyYWN0VmFsdWVQcmljZUZvcm11bGFQYXJhbWV0ZXJzKFxuICAgIHZhbHVlOiBDb25maWd1cmF0b3IuVmFsdWVcbiAgKTogQ29uZmlndXJhdG9yUHJpY2VDb21wb25lbnRPcHRpb25zIHtcbiAgICByZXR1cm4ge1xuICAgICAgcXVhbnRpdHk6IHZhbHVlLnF1YW50aXR5LFxuICAgICAgcHJpY2U6IHZhbHVlLnZhbHVlUHJpY2UsXG4gICAgICBwcmljZVRvdGFsOiB2YWx1ZS52YWx1ZVByaWNlVG90YWwsXG4gICAgICBpc0xpZ2h0ZWRVcDogdmFsdWUuc2VsZWN0ZWQsXG4gICAgfTtcbiAgfVxufVxuIiwiPGRpdiBpZD1cInt7IGNyZWF0ZUF0dHJpYnV0ZUlkRm9yQ29uZmlndXJhdG9yKGF0dHJpYnV0ZSkgfX1cIiBjbGFzcz1cImN4LXJvd1wiPlxuICA8ZGl2XG4gICAgKm5nRm9yPVwibGV0IHZhbHVlIG9mIGF0dHJpYnV0ZS52YWx1ZXM7IGxldCBpID0gaW5kZXhcIlxuICAgIGlkPVwie3sgY3JlYXRlQXR0cmlidXRlVmFsdWVJZEZvckNvbmZpZ3VyYXRvcihhdHRyaWJ1dGUsIHZhbHVlLnZhbHVlQ29kZSkgfX1cIlxuICAgIGNsYXNzPVwiY3gtY29uZmlndXJhdG9yLXNlbGVjdFwiXG4gID5cbiAgICA8aW5wdXRcbiAgICAgIGlkPVwie3tcbiAgICAgICAgY3JlYXRlQXR0cmlidXRlVmFsdWVJZEZvckNvbmZpZ3VyYXRvcihhdHRyaWJ1dGUsIHZhbHVlLnZhbHVlQ29kZSkgK1xuICAgICAgICAgICctaW5wdXQnXG4gICAgICB9fVwiXG4gICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgY2xhc3M9XCJmb3JtLWlucHV0XCJcbiAgICAgIFt2YWx1ZV09XCJ2YWx1ZS52YWx1ZUNvZGVcIlxuICAgICAgW2Zvcm1Db250cm9sXT1cImF0dHJpYnV0ZUNoZWNrQm94Rm9ybXNbaV1cIlxuICAgICAgbmFtZT1cInt7IGNyZWF0ZUF0dHJpYnV0ZUlkRm9yQ29uZmlndXJhdG9yKGF0dHJpYnV0ZSkgfX1cIlxuICAgICAgKGNsaWNrKT1cIm9uU2VsZWN0KGkpXCJcbiAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiXG4gICAgICAgIHZhbHVlLnZhbHVlUHJpY2UgJiYgdmFsdWUudmFsdWVQcmljZT8udmFsdWUgIT09IDBcbiAgICAgICAgICA/ICgnY29uZmlndXJhdG9yLmExMXkudmFsdWVPZkF0dHJpYnV0ZUZ1bGxXaXRoUHJpY2UnXG4gICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLnZhbHVlRGlzcGxheSxcbiAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgcHJpY2U6IHZhbHVlLnZhbHVlUHJpY2UuZm9ybWF0dGVkVmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgIDogKCdjb25maWd1cmF0b3IuYTExeS52YWx1ZU9mQXR0cmlidXRlRnVsbCdcbiAgICAgICAgICAgIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgICAgOiB7IHZhbHVlOiB2YWx1ZS52YWx1ZURpc3BsYXksIGF0dHJpYnV0ZTogYXR0cmlidXRlLmxhYmVsIH0pXG4gICAgICBcIlxuICAgICAgW2F0dHIuYXJpYS1kZXNjcmliZWRieV09XCJjcmVhdGVBdHRyaWJ1dGVVaUtleSgnbGFiZWwnLCBhdHRyaWJ1dGUubmFtZSlcIlxuICAgICAgW2F0dHIuY2hlY2tlZF09XCJhdHRyaWJ1dGVDaGVja0JveEZvcm1zW2ldLnZhbHVlID8gJ2NoZWNrZWQnIDogbnVsbFwiXG4gICAgICBbY3hGb2N1c109XCJ7IGtleTogYXR0cmlidXRlLm5hbWUgKyAnLScgKyB2YWx1ZS5uYW1lIH1cIlxuICAgIC8+XG4gICAgPGRpdiBjbGFzcz1cImN4LWxhYmVsLWNvbnRhaW5lclwiPlxuICAgICAgPGxhYmVsXG4gICAgICAgIGlkPVwie3sgY3JlYXRlVmFsdWVVaUtleSgnbGFiZWwnLCBhdHRyaWJ1dGUubmFtZSwgdmFsdWUudmFsdWVDb2RlKSB9fVwiXG4gICAgICAgIGZvcj1cInt7XG4gICAgICAgICAgY3JlYXRlQXR0cmlidXRlVmFsdWVJZEZvckNvbmZpZ3VyYXRvcihhdHRyaWJ1dGUsIHZhbHVlLnZhbHVlQ29kZSkgK1xuICAgICAgICAgICAgJy1pbnB1dCdcbiAgICAgICAgfX1cIlxuICAgICAgICBhcmlhLWhpZGRlbj1cInRydWVcIlxuICAgICAgICBjbGFzcz1cImZvcm0tY2hlY2stbGFiZWxcIlxuICAgICAgPlxuICAgICAgICA8aW1nXG4gICAgICAgICAgKm5nSWY9XCJnZXRJbWFnZSh2YWx1ZSkgYXMgaW1hZ2VcIlxuICAgICAgICAgIGNsYXNzPVwiY3gtaW1nXCJcbiAgICAgICAgICBzcmM9XCJ7eyBpbWFnZT8udXJsIH19XCJcbiAgICAgICAgICBhbHQ9XCJ7eyBpbWFnZT8uYWx0VGV4dCB9fVwiXG4gICAgICAgIC8+XG4gICAgICAgIDxkaXYgKm5nSWY9XCIhZ2V0SW1hZ2UodmFsdWUpXCIgY2xhc3M9XCJjeC1pbWctZHVtbXlcIj48L2Rpdj5cbiAgICAgICAge3sgZ2V0TGFiZWwoZXhwTW9kZSwgdmFsdWUudmFsdWVEaXNwbGF5LCB2YWx1ZS52YWx1ZUNvZGUpIH19XG4gICAgICAgIDxjeC1jb25maWd1cmF0b3ItcHJpY2VcbiAgICAgICAgICBbZm9ybXVsYV09XCJleHRyYWN0VmFsdWVQcmljZUZvcm11bGFQYXJhbWV0ZXJzKHZhbHVlKVwiXG4gICAgICAgID48L2N4LWNvbmZpZ3VyYXRvci1wcmljZT5cbiAgICAgIDwvbGFiZWw+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=