/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { ConfiguratorAttributeBaseComponent } from '../base/configurator-attribute-base.component';
import { take } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/core";
import * as i2 from "../../composition/configurator-attribute-composition.model";
import * as i3 from "../../../price/configurator-price.component";
import * as i4 from "@angular/common";
export class ConfiguratorAttributeReadOnlyComponent extends ConfiguratorAttributeBaseComponent {
    constructor(translationService, attributeComponentContext) {
        super();
        this.translationService = translationService;
        this.attributeComponentContext = attributeComponentContext;
        this.attribute = attributeComponentContext.attribute;
        this.group = attributeComponentContext.group.id;
        this.expMode = attributeComponentContext.expMode;
    }
    getCurrentValueName(attribute, value) {
        let name = '';
        if (attribute.selectedSingleValue && !value) {
            name = attribute.selectedSingleValue;
        }
        else if (attribute.userInput && !value) {
            name = attribute.userInput;
        }
        else if (value && value.valueDisplay) {
            name = value?.valueDisplay;
        }
        return name;
    }
    getAriaLabel(attribute, value) {
        let ariaLabel = '';
        if (value) {
            const valueName = this.getCurrentValueName(attribute, value);
            if (value.valuePrice && value.valuePrice?.value !== 0) {
                if (value.valuePriceTotal && value.valuePriceTotal?.value !== 0) {
                    ariaLabel = this.translate('configurator.a11y.readOnlyValueOfAttributeFullWithPrice', valueName, attribute, value.valuePriceTotal?.formattedValue);
                }
                else {
                    ariaLabel = this.translate('configurator.a11y.readOnlyValueOfAttributeFullWithPrice', valueName, attribute, value.valuePrice?.formattedValue);
                }
            }
            else {
                ariaLabel = this.translate('configurator.a11y.readOnlyValueOfAttributeFull', valueName, attribute);
            }
        }
        else {
            const valueName = this.getCurrentValueName(attribute);
            ariaLabel = this.translate('configurator.a11y.readOnlyValueOfAttributeFull', valueName, attribute);
        }
        return ariaLabel;
    }
    translate(resourceKey, valueName, attribute, formattedPrice) {
        let ariaLabel = '';
        const options = formattedPrice
            ? {
                value: valueName,
                attribute: attribute.label,
                price: formattedPrice,
            }
            : {
                value: valueName,
                attribute: attribute.label,
            };
        this.translationService
            .translate(resourceKey, options)
            .pipe(take(1))
            .subscribe((text) => (ariaLabel = text));
        return ariaLabel;
    }
    /**
     * Extract corresponding value price formula parameters.
     * For the read-only attribute types the complete price formula should be displayed at the value level.
     *
     * @param {Configurator.Value} value - Configurator value
     * @return {ConfiguratorPriceComponentOptions} - New price formula
     */
    extractValuePriceFormulaParameters(value) {
        return {
            quantity: value.quantity,
            price: value.valuePrice,
            priceTotal: value.valuePriceTotal,
            isLightedUp: value.selected,
        };
    }
}
ConfiguratorAttributeReadOnlyComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeReadOnlyComponent, deps: [{ token: i1.TranslationService }, { token: i2.ConfiguratorAttributeCompositionContext }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorAttributeReadOnlyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorAttributeReadOnlyComponent, selector: "cx-configurator-attribute-read-only", usesInheritance: true, ngImport: i0, template: "<fieldset>\n  <div id=\"{{ createAttributeIdForConfigurator(attribute) }}\">\n    <ng-container\n      *ngIf=\"\n        attribute.values && attribute.values.length > 0;\n        else noStaticDomain\n      \"\n    >\n      <ng-container *ngFor=\"let value of attribute.values\">\n        <div *ngIf=\"value.selected\" class=\"form-check\">\n          <span\n            id=\"{{\n              createValueUiKey('label', attribute.name, value.valueCode)\n            }}\"\n            tabindex=\"0\"\n            class=\"cx-visually-hidden\"\n          >\n            {{ getAriaLabel(attribute, value) }}\n          </span>\n          <div class=\"cx-value-label-pair\">\n            <label\n              id=\"{{\n                createValueUiKey('label', attribute.name, value.valueCode)\n              }}\"\n              aria-hidden=\"true\"\n              class=\"cx-read-only-attribute-label\"\n              >{{\n                getLabel(expMode, value.valueDisplay, value.valueCode)\n              }}</label\n            >\n          </div>\n          <div class=\"cx-value-price\">\n            <cx-configurator-price\n              [formula]=\"extractValuePriceFormulaParameters(value)\"\n            ></cx-configurator-price>\n          </div>\n        </div>\n      </ng-container>\n    </ng-container>\n    <ng-template #noStaticDomain>\n      <ng-container *ngIf=\"attribute.selectedSingleValue\">\n        <span\n          id=\"{{\n            createValueUiKey(\n              'label',\n              attribute.name,\n              attribute.selectedSingleValue\n            )\n          }}\"\n          tabindex=\"0\"\n          class=\"cx-visually-hidden\"\n        >\n          {{ getAriaLabel(attribute) }}\n        </span>\n        <div class=\"cx-read-only-attribute-label\" aria-hidden=\"true\">\n          <span aria-hidden=\"true\">{{ attribute.selectedSingleValue }}</span>\n        </div>\n      </ng-container>\n      <ng-container *ngIf=\"attribute.userInput\">\n        <span\n          id=\"{{\n            createValueUiKey('label', attribute.name, attribute.userInput)\n          }}\"\n          tabindex=\"0\"\n          class=\"cx-visually-hidden\"\n        >\n          {{ getAriaLabel(attribute) }}\n        </span>\n        <div class=\"cx-read-only-attribute-label\" aria-hidden=\"true\">\n          <span aria-hidden=\"true\">{{ attribute.userInput }}</span>\n        </div>\n      </ng-container>\n    </ng-template>\n  </div>\n</fieldset>\n", dependencies: [{ kind: "component", type: i3.ConfiguratorPriceComponent, selector: "cx-configurator-price", inputs: ["formula"] }, { kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeReadOnlyComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-attribute-read-only', changeDetection: ChangeDetectionStrategy.OnPush, template: "<fieldset>\n  <div id=\"{{ createAttributeIdForConfigurator(attribute) }}\">\n    <ng-container\n      *ngIf=\"\n        attribute.values && attribute.values.length > 0;\n        else noStaticDomain\n      \"\n    >\n      <ng-container *ngFor=\"let value of attribute.values\">\n        <div *ngIf=\"value.selected\" class=\"form-check\">\n          <span\n            id=\"{{\n              createValueUiKey('label', attribute.name, value.valueCode)\n            }}\"\n            tabindex=\"0\"\n            class=\"cx-visually-hidden\"\n          >\n            {{ getAriaLabel(attribute, value) }}\n          </span>\n          <div class=\"cx-value-label-pair\">\n            <label\n              id=\"{{\n                createValueUiKey('label', attribute.name, value.valueCode)\n              }}\"\n              aria-hidden=\"true\"\n              class=\"cx-read-only-attribute-label\"\n              >{{\n                getLabel(expMode, value.valueDisplay, value.valueCode)\n              }}</label\n            >\n          </div>\n          <div class=\"cx-value-price\">\n            <cx-configurator-price\n              [formula]=\"extractValuePriceFormulaParameters(value)\"\n            ></cx-configurator-price>\n          </div>\n        </div>\n      </ng-container>\n    </ng-container>\n    <ng-template #noStaticDomain>\n      <ng-container *ngIf=\"attribute.selectedSingleValue\">\n        <span\n          id=\"{{\n            createValueUiKey(\n              'label',\n              attribute.name,\n              attribute.selectedSingleValue\n            )\n          }}\"\n          tabindex=\"0\"\n          class=\"cx-visually-hidden\"\n        >\n          {{ getAriaLabel(attribute) }}\n        </span>\n        <div class=\"cx-read-only-attribute-label\" aria-hidden=\"true\">\n          <span aria-hidden=\"true\">{{ attribute.selectedSingleValue }}</span>\n        </div>\n      </ng-container>\n      <ng-container *ngIf=\"attribute.userInput\">\n        <span\n          id=\"{{\n            createValueUiKey('label', attribute.name, attribute.userInput)\n          }}\"\n          tabindex=\"0\"\n          class=\"cx-visually-hidden\"\n        >\n          {{ getAriaLabel(attribute) }}\n        </span>\n        <div class=\"cx-read-only-attribute-label\" aria-hidden=\"true\">\n          <span aria-hidden=\"true\">{{ attribute.userInput }}</span>\n        </div>\n      </ng-container>\n    </ng-template>\n  </div>\n</fieldset>\n" }]
        }], ctorParameters: function () { return [{ type: i1.TranslationService }, { type: i2.ConfiguratorAttributeCompositionContext }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1yZWFkLW9ubHkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS90eXBlcy9yZWFkLW9ubHkvY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1yZWFkLW9ubHkuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS90eXBlcy9yZWFkLW9ubHkvY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1yZWFkLW9ubHkuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHbkUsT0FBTyxFQUFFLGtDQUFrQyxFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFFbkcsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7QUFRdEMsTUFBTSxPQUFPLHNDQUF1QyxTQUFRLGtDQUFrQztJQUs1RixZQUNZLGtCQUFzQyxFQUN0Qyx5QkFBa0U7UUFFNUUsS0FBSyxFQUFFLENBQUM7UUFIRSx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQ3RDLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBeUM7UUFHNUUsSUFBSSxDQUFDLFNBQVMsR0FBRyx5QkFBeUIsQ0FBQyxTQUFTLENBQUM7UUFDckQsSUFBSSxDQUFDLEtBQUssR0FBRyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ2hELElBQUksQ0FBQyxPQUFPLEdBQUcseUJBQXlCLENBQUMsT0FBTyxDQUFDO0lBQ25ELENBQUM7SUFFUyxtQkFBbUIsQ0FDM0IsU0FBaUMsRUFDakMsS0FBMEI7UUFFMUIsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2QsSUFBSSxTQUFTLENBQUMsbUJBQW1CLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDM0MsSUFBSSxHQUFHLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQztTQUN0QzthQUFNLElBQUksU0FBUyxDQUFDLFNBQVMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUN4QyxJQUFJLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztTQUM1QjthQUFNLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxZQUFZLEVBQUU7WUFDdEMsSUFBSSxHQUFHLEtBQUssRUFBRSxZQUFZLENBQUM7U0FDNUI7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxZQUFZLENBQ1YsU0FBaUMsRUFDakMsS0FBc0M7UUFFdEMsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ25CLElBQUksS0FBSyxFQUFFO1lBQ1QsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM3RCxJQUFJLEtBQUssQ0FBQyxVQUFVLElBQUksS0FBSyxDQUFDLFVBQVUsRUFBRSxLQUFLLEtBQUssQ0FBQyxFQUFFO2dCQUNyRCxJQUFJLEtBQUssQ0FBQyxlQUFlLElBQUksS0FBSyxDQUFDLGVBQWUsRUFBRSxLQUFLLEtBQUssQ0FBQyxFQUFFO29CQUMvRCxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FDeEIseURBQXlELEVBQ3pELFNBQVMsRUFDVCxTQUFTLEVBQ1QsS0FBSyxDQUFDLGVBQWUsRUFBRSxjQUFjLENBQ3RDLENBQUM7aUJBQ0g7cUJBQU07b0JBQ0wsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQ3hCLHlEQUF5RCxFQUN6RCxTQUFTLEVBQ1QsU0FBUyxFQUNULEtBQUssQ0FBQyxVQUFVLEVBQUUsY0FBYyxDQUNqQyxDQUFDO2lCQUNIO2FBQ0Y7aUJBQU07Z0JBQ0wsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQ3hCLGdEQUFnRCxFQUNoRCxTQUFTLEVBQ1QsU0FBUyxDQUNWLENBQUM7YUFDSDtTQUNGO2FBQU07WUFDTCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdEQsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQ3hCLGdEQUFnRCxFQUNoRCxTQUFTLEVBQ1QsU0FBUyxDQUNWLENBQUM7U0FDSDtRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFUyxTQUFTLENBQ2pCLFdBQW1CLEVBQ25CLFNBQWlCLEVBQ2pCLFNBQWlDLEVBQ2pDLGNBQXVCO1FBRXZCLElBQUksU0FBUyxHQUFXLEVBQUUsQ0FBQztRQUUzQixNQUFNLE9BQU8sR0FBRyxjQUFjO1lBQzVCLENBQUMsQ0FBQztnQkFDRSxLQUFLLEVBQUUsU0FBUztnQkFDaEIsU0FBUyxFQUFFLFNBQVMsQ0FBQyxLQUFLO2dCQUMxQixLQUFLLEVBQUUsY0FBYzthQUN0QjtZQUNILENBQUMsQ0FBQztnQkFDRSxLQUFLLEVBQUUsU0FBUztnQkFDaEIsU0FBUyxFQUFFLFNBQVMsQ0FBQyxLQUFLO2FBQzNCLENBQUM7UUFFTixJQUFJLENBQUMsa0JBQWtCO2FBQ3BCLFNBQVMsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDO2FBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDYixTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7UUFFM0MsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILGtDQUFrQyxDQUNoQyxLQUF5QjtRQUV6QixPQUFPO1lBQ0wsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO1lBQ3hCLEtBQUssRUFBRSxLQUFLLENBQUMsVUFBVTtZQUN2QixVQUFVLEVBQUUsS0FBSyxDQUFDLGVBQWU7WUFDakMsV0FBVyxFQUFFLEtBQUssQ0FBQyxRQUFRO1NBQzVCLENBQUM7SUFDSixDQUFDOzttSUFsSFUsc0NBQXNDO3VIQUF0QyxzQ0FBc0Msa0dDbkJuRCxnN0VBMkVBOzJGRHhEYSxzQ0FBc0M7a0JBTGxELFNBQVM7K0JBQ0UscUNBQXFDLG1CQUU5Qix1QkFBdUIsQ0FBQyxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29yZS9tb2RlbC9jb25maWd1cmF0b3IubW9kZWwnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yUHJpY2VDb21wb25lbnRPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcHJpY2UnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yQXR0cmlidXRlQmFzZUNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UvY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUcmFuc2xhdGlvblNlcnZpY2UgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckF0dHJpYnV0ZUNvbXBvc2l0aW9uQ29udGV4dCB9IGZyb20gJy4uLy4uL2NvbXBvc2l0aW9uL2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtY29tcG9zaXRpb24ubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1jb25maWd1cmF0b3ItYXR0cmlidXRlLXJlYWQtb25seScsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0b3ItYXR0cmlidXRlLXJlYWQtb25seS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBDb25maWd1cmF0b3JBdHRyaWJ1dGVSZWFkT25seUNvbXBvbmVudCBleHRlbmRzIENvbmZpZ3VyYXRvckF0dHJpYnV0ZUJhc2VDb21wb25lbnQge1xuICBhdHRyaWJ1dGU6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGU7XG4gIGdyb3VwOiBzdHJpbmc7XG4gIGV4cE1vZGU6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBhdHRyaWJ1dGVDb21wb25lbnRDb250ZXh0OiBDb25maWd1cmF0b3JBdHRyaWJ1dGVDb21wb3NpdGlvbkNvbnRleHRcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZUNvbXBvbmVudENvbnRleHQuYXR0cmlidXRlO1xuICAgIHRoaXMuZ3JvdXAgPSBhdHRyaWJ1dGVDb21wb25lbnRDb250ZXh0Lmdyb3VwLmlkO1xuICAgIHRoaXMuZXhwTW9kZSA9IGF0dHJpYnV0ZUNvbXBvbmVudENvbnRleHQuZXhwTW9kZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRDdXJyZW50VmFsdWVOYW1lKFxuICAgIGF0dHJpYnV0ZTogQ29uZmlndXJhdG9yLkF0dHJpYnV0ZSxcbiAgICB2YWx1ZT86IENvbmZpZ3VyYXRvci5WYWx1ZVxuICApOiBzdHJpbmcge1xuICAgIGxldCBuYW1lID0gJyc7XG4gICAgaWYgKGF0dHJpYnV0ZS5zZWxlY3RlZFNpbmdsZVZhbHVlICYmICF2YWx1ZSkge1xuICAgICAgbmFtZSA9IGF0dHJpYnV0ZS5zZWxlY3RlZFNpbmdsZVZhbHVlO1xuICAgIH0gZWxzZSBpZiAoYXR0cmlidXRlLnVzZXJJbnB1dCAmJiAhdmFsdWUpIHtcbiAgICAgIG5hbWUgPSBhdHRyaWJ1dGUudXNlcklucHV0O1xuICAgIH0gZWxzZSBpZiAodmFsdWUgJiYgdmFsdWUudmFsdWVEaXNwbGF5KSB7XG4gICAgICBuYW1lID0gdmFsdWU/LnZhbHVlRGlzcGxheTtcbiAgICB9XG4gICAgcmV0dXJuIG5hbWU7XG4gIH1cblxuICBnZXRBcmlhTGFiZWwoXG4gICAgYXR0cmlidXRlOiBDb25maWd1cmF0b3IuQXR0cmlidXRlLFxuICAgIHZhbHVlPzogQ29uZmlndXJhdG9yLlZhbHVlIHwgdW5kZWZpbmVkXG4gICk6IHN0cmluZyB7XG4gICAgbGV0IGFyaWFMYWJlbCA9ICcnO1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgY29uc3QgdmFsdWVOYW1lID0gdGhpcy5nZXRDdXJyZW50VmFsdWVOYW1lKGF0dHJpYnV0ZSwgdmFsdWUpO1xuICAgICAgaWYgKHZhbHVlLnZhbHVlUHJpY2UgJiYgdmFsdWUudmFsdWVQcmljZT8udmFsdWUgIT09IDApIHtcbiAgICAgICAgaWYgKHZhbHVlLnZhbHVlUHJpY2VUb3RhbCAmJiB2YWx1ZS52YWx1ZVByaWNlVG90YWw/LnZhbHVlICE9PSAwKSB7XG4gICAgICAgICAgYXJpYUxhYmVsID0gdGhpcy50cmFuc2xhdGUoXG4gICAgICAgICAgICAnY29uZmlndXJhdG9yLmExMXkucmVhZE9ubHlWYWx1ZU9mQXR0cmlidXRlRnVsbFdpdGhQcmljZScsXG4gICAgICAgICAgICB2YWx1ZU5hbWUsXG4gICAgICAgICAgICBhdHRyaWJ1dGUsXG4gICAgICAgICAgICB2YWx1ZS52YWx1ZVByaWNlVG90YWw/LmZvcm1hdHRlZFZhbHVlXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhcmlhTGFiZWwgPSB0aGlzLnRyYW5zbGF0ZShcbiAgICAgICAgICAgICdjb25maWd1cmF0b3IuYTExeS5yZWFkT25seVZhbHVlT2ZBdHRyaWJ1dGVGdWxsV2l0aFByaWNlJyxcbiAgICAgICAgICAgIHZhbHVlTmFtZSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZSxcbiAgICAgICAgICAgIHZhbHVlLnZhbHVlUHJpY2U/LmZvcm1hdHRlZFZhbHVlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXJpYUxhYmVsID0gdGhpcy50cmFuc2xhdGUoXG4gICAgICAgICAgJ2NvbmZpZ3VyYXRvci5hMTF5LnJlYWRPbmx5VmFsdWVPZkF0dHJpYnV0ZUZ1bGwnLFxuICAgICAgICAgIHZhbHVlTmFtZSxcbiAgICAgICAgICBhdHRyaWJ1dGVcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdmFsdWVOYW1lID0gdGhpcy5nZXRDdXJyZW50VmFsdWVOYW1lKGF0dHJpYnV0ZSk7XG4gICAgICBhcmlhTGFiZWwgPSB0aGlzLnRyYW5zbGF0ZShcbiAgICAgICAgJ2NvbmZpZ3VyYXRvci5hMTF5LnJlYWRPbmx5VmFsdWVPZkF0dHJpYnV0ZUZ1bGwnLFxuICAgICAgICB2YWx1ZU5hbWUsXG4gICAgICAgIGF0dHJpYnV0ZVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGFyaWFMYWJlbDtcbiAgfVxuXG4gIHByb3RlY3RlZCB0cmFuc2xhdGUoXG4gICAgcmVzb3VyY2VLZXk6IHN0cmluZyxcbiAgICB2YWx1ZU5hbWU6IHN0cmluZyxcbiAgICBhdHRyaWJ1dGU6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGUsXG4gICAgZm9ybWF0dGVkUHJpY2U/OiBzdHJpbmdcbiAgKTogc3RyaW5nIHtcbiAgICBsZXQgYXJpYUxhYmVsOiBzdHJpbmcgPSAnJztcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBmb3JtYXR0ZWRQcmljZVxuICAgICAgPyB7XG4gICAgICAgICAgdmFsdWU6IHZhbHVlTmFtZSxcbiAgICAgICAgICBhdHRyaWJ1dGU6IGF0dHJpYnV0ZS5sYWJlbCxcbiAgICAgICAgICBwcmljZTogZm9ybWF0dGVkUHJpY2UsXG4gICAgICAgIH1cbiAgICAgIDoge1xuICAgICAgICAgIHZhbHVlOiB2YWx1ZU5hbWUsXG4gICAgICAgICAgYXR0cmlidXRlOiBhdHRyaWJ1dGUubGFiZWwsXG4gICAgICAgIH07XG5cbiAgICB0aGlzLnRyYW5zbGF0aW9uU2VydmljZVxuICAgICAgLnRyYW5zbGF0ZShyZXNvdXJjZUtleSwgb3B0aW9ucylcbiAgICAgIC5waXBlKHRha2UoMSkpXG4gICAgICAuc3Vic2NyaWJlKCh0ZXh0KSA9PiAoYXJpYUxhYmVsID0gdGV4dCkpO1xuXG4gICAgcmV0dXJuIGFyaWFMYWJlbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IGNvcnJlc3BvbmRpbmcgdmFsdWUgcHJpY2UgZm9ybXVsYSBwYXJhbWV0ZXJzLlxuICAgKiBGb3IgdGhlIHJlYWQtb25seSBhdHRyaWJ1dGUgdHlwZXMgdGhlIGNvbXBsZXRlIHByaWNlIGZvcm11bGEgc2hvdWxkIGJlIGRpc3BsYXllZCBhdCB0aGUgdmFsdWUgbGV2ZWwuXG4gICAqXG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdG9yLlZhbHVlfSB2YWx1ZSAtIENvbmZpZ3VyYXRvciB2YWx1ZVxuICAgKiBAcmV0dXJuIHtDb25maWd1cmF0b3JQcmljZUNvbXBvbmVudE9wdGlvbnN9IC0gTmV3IHByaWNlIGZvcm11bGFcbiAgICovXG4gIGV4dHJhY3RWYWx1ZVByaWNlRm9ybXVsYVBhcmFtZXRlcnMoXG4gICAgdmFsdWU6IENvbmZpZ3VyYXRvci5WYWx1ZVxuICApOiBDb25maWd1cmF0b3JQcmljZUNvbXBvbmVudE9wdGlvbnMge1xuICAgIHJldHVybiB7XG4gICAgICBxdWFudGl0eTogdmFsdWUucXVhbnRpdHksXG4gICAgICBwcmljZTogdmFsdWUudmFsdWVQcmljZSxcbiAgICAgIHByaWNlVG90YWw6IHZhbHVlLnZhbHVlUHJpY2VUb3RhbCxcbiAgICAgIGlzTGlnaHRlZFVwOiB2YWx1ZS5zZWxlY3RlZCxcbiAgICB9O1xuICB9XG59XG4iLCI8ZmllbGRzZXQ+XG4gIDxkaXYgaWQ9XCJ7eyBjcmVhdGVBdHRyaWJ1dGVJZEZvckNvbmZpZ3VyYXRvcihhdHRyaWJ1dGUpIH19XCI+XG4gICAgPG5nLWNvbnRhaW5lclxuICAgICAgKm5nSWY9XCJcbiAgICAgICAgYXR0cmlidXRlLnZhbHVlcyAmJiBhdHRyaWJ1dGUudmFsdWVzLmxlbmd0aCA+IDA7XG4gICAgICAgIGVsc2Ugbm9TdGF0aWNEb21haW5cbiAgICAgIFwiXG4gICAgPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgdmFsdWUgb2YgYXR0cmlidXRlLnZhbHVlc1wiPlxuICAgICAgICA8ZGl2ICpuZ0lmPVwidmFsdWUuc2VsZWN0ZWRcIiBjbGFzcz1cImZvcm0tY2hlY2tcIj5cbiAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgaWQ9XCJ7e1xuICAgICAgICAgICAgICBjcmVhdGVWYWx1ZVVpS2V5KCdsYWJlbCcsIGF0dHJpYnV0ZS5uYW1lLCB2YWx1ZS52YWx1ZUNvZGUpXG4gICAgICAgICAgICB9fVwiXG4gICAgICAgICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgICAgICAgY2xhc3M9XCJjeC12aXN1YWxseS1oaWRkZW5cIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt7IGdldEFyaWFMYWJlbChhdHRyaWJ1dGUsIHZhbHVlKSB9fVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY3gtdmFsdWUtbGFiZWwtcGFpclwiPlxuICAgICAgICAgICAgPGxhYmVsXG4gICAgICAgICAgICAgIGlkPVwie3tcbiAgICAgICAgICAgICAgICBjcmVhdGVWYWx1ZVVpS2V5KCdsYWJlbCcsIGF0dHJpYnV0ZS5uYW1lLCB2YWx1ZS52YWx1ZUNvZGUpXG4gICAgICAgICAgICAgIH19XCJcbiAgICAgICAgICAgICAgYXJpYS1oaWRkZW49XCJ0cnVlXCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJjeC1yZWFkLW9ubHktYXR0cmlidXRlLWxhYmVsXCJcbiAgICAgICAgICAgICAgPnt7XG4gICAgICAgICAgICAgICAgZ2V0TGFiZWwoZXhwTW9kZSwgdmFsdWUudmFsdWVEaXNwbGF5LCB2YWx1ZS52YWx1ZUNvZGUpXG4gICAgICAgICAgICAgIH19PC9sYWJlbFxuICAgICAgICAgICAgPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC12YWx1ZS1wcmljZVwiPlxuICAgICAgICAgICAgPGN4LWNvbmZpZ3VyYXRvci1wcmljZVxuICAgICAgICAgICAgICBbZm9ybXVsYV09XCJleHRyYWN0VmFsdWVQcmljZUZvcm11bGFQYXJhbWV0ZXJzKHZhbHVlKVwiXG4gICAgICAgICAgICA+PC9jeC1jb25maWd1cmF0b3ItcHJpY2U+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgPG5nLXRlbXBsYXRlICNub1N0YXRpY0RvbWFpbj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJhdHRyaWJ1dGUuc2VsZWN0ZWRTaW5nbGVWYWx1ZVwiPlxuICAgICAgICA8c3BhblxuICAgICAgICAgIGlkPVwie3tcbiAgICAgICAgICAgIGNyZWF0ZVZhbHVlVWlLZXkoXG4gICAgICAgICAgICAgICdsYWJlbCcsXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZS5uYW1lLFxuICAgICAgICAgICAgICBhdHRyaWJ1dGUuc2VsZWN0ZWRTaW5nbGVWYWx1ZVxuICAgICAgICAgICAgKVxuICAgICAgICAgIH19XCJcbiAgICAgICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgICAgIGNsYXNzPVwiY3gtdmlzdWFsbHktaGlkZGVuXCJcbiAgICAgICAgPlxuICAgICAgICAgIHt7IGdldEFyaWFMYWJlbChhdHRyaWJ1dGUpIH19XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LXJlYWQtb25seS1hdHRyaWJ1dGUtbGFiZWxcIiBhcmlhLWhpZGRlbj1cInRydWVcIj5cbiAgICAgICAgICA8c3BhbiBhcmlhLWhpZGRlbj1cInRydWVcIj57eyBhdHRyaWJ1dGUuc2VsZWN0ZWRTaW5nbGVWYWx1ZSB9fTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJhdHRyaWJ1dGUudXNlcklucHV0XCI+XG4gICAgICAgIDxzcGFuXG4gICAgICAgICAgaWQ9XCJ7e1xuICAgICAgICAgICAgY3JlYXRlVmFsdWVVaUtleSgnbGFiZWwnLCBhdHRyaWJ1dGUubmFtZSwgYXR0cmlidXRlLnVzZXJJbnB1dClcbiAgICAgICAgICB9fVwiXG4gICAgICAgICAgdGFiaW5kZXg9XCIwXCJcbiAgICAgICAgICBjbGFzcz1cImN4LXZpc3VhbGx5LWhpZGRlblwiXG4gICAgICAgID5cbiAgICAgICAgICB7eyBnZXRBcmlhTGFiZWwoYXR0cmlidXRlKSB9fVxuICAgICAgICA8L3NwYW4+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC1yZWFkLW9ubHktYXR0cmlidXRlLWxhYmVsXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+XG4gICAgICAgICAgPHNwYW4gYXJpYS1oaWRkZW49XCJ0cnVlXCI+e3sgYXR0cmlidXRlLnVzZXJJbnB1dCB9fTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICA8L2Rpdj5cbjwvZmllbGRzZXQ+XG4iXX0=