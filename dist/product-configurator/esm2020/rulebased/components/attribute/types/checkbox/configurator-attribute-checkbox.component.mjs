/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { UntypedFormControl } from '@angular/forms';
import { Configurator } from '../../../../core/model/configurator.model';
import { ConfiguratorAttributeBaseComponent } from '../base/configurator-attribute-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../composition/configurator-attribute-composition.model";
import * as i2 from "../../../../core/facade/configurator-commons.service";
import * as i3 from "@spartacus/storefront";
import * as i4 from "@angular/forms";
import * as i5 from "../../../price/configurator-price.component";
import * as i6 from "@spartacus/core";
export class ConfiguratorAttributeCheckBoxComponent extends ConfiguratorAttributeBaseComponent {
    constructor(attributeComponentContext, configuratorCommonsService) {
        super();
        this.attributeComponentContext = attributeComponentContext;
        this.configuratorCommonsService = configuratorCommonsService;
        this.attributeCheckBoxForm = new UntypedFormControl('');
        this.attribute = attributeComponentContext.attribute;
        this.group = attributeComponentContext.group.id;
        this.ownerKey = attributeComponentContext.owner.key;
        this.expMode = attributeComponentContext.expMode;
    }
    ngOnInit() {
        this.attributeCheckBoxForm.setValue(this.attribute.selectedSingleValue);
        this.attributeValue = this.getValueFromAttribute();
    }
    /**
     * Fired when a check box has been selected i.e. when a value has been set
     */
    onSelect() {
        const selectedValues = this.assembleSingleValue();
        this.configuratorCommonsService.updateConfiguration(this.ownerKey, {
            ...this.attribute,
            values: selectedValues,
        }, Configurator.UpdateType.ATTRIBUTE);
    }
    getValueFromAttribute() {
        //we can assume that for this component, value is always present
        //otherwise attribute type would not be correct,
        //could only happen in exceptional cases, on wrong modifications e.g.
        return this.attribute.values ? this.attribute.values[0] : { valueCode: '' };
    }
    assembleSingleValue() {
        const localAssembledValues = [];
        const value = this.getValueFromAttribute();
        const localAttributeValue = {
            valueCode: value.valueCode,
        };
        localAttributeValue.name = value.name;
        localAttributeValue.selected = this.attributeCheckBoxForm.value;
        localAssembledValues.push(localAttributeValue);
        return localAssembledValues;
    }
    /**
     * Extract corresponding value price formula parameters.
     * For the multi-selection attribute types the complete price formula should be displayed at the value level.
     *
     * @param {Configurator.Value} value - Configurator value
     * @return {ConfiguratorPriceComponentOptions} - New price formula
     */
    extractValuePriceFormulaParameters(value) {
        return {
            quantity: value.quantity,
            price: value.valuePrice,
            priceTotal: value.valuePriceTotal,
            isLightedUp: value.selected,
        };
    }
}
ConfiguratorAttributeCheckBoxComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeCheckBoxComponent, deps: [{ token: i1.ConfiguratorAttributeCompositionContext }, { token: i2.ConfiguratorCommonsService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorAttributeCheckBoxComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ConfiguratorAttributeCheckBoxComponent, selector: "cx-configurator-attribute-checkbox", usesInheritance: true, ngImport: i0, template: "<ng-container>\n  <fieldset>\n    <legend style=\"display: none\">{{ attribute.label }}</legend>\n    <div id=\"{{ createAttributeIdForConfigurator(attribute) }}\">\n      <div class=\"form-check\">\n        <div class=\"cx-value-label-pair\">\n          <input\n            id=\"{{\n              createAttributeValueIdForConfigurator(\n                attribute,\n                attributeValue.valueCode\n              )\n            }}\"\n            type=\"checkbox\"\n            class=\"form-check-input\"\n            [value]=\"attributeValue.valueCode\"\n            [cxFocus]=\"{\n              key: attribute.name + '-' + attributeValue.name\n            }\"\n            (change)=\"onSelect()\"\n            [formControl]=\"attributeCheckBoxForm\"\n            name=\"{{ createAttributeIdForConfigurator(attribute) }}\"\n            [attr.aria-label]=\"\n              attributeValue.valuePrice &&\n              attributeValue.valuePrice?.value !== 0\n                ? ('configurator.a11y.valueOfAttributeFullWithPrice'\n                  | cxTranslate\n                    : {\n                        value: attributeValue.valueDisplay,\n                        attribute: attribute.label,\n                        price: attributeValue.valuePrice.formattedValue\n                      })\n                : ('configurator.a11y.valueOfAttributeFull'\n                  | cxTranslate\n                    : {\n                        value: attributeValue.valueDisplay,\n                        attribute: attribute.label\n                      })\n            \"\n            [attr.aria-describedby]=\"\n              createAttributeUiKey('label', attribute.name) +\n              ' ' +\n              createAttributeUiKey('attribute-msg', attribute.name)\n            \"\n          />\n          <label\n            id=\"{{\n              createValueUiKey(\n                'label',\n                attribute.name,\n                attributeValue.valueCode\n              )\n            }}\"\n            for=\"{{\n              createAttributeValueIdForConfigurator(\n                attribute,\n                attributeValue.valueCode\n              )\n            }}\"\n            aria-hidden=\"true\"\n            class=\"form-check-label\"\n            >{{\n              getLabel(\n                expMode,\n                attributeValue.valueDisplay,\n                attributeValue.valueCode\n              )\n            }}</label\n          >\n        </div>\n        <div class=\"cx-value-price\">\n          <cx-configurator-price\n            [formula]=\"extractValuePriceFormulaParameters(attributeValue)\"\n          ></cx-configurator-price>\n        </div>\n      </div>\n    </div>\n  </fieldset>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i3.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "directive", type: i4.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "component", type: i5.ConfiguratorPriceComponent, selector: "cx-configurator-price", inputs: ["formula"] }, { kind: "pipe", type: i6.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ConfiguratorAttributeCheckBoxComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-attribute-checkbox', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-container>\n  <fieldset>\n    <legend style=\"display: none\">{{ attribute.label }}</legend>\n    <div id=\"{{ createAttributeIdForConfigurator(attribute) }}\">\n      <div class=\"form-check\">\n        <div class=\"cx-value-label-pair\">\n          <input\n            id=\"{{\n              createAttributeValueIdForConfigurator(\n                attribute,\n                attributeValue.valueCode\n              )\n            }}\"\n            type=\"checkbox\"\n            class=\"form-check-input\"\n            [value]=\"attributeValue.valueCode\"\n            [cxFocus]=\"{\n              key: attribute.name + '-' + attributeValue.name\n            }\"\n            (change)=\"onSelect()\"\n            [formControl]=\"attributeCheckBoxForm\"\n            name=\"{{ createAttributeIdForConfigurator(attribute) }}\"\n            [attr.aria-label]=\"\n              attributeValue.valuePrice &&\n              attributeValue.valuePrice?.value !== 0\n                ? ('configurator.a11y.valueOfAttributeFullWithPrice'\n                  | cxTranslate\n                    : {\n                        value: attributeValue.valueDisplay,\n                        attribute: attribute.label,\n                        price: attributeValue.valuePrice.formattedValue\n                      })\n                : ('configurator.a11y.valueOfAttributeFull'\n                  | cxTranslate\n                    : {\n                        value: attributeValue.valueDisplay,\n                        attribute: attribute.label\n                      })\n            \"\n            [attr.aria-describedby]=\"\n              createAttributeUiKey('label', attribute.name) +\n              ' ' +\n              createAttributeUiKey('attribute-msg', attribute.name)\n            \"\n          />\n          <label\n            id=\"{{\n              createValueUiKey(\n                'label',\n                attribute.name,\n                attributeValue.valueCode\n              )\n            }}\"\n            for=\"{{\n              createAttributeValueIdForConfigurator(\n                attribute,\n                attributeValue.valueCode\n              )\n            }}\"\n            aria-hidden=\"true\"\n            class=\"form-check-label\"\n            >{{\n              getLabel(\n                expMode,\n                attributeValue.valueDisplay,\n                attributeValue.valueCode\n              )\n            }}</label\n          >\n        </div>\n        <div class=\"cx-value-price\">\n          <cx-configurator-price\n            [formula]=\"extractValuePriceFormulaParameters(attributeValue)\"\n          ></cx-configurator-price>\n        </div>\n      </div>\n    </div>\n  </fieldset>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorAttributeCompositionContext }, { type: i2.ConfiguratorCommonsService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1jaGVja2JveC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcHJvZHVjdC1jb25maWd1cmF0b3IvcnVsZWJhc2VkL2NvbXBvbmVudHMvYXR0cmlidXRlL3R5cGVzL2NoZWNrYm94L2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtY2hlY2tib3guY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS90eXBlcy9jaGVja2JveC9jb25maWd1cmF0b3ItYXR0cmlidXRlLWNoZWNrYm94LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQzNFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUV6RSxPQUFPLEVBQUUsa0NBQWtDLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQzs7Ozs7Ozs7QUFTbkcsTUFBTSxPQUFPLHNDQUNYLFNBQVEsa0NBQWtDO0lBVzFDLFlBQ1kseUJBQWtFLEVBQ2xFLDBCQUFzRDtRQUVoRSxLQUFLLEVBQUUsQ0FBQztRQUhFLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBeUM7UUFDbEUsK0JBQTBCLEdBQTFCLDBCQUEwQixDQUE0QjtRQUpsRSwwQkFBcUIsR0FBRyxJQUFJLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBT2pELElBQUksQ0FBQyxTQUFTLEdBQUcseUJBQXlCLENBQUMsU0FBUyxDQUFDO1FBQ3JELElBQUksQ0FBQyxLQUFLLEdBQUcseUJBQXlCLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNoRCxJQUFJLENBQUMsUUFBUSxHQUFHLHlCQUF5QixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7UUFDcEQsSUFBSSxDQUFDLE9BQU8sR0FBRyx5QkFBeUIsQ0FBQyxPQUFPLENBQUM7SUFDbkQsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUN4RSxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQ3JELENBQUM7SUFFRDs7T0FFRztJQUNILFFBQVE7UUFDTixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUVsRCxJQUFJLENBQUMsMEJBQTBCLENBQUMsbUJBQW1CLENBQ2pELElBQUksQ0FBQyxRQUFRLEVBQ2I7WUFDRSxHQUFHLElBQUksQ0FBQyxTQUFTO1lBQ2pCLE1BQU0sRUFBRSxjQUFjO1NBQ3ZCLEVBQ0QsWUFBWSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQ2xDLENBQUM7SUFDSixDQUFDO0lBRVMscUJBQXFCO1FBQzdCLGdFQUFnRTtRQUNoRSxnREFBZ0Q7UUFDaEQscUVBQXFFO1FBQ3JFLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUM5RSxDQUFDO0lBRVMsbUJBQW1CO1FBQzNCLE1BQU0sb0JBQW9CLEdBQXlCLEVBQUUsQ0FBQztRQUN0RCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUUzQyxNQUFNLG1CQUFtQixHQUF1QjtZQUM5QyxTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7U0FDM0IsQ0FBQztRQUVGLG1CQUFtQixDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQ3RDLG1CQUFtQixDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDO1FBQ2hFLG9CQUFvQixDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBRS9DLE9BQU8sb0JBQW9CLENBQUM7SUFDOUIsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILGtDQUFrQyxDQUNoQyxLQUF5QjtRQUV6QixPQUFPO1lBQ0wsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO1lBQ3hCLEtBQUssRUFBRSxLQUFLLENBQUMsVUFBVTtZQUN2QixVQUFVLEVBQUUsS0FBSyxDQUFDLGVBQWU7WUFDakMsV0FBVyxFQUFFLEtBQUssQ0FBQyxRQUFRO1NBQzVCLENBQUM7SUFDSixDQUFDOzttSUFsRlUsc0NBQXNDO3VIQUF0QyxzQ0FBc0MsaUdDbkJuRCxvc0ZBK0VBOzJGRDVEYSxzQ0FBc0M7a0JBTGxELFNBQVM7K0JBQ0Usb0NBQW9DLG1CQUU3Qix1QkFBdUIsQ0FBQyxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBVbnR5cGVkRm9ybUNvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3IgfSBmcm9tICcuLi8uLi8uLi8uLi9jb3JlL21vZGVsL2NvbmZpZ3VyYXRvci5tb2RlbCc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JQcmljZUNvbXBvbmVudE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9wcmljZSc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JBdHRyaWJ1dGVCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi4vYmFzZS9jb25maWd1cmF0b3ItYXR0cmlidXRlLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckF0dHJpYnV0ZUNvbXBvc2l0aW9uQ29udGV4dCB9IGZyb20gJy4uLy4uL2NvbXBvc2l0aW9uL2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtY29tcG9zaXRpb24ubW9kZWwnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9jb3JlL2ZhY2FkZS9jb25maWd1cmF0b3ItY29tbW9ucy5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1jaGVja2JveCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0b3ItYXR0cmlidXRlLWNoZWNrYm94LmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIENvbmZpZ3VyYXRvckF0dHJpYnV0ZUNoZWNrQm94Q29tcG9uZW50XG4gIGV4dGVuZHMgQ29uZmlndXJhdG9yQXR0cmlidXRlQmFzZUNvbXBvbmVudFxuICBpbXBsZW1lbnRzIE9uSW5pdFxue1xuICBhdHRyaWJ1dGU6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGU7XG4gIGdyb3VwOiBzdHJpbmc7XG4gIG93bmVyS2V5OiBzdHJpbmc7XG4gIGV4cE1vZGU6IGJvb2xlYW47XG4gIGF0dHJpYnV0ZVZhbHVlOiBDb25maWd1cmF0b3IuVmFsdWU7XG5cbiAgYXR0cmlidXRlQ2hlY2tCb3hGb3JtID0gbmV3IFVudHlwZWRGb3JtQ29udHJvbCgnJyk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGF0dHJpYnV0ZUNvbXBvbmVudENvbnRleHQ6IENvbmZpZ3VyYXRvckF0dHJpYnV0ZUNvbXBvc2l0aW9uQ29udGV4dCxcbiAgICBwcm90ZWN0ZWQgY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2U6IENvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5hdHRyaWJ1dGUgPSBhdHRyaWJ1dGVDb21wb25lbnRDb250ZXh0LmF0dHJpYnV0ZTtcbiAgICB0aGlzLmdyb3VwID0gYXR0cmlidXRlQ29tcG9uZW50Q29udGV4dC5ncm91cC5pZDtcbiAgICB0aGlzLm93bmVyS2V5ID0gYXR0cmlidXRlQ29tcG9uZW50Q29udGV4dC5vd25lci5rZXk7XG4gICAgdGhpcy5leHBNb2RlID0gYXR0cmlidXRlQ29tcG9uZW50Q29udGV4dC5leHBNb2RlO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5hdHRyaWJ1dGVDaGVja0JveEZvcm0uc2V0VmFsdWUodGhpcy5hdHRyaWJ1dGUuc2VsZWN0ZWRTaW5nbGVWYWx1ZSk7XG4gICAgdGhpcy5hdHRyaWJ1dGVWYWx1ZSA9IHRoaXMuZ2V0VmFsdWVGcm9tQXR0cmlidXRlKCk7XG4gIH1cblxuICAvKipcbiAgICogRmlyZWQgd2hlbiBhIGNoZWNrIGJveCBoYXMgYmVlbiBzZWxlY3RlZCBpLmUuIHdoZW4gYSB2YWx1ZSBoYXMgYmVlbiBzZXRcbiAgICovXG4gIG9uU2VsZWN0KCk6IHZvaWQge1xuICAgIGNvbnN0IHNlbGVjdGVkVmFsdWVzID0gdGhpcy5hc3NlbWJsZVNpbmdsZVZhbHVlKCk7XG5cbiAgICB0aGlzLmNvbmZpZ3VyYXRvckNvbW1vbnNTZXJ2aWNlLnVwZGF0ZUNvbmZpZ3VyYXRpb24oXG4gICAgICB0aGlzLm93bmVyS2V5LFxuICAgICAge1xuICAgICAgICAuLi50aGlzLmF0dHJpYnV0ZSxcbiAgICAgICAgdmFsdWVzOiBzZWxlY3RlZFZhbHVlcyxcbiAgICAgIH0sXG4gICAgICBDb25maWd1cmF0b3IuVXBkYXRlVHlwZS5BVFRSSUJVVEVcbiAgICApO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFZhbHVlRnJvbUF0dHJpYnV0ZSgpOiBDb25maWd1cmF0b3IuVmFsdWUge1xuICAgIC8vd2UgY2FuIGFzc3VtZSB0aGF0IGZvciB0aGlzIGNvbXBvbmVudCwgdmFsdWUgaXMgYWx3YXlzIHByZXNlbnRcbiAgICAvL290aGVyd2lzZSBhdHRyaWJ1dGUgdHlwZSB3b3VsZCBub3QgYmUgY29ycmVjdCxcbiAgICAvL2NvdWxkIG9ubHkgaGFwcGVuIGluIGV4Y2VwdGlvbmFsIGNhc2VzLCBvbiB3cm9uZyBtb2RpZmljYXRpb25zIGUuZy5cbiAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGUudmFsdWVzID8gdGhpcy5hdHRyaWJ1dGUudmFsdWVzWzBdIDogeyB2YWx1ZUNvZGU6ICcnIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgYXNzZW1ibGVTaW5nbGVWYWx1ZSgpOiBDb25maWd1cmF0b3IuVmFsdWVbXSB7XG4gICAgY29uc3QgbG9jYWxBc3NlbWJsZWRWYWx1ZXM6IENvbmZpZ3VyYXRvci5WYWx1ZVtdID0gW107XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlRnJvbUF0dHJpYnV0ZSgpO1xuXG4gICAgY29uc3QgbG9jYWxBdHRyaWJ1dGVWYWx1ZTogQ29uZmlndXJhdG9yLlZhbHVlID0ge1xuICAgICAgdmFsdWVDb2RlOiB2YWx1ZS52YWx1ZUNvZGUsXG4gICAgfTtcblxuICAgIGxvY2FsQXR0cmlidXRlVmFsdWUubmFtZSA9IHZhbHVlLm5hbWU7XG4gICAgbG9jYWxBdHRyaWJ1dGVWYWx1ZS5zZWxlY3RlZCA9IHRoaXMuYXR0cmlidXRlQ2hlY2tCb3hGb3JtLnZhbHVlO1xuICAgIGxvY2FsQXNzZW1ibGVkVmFsdWVzLnB1c2gobG9jYWxBdHRyaWJ1dGVWYWx1ZSk7XG5cbiAgICByZXR1cm4gbG9jYWxBc3NlbWJsZWRWYWx1ZXM7XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdCBjb3JyZXNwb25kaW5nIHZhbHVlIHByaWNlIGZvcm11bGEgcGFyYW1ldGVycy5cbiAgICogRm9yIHRoZSBtdWx0aS1zZWxlY3Rpb24gYXR0cmlidXRlIHR5cGVzIHRoZSBjb21wbGV0ZSBwcmljZSBmb3JtdWxhIHNob3VsZCBiZSBkaXNwbGF5ZWQgYXQgdGhlIHZhbHVlIGxldmVsLlxuICAgKlxuICAgKiBAcGFyYW0ge0NvbmZpZ3VyYXRvci5WYWx1ZX0gdmFsdWUgLSBDb25maWd1cmF0b3IgdmFsdWVcbiAgICogQHJldHVybiB7Q29uZmlndXJhdG9yUHJpY2VDb21wb25lbnRPcHRpb25zfSAtIE5ldyBwcmljZSBmb3JtdWxhXG4gICAqL1xuICBleHRyYWN0VmFsdWVQcmljZUZvcm11bGFQYXJhbWV0ZXJzKFxuICAgIHZhbHVlOiBDb25maWd1cmF0b3IuVmFsdWVcbiAgKTogQ29uZmlndXJhdG9yUHJpY2VDb21wb25lbnRPcHRpb25zIHtcbiAgICByZXR1cm4ge1xuICAgICAgcXVhbnRpdHk6IHZhbHVlLnF1YW50aXR5LFxuICAgICAgcHJpY2U6IHZhbHVlLnZhbHVlUHJpY2UsXG4gICAgICBwcmljZVRvdGFsOiB2YWx1ZS52YWx1ZVByaWNlVG90YWwsXG4gICAgICBpc0xpZ2h0ZWRVcDogdmFsdWUuc2VsZWN0ZWQsXG4gICAgfTtcbiAgfVxufVxuIiwiPG5nLWNvbnRhaW5lcj5cbiAgPGZpZWxkc2V0PlxuICAgIDxsZWdlbmQgc3R5bGU9XCJkaXNwbGF5OiBub25lXCI+e3sgYXR0cmlidXRlLmxhYmVsIH19PC9sZWdlbmQ+XG4gICAgPGRpdiBpZD1cInt7IGNyZWF0ZUF0dHJpYnV0ZUlkRm9yQ29uZmlndXJhdG9yKGF0dHJpYnV0ZSkgfX1cIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWNoZWNrXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC12YWx1ZS1sYWJlbC1wYWlyXCI+XG4gICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICBpZD1cInt7XG4gICAgICAgICAgICAgIGNyZWF0ZUF0dHJpYnV0ZVZhbHVlSWRGb3JDb25maWd1cmF0b3IoXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlLnZhbHVlQ29kZVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9fVwiXG4gICAgICAgICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNoZWNrLWlucHV0XCJcbiAgICAgICAgICAgIFt2YWx1ZV09XCJhdHRyaWJ1dGVWYWx1ZS52YWx1ZUNvZGVcIlxuICAgICAgICAgICAgW2N4Rm9jdXNdPVwie1xuICAgICAgICAgICAgICBrZXk6IGF0dHJpYnV0ZS5uYW1lICsgJy0nICsgYXR0cmlidXRlVmFsdWUubmFtZVxuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgICAoY2hhbmdlKT1cIm9uU2VsZWN0KClcIlxuICAgICAgICAgICAgW2Zvcm1Db250cm9sXT1cImF0dHJpYnV0ZUNoZWNrQm94Rm9ybVwiXG4gICAgICAgICAgICBuYW1lPVwie3sgY3JlYXRlQXR0cmlidXRlSWRGb3JDb25maWd1cmF0b3IoYXR0cmlidXRlKSB9fVwiXG4gICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgICBhdHRyaWJ1dGVWYWx1ZS52YWx1ZVByaWNlICYmXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlLnZhbHVlUHJpY2U/LnZhbHVlICE9PSAwXG4gICAgICAgICAgICAgICAgPyAoJ2NvbmZpZ3VyYXRvci5hMTF5LnZhbHVlT2ZBdHRyaWJ1dGVGdWxsV2l0aFByaWNlJ1xuICAgICAgICAgICAgICAgICAgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhdHRyaWJ1dGVWYWx1ZS52YWx1ZURpc3BsYXksXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGU6IGF0dHJpYnV0ZS5sYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlOiBhdHRyaWJ1dGVWYWx1ZS52YWx1ZVByaWNlLmZvcm1hdHRlZFZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA6ICgnY29uZmlndXJhdG9yLmExMXkudmFsdWVPZkF0dHJpYnV0ZUZ1bGwnXG4gICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGF0dHJpYnV0ZVZhbHVlLnZhbHVlRGlzcGxheSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlLmxhYmVsXG4gICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIFwiXG4gICAgICAgICAgICBbYXR0ci5hcmlhLWRlc2NyaWJlZGJ5XT1cIlxuICAgICAgICAgICAgICBjcmVhdGVBdHRyaWJ1dGVVaUtleSgnbGFiZWwnLCBhdHRyaWJ1dGUubmFtZSkgK1xuICAgICAgICAgICAgICAnICcgK1xuICAgICAgICAgICAgICBjcmVhdGVBdHRyaWJ1dGVVaUtleSgnYXR0cmlidXRlLW1zZycsIGF0dHJpYnV0ZS5uYW1lKVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICAvPlxuICAgICAgICAgIDxsYWJlbFxuICAgICAgICAgICAgaWQ9XCJ7e1xuICAgICAgICAgICAgICBjcmVhdGVWYWx1ZVVpS2V5KFxuICAgICAgICAgICAgICAgICdsYWJlbCcsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlLm5hbWUsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlVmFsdWUudmFsdWVDb2RlXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH19XCJcbiAgICAgICAgICAgIGZvcj1cInt7XG4gICAgICAgICAgICAgIGNyZWF0ZUF0dHJpYnV0ZVZhbHVlSWRGb3JDb25maWd1cmF0b3IoXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlLnZhbHVlQ29kZVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9fVwiXG4gICAgICAgICAgICBhcmlhLWhpZGRlbj1cInRydWVcIlxuICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNoZWNrLWxhYmVsXCJcbiAgICAgICAgICAgID57e1xuICAgICAgICAgICAgICBnZXRMYWJlbChcbiAgICAgICAgICAgICAgICBleHBNb2RlLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlLnZhbHVlRGlzcGxheSxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVWYWx1ZS52YWx1ZUNvZGVcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfX08L2xhYmVsXG4gICAgICAgICAgPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LXZhbHVlLXByaWNlXCI+XG4gICAgICAgICAgPGN4LWNvbmZpZ3VyYXRvci1wcmljZVxuICAgICAgICAgICAgW2Zvcm11bGFdPVwiZXh0cmFjdFZhbHVlUHJpY2VGb3JtdWxhUGFyYW1ldGVycyhhdHRyaWJ1dGVWYWx1ZSlcIlxuICAgICAgICAgID48L2N4LWNvbmZpZ3VyYXRvci1wcmljZT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9maWVsZHNldD5cbjwvbmctY29udGFpbmVyPlxuIl19