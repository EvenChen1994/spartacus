{"version":3,"file":"spartacus-pdf-invoices-occ.mjs","sources":["../../../feature-libs/pdf-invoices/occ/adapters/occ-pdf-invoices.adapter.ts","../../../feature-libs/pdf-invoices/occ/adapters/index.ts","../../../feature-libs/pdf-invoices/occ/model/occ-pdf-invoices.model.ts","../../../feature-libs/pdf-invoices/occ/model/index.ts","../../../feature-libs/pdf-invoices/occ/config/default-occ-pdf-invoices-config.ts","../../../feature-libs/pdf-invoices/occ/pdf-invoices-occ.module.ts","../../../feature-libs/pdf-invoices/occ/public_api.ts","../../../feature-libs/pdf-invoices/occ/spartacus-pdf-invoices-occ.ts"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { inject, Injectable } from '@angular/core';\nimport {\n  ConverterService,\n  LoggerService,\n  normalizeHttpError,\n  OccEndpointsService,\n} from '@spartacus/core';\nimport {\n  PDFInvoicesAdapter,\n  PDF_INVOICES_LIST_INVOICES_NORMALIZER,\n} from '@spartacus/pdf-invoices/core';\nimport {\n  InvoiceQueryParams,\n  OrderInvoiceList,\n} from '@spartacus/pdf-invoices/root';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\n@Injectable()\nexport class OccPDFInvoicesAdapter implements PDFInvoicesAdapter {\n  protected logger = inject(LoggerService);\n\n  constructor(\n    protected http: HttpClient,\n    protected occEndpoints: OccEndpointsService,\n    protected converter: ConverterService\n  ) {}\n\n  getInvoicesForOrder(\n    userId: string,\n    orderId: string,\n    queryParams: InvoiceQueryParams\n  ): Observable<OrderInvoiceList> {\n    return this.http\n      .get<OrderInvoiceList>(\n        this.buildInvoiceListUrl(userId, orderId, queryParams)\n      )\n      .pipe(\n        catchError((error: HttpErrorResponse) =>\n          throwError(normalizeHttpError(error, this.logger))\n        ),\n        this.converter.pipeable(PDF_INVOICES_LIST_INVOICES_NORMALIZER)\n      );\n  }\n\n  getInvoicePDF(\n    userId: string,\n    orderId: string,\n    invoiceId: string,\n    externalSystemId?: string\n  ): Observable<Blob> {\n    const options = {\n      responseType: 'blob' as 'json',\n    };\n\n    return this.http\n      .get<Blob>(\n        this.buildInvoicePDFUrl(userId, orderId, invoiceId, externalSystemId),\n        options\n      )\n      .pipe(\n        catchError((error: HttpErrorResponse) =>\n          throwError(normalizeHttpError(error, this.logger))\n        )\n      );\n  }\n\n  private buildInvoiceListUrl(\n    userId: string,\n    orderId: string,\n    queryParams: InvoiceQueryParams\n  ): string {\n    return this.occEndpoints.buildUrl('pdfInvoicesListInvoices', {\n      urlParams: { userId, orderId },\n      queryParams,\n    });\n  }\n\n  private buildInvoicePDFUrl(\n    userId: string,\n    orderId: string,\n    invoiceId: string,\n    externalSystemId?: string\n  ): string {\n    return this.occEndpoints.buildUrl('pdfInvoicesDownloadInvoicePDF', {\n      urlParams: { userId, orderId, invoiceId },\n      queryParams: externalSystemId ? { externalSystemId } : undefined,\n    });\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './occ-pdf-invoices.adapter';\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { OccEndpoint } from '@spartacus/core';\n\ndeclare module '@spartacus/core' {\n  interface OccEndpoints {\n    /**\n     * Get the list of invoices for an order\n     *\n     * @member {string} [pdfInvoicesListInvoices]\n     */\n\n    pdfInvoicesListInvoices?: string | OccEndpoint;\n\n    /**\n     * Get the invoice document as a PDF file\n     *\n     * @member {string} [pdfInvoicesDownloadInvoicePDF]\n     */\n\n    pdfInvoicesDownloadInvoicePDF?: string | OccEndpoint;\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Imported for side effects (module augmentation)\nimport './occ-pdf-invoices.model';\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { OccConfig } from '@spartacus/core';\n\nexport const defaultOccPDFInvoicesConfig: OccConfig = {\n  backend: {\n    occ: {\n      endpoints: {\n        pdfInvoicesListInvoices: 'users/${userId}/orders/${orderId}/invoices',\n        pdfInvoicesDownloadInvoicePDF:\n          'users/${userId}/orders/${orderId}/invoices/${invoiceId}/download',\n      },\n    },\n  },\n};\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { provideDefaultConfig } from '@spartacus/core';\nimport { PDFInvoicesAdapter } from '@spartacus/pdf-invoices/core';\nimport { OccPDFInvoicesAdapter } from './adapters/occ-pdf-invoices.adapter';\nimport { defaultOccPDFInvoicesConfig } from './config/default-occ-pdf-invoices-config';\n\n@NgModule({\n  imports: [CommonModule],\n  providers: [\n    provideDefaultConfig(defaultOccPDFInvoicesConfig),\n    {\n      provide: PDFInvoicesAdapter,\n      useClass: OccPDFInvoicesAdapter,\n    },\n  ],\n})\nexport class PDFInvoicesOccModule {}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './adapters/index';\nexport * from './model/index';\nexport * from './pdf-invoices-occ.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}