/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Component, inject } from '@angular/core';
import { CartOutlets, PromotionLocation, } from '@spartacus/cart/base/root';
import { OrderOutlets } from '@spartacus/order/root';
import { of } from 'rxjs';
import { map, tap } from 'rxjs/operators';
import { MyAccountV2OrderConsignmentsService } from '../my-account-v2-order-consignments.service';
import * as i0 from "@angular/core";
import * as i1 from "../order-details.service";
import * as i2 from "@spartacus/storefront";
import * as i3 from "@angular/common";
import * as i4 from "@spartacus/cart/base/components/add-to-cart";
import * as i5 from "./order-consigned-entries/order-consigned-entries.component";
import * as i6 from "@spartacus/core";
export class OrderDetailItemsComponent {
    constructor(orderDetailsService, component) {
        this.orderDetailsService = orderDetailsService;
        this.component = component;
        this.orderConsignmentsService = inject(MyAccountV2OrderConsignmentsService);
        this.OrderOutlets = OrderOutlets;
        this.CartOutlets = CartOutlets;
        this.promotionLocation = PromotionLocation.Order;
        this.order$ = this.orderDetailsService.getOrderDetails().pipe(tap((order) => {
            this.pickupConsignments = this.getGroupedConsignments(order, true);
            this.deliveryConsignments = this.getGroupedConsignments(order, false);
            this.pickupUnconsignedEntries = this.getUnconsignedEntries(order, true);
            this.deliveryUnConsignedEntries = this.getUnconsignedEntries(order, false);
        }));
        this.enableAddToCart$ = this.component.data$.pipe(map((data) => data.enableAddToCart));
        this.isOrderLoading$ = typeof this.orderDetailsService.isOrderDetailsLoading === 'function'
            ? this.orderDetailsService.isOrderDetailsLoading()
            : of(false);
        this.groupCartItems$ = this.component.data$.pipe(map((data) => data.groupCartItems));
    }
    getGroupedConsignments(order, pickup) {
        return this.orderConsignmentsService.getGroupedConsignments(order, pickup);
    }
    getUnconsignedEntries(order, pickup) {
        return this.orderConsignmentsService.getUnconsignedEntries(order, pickup);
    }
}
OrderDetailItemsComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: OrderDetailItemsComponent, deps: [{ token: i1.OrderDetailsService }, { token: i2.CmsComponentData }], target: i0.ɵɵFactoryTarget.Component });
OrderDetailItemsComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: OrderDetailItemsComponent, selector: "cx-order-details-items", ngImport: i0, template: "<ng-container *ngIf=\"order$ | async as order\">\n  <ng-container *ngIf=\"!(isOrderLoading$ | async)\">\n    <ng-container\n      *ngIf=\"\n        order.consignments?.length ||\n        order.unconsignedEntries?.length ||\n        order.replenishmentOrderCode\n      \"\n    >\n      <cx-promotions\n        [promotions]=\"order.appliedOrderPromotions || []\"\n      ></cx-promotions>\n    </ng-container>\n\n    <!-- pickup consigned entries -->\n    <div\n      *ngIf=\"pickupConsignments?.length\"\n      class=\"cx-pickup-order-consigned-entries-header\"\n    >\n      {{ 'deliveryPointOfServiceDetails.itemsToBePickUp' | cxTranslate }}\n    </div>\n    <cx-order-consigned-entries\n      *ngIf=\"pickupConsignments\"\n      [order]=\"order\"\n      [consignments]=\"pickupConsignments\"\n      [enableAddToCart]=\"enableAddToCart$ | async\"\n      [buyItAgainTranslation]=\"'addToCart.buyItAgain' | cxTranslate\"\n    ></cx-order-consigned-entries>\n\n    <!-- delivery consignment address and delivery mode -->\n    <ng-template\n      *ngIf=\"\n        deliveryConsignments &&\n        deliveryConsignments.length > 0 &&\n        (groupCartItems$ | async)\n      \"\n      [cxOutlet]=\"OrderOutlets.CONSIGNMENT_DELIVERY_INFO\"\n      [cxOutletContext]=\"{\n        showItemList: false,\n        order: order\n      }\"\n    >\n    </ng-template>\n\n    <!-- delivery consigned entries -->\n    <cx-order-consigned-entries\n      *ngIf=\"deliveryConsignments\"\n      [order]=\"order\"\n      [consignments]=\"deliveryConsignments\"\n      [enableAddToCart]=\"enableAddToCart$ | async\"\n      [buyItAgainTranslation]=\"'addToCart.buyItAgain' | cxTranslate\"\n    ></cx-order-consigned-entries>\n\n    <!-- unconsigned entries -->\n    <ng-container *ngIf=\"order?.unconsignedEntries?.length\">\n      <div *ngIf=\"order?.statusDisplay\" class=\"cx-list-header\">\n        <div class=\"cx-list-status\">\n          {{\n            'orderDetails.statusDisplay_' + order?.statusDisplay | cxTranslate\n          }}\n        </div>\n      </div>\n      <!-- delivery unconsigned entries -->\n      <ng-container *ngIf=\"deliveryUnConsignedEntries?.length\">\n        <h2 *ngIf=\"groupCartItems$ | async\" class=\"cx-review-header\">\n          {{ 'checkoutMode.deliveryEntries' | cxTranslate }}\n        </h2>\n        <div class=\"cx-list-item\">\n          <ng-template\n            [cxOutlet]=\"CartOutlets.CART_ITEM_LIST\"\n            [cxOutletContext]=\"{\n              items: deliveryUnConsignedEntries,\n              readonly: true,\n              promotionLocation: promotionLocation,\n              options: {\n                displayAddToCart: enableAddToCart$ | async,\n                addToCartString: 'addToCart.buyItAgain' | cxTranslate,\n                optionalBtn: addToCartBtn\n              }\n            }\"\n          >\n          </ng-template>\n        </div>\n      </ng-container>\n      <!-- pickup unconsigned entries, b2b does not have pickup items -->\n      <ng-container *ngIf=\"pickupUnconsignedEntries?.length\">\n        <h2 class=\"cx-review-header\">\n          {{ 'checkoutPickupInStore.heading' | cxTranslate }}\n        </h2>\n        <div class=\"cx-list-item\">\n          <ng-template\n            [cxOutlet]=\"CartOutlets.CART_ITEM_LIST\"\n            [cxOutletContext]=\"{\n              items: pickupUnconsignedEntries,\n              readonly: true,\n              promotionLocation: promotionLocation,\n              options: {\n                displayAddToCart: enableAddToCart$ | async,\n                addToCartString: 'addToCart.buyItAgain' | cxTranslate,\n                optionalBtn: addToCartBtn\n              }\n            }\"\n          >\n          </ng-template>\n        </div>\n      </ng-container>\n    </ng-container>\n\n    <!-- replenishment other entries -->\n    <ng-container *ngIf=\"order?.entries && order?.replenishmentOrderCode\">\n      <div class=\"cx-list\">\n        <div *ngIf=\"order?.statusDisplay\" class=\"cx-list-header\">\n          <div class=\"cx-list-status\">\n            {{\n              'orderDetails.statusDisplay_' + order?.statusDisplay | cxTranslate\n            }}\n          </div>\n        </div>\n        <div class=\"cx-list-item\">\n          <ng-template\n            [cxOutlet]=\"CartOutlets.CART_ITEM_LIST\"\n            [cxOutletContext]=\"{\n              items: order.entries,\n              readonly: true,\n              promotionLocation: promotionLocation,\n              options: {\n                displayAddToCart: enableAddToCart$ | async,\n                addToCartString: 'addToCart.buyItAgain' | cxTranslate,\n                optionalBtn: addToCartBtn\n              }\n            }\"\n          >\n          </ng-template>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template let-ctx #addToCartBtn>\n    <cx-add-to-cart\n      [productCode]=\"ctx.item.product?.code\"\n      [product]=\"ctx.item.product\"\n      [showQuantity]=\"false\"\n      [options]=\"ctx.options\"\n      [pickupStore]=\"ctx.item.deliveryPointOfService?.name\"\n      class=\"add-to-cart\"\n    >\n    </cx-add-to-cart>\n  </ng-template>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.PromotionsComponent, selector: "cx-promotions", inputs: ["promotions"] }, { kind: "directive", type: i2.OutletDirective, selector: "[cxOutlet]", inputs: ["cxOutlet", "cxOutletContext", "cxOutletDefer", "cxComponentRef"], outputs: ["loaded", "cxComponentRefChange"] }, { kind: "component", type: i4.AddToCartComponent, selector: "cx-add-to-cart", inputs: ["productCode", "showQuantity", "options", "pickupStore", "product"] }, { kind: "component", type: i5.OrderConsignedEntriesComponent, selector: "cx-order-consigned-entries", inputs: ["consignments", "order", "enableAddToCart", "buyItAgainTranslation"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i6.TranslatePipe, name: "cxTranslate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: OrderDetailItemsComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-order-details-items', template: "<ng-container *ngIf=\"order$ | async as order\">\n  <ng-container *ngIf=\"!(isOrderLoading$ | async)\">\n    <ng-container\n      *ngIf=\"\n        order.consignments?.length ||\n        order.unconsignedEntries?.length ||\n        order.replenishmentOrderCode\n      \"\n    >\n      <cx-promotions\n        [promotions]=\"order.appliedOrderPromotions || []\"\n      ></cx-promotions>\n    </ng-container>\n\n    <!-- pickup consigned entries -->\n    <div\n      *ngIf=\"pickupConsignments?.length\"\n      class=\"cx-pickup-order-consigned-entries-header\"\n    >\n      {{ 'deliveryPointOfServiceDetails.itemsToBePickUp' | cxTranslate }}\n    </div>\n    <cx-order-consigned-entries\n      *ngIf=\"pickupConsignments\"\n      [order]=\"order\"\n      [consignments]=\"pickupConsignments\"\n      [enableAddToCart]=\"enableAddToCart$ | async\"\n      [buyItAgainTranslation]=\"'addToCart.buyItAgain' | cxTranslate\"\n    ></cx-order-consigned-entries>\n\n    <!-- delivery consignment address and delivery mode -->\n    <ng-template\n      *ngIf=\"\n        deliveryConsignments &&\n        deliveryConsignments.length > 0 &&\n        (groupCartItems$ | async)\n      \"\n      [cxOutlet]=\"OrderOutlets.CONSIGNMENT_DELIVERY_INFO\"\n      [cxOutletContext]=\"{\n        showItemList: false,\n        order: order\n      }\"\n    >\n    </ng-template>\n\n    <!-- delivery consigned entries -->\n    <cx-order-consigned-entries\n      *ngIf=\"deliveryConsignments\"\n      [order]=\"order\"\n      [consignments]=\"deliveryConsignments\"\n      [enableAddToCart]=\"enableAddToCart$ | async\"\n      [buyItAgainTranslation]=\"'addToCart.buyItAgain' | cxTranslate\"\n    ></cx-order-consigned-entries>\n\n    <!-- unconsigned entries -->\n    <ng-container *ngIf=\"order?.unconsignedEntries?.length\">\n      <div *ngIf=\"order?.statusDisplay\" class=\"cx-list-header\">\n        <div class=\"cx-list-status\">\n          {{\n            'orderDetails.statusDisplay_' + order?.statusDisplay | cxTranslate\n          }}\n        </div>\n      </div>\n      <!-- delivery unconsigned entries -->\n      <ng-container *ngIf=\"deliveryUnConsignedEntries?.length\">\n        <h2 *ngIf=\"groupCartItems$ | async\" class=\"cx-review-header\">\n          {{ 'checkoutMode.deliveryEntries' | cxTranslate }}\n        </h2>\n        <div class=\"cx-list-item\">\n          <ng-template\n            [cxOutlet]=\"CartOutlets.CART_ITEM_LIST\"\n            [cxOutletContext]=\"{\n              items: deliveryUnConsignedEntries,\n              readonly: true,\n              promotionLocation: promotionLocation,\n              options: {\n                displayAddToCart: enableAddToCart$ | async,\n                addToCartString: 'addToCart.buyItAgain' | cxTranslate,\n                optionalBtn: addToCartBtn\n              }\n            }\"\n          >\n          </ng-template>\n        </div>\n      </ng-container>\n      <!-- pickup unconsigned entries, b2b does not have pickup items -->\n      <ng-container *ngIf=\"pickupUnconsignedEntries?.length\">\n        <h2 class=\"cx-review-header\">\n          {{ 'checkoutPickupInStore.heading' | cxTranslate }}\n        </h2>\n        <div class=\"cx-list-item\">\n          <ng-template\n            [cxOutlet]=\"CartOutlets.CART_ITEM_LIST\"\n            [cxOutletContext]=\"{\n              items: pickupUnconsignedEntries,\n              readonly: true,\n              promotionLocation: promotionLocation,\n              options: {\n                displayAddToCart: enableAddToCart$ | async,\n                addToCartString: 'addToCart.buyItAgain' | cxTranslate,\n                optionalBtn: addToCartBtn\n              }\n            }\"\n          >\n          </ng-template>\n        </div>\n      </ng-container>\n    </ng-container>\n\n    <!-- replenishment other entries -->\n    <ng-container *ngIf=\"order?.entries && order?.replenishmentOrderCode\">\n      <div class=\"cx-list\">\n        <div *ngIf=\"order?.statusDisplay\" class=\"cx-list-header\">\n          <div class=\"cx-list-status\">\n            {{\n              'orderDetails.statusDisplay_' + order?.statusDisplay | cxTranslate\n            }}\n          </div>\n        </div>\n        <div class=\"cx-list-item\">\n          <ng-template\n            [cxOutlet]=\"CartOutlets.CART_ITEM_LIST\"\n            [cxOutletContext]=\"{\n              items: order.entries,\n              readonly: true,\n              promotionLocation: promotionLocation,\n              options: {\n                displayAddToCart: enableAddToCart$ | async,\n                addToCartString: 'addToCart.buyItAgain' | cxTranslate,\n                optionalBtn: addToCartBtn\n              }\n            }\"\n          >\n          </ng-template>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template let-ctx #addToCartBtn>\n    <cx-add-to-cart\n      [productCode]=\"ctx.item.product?.code\"\n      [product]=\"ctx.item.product\"\n      [showQuantity]=\"false\"\n      [options]=\"ctx.options\"\n      [pickupStore]=\"ctx.item.deliveryPointOfService?.name\"\n      class=\"add-to-cart\"\n    >\n    </cx-add-to-cart>\n  </ng-template>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.OrderDetailsService }, { type: i2.CmsComponentData }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXItZGV0YWlsLWl0ZW1zLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9vcmRlci9jb21wb25lbnRzL29yZGVyLWRldGFpbHMvb3JkZXItZGV0YWlsLWl0ZW1zL29yZGVyLWRldGFpbC1pdGVtcy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JkZXIvY29tcG9uZW50cy9vcmRlci1kZXRhaWxzL29yZGVyLWRldGFpbC1pdGVtcy9vcmRlci1kZXRhaWwtaXRlbXMuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2xELE9BQU8sRUFDTCxXQUFXLEVBRVgsaUJBQWlCLEdBQ2xCLE1BQU0sMkJBQTJCLENBQUM7QUFFbkMsT0FBTyxFQUFzQixZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUV6RSxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUMsT0FBTyxFQUFFLG1DQUFtQyxFQUFFLE1BQU0sNkNBQTZDLENBQUM7Ozs7Ozs7O0FBT2xHLE1BQU0sT0FBTyx5QkFBeUI7SUF5Q3BDLFlBQ1ksbUJBQXdDLEVBQ3hDLFNBQXlEO1FBRHpELHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7UUFDeEMsY0FBUyxHQUFULFNBQVMsQ0FBZ0Q7UUExQzNELDZCQUF3QixHQUFHLE1BQU0sQ0FDekMsbUNBQW1DLENBQ3BDLENBQUM7UUFDTyxpQkFBWSxHQUFHLFlBQVksQ0FBQztRQUM1QixnQkFBVyxHQUFHLFdBQVcsQ0FBQztRQUVuQyxzQkFBaUIsR0FBc0IsaUJBQWlCLENBQUMsS0FBSyxDQUFDO1FBUS9ELFdBQU0sR0FBc0IsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGVBQWUsRUFBRSxDQUFDLElBQUksQ0FDekUsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDWixJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNuRSxJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztZQUV0RSxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN4RSxJQUFJLENBQUMsMEJBQTBCLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUMxRCxLQUFLLEVBQ0wsS0FBSyxDQUNOLENBQUM7UUFDSixDQUFDLENBQUMsQ0FDSCxDQUFDO1FBRUYscUJBQWdCLEdBQW9DLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FDM0UsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQ3BDLENBQUM7UUFFRixvQkFBZSxHQUNiLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLHFCQUFxQixLQUFLLFVBQVU7WUFDbEUsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxxQkFBcUIsRUFBRTtZQUNsRCxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRWhCLG9CQUFlLEdBQW9DLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FDMUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQ25DLENBQUM7SUFLQyxDQUFDO0lBRU0sc0JBQXNCLENBQzlCLEtBQVksRUFDWixNQUFlO1FBRWYsT0FBTyxJQUFJLENBQUMsd0JBQXdCLENBQUMsc0JBQXNCLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdFLENBQUM7SUFFUyxxQkFBcUIsQ0FDN0IsS0FBWSxFQUNaLE1BQWU7UUFFZixPQUFPLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDNUUsQ0FBQzs7c0hBMURVLHlCQUF5QjswR0FBekIseUJBQXlCLDhEQ3hCdEMsNGtLQXNKQTsyRkQ5SGEseUJBQXlCO2tCQUpyQyxTQUFTOytCQUNFLHdCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgaW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBDYXJ0T3V0bGV0cyxcbiAgT3JkZXJFbnRyeSxcbiAgUHJvbW90aW9uTG9jYXRpb24sXG59IGZyb20gJ0BzcGFydGFjdXMvY2FydC9iYXNlL3Jvb3QnO1xuaW1wb3J0IHsgQ21zT3JkZXJEZXRhaWxJdGVtc0NvbXBvbmVudCB9IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQgeyBDb25zaWdubWVudCwgT3JkZXIsIE9yZGVyT3V0bGV0cyB9IGZyb20gJ0BzcGFydGFjdXMvb3JkZXIvcm9vdCc7XG5pbXBvcnQgeyBDbXNDb21wb25lbnREYXRhIH0gZnJvbSAnQHNwYXJ0YWN1cy9zdG9yZWZyb250JztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE15QWNjb3VudFYyT3JkZXJDb25zaWdubWVudHNTZXJ2aWNlIH0gZnJvbSAnLi4vbXktYWNjb3VudC12Mi1vcmRlci1jb25zaWdubWVudHMuc2VydmljZSc7XG5pbXBvcnQgeyBPcmRlckRldGFpbHNTZXJ2aWNlIH0gZnJvbSAnLi4vb3JkZXItZGV0YWlscy5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtb3JkZXItZGV0YWlscy1pdGVtcycsXG4gIHRlbXBsYXRlVXJsOiAnLi9vcmRlci1kZXRhaWwtaXRlbXMuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBPcmRlckRldGFpbEl0ZW1zQ29tcG9uZW50IHtcbiAgcHJvdGVjdGVkIG9yZGVyQ29uc2lnbm1lbnRzU2VydmljZSA9IGluamVjdChcbiAgICBNeUFjY291bnRWMk9yZGVyQ29uc2lnbm1lbnRzU2VydmljZVxuICApO1xuICByZWFkb25seSBPcmRlck91dGxldHMgPSBPcmRlck91dGxldHM7XG4gIHJlYWRvbmx5IENhcnRPdXRsZXRzID0gQ2FydE91dGxldHM7XG5cbiAgcHJvbW90aW9uTG9jYXRpb246IFByb21vdGlvbkxvY2F0aW9uID0gUHJvbW90aW9uTG9jYXRpb24uT3JkZXI7XG5cbiAgcGlja3VwQ29uc2lnbm1lbnRzOiBDb25zaWdubWVudFtdIHwgdW5kZWZpbmVkO1xuICBkZWxpdmVyeUNvbnNpZ25tZW50czogQ29uc2lnbm1lbnRbXSB8IHVuZGVmaW5lZDtcblxuICBwaWNrdXBVbmNvbnNpZ25lZEVudHJpZXM6IE9yZGVyRW50cnlbXSB8IHVuZGVmaW5lZDtcbiAgZGVsaXZlcnlVbkNvbnNpZ25lZEVudHJpZXM6IE9yZGVyRW50cnlbXSB8IHVuZGVmaW5lZDtcblxuICBvcmRlciQ6IE9ic2VydmFibGU8T3JkZXI+ID0gdGhpcy5vcmRlckRldGFpbHNTZXJ2aWNlLmdldE9yZGVyRGV0YWlscygpLnBpcGUoXG4gICAgdGFwKChvcmRlcikgPT4ge1xuICAgICAgdGhpcy5waWNrdXBDb25zaWdubWVudHMgPSB0aGlzLmdldEdyb3VwZWRDb25zaWdubWVudHMob3JkZXIsIHRydWUpO1xuICAgICAgdGhpcy5kZWxpdmVyeUNvbnNpZ25tZW50cyA9IHRoaXMuZ2V0R3JvdXBlZENvbnNpZ25tZW50cyhvcmRlciwgZmFsc2UpO1xuXG4gICAgICB0aGlzLnBpY2t1cFVuY29uc2lnbmVkRW50cmllcyA9IHRoaXMuZ2V0VW5jb25zaWduZWRFbnRyaWVzKG9yZGVyLCB0cnVlKTtcbiAgICAgIHRoaXMuZGVsaXZlcnlVbkNvbnNpZ25lZEVudHJpZXMgPSB0aGlzLmdldFVuY29uc2lnbmVkRW50cmllcyhcbiAgICAgICAgb3JkZXIsXG4gICAgICAgIGZhbHNlXG4gICAgICApO1xuICAgIH0pXG4gICk7XG5cbiAgZW5hYmxlQWRkVG9DYXJ0JDogT2JzZXJ2YWJsZTxib29sZWFuIHwgdW5kZWZpbmVkPiA9IHRoaXMuY29tcG9uZW50LmRhdGEkLnBpcGUoXG4gICAgbWFwKChkYXRhKSA9PiBkYXRhLmVuYWJsZUFkZFRvQ2FydClcbiAgKTtcblxuICBpc09yZGVyTG9hZGluZyQ6IE9ic2VydmFibGU8Ym9vbGVhbj4gPVxuICAgIHR5cGVvZiB0aGlzLm9yZGVyRGV0YWlsc1NlcnZpY2UuaXNPcmRlckRldGFpbHNMb2FkaW5nID09PSAnZnVuY3Rpb24nXG4gICAgICA/IHRoaXMub3JkZXJEZXRhaWxzU2VydmljZS5pc09yZGVyRGV0YWlsc0xvYWRpbmcoKVxuICAgICAgOiBvZihmYWxzZSk7XG5cbiAgZ3JvdXBDYXJ0SXRlbXMkOiBPYnNlcnZhYmxlPGJvb2xlYW4gfCB1bmRlZmluZWQ+ID0gdGhpcy5jb21wb25lbnQuZGF0YSQucGlwZShcbiAgICBtYXAoKGRhdGEpID0+IGRhdGEuZ3JvdXBDYXJ0SXRlbXMpXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIG9yZGVyRGV0YWlsc1NlcnZpY2U6IE9yZGVyRGV0YWlsc1NlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNvbXBvbmVudDogQ21zQ29tcG9uZW50RGF0YTxDbXNPcmRlckRldGFpbEl0ZW1zQ29tcG9uZW50PlxuICApIHt9XG5cbiAgcHJvdGVjdGVkIGdldEdyb3VwZWRDb25zaWdubWVudHMoXG4gICAgb3JkZXI6IE9yZGVyLFxuICAgIHBpY2t1cDogYm9vbGVhblxuICApOiBDb25zaWdubWVudFtdIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcmRlckNvbnNpZ25tZW50c1NlcnZpY2UuZ2V0R3JvdXBlZENvbnNpZ25tZW50cyhvcmRlciwgcGlja3VwKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRVbmNvbnNpZ25lZEVudHJpZXMoXG4gICAgb3JkZXI6IE9yZGVyLFxuICAgIHBpY2t1cDogYm9vbGVhblxuICApOiBPcmRlckVudHJ5W10gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm9yZGVyQ29uc2lnbm1lbnRzU2VydmljZS5nZXRVbmNvbnNpZ25lZEVudHJpZXMob3JkZXIsIHBpY2t1cCk7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXIgKm5nSWY9XCJvcmRlciQgfCBhc3luYyBhcyBvcmRlclwiPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwiIShpc09yZGVyTG9hZGluZyQgfCBhc3luYylcIj5cbiAgICA8bmctY29udGFpbmVyXG4gICAgICAqbmdJZj1cIlxuICAgICAgICBvcmRlci5jb25zaWdubWVudHM/Lmxlbmd0aCB8fFxuICAgICAgICBvcmRlci51bmNvbnNpZ25lZEVudHJpZXM/Lmxlbmd0aCB8fFxuICAgICAgICBvcmRlci5yZXBsZW5pc2htZW50T3JkZXJDb2RlXG4gICAgICBcIlxuICAgID5cbiAgICAgIDxjeC1wcm9tb3Rpb25zXG4gICAgICAgIFtwcm9tb3Rpb25zXT1cIm9yZGVyLmFwcGxpZWRPcmRlclByb21vdGlvbnMgfHwgW11cIlxuICAgICAgPjwvY3gtcHJvbW90aW9ucz5cbiAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgIDwhLS0gcGlja3VwIGNvbnNpZ25lZCBlbnRyaWVzIC0tPlxuICAgIDxkaXZcbiAgICAgICpuZ0lmPVwicGlja3VwQ29uc2lnbm1lbnRzPy5sZW5ndGhcIlxuICAgICAgY2xhc3M9XCJjeC1waWNrdXAtb3JkZXItY29uc2lnbmVkLWVudHJpZXMtaGVhZGVyXCJcbiAgICA+XG4gICAgICB7eyAnZGVsaXZlcnlQb2ludE9mU2VydmljZURldGFpbHMuaXRlbXNUb0JlUGlja1VwJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgPC9kaXY+XG4gICAgPGN4LW9yZGVyLWNvbnNpZ25lZC1lbnRyaWVzXG4gICAgICAqbmdJZj1cInBpY2t1cENvbnNpZ25tZW50c1wiXG4gICAgICBbb3JkZXJdPVwib3JkZXJcIlxuICAgICAgW2NvbnNpZ25tZW50c109XCJwaWNrdXBDb25zaWdubWVudHNcIlxuICAgICAgW2VuYWJsZUFkZFRvQ2FydF09XCJlbmFibGVBZGRUb0NhcnQkIHwgYXN5bmNcIlxuICAgICAgW2J1eUl0QWdhaW5UcmFuc2xhdGlvbl09XCInYWRkVG9DYXJ0LmJ1eUl0QWdhaW4nIHwgY3hUcmFuc2xhdGVcIlxuICAgID48L2N4LW9yZGVyLWNvbnNpZ25lZC1lbnRyaWVzPlxuXG4gICAgPCEtLSBkZWxpdmVyeSBjb25zaWdubWVudCBhZGRyZXNzIGFuZCBkZWxpdmVyeSBtb2RlIC0tPlxuICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgKm5nSWY9XCJcbiAgICAgICAgZGVsaXZlcnlDb25zaWdubWVudHMgJiZcbiAgICAgICAgZGVsaXZlcnlDb25zaWdubWVudHMubGVuZ3RoID4gMCAmJlxuICAgICAgICAoZ3JvdXBDYXJ0SXRlbXMkIHwgYXN5bmMpXG4gICAgICBcIlxuICAgICAgW2N4T3V0bGV0XT1cIk9yZGVyT3V0bGV0cy5DT05TSUdOTUVOVF9ERUxJVkVSWV9JTkZPXCJcbiAgICAgIFtjeE91dGxldENvbnRleHRdPVwie1xuICAgICAgICBzaG93SXRlbUxpc3Q6IGZhbHNlLFxuICAgICAgICBvcmRlcjogb3JkZXJcbiAgICAgIH1cIlxuICAgID5cbiAgICA8L25nLXRlbXBsYXRlPlxuXG4gICAgPCEtLSBkZWxpdmVyeSBjb25zaWduZWQgZW50cmllcyAtLT5cbiAgICA8Y3gtb3JkZXItY29uc2lnbmVkLWVudHJpZXNcbiAgICAgICpuZ0lmPVwiZGVsaXZlcnlDb25zaWdubWVudHNcIlxuICAgICAgW29yZGVyXT1cIm9yZGVyXCJcbiAgICAgIFtjb25zaWdubWVudHNdPVwiZGVsaXZlcnlDb25zaWdubWVudHNcIlxuICAgICAgW2VuYWJsZUFkZFRvQ2FydF09XCJlbmFibGVBZGRUb0NhcnQkIHwgYXN5bmNcIlxuICAgICAgW2J1eUl0QWdhaW5UcmFuc2xhdGlvbl09XCInYWRkVG9DYXJ0LmJ1eUl0QWdhaW4nIHwgY3hUcmFuc2xhdGVcIlxuICAgID48L2N4LW9yZGVyLWNvbnNpZ25lZC1lbnRyaWVzPlxuXG4gICAgPCEtLSB1bmNvbnNpZ25lZCBlbnRyaWVzIC0tPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJvcmRlcj8udW5jb25zaWduZWRFbnRyaWVzPy5sZW5ndGhcIj5cbiAgICAgIDxkaXYgKm5nSWY9XCJvcmRlcj8uc3RhdHVzRGlzcGxheVwiIGNsYXNzPVwiY3gtbGlzdC1oZWFkZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LWxpc3Qtc3RhdHVzXCI+XG4gICAgICAgICAge3tcbiAgICAgICAgICAgICdvcmRlckRldGFpbHMuc3RhdHVzRGlzcGxheV8nICsgb3JkZXI/LnN0YXR1c0Rpc3BsYXkgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgIH19XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8IS0tIGRlbGl2ZXJ5IHVuY29uc2lnbmVkIGVudHJpZXMgLS0+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiZGVsaXZlcnlVbkNvbnNpZ25lZEVudHJpZXM/Lmxlbmd0aFwiPlxuICAgICAgICA8aDIgKm5nSWY9XCJncm91cENhcnRJdGVtcyQgfCBhc3luY1wiIGNsYXNzPVwiY3gtcmV2aWV3LWhlYWRlclwiPlxuICAgICAgICAgIHt7ICdjaGVja291dE1vZGUuZGVsaXZlcnlFbnRyaWVzJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgIDwvaDI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC1saXN0LWl0ZW1cIj5cbiAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgIFtjeE91dGxldF09XCJDYXJ0T3V0bGV0cy5DQVJUX0lURU1fTElTVFwiXG4gICAgICAgICAgICBbY3hPdXRsZXRDb250ZXh0XT1cIntcbiAgICAgICAgICAgICAgaXRlbXM6IGRlbGl2ZXJ5VW5Db25zaWduZWRFbnRyaWVzLFxuICAgICAgICAgICAgICByZWFkb25seTogdHJ1ZSxcbiAgICAgICAgICAgICAgcHJvbW90aW9uTG9jYXRpb246IHByb21vdGlvbkxvY2F0aW9uLFxuICAgICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgZGlzcGxheUFkZFRvQ2FydDogZW5hYmxlQWRkVG9DYXJ0JCB8IGFzeW5jLFxuICAgICAgICAgICAgICAgIGFkZFRvQ2FydFN0cmluZzogJ2FkZFRvQ2FydC5idXlJdEFnYWluJyB8IGN4VHJhbnNsYXRlLFxuICAgICAgICAgICAgICAgIG9wdGlvbmFsQnRuOiBhZGRUb0NhcnRCdG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgPlxuICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8IS0tIHBpY2t1cCB1bmNvbnNpZ25lZCBlbnRyaWVzLCBiMmIgZG9lcyBub3QgaGF2ZSBwaWNrdXAgaXRlbXMgLS0+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwicGlja3VwVW5jb25zaWduZWRFbnRyaWVzPy5sZW5ndGhcIj5cbiAgICAgICAgPGgyIGNsYXNzPVwiY3gtcmV2aWV3LWhlYWRlclwiPlxuICAgICAgICAgIHt7ICdjaGVja291dFBpY2t1cEluU3RvcmUuaGVhZGluZycgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICA8L2gyPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY3gtbGlzdC1pdGVtXCI+XG4gICAgICAgICAgPG5nLXRlbXBsYXRlXG4gICAgICAgICAgICBbY3hPdXRsZXRdPVwiQ2FydE91dGxldHMuQ0FSVF9JVEVNX0xJU1RcIlxuICAgICAgICAgICAgW2N4T3V0bGV0Q29udGV4dF09XCJ7XG4gICAgICAgICAgICAgIGl0ZW1zOiBwaWNrdXBVbmNvbnNpZ25lZEVudHJpZXMsXG4gICAgICAgICAgICAgIHJlYWRvbmx5OiB0cnVlLFxuICAgICAgICAgICAgICBwcm9tb3Rpb25Mb2NhdGlvbjogcHJvbW90aW9uTG9jYXRpb24sXG4gICAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5QWRkVG9DYXJ0OiBlbmFibGVBZGRUb0NhcnQkIHwgYXN5bmMsXG4gICAgICAgICAgICAgICAgYWRkVG9DYXJ0U3RyaW5nOiAnYWRkVG9DYXJ0LmJ1eUl0QWdhaW4nIHwgY3hUcmFuc2xhdGUsXG4gICAgICAgICAgICAgICAgb3B0aW9uYWxCdG46IGFkZFRvQ2FydEJ0blxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XCJcbiAgICAgICAgICA+XG4gICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgIDwhLS0gcmVwbGVuaXNobWVudCBvdGhlciBlbnRyaWVzIC0tPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJvcmRlcj8uZW50cmllcyAmJiBvcmRlcj8ucmVwbGVuaXNobWVudE9yZGVyQ29kZVwiPlxuICAgICAgPGRpdiBjbGFzcz1cImN4LWxpc3RcIj5cbiAgICAgICAgPGRpdiAqbmdJZj1cIm9yZGVyPy5zdGF0dXNEaXNwbGF5XCIgY2xhc3M9XCJjeC1saXN0LWhlYWRlclwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1saXN0LXN0YXR1c1wiPlxuICAgICAgICAgICAge3tcbiAgICAgICAgICAgICAgJ29yZGVyRGV0YWlscy5zdGF0dXNEaXNwbGF5XycgKyBvcmRlcj8uc3RhdHVzRGlzcGxheSB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICB9fVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LWxpc3QtaXRlbVwiPlxuICAgICAgICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgICAgICAgW2N4T3V0bGV0XT1cIkNhcnRPdXRsZXRzLkNBUlRfSVRFTV9MSVNUXCJcbiAgICAgICAgICAgIFtjeE91dGxldENvbnRleHRdPVwie1xuICAgICAgICAgICAgICBpdGVtczogb3JkZXIuZW50cmllcyxcbiAgICAgICAgICAgICAgcmVhZG9ubHk6IHRydWUsXG4gICAgICAgICAgICAgIHByb21vdGlvbkxvY2F0aW9uOiBwcm9tb3Rpb25Mb2NhdGlvbixcbiAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlBZGRUb0NhcnQ6IGVuYWJsZUFkZFRvQ2FydCQgfCBhc3luYyxcbiAgICAgICAgICAgICAgICBhZGRUb0NhcnRTdHJpbmc6ICdhZGRUb0NhcnQuYnV5SXRBZ2FpbicgfCBjeFRyYW5zbGF0ZSxcbiAgICAgICAgICAgICAgICBvcHRpb25hbEJ0bjogYWRkVG9DYXJ0QnRuXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cIlxuICAgICAgICAgID5cbiAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L25nLWNvbnRhaW5lcj5cblxuICA8bmctdGVtcGxhdGUgbGV0LWN0eCAjYWRkVG9DYXJ0QnRuPlxuICAgIDxjeC1hZGQtdG8tY2FydFxuICAgICAgW3Byb2R1Y3RDb2RlXT1cImN0eC5pdGVtLnByb2R1Y3Q/LmNvZGVcIlxuICAgICAgW3Byb2R1Y3RdPVwiY3R4Lml0ZW0ucHJvZHVjdFwiXG4gICAgICBbc2hvd1F1YW50aXR5XT1cImZhbHNlXCJcbiAgICAgIFtvcHRpb25zXT1cImN0eC5vcHRpb25zXCJcbiAgICAgIFtwaWNrdXBTdG9yZV09XCJjdHguaXRlbS5kZWxpdmVyeVBvaW50T2ZTZXJ2aWNlPy5uYW1lXCJcbiAgICAgIGNsYXNzPVwiYWRkLXRvLWNhcnRcIlxuICAgID5cbiAgICA8L2N4LWFkZC10by1jYXJ0PlxuICA8L25nLXRlbXBsYXRlPlxuPC9uZy1jb250YWluZXI+XG4iXX0=