/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { forkJoin, of } from 'rxjs';
import { concatMap, filter, map, take } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../asm-customer-360-section-context.model";
import * as i2 from "@spartacus/core";
import * as i3 from "@angular/common";
import * as i4 from "../../asm-customer-360-product-listing/asm-customer-360-product-listing.component";
export class AsmCustomer360SavedCartComponent {
    constructor(sectionContext, productService) {
        this.sectionContext = sectionContext;
        this.productService = productService;
        this.savedCart$ = this.sectionContext.data$.pipe(map((cart) => {
            return cart.savedCart;
        }));
        this.productItems$ = this.savedCart$.pipe(concatMap((cart) => {
            if (!cart?.entries?.length) {
                return of([]);
            }
            else {
                return forkJoin(cart.entries.map((entry) => {
                    return this.productService
                        .get(entry.productCode, "details" /* ProductScope.DETAILS */)
                        .pipe(filter((product) => Boolean(product)), map((product) => {
                        return {
                            ...product,
                            quantity: entry.quantity,
                            basePrice: entry.basePrice,
                            totalPrice: entry.totalPrice,
                        };
                    }), take(1));
                }));
            }
        }));
    }
}
AsmCustomer360SavedCartComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: AsmCustomer360SavedCartComponent, deps: [{ token: i1.AsmCustomer360SectionContext }, { token: i2.ProductService }], target: i0.ɵɵFactoryTarget.Component });
AsmCustomer360SavedCartComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: AsmCustomer360SavedCartComponent, selector: "cx-asm-customer-360-saved-cart", ngImport: i0, template: "<cx-asm-customer-360-product-listing\n  *ngIf=\"productItems$ | async as productItems\"\n  [emptyResultDescription]=\"\n    'asmCustomer360.savedCart.emptyDescription' | cxTranslate\n  \"\n  [headerInactive]=\"true\"\n  [headerTemplate]=\"headerTemplate\"\n  [headerText]=\"'asmCustomer360.savedCart.header' | cxTranslate\"\n  [products]=\"productItems\"\n  (selectProduct)=\"\n    sectionContext.navigate$.next({ cxRoute: 'product', params: $event })\n  \"\n>\n</cx-asm-customer-360-product-listing>\n\n<ng-template #headerTemplate>\n  <ng-container *ngIf=\"savedCart$ | async as savedCart\">\n    <button\n      [attr.aria-label]=\"\n        'asmCustomer360.savedCart.aria.linkLabel'\n          | cxTranslate: { code: savedCart.code }\n      \"\n      class=\"cx-overview-title-link link\"\n      (click)=\"\n        sectionContext.navigate$.next({\n          cxRoute: 'savedCartsDetails',\n          params: { savedCartId: savedCart?.code }\n        })\n      \"\n    >\n      {{ savedCart.code }}\n    </button>\n    <div class=\"cart-total-no-items\">\n      {{\n        'asmCustomer360.productListing.totalNoItems'\n          | cxTranslate: { count: savedCart.totalItemCount }\n      }}\n    </div>\n    <div class=\"cart-divider\"></div>\n    <div class=\"cart-total-price\">\n      {{\n        'asmCustomer360.productListing.totalPrice'\n          | cxTranslate: { price: savedCart.totalPrice }\n      }}\n    </div>\n  </ng-container>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.AsmCustomer360ProductListingComponent, selector: "cx-asm-customer-360-product-listing", inputs: ["emptyResultDescription", "headerInactive", "headerText", "products", "headerTemplate"], outputs: ["clickHeader", "selectProduct"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i2.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: AsmCustomer360SavedCartComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-asm-customer-360-saved-cart', changeDetection: ChangeDetectionStrategy.OnPush, template: "<cx-asm-customer-360-product-listing\n  *ngIf=\"productItems$ | async as productItems\"\n  [emptyResultDescription]=\"\n    'asmCustomer360.savedCart.emptyDescription' | cxTranslate\n  \"\n  [headerInactive]=\"true\"\n  [headerTemplate]=\"headerTemplate\"\n  [headerText]=\"'asmCustomer360.savedCart.header' | cxTranslate\"\n  [products]=\"productItems\"\n  (selectProduct)=\"\n    sectionContext.navigate$.next({ cxRoute: 'product', params: $event })\n  \"\n>\n</cx-asm-customer-360-product-listing>\n\n<ng-template #headerTemplate>\n  <ng-container *ngIf=\"savedCart$ | async as savedCart\">\n    <button\n      [attr.aria-label]=\"\n        'asmCustomer360.savedCart.aria.linkLabel'\n          | cxTranslate: { code: savedCart.code }\n      \"\n      class=\"cx-overview-title-link link\"\n      (click)=\"\n        sectionContext.navigate$.next({\n          cxRoute: 'savedCartsDetails',\n          params: { savedCartId: savedCart?.code }\n        })\n      \"\n    >\n      {{ savedCart.code }}\n    </button>\n    <div class=\"cart-total-no-items\">\n      {{\n        'asmCustomer360.productListing.totalNoItems'\n          | cxTranslate: { count: savedCart.totalItemCount }\n      }}\n    </div>\n    <div class=\"cart-divider\"></div>\n    <div class=\"cart-total-price\">\n      {{\n        'asmCustomer360.productListing.totalPrice'\n          | cxTranslate: { price: savedCart.totalPrice }\n      }}\n    </div>\n  </ng-container>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i1.AsmCustomer360SectionContext }, { type: i2.ProductService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNtLWN1c3RvbWVyLTM2MC1zYXZlZC1jYXJ0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9hc20vY3VzdG9tZXItMzYwL2NvbXBvbmVudHMvc2VjdGlvbnMvYXNtLWN1c3RvbWVyLTM2MC1zYXZlZC1jYXJ0L2FzbS1jdXN0b21lci0zNjAtc2F2ZWQtY2FydC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvYXNtL2N1c3RvbWVyLTM2MC9jb21wb25lbnRzL3NlY3Rpb25zL2FzbS1jdXN0b21lci0zNjAtc2F2ZWQtY2FydC9hc20tY3VzdG9tZXItMzYwLXNhdmVkLWNhcnQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkUsT0FBTyxFQUFjLFFBQVEsRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7QUFlOUQsTUFBTSxPQUFPLGdDQUFnQztJQUkzQyxZQUNZLGNBQXFFLEVBQ3JFLGNBQThCO1FBRDlCLG1CQUFjLEdBQWQsY0FBYyxDQUF1RDtRQUNyRSxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFFeEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQzlDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ1gsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUNILENBQUM7UUFDRixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUN2QyxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNqQixJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUU7Z0JBQzFCLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQ2Y7aUJBQU07Z0JBQ0wsT0FBTyxRQUFRLENBQ2IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtvQkFDekIsT0FBTyxJQUFJLENBQUMsY0FBYzt5QkFDdkIsR0FBRyxDQUFDLEtBQUssQ0FBQyxXQUFXLHVDQUF1Qjt5QkFDNUMsSUFBSSxDQUNILE1BQU0sQ0FBQyxDQUFDLE9BQU8sRUFBc0IsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUN6RCxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTt3QkFDZCxPQUFPOzRCQUNMLEdBQUcsT0FBTzs0QkFDVixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7NEJBQ3hCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUzs0QkFDMUIsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO3lCQUNkLENBQUM7b0JBQ25CLENBQUMsQ0FBQyxFQUNGLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FDUixDQUFDO2dCQUNOLENBQUMsQ0FBQyxDQUNILENBQUM7YUFDSDtRQUNILENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDOzs2SEF2Q1UsZ0NBQWdDO2lIQUFoQyxnQ0FBZ0Msc0VDdkI3Qyx1N0NBK0NBOzJGRHhCYSxnQ0FBZ0M7a0JBTDVDLFNBQVM7K0JBQ0UsZ0NBQWdDLG1CQUN6Qix1QkFBdUIsQ0FBQyxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZm9ya0pvaW4sIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjb25jYXRNYXAsIGZpbHRlciwgbWFwLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBQcm9kdWN0SXRlbSB9IGZyb20gJy4uLy4uL2FzbS1jdXN0b21lci0zNjAtcHJvZHVjdC1saXN0aW5nL3Byb2R1Y3QtaXRlbS5tb2RlbCc7XG5pbXBvcnQgeyBBc21DdXN0b21lcjM2MFNlY3Rpb25Db250ZXh0IH0gZnJvbSAnLi4vYXNtLWN1c3RvbWVyLTM2MC1zZWN0aW9uLWNvbnRleHQubW9kZWwnO1xuaW1wb3J0IHtcbiAgQXNtQ3VzdG9tZXIzNjBTYXZlZENhcnQsXG4gIEN1c3RvbWVyQ2FydCxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9hc20vY3VzdG9tZXItMzYwL3Jvb3QnO1xuaW1wb3J0IHsgUHJvZHVjdCwgUHJvZHVjdFNjb3BlLCBQcm9kdWN0U2VydmljZSB9IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LWFzbS1jdXN0b21lci0zNjAtc2F2ZWQtY2FydCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICB0ZW1wbGF0ZVVybDogJy4vYXNtLWN1c3RvbWVyLTM2MC1zYXZlZC1jYXJ0LmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgQXNtQ3VzdG9tZXIzNjBTYXZlZENhcnRDb21wb25lbnQge1xuICBzYXZlZENhcnQkOiBPYnNlcnZhYmxlPEN1c3RvbWVyQ2FydCB8IHVuZGVmaW5lZD47XG4gIHByb2R1Y3RJdGVtcyQ6IE9ic2VydmFibGU8QXJyYXk8UHJvZHVjdEl0ZW0+PjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgc2VjdGlvbkNvbnRleHQ6IEFzbUN1c3RvbWVyMzYwU2VjdGlvbkNvbnRleHQ8QXNtQ3VzdG9tZXIzNjBTYXZlZENhcnQ+LFxuICAgIHByb3RlY3RlZCBwcm9kdWN0U2VydmljZTogUHJvZHVjdFNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy5zYXZlZENhcnQkID0gdGhpcy5zZWN0aW9uQ29udGV4dC5kYXRhJC5waXBlKFxuICAgICAgbWFwKChjYXJ0KSA9PiB7XG4gICAgICAgIHJldHVybiBjYXJ0LnNhdmVkQ2FydDtcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLnByb2R1Y3RJdGVtcyQgPSB0aGlzLnNhdmVkQ2FydCQucGlwZShcbiAgICAgIGNvbmNhdE1hcCgoY2FydCkgPT4ge1xuICAgICAgICBpZiAoIWNhcnQ/LmVudHJpZXM/Lmxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiBvZihbXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGZvcmtKb2luKFxuICAgICAgICAgICAgY2FydC5lbnRyaWVzLm1hcCgoZW50cnkpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvZHVjdFNlcnZpY2VcbiAgICAgICAgICAgICAgICAuZ2V0KGVudHJ5LnByb2R1Y3RDb2RlLCBQcm9kdWN0U2NvcGUuREVUQUlMUylcbiAgICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICAgIGZpbHRlcigocHJvZHVjdCk6IHByb2R1Y3QgaXMgUHJvZHVjdCA9PiBCb29sZWFuKHByb2R1Y3QpKSxcbiAgICAgICAgICAgICAgICAgIG1hcCgocHJvZHVjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgIC4uLnByb2R1Y3QsXG4gICAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IGVudHJ5LnF1YW50aXR5LFxuICAgICAgICAgICAgICAgICAgICAgIGJhc2VQcmljZTogZW50cnkuYmFzZVByaWNlLFxuICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUHJpY2U6IGVudHJ5LnRvdGFsUHJpY2UsXG4gICAgICAgICAgICAgICAgICAgIH0gYXMgUHJvZHVjdEl0ZW07XG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgIHRha2UoMSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cbn1cbiIsIjxjeC1hc20tY3VzdG9tZXItMzYwLXByb2R1Y3QtbGlzdGluZ1xuICAqbmdJZj1cInByb2R1Y3RJdGVtcyQgfCBhc3luYyBhcyBwcm9kdWN0SXRlbXNcIlxuICBbZW1wdHlSZXN1bHREZXNjcmlwdGlvbl09XCJcbiAgICAnYXNtQ3VzdG9tZXIzNjAuc2F2ZWRDYXJ0LmVtcHR5RGVzY3JpcHRpb24nIHwgY3hUcmFuc2xhdGVcbiAgXCJcbiAgW2hlYWRlckluYWN0aXZlXT1cInRydWVcIlxuICBbaGVhZGVyVGVtcGxhdGVdPVwiaGVhZGVyVGVtcGxhdGVcIlxuICBbaGVhZGVyVGV4dF09XCInYXNtQ3VzdG9tZXIzNjAuc2F2ZWRDYXJ0LmhlYWRlcicgfCBjeFRyYW5zbGF0ZVwiXG4gIFtwcm9kdWN0c109XCJwcm9kdWN0SXRlbXNcIlxuICAoc2VsZWN0UHJvZHVjdCk9XCJcbiAgICBzZWN0aW9uQ29udGV4dC5uYXZpZ2F0ZSQubmV4dCh7IGN4Um91dGU6ICdwcm9kdWN0JywgcGFyYW1zOiAkZXZlbnQgfSlcbiAgXCJcbj5cbjwvY3gtYXNtLWN1c3RvbWVyLTM2MC1wcm9kdWN0LWxpc3Rpbmc+XG5cbjxuZy10ZW1wbGF0ZSAjaGVhZGVyVGVtcGxhdGU+XG4gIDxuZy1jb250YWluZXIgKm5nSWY9XCJzYXZlZENhcnQkIHwgYXN5bmMgYXMgc2F2ZWRDYXJ0XCI+XG4gICAgPGJ1dHRvblxuICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJcbiAgICAgICAgJ2FzbUN1c3RvbWVyMzYwLnNhdmVkQ2FydC5hcmlhLmxpbmtMYWJlbCdcbiAgICAgICAgICB8IGN4VHJhbnNsYXRlOiB7IGNvZGU6IHNhdmVkQ2FydC5jb2RlIH1cbiAgICAgIFwiXG4gICAgICBjbGFzcz1cImN4LW92ZXJ2aWV3LXRpdGxlLWxpbmsgbGlua1wiXG4gICAgICAoY2xpY2spPVwiXG4gICAgICAgIHNlY3Rpb25Db250ZXh0Lm5hdmlnYXRlJC5uZXh0KHtcbiAgICAgICAgICBjeFJvdXRlOiAnc2F2ZWRDYXJ0c0RldGFpbHMnLFxuICAgICAgICAgIHBhcmFtczogeyBzYXZlZENhcnRJZDogc2F2ZWRDYXJ0Py5jb2RlIH1cbiAgICAgICAgfSlcbiAgICAgIFwiXG4gICAgPlxuICAgICAge3sgc2F2ZWRDYXJ0LmNvZGUgfX1cbiAgICA8L2J1dHRvbj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FydC10b3RhbC1uby1pdGVtc1wiPlxuICAgICAge3tcbiAgICAgICAgJ2FzbUN1c3RvbWVyMzYwLnByb2R1Y3RMaXN0aW5nLnRvdGFsTm9JdGVtcydcbiAgICAgICAgICB8IGN4VHJhbnNsYXRlOiB7IGNvdW50OiBzYXZlZENhcnQudG90YWxJdGVtQ291bnQgfVxuICAgICAgfX1cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FydC1kaXZpZGVyXCI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImNhcnQtdG90YWwtcHJpY2VcIj5cbiAgICAgIHt7XG4gICAgICAgICdhc21DdXN0b21lcjM2MC5wcm9kdWN0TGlzdGluZy50b3RhbFByaWNlJ1xuICAgICAgICAgIHwgY3hUcmFuc2xhdGU6IHsgcHJpY2U6IHNhdmVkQ2FydC50b3RhbFByaWNlIH1cbiAgICAgIH19XG4gICAgPC9kaXY+XG4gIDwvbmctY29udGFpbmVyPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==