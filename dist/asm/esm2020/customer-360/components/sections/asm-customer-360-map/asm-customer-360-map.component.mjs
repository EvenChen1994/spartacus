/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, } from '@angular/core';
import { combineLatest, of, Subscription } from 'rxjs';
import { concatMap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../asm-customer-360-section-context.model";
import * as i2 from "@spartacus/storefinder/core";
import * as i3 from "@spartacus/core";
import * as i4 from "@angular/common";
export class AsmCustomer360MapComponent {
    constructor(source, changeDetectorRef, storeFinderService, translationService, storeFinderConfig) {
        this.source = source;
        this.changeDetectorRef = changeDetectorRef;
        this.storeFinderService = storeFinderService;
        this.translationService = translationService;
        this.storeFinderConfig = storeFinderConfig;
        this.subscription = new Subscription();
    }
    ngOnInit() {
        this.dataSource$ = combineLatest([this.source.config$, this.source.data$]);
        this.subscription.add(this.dataSource$
            .pipe(concatMap(([config, data]) => {
            this.storeFinderService.findStoresAction(data.address, {
                pageSize: config.pageSize,
            }, undefined, undefined, undefined, this.storeFinderConfig.googleMaps?.radius);
            return this.storeFinderService.getFindStoresEntities();
        }), concatMap((storeSearchData) => {
            if (storeSearchData) {
                this.storeData = storeSearchData;
                this.selectedStore = this.storeData.stores?.[0];
            }
            return of(undefined);
        }))
            .subscribe(() => this.changeDetectorRef.detectChanges()));
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
    selectStore(store) {
        this.selectedStore = store;
    }
    getStoreOpening(opening) {
        const { closed, openingTime, closingTime } = opening;
        if (closed) {
            return this.translationService.translate('asmCustomer360.maps.storeClosed');
        }
        else if (openingTime) {
            let storeOpening = `${openingTime.formattedHour}`;
            if (closingTime) {
                storeOpening = `${storeOpening} - ${closingTime.formattedHour}`;
            }
            return of(storeOpening);
        }
        else {
            return of('');
        }
    }
}
AsmCustomer360MapComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: AsmCustomer360MapComponent, deps: [{ token: i1.AsmCustomer360SectionContext }, { token: i0.ChangeDetectorRef }, { token: i2.StoreFinderService }, { token: i3.TranslationService }, { token: i2.StoreFinderConfig }], target: i0.ɵɵFactoryTarget.Component });
AsmCustomer360MapComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: AsmCustomer360MapComponent, selector: "cx-asm-customer-360-map", ngImport: i0, template: "<ng-container *ngIf=\"storeData\">\n  <div class=\"store-count\">\n    {{\n      'asmCustomer360.maps.storesFound'\n        | cxTranslate\n          : {\n              initial: 1,\n              end: storeData.pagination?.pageSize,\n              total: storeData.pagination?.totalResults\n            }\n    }}\n  </div>\n\n  <div>\n    <button\n      class=\"store-listing-item\"\n      [class.selected]=\"selectedStore === store\"\n      *ngFor=\"let store of storeData.stores\"\n      [attr.aria-label]=\"store.displayName\"\n      (click)=\"selectStore(store)\"\n    >\n      <div class=\"store-listing-item-details\">\n        <div class=\"store-listing-item-text\">{{ store.displayName }}</div>\n        <div class=\"store-listing-item-text\">\n          {{ store.address?.line1 }}, {{ store.address?.line2 }}\n        </div>\n        <div class=\"store-listing-item-text\">{{ store.address?.town }}</div>\n      </div>\n      <div class=\"store-listing-item-distance store-listing-item-text\">\n        {{ store.formattedDistance }}\n      </div>\n    </button>\n  </div>\n\n  <div *ngIf=\"selectedStore\">\n    <div class=\"store-details\">\n      <img\n        *ngIf=\"selectedStore.storeImages?.[0]\"\n        [src]=\"selectedStore.storeImages?.[0]?.url\"\n        alt=\"{{ selectedStore.displayName }}\"\n        width=\"110px\"\n        height=\"110px\"\n      />\n      <div class=\"store-details-info\">\n        <div class=\"bold\">{{ selectedStore.displayName }}</div>\n        <div>{{ selectedStore.address?.line1 }}</div>\n        <div>{{ selectedStore.address?.line2 }}</div>\n        <div>{{ selectedStore.address?.town }}</div>\n      </div>\n    </div>\n    <div\n      class=\"store-openings\"\n      *ngIf=\"selectedStore?.openingHours as openingHours\"\n    >\n      <div\n        class=\"store-openings-dates\"\n        *ngIf=\"openingHours.weekDayOpeningList as weekDayOpeningList\"\n      >\n        <div\n          class=\"store-openings-date\"\n          *ngFor=\"let opening of weekDayOpeningList\"\n        >\n          <span class=\"store-openings-day bold\">{{ opening.weekDay }}</span\n          >{{ getStoreOpening(opening) | async }}\n        </div>\n      </div>\n      <div\n        class=\"store-openings-dates\"\n        *ngIf=\"openingHours.specialDayOpeningList as specialDayOpeningList\"\n      >\n        <div\n          class=\"store-openings-date\"\n          *ngFor=\"let opening of specialDayOpeningList\"\n        >\n          <span class=\"store-openings-day bold\">{{ opening.name }}</span\n          >{{ getStoreOpening(opening) | async }}\n        </div>\n      </div>\n      <div class=\"store-openings-features\">\n        <div *ngFor=\"let feature of selectedStore.features?.entry\">\n          {{ feature.value }}\n        </div>\n      </div>\n    </div>\n  </div>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }, { kind: "pipe", type: i3.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: AsmCustomer360MapComponent, decorators: [{
            type: Component,
            args: [{ changeDetection: ChangeDetectionStrategy.OnPush, selector: 'cx-asm-customer-360-map', template: "<ng-container *ngIf=\"storeData\">\n  <div class=\"store-count\">\n    {{\n      'asmCustomer360.maps.storesFound'\n        | cxTranslate\n          : {\n              initial: 1,\n              end: storeData.pagination?.pageSize,\n              total: storeData.pagination?.totalResults\n            }\n    }}\n  </div>\n\n  <div>\n    <button\n      class=\"store-listing-item\"\n      [class.selected]=\"selectedStore === store\"\n      *ngFor=\"let store of storeData.stores\"\n      [attr.aria-label]=\"store.displayName\"\n      (click)=\"selectStore(store)\"\n    >\n      <div class=\"store-listing-item-details\">\n        <div class=\"store-listing-item-text\">{{ store.displayName }}</div>\n        <div class=\"store-listing-item-text\">\n          {{ store.address?.line1 }}, {{ store.address?.line2 }}\n        </div>\n        <div class=\"store-listing-item-text\">{{ store.address?.town }}</div>\n      </div>\n      <div class=\"store-listing-item-distance store-listing-item-text\">\n        {{ store.formattedDistance }}\n      </div>\n    </button>\n  </div>\n\n  <div *ngIf=\"selectedStore\">\n    <div class=\"store-details\">\n      <img\n        *ngIf=\"selectedStore.storeImages?.[0]\"\n        [src]=\"selectedStore.storeImages?.[0]?.url\"\n        alt=\"{{ selectedStore.displayName }}\"\n        width=\"110px\"\n        height=\"110px\"\n      />\n      <div class=\"store-details-info\">\n        <div class=\"bold\">{{ selectedStore.displayName }}</div>\n        <div>{{ selectedStore.address?.line1 }}</div>\n        <div>{{ selectedStore.address?.line2 }}</div>\n        <div>{{ selectedStore.address?.town }}</div>\n      </div>\n    </div>\n    <div\n      class=\"store-openings\"\n      *ngIf=\"selectedStore?.openingHours as openingHours\"\n    >\n      <div\n        class=\"store-openings-dates\"\n        *ngIf=\"openingHours.weekDayOpeningList as weekDayOpeningList\"\n      >\n        <div\n          class=\"store-openings-date\"\n          *ngFor=\"let opening of weekDayOpeningList\"\n        >\n          <span class=\"store-openings-day bold\">{{ opening.weekDay }}</span\n          >{{ getStoreOpening(opening) | async }}\n        </div>\n      </div>\n      <div\n        class=\"store-openings-dates\"\n        *ngIf=\"openingHours.specialDayOpeningList as specialDayOpeningList\"\n      >\n        <div\n          class=\"store-openings-date\"\n          *ngFor=\"let opening of specialDayOpeningList\"\n        >\n          <span class=\"store-openings-day bold\">{{ opening.name }}</span\n          >{{ getStoreOpening(opening) | async }}\n        </div>\n      </div>\n      <div class=\"store-openings-features\">\n        <div *ngFor=\"let feature of selectedStore.features?.entry\">\n          {{ feature.value }}\n        </div>\n      </div>\n    </div>\n  </div>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.AsmCustomer360SectionContext }, { type: i0.ChangeDetectorRef }, { type: i2.StoreFinderService }, { type: i3.TranslationService }, { type: i2.StoreFinderConfig }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNtLWN1c3RvbWVyLTM2MC1tYXAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL2FzbS9jdXN0b21lci0zNjAvY29tcG9uZW50cy9zZWN0aW9ucy9hc20tY3VzdG9tZXItMzYwLW1hcC9hc20tY3VzdG9tZXItMzYwLW1hcC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvYXNtL2N1c3RvbWVyLTM2MC9jb21wb25lbnRzL3NlY3Rpb25zL2FzbS1jdXN0b21lci0zNjAtbWFwL2FzbS1jdXN0b21lci0zNjAtbWFwLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQ0wsdUJBQXVCLEVBRXZCLFNBQVMsR0FHVixNQUFNLGVBQWUsQ0FBQztBQWV2QixPQUFPLEVBQUUsYUFBYSxFQUFjLEVBQUUsRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDbkUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7QUFTM0MsTUFBTSxPQUFPLDBCQUEwQjtJQWFyQyxZQUNTLE1BQWlFLEVBQzlELGlCQUFvQyxFQUNwQyxrQkFBc0MsRUFDdEMsa0JBQXNDLEVBQ3RDLGlCQUFvQztRQUp2QyxXQUFNLEdBQU4sTUFBTSxDQUEyRDtRQUM5RCxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUN0QyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBUHRDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQVF6QyxDQUFDO0lBRUosUUFBUTtRQUNOLElBQUksQ0FBQyxXQUFXLEdBQUcsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRTNFLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUNuQixJQUFJLENBQUMsV0FBVzthQUNiLElBQUksQ0FDSCxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzNCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FDdEMsSUFBSSxDQUFDLE9BQU8sRUFDWjtnQkFDRSxRQUFRLEVBQUUsTUFBTSxDQUFDLFFBQVE7YUFDMUIsRUFDRCxTQUFTLEVBQ1QsU0FBUyxFQUNULFNBQVMsRUFDVCxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FDMUMsQ0FBQztZQUVGLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDekQsQ0FBQyxDQUFDLEVBQ0YsU0FBUyxDQUFDLENBQUMsZUFBZSxFQUFFLEVBQUU7WUFDNUIsSUFBSSxlQUFlLEVBQUU7Z0JBQ25CLElBQUksQ0FBQyxTQUFTLEdBQUcsZUFBd0MsQ0FBQztnQkFDMUQsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2pEO1lBQ0QsT0FBTyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLENBQ0g7YUFDQSxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsRUFBRSxDQUFDLENBQzNELENBQUM7SUFDSixDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDbEMsQ0FBQztJQUVELFdBQVcsQ0FBQyxLQUFxQjtRQUMvQixJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztJQUM3QixDQUFDO0lBRUQsZUFBZSxDQUFDLE9BQTBCO1FBQ3hDLE1BQU0sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxHQUFHLE9BQU8sQ0FBQztRQUNyRCxJQUFJLE1BQU0sRUFBRTtZQUNWLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FDdEMsaUNBQWlDLENBQ2xDLENBQUM7U0FDSDthQUFNLElBQUksV0FBVyxFQUFFO1lBQ3RCLElBQUksWUFBWSxHQUFHLEdBQUcsV0FBVyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBRWxELElBQUksV0FBVyxFQUFFO2dCQUNmLFlBQVksR0FBRyxHQUFHLFlBQVksTUFBTSxXQUFXLENBQUMsYUFBYSxFQUFFLENBQUM7YUFDakU7WUFFRCxPQUFPLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUN6QjthQUFNO1lBQ0wsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDZjtJQUNILENBQUM7O3VIQTlFVSwwQkFBMEI7MkdBQTFCLDBCQUEwQiwrRENyQ3ZDLDZ4RkFzRkE7MkZEakRhLDBCQUEwQjtrQkFMdEMsU0FBUztzQ0FDUyx1QkFBdUIsQ0FBQyxNQUFNLFlBQ3JDLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBBc21DdXN0b21lcjM2MFNlY3Rpb25Db25maWcsXG4gIEFzbUN1c3RvbWVyMzYwU3RvcmVMb2NhdGlvbixcbn0gZnJvbSAnQHNwYXJ0YWN1cy9hc20vY3VzdG9tZXItMzYwL3Jvb3QnO1xuaW1wb3J0IHtcbiAgUG9pbnRPZlNlcnZpY2UsXG4gIFRyYW5zbGF0aW9uU2VydmljZSxcbiAgV2Vla2RheU9wZW5pbmdEYXksXG59IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQge1xuICBTdG9yZUZpbmRlckNvbmZpZyxcbiAgU3RvcmVGaW5kZXJTZWFyY2hQYWdlLFxuICBTdG9yZUZpbmRlclNlcnZpY2UsXG59IGZyb20gJ0BzcGFydGFjdXMvc3RvcmVmaW5kZXIvY29yZSc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlLCBvZiwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjb25jYXRNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IEFzbUN1c3RvbWVyMzYwU2VjdGlvbkNvbnRleHQgfSBmcm9tICcuLi9hc20tY3VzdG9tZXItMzYwLXNlY3Rpb24tY29udGV4dC5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgc2VsZWN0b3I6ICdjeC1hc20tY3VzdG9tZXItMzYwLW1hcCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9hc20tY3VzdG9tZXItMzYwLW1hcC5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIEFzbUN1c3RvbWVyMzYwTWFwQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xuICBzdG9yZURhdGE6IFN0b3JlRmluZGVyU2VhcmNoUGFnZTtcblxuICBzZWxlY3RlZFN0b3JlOiBQb2ludE9mU2VydmljZSB8IHVuZGVmaW5lZDtcblxuICBhcGlLZXk6IHN0cmluZztcblxuICBkYXRhU291cmNlJDogT2JzZXJ2YWJsZTxcbiAgICBbQXNtQ3VzdG9tZXIzNjBTZWN0aW9uQ29uZmlnLCBBc21DdXN0b21lcjM2MFN0b3JlTG9jYXRpb25dXG4gID47XG5cbiAgcHJvdGVjdGVkIHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgc291cmNlOiBBc21DdXN0b21lcjM2MFNlY3Rpb25Db250ZXh0PEFzbUN1c3RvbWVyMzYwU3RvcmVMb2NhdGlvbj4sXG4gICAgcHJvdGVjdGVkIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcm90ZWN0ZWQgc3RvcmVGaW5kZXJTZXJ2aWNlOiBTdG9yZUZpbmRlclNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBzdG9yZUZpbmRlckNvbmZpZzogU3RvcmVGaW5kZXJDb25maWdcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZGF0YVNvdXJjZSQgPSBjb21iaW5lTGF0ZXN0KFt0aGlzLnNvdXJjZS5jb25maWckLCB0aGlzLnNvdXJjZS5kYXRhJF0pO1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKFxuICAgICAgdGhpcy5kYXRhU291cmNlJFxuICAgICAgICAucGlwZShcbiAgICAgICAgICBjb25jYXRNYXAoKFtjb25maWcsIGRhdGFdKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlRmluZGVyU2VydmljZS5maW5kU3RvcmVzQWN0aW9uKFxuICAgICAgICAgICAgICBkYXRhLmFkZHJlc3MsXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYWdlU2l6ZTogY29uZmlnLnBhZ2VTaXplLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICB0aGlzLnN0b3JlRmluZGVyQ29uZmlnLmdvb2dsZU1hcHM/LnJhZGl1c1xuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmVGaW5kZXJTZXJ2aWNlLmdldEZpbmRTdG9yZXNFbnRpdGllcygpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNvbmNhdE1hcCgoc3RvcmVTZWFyY2hEYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAoc3RvcmVTZWFyY2hEYXRhKSB7XG4gICAgICAgICAgICAgIHRoaXMuc3RvcmVEYXRhID0gc3RvcmVTZWFyY2hEYXRhIGFzIFN0b3JlRmluZGVyU2VhcmNoUGFnZTtcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFN0b3JlID0gdGhpcy5zdG9yZURhdGEuc3RvcmVzPy5bMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2YodW5kZWZpbmVkKTtcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCkpXG4gICAgKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBzZWxlY3RTdG9yZShzdG9yZTogUG9pbnRPZlNlcnZpY2UpOiB2b2lkIHtcbiAgICB0aGlzLnNlbGVjdGVkU3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIGdldFN0b3JlT3BlbmluZyhvcGVuaW5nOiBXZWVrZGF5T3BlbmluZ0RheSk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgY29uc3QgeyBjbG9zZWQsIG9wZW5pbmdUaW1lLCBjbG9zaW5nVGltZSB9ID0gb3BlbmluZztcbiAgICBpZiAoY2xvc2VkKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKFxuICAgICAgICAnYXNtQ3VzdG9tZXIzNjAubWFwcy5zdG9yZUNsb3NlZCdcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmIChvcGVuaW5nVGltZSkge1xuICAgICAgbGV0IHN0b3JlT3BlbmluZyA9IGAke29wZW5pbmdUaW1lLmZvcm1hdHRlZEhvdXJ9YDtcblxuICAgICAgaWYgKGNsb3NpbmdUaW1lKSB7XG4gICAgICAgIHN0b3JlT3BlbmluZyA9IGAke3N0b3JlT3BlbmluZ30gLSAke2Nsb3NpbmdUaW1lLmZvcm1hdHRlZEhvdXJ9YDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG9mKHN0b3JlT3BlbmluZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBvZignJyk7XG4gICAgfVxuICB9XG59XG4iLCI8bmctY29udGFpbmVyICpuZ0lmPVwic3RvcmVEYXRhXCI+XG4gIDxkaXYgY2xhc3M9XCJzdG9yZS1jb3VudFwiPlxuICAgIHt7XG4gICAgICAnYXNtQ3VzdG9tZXIzNjAubWFwcy5zdG9yZXNGb3VuZCdcbiAgICAgICAgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgIDoge1xuICAgICAgICAgICAgICBpbml0aWFsOiAxLFxuICAgICAgICAgICAgICBlbmQ6IHN0b3JlRGF0YS5wYWdpbmF0aW9uPy5wYWdlU2l6ZSxcbiAgICAgICAgICAgICAgdG90YWw6IHN0b3JlRGF0YS5wYWdpbmF0aW9uPy50b3RhbFJlc3VsdHNcbiAgICAgICAgICAgIH1cbiAgICB9fVxuICA8L2Rpdj5cblxuICA8ZGl2PlxuICAgIDxidXR0b25cbiAgICAgIGNsYXNzPVwic3RvcmUtbGlzdGluZy1pdGVtXCJcbiAgICAgIFtjbGFzcy5zZWxlY3RlZF09XCJzZWxlY3RlZFN0b3JlID09PSBzdG9yZVwiXG4gICAgICAqbmdGb3I9XCJsZXQgc3RvcmUgb2Ygc3RvcmVEYXRhLnN0b3Jlc1wiXG4gICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cInN0b3JlLmRpc3BsYXlOYW1lXCJcbiAgICAgIChjbGljayk9XCJzZWxlY3RTdG9yZShzdG9yZSlcIlxuICAgID5cbiAgICAgIDxkaXYgY2xhc3M9XCJzdG9yZS1saXN0aW5nLWl0ZW0tZGV0YWlsc1wiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RvcmUtbGlzdGluZy1pdGVtLXRleHRcIj57eyBzdG9yZS5kaXNwbGF5TmFtZSB9fTwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RvcmUtbGlzdGluZy1pdGVtLXRleHRcIj5cbiAgICAgICAgICB7eyBzdG9yZS5hZGRyZXNzPy5saW5lMSB9fSwge3sgc3RvcmUuYWRkcmVzcz8ubGluZTIgfX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdG9yZS1saXN0aW5nLWl0ZW0tdGV4dFwiPnt7IHN0b3JlLmFkZHJlc3M/LnRvd24gfX08L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cInN0b3JlLWxpc3RpbmctaXRlbS1kaXN0YW5jZSBzdG9yZS1saXN0aW5nLWl0ZW0tdGV4dFwiPlxuICAgICAgICB7eyBzdG9yZS5mb3JtYXR0ZWREaXN0YW5jZSB9fVxuICAgICAgPC9kaXY+XG4gICAgPC9idXR0b24+XG4gIDwvZGl2PlxuXG4gIDxkaXYgKm5nSWY9XCJzZWxlY3RlZFN0b3JlXCI+XG4gICAgPGRpdiBjbGFzcz1cInN0b3JlLWRldGFpbHNcIj5cbiAgICAgIDxpbWdcbiAgICAgICAgKm5nSWY9XCJzZWxlY3RlZFN0b3JlLnN0b3JlSW1hZ2VzPy5bMF1cIlxuICAgICAgICBbc3JjXT1cInNlbGVjdGVkU3RvcmUuc3RvcmVJbWFnZXM/LlswXT8udXJsXCJcbiAgICAgICAgYWx0PVwie3sgc2VsZWN0ZWRTdG9yZS5kaXNwbGF5TmFtZSB9fVwiXG4gICAgICAgIHdpZHRoPVwiMTEwcHhcIlxuICAgICAgICBoZWlnaHQ9XCIxMTBweFwiXG4gICAgICAvPlxuICAgICAgPGRpdiBjbGFzcz1cInN0b3JlLWRldGFpbHMtaW5mb1wiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYm9sZFwiPnt7IHNlbGVjdGVkU3RvcmUuZGlzcGxheU5hbWUgfX08L2Rpdj5cbiAgICAgICAgPGRpdj57eyBzZWxlY3RlZFN0b3JlLmFkZHJlc3M/LmxpbmUxIH19PC9kaXY+XG4gICAgICAgIDxkaXY+e3sgc2VsZWN0ZWRTdG9yZS5hZGRyZXNzPy5saW5lMiB9fTwvZGl2PlxuICAgICAgICA8ZGl2Pnt7IHNlbGVjdGVkU3RvcmUuYWRkcmVzcz8udG93biB9fTwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJzdG9yZS1vcGVuaW5nc1wiXG4gICAgICAqbmdJZj1cInNlbGVjdGVkU3RvcmU/Lm9wZW5pbmdIb3VycyBhcyBvcGVuaW5nSG91cnNcIlxuICAgID5cbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9XCJzdG9yZS1vcGVuaW5ncy1kYXRlc1wiXG4gICAgICAgICpuZ0lmPVwib3BlbmluZ0hvdXJzLndlZWtEYXlPcGVuaW5nTGlzdCBhcyB3ZWVrRGF5T3BlbmluZ0xpc3RcIlxuICAgICAgPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3M9XCJzdG9yZS1vcGVuaW5ncy1kYXRlXCJcbiAgICAgICAgICAqbmdGb3I9XCJsZXQgb3BlbmluZyBvZiB3ZWVrRGF5T3BlbmluZ0xpc3RcIlxuICAgICAgICA+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdG9yZS1vcGVuaW5ncy1kYXkgYm9sZFwiPnt7IG9wZW5pbmcud2Vla0RheSB9fTwvc3BhblxuICAgICAgICAgID57eyBnZXRTdG9yZU9wZW5pbmcob3BlbmluZykgfCBhc3luYyB9fVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdlxuICAgICAgICBjbGFzcz1cInN0b3JlLW9wZW5pbmdzLWRhdGVzXCJcbiAgICAgICAgKm5nSWY9XCJvcGVuaW5nSG91cnMuc3BlY2lhbERheU9wZW5pbmdMaXN0IGFzIHNwZWNpYWxEYXlPcGVuaW5nTGlzdFwiXG4gICAgICA+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzcz1cInN0b3JlLW9wZW5pbmdzLWRhdGVcIlxuICAgICAgICAgICpuZ0Zvcj1cImxldCBvcGVuaW5nIG9mIHNwZWNpYWxEYXlPcGVuaW5nTGlzdFwiXG4gICAgICAgID5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0b3JlLW9wZW5pbmdzLWRheSBib2xkXCI+e3sgb3BlbmluZy5uYW1lIH19PC9zcGFuXG4gICAgICAgICAgPnt7IGdldFN0b3JlT3BlbmluZyhvcGVuaW5nKSB8IGFzeW5jIH19XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwic3RvcmUtb3BlbmluZ3MtZmVhdHVyZXNcIj5cbiAgICAgICAgPGRpdiAqbmdGb3I9XCJsZXQgZmVhdHVyZSBvZiBzZWxlY3RlZFN0b3JlLmZlYXR1cmVzPy5lbnRyeVwiPlxuICAgICAgICAgIHt7IGZlYXR1cmUudmFsdWUgfX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L25nLWNvbnRhaW5lcj5cbiJdfQ==