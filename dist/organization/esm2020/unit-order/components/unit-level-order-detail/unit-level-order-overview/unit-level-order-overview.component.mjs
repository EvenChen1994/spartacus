/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { combineLatest, of } from 'rxjs';
import { filter, map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/core";
import * as i2 from "../unit-level-order-detail.service";
import * as i3 from "@angular/common";
import * as i4 from "@spartacus/storefront";
export class UnitLevelOrderOverviewComponent {
    constructor(translation, unitLevelOrderDetailsService) {
        this.translation = translation;
        this.unitLevelOrderDetailsService = unitLevelOrderDetailsService;
    }
    ngOnInit() {
        this.order$ = this.unitLevelOrderDetailsService.getOrderDetails();
    }
    getOrderCodeCardContent(orderCode) {
        return this.translation.translate('orderDetails.orderNumber').pipe(filter(() => Boolean(orderCode)), map((textTitle) => ({
            title: textTitle,
            text: [orderCode],
        })));
    }
    getOrderCurrentDateCardContent(isoDate) {
        return this.translation.translate('orderDetails.placedOn').pipe(filter(() => Boolean(isoDate)), map((textTitle) => {
            return {
                title: textTitle,
                text: [isoDate],
            };
        }));
    }
    getOrderStatusCardContent(status) {
        return combineLatest([
            this.translation.translate('orderDetails.status'),
            status
                ? this.translation.translate('orderDetails.statusDisplay_' + status)
                : of(''),
        ]).pipe(filter(() => Boolean(status)), map(([textTitle, textStatus]) => ({
            title: textTitle,
            text: [textStatus],
        })));
    }
    getPurchaseOrderNumber(poNumber) {
        return combineLatest([
            this.translation.translate('orderDetails.purchaseOrderNumber'),
            this.translation.translate('orderDetails.emptyPurchaseOrderId'),
        ]).pipe(filter(() => Boolean(poNumber)), map(([textTitle, noneTextTitle]) => ({
            title: textTitle,
            text: [poNumber ? poNumber : noneTextTitle],
        })));
    }
    getMethodOfPaymentCardContent(hasPaymentInfo) {
        return combineLatest([
            this.translation.translate('orderDetails.methodOfPayment'),
            this.translation.translate('paymentTypes.paymentType_ACCOUNT'),
            this.translation.translate('paymentTypes.paymentType_CARD'),
        ]).pipe(filter(() => Boolean(hasPaymentInfo)), map(([textTitle, textAccount, textCard]) => ({
            title: textTitle,
            text: [Boolean(hasPaymentInfo) ? textCard : textAccount],
        })));
    }
    getCostCenterCardContent(costCenter) {
        return this.translation.translate('orderDetails.costCenter').pipe(filter(() => Boolean(costCenter)), map((textTitle) => ({
            title: textTitle,
            textBold: costCenter?.name,
            text: [`(${costCenter?.unit?.name})`],
        })));
    }
    getAddressCardContent(deliveryAddress) {
        return this.translation.translate('addressCard.shipTo').pipe(filter(() => Boolean(deliveryAddress)), map((textTitle) => {
            const formattedAddress = this.normalizeFormattedAddress(deliveryAddress?.formattedAddress ?? '');
            return {
                title: textTitle,
                textBold: `${deliveryAddress?.firstName} ${deliveryAddress?.lastName}`,
                text: [formattedAddress, deliveryAddress?.country?.name],
            };
        }));
    }
    getDeliveryModeCardContent(deliveryMode) {
        return this.translation.translate('orderDetails.shippingMethod').pipe(filter(() => Boolean(deliveryMode)), map((textTitle) => ({
            title: textTitle,
            textBold: deliveryMode?.name,
            text: [
                deliveryMode?.description,
                deliveryMode?.deliveryCost?.formattedValue
                    ? deliveryMode.deliveryCost?.formattedValue
                    : '',
            ],
        })));
    }
    getPaymentInfoCardContent(payment) {
        return combineLatest([
            this.translation.translate('paymentForm.payment'),
            this.translation.translate('paymentCard.expires', {
                month: payment ? payment.expiryMonth : '',
                year: payment ? payment.expiryYear : '',
            }),
        ]).pipe(filter(() => Boolean(payment)), map(([textTitle, textExpires]) => ({
            title: textTitle,
            textBold: payment?.accountHolderName,
            text: [payment?.cardNumber, textExpires],
        })));
    }
    getBillingAddressCardContent(billingAddress) {
        return this.translation.translate('paymentForm.billingAddress').pipe(filter(() => Boolean(billingAddress)), map((textTitle) => ({
            title: textTitle,
            textBold: `${billingAddress?.firstName} ${billingAddress?.lastName}`,
            text: [
                billingAddress?.formattedAddress,
                billingAddress?.country?.name,
            ],
        })));
    }
    getBuyerNameCardContent(customer) {
        return this.translation.translate('unitLevelOrderDetails.buyer').pipe(filter(() => Boolean(customer)), map((textTitle) => ({
            title: textTitle,
            text: [customer?.name, `(${customer?.email})`],
        })));
    }
    getUnitNameCardContent(orgUnit) {
        return this.translation.translate('orderDetails.unit').pipe(filter(() => Boolean(orgUnit)), map((textTitle) => ({
            title: textTitle,
            text: [orgUnit],
        })));
    }
    normalizeFormattedAddress(formattedAddress) {
        const addresses = formattedAddress
            .split(',')
            .map((address) => address.trim());
        return addresses.filter(Boolean).join(', ');
    }
}
UnitLevelOrderOverviewComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: UnitLevelOrderOverviewComponent, deps: [{ token: i1.TranslationService }, { token: i2.UnitLevelOrderDetailService }], target: i0.ɵɵFactoryTarget.Component });
UnitLevelOrderOverviewComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: UnitLevelOrderOverviewComponent, selector: "cx-unit-level-order-overview", ngImport: i0, template: "<div class=\"cx-order-summary\" *ngIf=\"order$ | async as order\">\n  <div class=\"container\">\n    <div class=\"cx-summary-card\">\n      <cx-card\n        [content]=\"getOrderCodeCardContent(order.code) | async\"\n      ></cx-card>\n\n      <cx-card\n        [content]=\"\n          getOrderCurrentDateCardContent(order.created | cxDate) | async\n        \"\n      ></cx-card>\n\n      <cx-card\n        [content]=\"getOrderStatusCardContent(order.statusDisplay) | async\"\n      ></cx-card>\n\n      <cx-card\n        class=\"cx-display-inline\"\n        [content]=\"getBuyerNameCardContent(order.orgCustomer) | async\"\n      ></cx-card>\n    </div>\n    <div class=\"cx-summary-card\">\n      <cx-card\n        [content]=\"getUnitNameCardContent(order.orgUnit?.name) | async\"\n      ></cx-card>\n\n      <cx-card\n        [content]=\"getPurchaseOrderNumber(order.purchaseOrderNumber) | async\"\n      ></cx-card>\n\n      <cx-card\n        [content]=\"getMethodOfPaymentCardContent(order.paymentInfo) | async\"\n      ></cx-card>\n\n      <ng-container *ngIf=\"order.costCenter\">\n        <cx-card\n          [content]=\"getCostCenterCardContent(order.costCenter) | async\"\n        ></cx-card>\n      </ng-container>\n    </div>\n\n    <div class=\"cx-summary-card\">\n      <ng-container *ngIf=\"order.deliveryAddress\">\n        <cx-card\n          [content]=\"getAddressCardContent(order.deliveryAddress) | async\"\n        ></cx-card>\n      </ng-container>\n\n      <ng-container *ngIf=\"order.deliveryMode\">\n        <cx-card\n          [content]=\"getDeliveryModeCardContent(order.deliveryMode) | async\"\n        ></cx-card>\n      </ng-container>\n    </div>\n\n    <ng-container *ngIf=\"order.paymentInfo\">\n      <div class=\"cx-summary-card\">\n        <cx-card\n          [content]=\"getPaymentInfoCardContent(order.paymentInfo) | async\"\n        ></cx-card>\n\n        <cx-card\n          [content]=\"\n            getBillingAddressCardContent(order.paymentInfo?.billingAddress)\n              | async\n          \"\n        ></cx-card>\n      </div>\n    </ng-container>\n  </div>\n</div>\n", dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.CardComponent, selector: "cx-card", inputs: ["border", "editMode", "isDefault", "content", "fitToContainer", "truncateText", "charactersLimit", "index"], outputs: ["deleteCard", "setDefaultCard", "sendCard", "editCard", "cancelCard"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i1.CxDatePipe, name: "cxDate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: UnitLevelOrderOverviewComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-unit-level-order-overview', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"cx-order-summary\" *ngIf=\"order$ | async as order\">\n  <div class=\"container\">\n    <div class=\"cx-summary-card\">\n      <cx-card\n        [content]=\"getOrderCodeCardContent(order.code) | async\"\n      ></cx-card>\n\n      <cx-card\n        [content]=\"\n          getOrderCurrentDateCardContent(order.created | cxDate) | async\n        \"\n      ></cx-card>\n\n      <cx-card\n        [content]=\"getOrderStatusCardContent(order.statusDisplay) | async\"\n      ></cx-card>\n\n      <cx-card\n        class=\"cx-display-inline\"\n        [content]=\"getBuyerNameCardContent(order.orgCustomer) | async\"\n      ></cx-card>\n    </div>\n    <div class=\"cx-summary-card\">\n      <cx-card\n        [content]=\"getUnitNameCardContent(order.orgUnit?.name) | async\"\n      ></cx-card>\n\n      <cx-card\n        [content]=\"getPurchaseOrderNumber(order.purchaseOrderNumber) | async\"\n      ></cx-card>\n\n      <cx-card\n        [content]=\"getMethodOfPaymentCardContent(order.paymentInfo) | async\"\n      ></cx-card>\n\n      <ng-container *ngIf=\"order.costCenter\">\n        <cx-card\n          [content]=\"getCostCenterCardContent(order.costCenter) | async\"\n        ></cx-card>\n      </ng-container>\n    </div>\n\n    <div class=\"cx-summary-card\">\n      <ng-container *ngIf=\"order.deliveryAddress\">\n        <cx-card\n          [content]=\"getAddressCardContent(order.deliveryAddress) | async\"\n        ></cx-card>\n      </ng-container>\n\n      <ng-container *ngIf=\"order.deliveryMode\">\n        <cx-card\n          [content]=\"getDeliveryModeCardContent(order.deliveryMode) | async\"\n        ></cx-card>\n      </ng-container>\n    </div>\n\n    <ng-container *ngIf=\"order.paymentInfo\">\n      <div class=\"cx-summary-card\">\n        <cx-card\n          [content]=\"getPaymentInfoCardContent(order.paymentInfo) | async\"\n        ></cx-card>\n\n        <cx-card\n          [content]=\"\n            getBillingAddressCardContent(order.paymentInfo?.billingAddress)\n              | async\n          \"\n        ></cx-card>\n      </div>\n    </ng-container>\n  </div>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.TranslationService }, { type: i2.UnitLevelOrderDetailService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pdC1sZXZlbC1vcmRlci1vdmVydmlldy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JnYW5pemF0aW9uL3VuaXQtb3JkZXIvY29tcG9uZW50cy91bml0LWxldmVsLW9yZGVyLWRldGFpbC91bml0LWxldmVsLW9yZGVyLW92ZXJ2aWV3L3VuaXQtbGV2ZWwtb3JkZXItb3ZlcnZpZXcuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi91bml0LW9yZGVyL2NvbXBvbmVudHMvdW5pdC1sZXZlbC1vcmRlci1kZXRhaWwvdW5pdC1sZXZlbC1vcmRlci1vdmVydmlldy91bml0LWxldmVsLW9yZGVyLW92ZXJ2aWV3LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBVTNFLE9BQU8sRUFBRSxhQUFhLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3JELE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7OztBQVE3QyxNQUFNLE9BQU8sK0JBQStCO0lBQzFDLFlBQ1ksV0FBK0IsRUFDL0IsNEJBQXlEO1FBRHpELGdCQUFXLEdBQVgsV0FBVyxDQUFvQjtRQUMvQixpQ0FBNEIsR0FBNUIsNEJBQTRCLENBQTZCO0lBQ2xFLENBQUM7SUFJSixRQUFRO1FBQ04sSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsNEJBQTRCLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDcEUsQ0FBQztJQUVELHVCQUF1QixDQUFDLFNBQTZCO1FBQ25ELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxJQUFJ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LFNBQVM7WUFDaEIsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDO1NBQ1AsQ0FBQSxDQUNiLENBQ0YsQ0FBQztJQUNKLENBQUM7SUFFTyx5QkFBeUIsQ0FBQyxnQkFBd0I7UUFDeEQsTUFBTSxTQUFTLEdBQUcsZ0JBQWdCO2FBQy9CLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDVixHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRXBDLE9BQU8sU0FBUyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUMsQ0FBQzs7NEhBbE5VLCtCQUErQjtnSEFBL0IsK0JBQStCLG9FQ3pCNUMsdWtFQXdFQTsyRkQvQ2EsK0JBQStCO2tCQUwzQyxTQUFTOytCQUNFLDhCQUE4QixtQkFFdkIsdUJBQXVCLENBQUMsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRGVsaXZlcnlNb2RlLCBQYXltZW50RGV0YWlscyB9IGZyb20gJ0BzcGFydGFjdXMvY2FydC9iYXNlL3Jvb3QnO1xuaW1wb3J0IHtcbiAgQWRkcmVzcyxcbiAgQjJCVXNlcixcbiAgQ29zdENlbnRlcixcbiAgVHJhbnNsYXRpb25TZXJ2aWNlLFxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgT3JkZXIgfSBmcm9tICdAc3BhcnRhY3VzL29yZGVyL3Jvb3QnO1xuaW1wb3J0IHsgQ2FyZCB9IGZyb20gJ0BzcGFydGFjdXMvc3RvcmVmcm9udCc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBVbml0TGV2ZWxPcmRlckRldGFpbFNlcnZpY2UgfSBmcm9tICcuLi91bml0LWxldmVsLW9yZGVyLWRldGFpbC5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtdW5pdC1sZXZlbC1vcmRlci1vdmVydmlldycsXG4gIHRlbXBsYXRlVXJsOiAnLi91bml0LWxldmVsLW9yZGVyLW92ZXJ2aWV3LmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIFVuaXRMZXZlbE9yZGVyT3ZlcnZpZXdDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgdHJhbnNsYXRpb246IFRyYW5zbGF0aW9uU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgdW5pdExldmVsT3JkZXJEZXRhaWxzU2VydmljZTogVW5pdExldmVsT3JkZXJEZXRhaWxTZXJ2aWNlXG4gICkge31cblxuICBvcmRlciQ6IE9ic2VydmFibGU8T3JkZXI+O1xuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMub3JkZXIkID0gdGhpcy51bml0TGV2ZWxPcmRlckRldGFpbHNTZXJ2aWNlLmdldE9yZGVyRGV0YWlscygpO1xuICB9XG5cbiAgZ2V0T3JkZXJDb2RlQ2FyZENvbnRlbnQob3JkZXJDb2RlOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBPYnNlcnZhYmxlPENhcmQ+IHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ29yZGVyRGV0YWlscy5vcmRlck51bWJlcicpLnBpcGUoXG4gICAgICBmaWx0ZXIoKCkgPT4gQm9vbGVhbihvcmRlckNvZGUpKSxcbiAgICAgIG1hcChcbiAgICAgICAgKHRleHRUaXRsZSkgPT5cbiAgICAgICAgICAoe1xuICAgICAgICAgICAgdGl0bGU6IHRleHRUaXRsZSxcbiAgICAgICAgICAgIHRleHQ6IFtvcmRlckNvZGVdLFxuICAgICAgICAgIH0gYXMgQ2FyZClcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgZ2V0T3JkZXJDdXJyZW50RGF0ZUNhcmRDb250ZW50KGlzb0RhdGU6IHN0cmluZyB8IG51bGwpOiBPYnNlcnZhYmxlPENhcmQ+IHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ29yZGVyRGV0YWlscy5wbGFjZWRPbicpLnBpcGUoXG4gICAgICBmaWx0ZXIoKCkgPT4gQm9vbGVhbihpc29EYXRlKSksXG4gICAgICBtYXAoKHRleHRUaXRsZSkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRpdGxlOiB0ZXh0VGl0bGUsXG4gICAgICAgICAgdGV4dDogW2lzb0RhdGVdLFxuICAgICAgICB9IGFzIENhcmQ7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBnZXRPcmRlclN0YXR1c0NhcmRDb250ZW50KHN0YXR1czogc3RyaW5nIHwgdW5kZWZpbmVkKTogT2JzZXJ2YWJsZTxDYXJkPiB7XG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoW1xuICAgICAgdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ29yZGVyRGV0YWlscy5zdGF0dXMnKSxcbiAgICAgIHN0YXR1c1xuICAgICAgICA/IHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdvcmRlckRldGFpbHMuc3RhdHVzRGlzcGxheV8nICsgc3RhdHVzKVxuICAgICAgICA6IG9mKCcnKSxcbiAgICBdKS5waXBlKFxuICAgICAgZmlsdGVyKCgpID0+IEJvb2xlYW4oc3RhdHVzKSksXG4gICAgICBtYXAoXG4gICAgICAgIChbdGV4dFRpdGxlLCB0ZXh0U3RhdHVzXSkgPT5cbiAgICAgICAgICAoe1xuICAgICAgICAgICAgdGl0bGU6IHRleHRUaXRsZSxcbiAgICAgICAgICAgIHRleHQ6IFt0ZXh0U3RhdHVzXSxcbiAgICAgICAgICB9IGFzIENhcmQpXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIGdldFB1cmNoYXNlT3JkZXJOdW1iZXIocG9OdW1iZXI6IHN0cmluZyB8IHVuZGVmaW5lZCk6IE9ic2VydmFibGU8Q2FyZD4ge1xuICAgIHJldHVybiBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdvcmRlckRldGFpbHMucHVyY2hhc2VPcmRlck51bWJlcicpLFxuICAgICAgdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ29yZGVyRGV0YWlscy5lbXB0eVB1cmNoYXNlT3JkZXJJZCcpLFxuICAgIF0pLnBpcGUoXG4gICAgICBmaWx0ZXIoKCkgPT4gQm9vbGVhbihwb051bWJlcikpLFxuICAgICAgbWFwKChbdGV4dFRpdGxlLCBub25lVGV4dFRpdGxlXSkgPT4gKHtcbiAgICAgICAgdGl0bGU6IHRleHRUaXRsZSxcbiAgICAgICAgdGV4dDogW3BvTnVtYmVyID8gcG9OdW1iZXIgOiBub25lVGV4dFRpdGxlXSxcbiAgICAgIH0pKVxuICAgICk7XG4gIH1cblxuICBnZXRNZXRob2RPZlBheW1lbnRDYXJkQ29udGVudChcbiAgICBoYXNQYXltZW50SW5mbzogUGF5bWVudERldGFpbHMgfCB1bmRlZmluZWRcbiAgKTogT2JzZXJ2YWJsZTxDYXJkPiB7XG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoW1xuICAgICAgdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ29yZGVyRGV0YWlscy5tZXRob2RPZlBheW1lbnQnKSxcbiAgICAgIHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdwYXltZW50VHlwZXMucGF5bWVudFR5cGVfQUNDT1VOVCcpLFxuICAgICAgdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ3BheW1lbnRUeXBlcy5wYXltZW50VHlwZV9DQVJEJyksXG4gICAgXSkucGlwZShcbiAgICAgIGZpbHRlcigoKSA9PiBCb29sZWFuKGhhc1BheW1lbnRJbmZvKSksXG4gICAgICBtYXAoKFt0ZXh0VGl0bGUsIHRleHRBY2NvdW50LCB0ZXh0Q2FyZF0pID0+ICh7XG4gICAgICAgIHRpdGxlOiB0ZXh0VGl0bGUsXG4gICAgICAgIHRleHQ6IFtCb29sZWFuKGhhc1BheW1lbnRJbmZvKSA/IHRleHRDYXJkIDogdGV4dEFjY291bnRdLFxuICAgICAgfSkpXG4gICAgKTtcbiAgfVxuXG4gIGdldENvc3RDZW50ZXJDYXJkQ29udGVudChcbiAgICBjb3N0Q2VudGVyOiBDb3N0Q2VudGVyIHwgdW5kZWZpbmVkXG4gICk6IE9ic2VydmFibGU8Q2FyZD4ge1xuICAgIHJldHVybiB0aGlzLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgnb3JkZXJEZXRhaWxzLmNvc3RDZW50ZXInKS5waXBlKFxuICAgICAgZmlsdGVyKCgpID0+IEJvb2xlYW4oY29zdENlbnRlcikpLFxuICAgICAgbWFwKCh0ZXh0VGl0bGUpID0+ICh7XG4gICAgICAgIHRpdGxlOiB0ZXh0VGl0bGUsXG4gICAgICAgIHRleHRCb2xkOiBjb3N0Q2VudGVyPy5uYW1lLFxuICAgICAgICB0ZXh0OiBbYCgke2Nvc3RDZW50ZXI/LnVuaXQ/Lm5hbWV9KWBdLFxuICAgICAgfSkpXG4gICAgKTtcbiAgfVxuXG4gIGdldEFkZHJlc3NDYXJkQ29udGVudChcbiAgICBkZWxpdmVyeUFkZHJlc3M6IEFkZHJlc3MgfCB1bmRlZmluZWRcbiAgKTogT2JzZXJ2YWJsZTxDYXJkPiB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdhZGRyZXNzQ2FyZC5zaGlwVG8nKS5waXBlKFxuICAgICAgZmlsdGVyKCgpID0+IEJvb2xlYW4oZGVsaXZlcnlBZGRyZXNzKSksXG4gICAgICBtYXAoKHRleHRUaXRsZSkgPT4ge1xuICAgICAgICBjb25zdCBmb3JtYXR0ZWRBZGRyZXNzID0gdGhpcy5ub3JtYWxpemVGb3JtYXR0ZWRBZGRyZXNzKFxuICAgICAgICAgIGRlbGl2ZXJ5QWRkcmVzcz8uZm9ybWF0dGVkQWRkcmVzcyA/PyAnJ1xuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGl0bGU6IHRleHRUaXRsZSxcbiAgICAgICAgICB0ZXh0Qm9sZDogYCR7ZGVsaXZlcnlBZGRyZXNzPy5maXJzdE5hbWV9ICR7ZGVsaXZlcnlBZGRyZXNzPy5sYXN0TmFtZX1gLFxuICAgICAgICAgIHRleHQ6IFtmb3JtYXR0ZWRBZGRyZXNzLCBkZWxpdmVyeUFkZHJlc3M/LmNvdW50cnk/Lm5hbWVdLFxuICAgICAgICB9IGFzIENhcmQ7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBnZXREZWxpdmVyeU1vZGVDYXJkQ29udGVudChcbiAgICBkZWxpdmVyeU1vZGU6IERlbGl2ZXJ5TW9kZSB8IHVuZGVmaW5lZFxuICApOiBPYnNlcnZhYmxlPENhcmQ+IHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ29yZGVyRGV0YWlscy5zaGlwcGluZ01ldGhvZCcpLnBpcGUoXG4gICAgICBmaWx0ZXIoKCkgPT4gQm9vbGVhbihkZWxpdmVyeU1vZGUpKSxcbiAgICAgIG1hcChcbiAgICAgICAgKHRleHRUaXRsZSkgPT5cbiAgICAgICAgICAoe1xuICAgICAgICAgICAgdGl0bGU6IHRleHRUaXRsZSxcbiAgICAgICAgICAgIHRleHRCb2xkOiBkZWxpdmVyeU1vZGU/Lm5hbWUsXG4gICAgICAgICAgICB0ZXh0OiBbXG4gICAgICAgICAgICAgIGRlbGl2ZXJ5TW9kZT8uZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgIGRlbGl2ZXJ5TW9kZT8uZGVsaXZlcnlDb3N0Py5mb3JtYXR0ZWRWYWx1ZVxuICAgICAgICAgICAgICAgID8gZGVsaXZlcnlNb2RlLmRlbGl2ZXJ5Q29zdD8uZm9ybWF0dGVkVmFsdWVcbiAgICAgICAgICAgICAgICA6ICcnLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9IGFzIENhcmQpXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIGdldFBheW1lbnRJbmZvQ2FyZENvbnRlbnQoXG4gICAgcGF5bWVudDogUGF5bWVudERldGFpbHMgfCB1bmRlZmluZWRcbiAgKTogT2JzZXJ2YWJsZTxDYXJkPiB7XG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoW1xuICAgICAgdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ3BheW1lbnRGb3JtLnBheW1lbnQnKSxcbiAgICAgIHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdwYXltZW50Q2FyZC5leHBpcmVzJywge1xuICAgICAgICBtb250aDogcGF5bWVudCA/IHBheW1lbnQuZXhwaXJ5TW9udGggOiAnJyxcbiAgICAgICAgeWVhcjogcGF5bWVudCA/IHBheW1lbnQuZXhwaXJ5WWVhciA6ICcnLFxuICAgICAgfSksXG4gICAgXSkucGlwZShcbiAgICAgIGZpbHRlcigoKSA9PiBCb29sZWFuKHBheW1lbnQpKSxcbiAgICAgIG1hcChcbiAgICAgICAgKFt0ZXh0VGl0bGUsIHRleHRFeHBpcmVzXSkgPT5cbiAgICAgICAgICAoe1xuICAgICAgICAgICAgdGl0bGU6IHRleHRUaXRsZSxcbiAgICAgICAgICAgIHRleHRCb2xkOiBwYXltZW50Py5hY2NvdW50SG9sZGVyTmFtZSxcbiAgICAgICAgICAgIHRleHQ6IFtwYXltZW50Py5jYXJkTnVtYmVyLCB0ZXh0RXhwaXJlc10sXG4gICAgICAgICAgfSBhcyBDYXJkKVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBnZXRCaWxsaW5nQWRkcmVzc0NhcmRDb250ZW50KFxuICAgIGJpbGxpbmdBZGRyZXNzOiBBZGRyZXNzIHwgdW5kZWZpbmVkXG4gICk6IE9ic2VydmFibGU8Q2FyZD4ge1xuICAgIHJldHVybiB0aGlzLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgncGF5bWVudEZvcm0uYmlsbGluZ0FkZHJlc3MnKS5waXBlKFxuICAgICAgZmlsdGVyKCgpID0+IEJvb2xlYW4oYmlsbGluZ0FkZHJlc3MpKSxcbiAgICAgIG1hcChcbiAgICAgICAgKHRleHRUaXRsZSkgPT5cbiAgICAgICAgICAoe1xuICAgICAgICAgICAgdGl0bGU6IHRleHRUaXRsZSxcbiAgICAgICAgICAgIHRleHRCb2xkOiBgJHtiaWxsaW5nQWRkcmVzcz8uZmlyc3ROYW1lfSAke2JpbGxpbmdBZGRyZXNzPy5sYXN0TmFtZX1gLFxuICAgICAgICAgICAgdGV4dDogW1xuICAgICAgICAgICAgICBiaWxsaW5nQWRkcmVzcz8uZm9ybWF0dGVkQWRkcmVzcyxcbiAgICAgICAgICAgICAgYmlsbGluZ0FkZHJlc3M/LmNvdW50cnk/Lm5hbWUsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0gYXMgQ2FyZClcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgZ2V0QnV5ZXJOYW1lQ2FyZENvbnRlbnQoY3VzdG9tZXI6IEIyQlVzZXIgfCB1bmRlZmluZWQpOiBPYnNlcnZhYmxlPENhcmQ+IHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ3VuaXRMZXZlbE9yZGVyRGV0YWlscy5idXllcicpLnBpcGUoXG4gICAgICBmaWx0ZXIoKCkgPT4gQm9vbGVhbihjdXN0b21lcikpLFxuICAgICAgbWFwKFxuICAgICAgICAodGV4dFRpdGxlKSA9PlxuICAgICAgICAgICh7XG4gICAgICAgICAgICB0aXRsZTogdGV4dFRpdGxlLFxuICAgICAgICAgICAgdGV4dDogW2N1c3RvbWVyPy5uYW1lLCBgKCR7Y3VzdG9tZXI/LmVtYWlsfSlgXSxcbiAgICAgICAgICB9IGFzIENhcmQpXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIGdldFVuaXROYW1lQ2FyZENvbnRlbnQob3JnVW5pdDogc3RyaW5nIHwgdW5kZWZpbmVkKTogT2JzZXJ2YWJsZTxDYXJkPiB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNsYXRpb24udHJhbnNsYXRlKCdvcmRlckRldGFpbHMudW5pdCcpLnBpcGUoXG4gICAgICBmaWx0ZXIoKCkgPT4gQm9vbGVhbihvcmdVbml0KSksXG4gICAgICBtYXAoXG4gICAgICAgICh0ZXh0VGl0bGUpID0+XG4gICAgICAgICAgKHtcbiAgICAgICAgICAgIHRpdGxlOiB0ZXh0VGl0bGUsXG4gICAgICAgICAgICB0ZXh0OiBbb3JnVW5pdF0sXG4gICAgICAgICAgfSBhcyBDYXJkKVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIG5vcm1hbGl6ZUZvcm1hdHRlZEFkZHJlc3MoZm9ybWF0dGVkQWRkcmVzczogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBhZGRyZXNzZXMgPSBmb3JtYXR0ZWRBZGRyZXNzXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcCgoYWRkcmVzcykgPT4gYWRkcmVzcy50cmltKCkpO1xuXG4gICAgcmV0dXJuIGFkZHJlc3Nlcy5maWx0ZXIoQm9vbGVhbikuam9pbignLCAnKTtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImN4LW9yZGVyLXN1bW1hcnlcIiAqbmdJZj1cIm9yZGVyJCB8IGFzeW5jIGFzIG9yZGVyXCI+XG4gIDxkaXYgY2xhc3M9XCJjb250YWluZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY3gtc3VtbWFyeS1jYXJkXCI+XG4gICAgICA8Y3gtY2FyZFxuICAgICAgICBbY29udGVudF09XCJnZXRPcmRlckNvZGVDYXJkQ29udGVudChvcmRlci5jb2RlKSB8IGFzeW5jXCJcbiAgICAgID48L2N4LWNhcmQ+XG5cbiAgICAgIDxjeC1jYXJkXG4gICAgICAgIFtjb250ZW50XT1cIlxuICAgICAgICAgIGdldE9yZGVyQ3VycmVudERhdGVDYXJkQ29udGVudChvcmRlci5jcmVhdGVkIHwgY3hEYXRlKSB8IGFzeW5jXG4gICAgICAgIFwiXG4gICAgICA+PC9jeC1jYXJkPlxuXG4gICAgICA8Y3gtY2FyZFxuICAgICAgICBbY29udGVudF09XCJnZXRPcmRlclN0YXR1c0NhcmRDb250ZW50KG9yZGVyLnN0YXR1c0Rpc3BsYXkpIHwgYXN5bmNcIlxuICAgICAgPjwvY3gtY2FyZD5cblxuICAgICAgPGN4LWNhcmRcbiAgICAgICAgY2xhc3M9XCJjeC1kaXNwbGF5LWlubGluZVwiXG4gICAgICAgIFtjb250ZW50XT1cImdldEJ1eWVyTmFtZUNhcmRDb250ZW50KG9yZGVyLm9yZ0N1c3RvbWVyKSB8IGFzeW5jXCJcbiAgICAgID48L2N4LWNhcmQ+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImN4LXN1bW1hcnktY2FyZFwiPlxuICAgICAgPGN4LWNhcmRcbiAgICAgICAgW2NvbnRlbnRdPVwiZ2V0VW5pdE5hbWVDYXJkQ29udGVudChvcmRlci5vcmdVbml0Py5uYW1lKSB8IGFzeW5jXCJcbiAgICAgID48L2N4LWNhcmQ+XG5cbiAgICAgIDxjeC1jYXJkXG4gICAgICAgIFtjb250ZW50XT1cImdldFB1cmNoYXNlT3JkZXJOdW1iZXIob3JkZXIucHVyY2hhc2VPcmRlck51bWJlcikgfCBhc3luY1wiXG4gICAgICA+PC9jeC1jYXJkPlxuXG4gICAgICA8Y3gtY2FyZFxuICAgICAgICBbY29udGVudF09XCJnZXRNZXRob2RPZlBheW1lbnRDYXJkQ29udGVudChvcmRlci5wYXltZW50SW5mbykgfCBhc3luY1wiXG4gICAgICA+PC9jeC1jYXJkPlxuXG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwib3JkZXIuY29zdENlbnRlclwiPlxuICAgICAgICA8Y3gtY2FyZFxuICAgICAgICAgIFtjb250ZW50XT1cImdldENvc3RDZW50ZXJDYXJkQ29udGVudChvcmRlci5jb3N0Q2VudGVyKSB8IGFzeW5jXCJcbiAgICAgICAgPjwvY3gtY2FyZD5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvZGl2PlxuXG4gICAgPGRpdiBjbGFzcz1cImN4LXN1bW1hcnktY2FyZFwiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIm9yZGVyLmRlbGl2ZXJ5QWRkcmVzc1wiPlxuICAgICAgICA8Y3gtY2FyZFxuICAgICAgICAgIFtjb250ZW50XT1cImdldEFkZHJlc3NDYXJkQ29udGVudChvcmRlci5kZWxpdmVyeUFkZHJlc3MpIHwgYXN5bmNcIlxuICAgICAgICA+PC9jeC1jYXJkPlxuICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJvcmRlci5kZWxpdmVyeU1vZGVcIj5cbiAgICAgICAgPGN4LWNhcmRcbiAgICAgICAgICBbY29udGVudF09XCJnZXREZWxpdmVyeU1vZGVDYXJkQ29udGVudChvcmRlci5kZWxpdmVyeU1vZGUpIHwgYXN5bmNcIlxuICAgICAgICA+PC9jeC1jYXJkPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9kaXY+XG5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwib3JkZXIucGF5bWVudEluZm9cIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjeC1zdW1tYXJ5LWNhcmRcIj5cbiAgICAgICAgPGN4LWNhcmRcbiAgICAgICAgICBbY29udGVudF09XCJnZXRQYXltZW50SW5mb0NhcmRDb250ZW50KG9yZGVyLnBheW1lbnRJbmZvKSB8IGFzeW5jXCJcbiAgICAgICAgPjwvY3gtY2FyZD5cblxuICAgICAgICA8Y3gtY2FyZFxuICAgICAgICAgIFtjb250ZW50XT1cIlxuICAgICAgICAgICAgZ2V0QmlsbGluZ0FkZHJlc3NDYXJkQ29udGVudChvcmRlci5wYXltZW50SW5mbz8uYmlsbGluZ0FkZHJlc3MpXG4gICAgICAgICAgICAgIHwgYXN5bmNcbiAgICAgICAgICBcIlxuICAgICAgICA+PC9jeC1jYXJkPlxuICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=