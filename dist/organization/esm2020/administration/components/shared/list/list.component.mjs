/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, HostBinding, Input, } from '@angular/core';
import { ICON_TYPE, TrapFocus, } from '@spartacus/storefront';
import { tap } from 'rxjs/operators';
import { CreateButtonType } from './list.service';
import * as i0 from "@angular/core";
import * as i1 from "./list.service";
import * as i2 from "../item.service";
import * as i3 from "@angular/common";
import * as i4 from "@angular/router";
import * as i5 from "@spartacus/storefront";
import * as i6 from "@ng-select/ng-select";
import * as i7 from "@angular/forms";
import * as i8 from "@spartacus/core";
export class ListComponent {
    constructor(service, organizationItemService) {
        this.service = service;
        this.organizationItemService = organizationItemService;
        this.trapFocus = TrapFocus;
        this.hasGhostData = false;
        this.viewType = this.service.viewType;
        this.domainType = this.service.domainType;
        this.iconTypes = ICON_TYPE;
        this.createButtonAllTypes = CreateButtonType;
        this.createButtonType = this.service.getCreateButtonType();
        /**
         * The current key represents the current selected item from the dataset.
         * This key is used to load the item details as well as highlight the item in
         * a list of items.
         */
        this.currentKey$ = this.organizationItemService.key$;
        this.structure$ = this.service.getStructure();
        this.listData$ = this.service
            .getData()
            .pipe(tap((data) => {
            this.sortCode = data?.pagination?.sort;
            this.hasGhostData = this.service.hasGhostData(data);
        }));
        this.key = this.service.key();
        this.hideAddButton = false;
    }
    /**
     * Returns the total number of items.
     */
    getListCount(dataTable) {
        return dataTable.pagination?.totalResults;
    }
    /**
     * Browses to the given page number
     */
    browse(pagination, pageNumber) {
        if (pagination) {
            this.service.view(pagination, pageNumber);
        }
    }
    /**
     * Navigates to the detailed view of the selected list item.
     */
    launchItem(event) {
        this.organizationItemService.launchDetails(event);
    }
    /**
     * Sorts the list.
     */
    sort(pagination) {
        if (pagination) {
            this.service.sort({
                ...pagination,
                ...{ sort: this.sortCode },
            });
        }
    }
    /**
     * Function to call when 'Manage Users' button is clicked
     */
    onCreateButtonClick() {
        this.service.onCreateButtonClick();
    }
    /**
     * Returns the label for Create button
     */
    getCreateButtonLabel() {
        return this.service.getCreateButtonLabel();
    }
}
ListComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ListComponent, deps: [{ token: i1.ListService }, { token: i2.ItemService }], target: i0.ɵɵFactoryTarget.Component });
ListComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: ListComponent, selector: "cx-org-list", inputs: { key: "key", hideAddButton: "hideAddButton" }, host: { properties: { "class.ghost": "this.hasGhostData", "class": "this.viewType" } }, ngImport: i0, template: "<cx-split-view [hideMode]=\"false\">\n  <ng-container *ngIf=\"structure$ | async as structure\">\n    <cx-view class=\"list\" *ngIf=\"listData$ | async as data\">\n      <div class=\"header\">\n        <div class=\"title\">\n          <h3>\n            {{\n              viewType + '.header' | cxTranslate: { count: getListCount(data) }\n            }}\n            <button\n              [cxPopover]=\"listHint\"\n              [cxPopoverOptions]=\"{\n                placement: 'auto',\n                class: 'hint-popover',\n                appendToBody: true,\n                displayCloseButton: true\n              }\"\n              [attr.aria-label]=\"'organization.information' | cxTranslate\"\n            >\n              <cx-icon [type]=\"iconTypes.INFO\"> </cx-icon>\n            </button>\n          </h3>\n        </div>\n\n        <div class=\"actions\">\n          <label>\n            <span *ngIf=\"data.pagination?.sort\">{{\n              structure.type + '.sortBy' | cxTranslate\n            }}</span>\n            <ng-select\n              name=\"sort\"\n              class=\"sort\"\n              *ngIf=\"data.pagination?.sort\"\n              [searchable]=\"false\"\n              [clearable]=\"false\"\n              (change)=\"sort($any(data.pagination))\"\n              [tabIndex]=\"0\"\n              [(ngModel)]=\"sortCode\"\n              [attr.aria-label]=\"\n                (sortCode\n                  ? structure.type + '.sort.' + sortCode\n                  : structure.type + '.sortBy'\n                ) | cxTranslate\n              \"\n            >\n              <ng-option *ngFor=\"let sort of data.sorts\" [value]=\"sort.code\">\n                {{ structure.type + '.sort.' + sort.code | cxTranslate }}\n              </ng-option>\n            </ng-select>\n          </label>\n\n          <ng-content select=\"[actions]\"></ng-content>\n\n          <ng-container\n            *ngIf=\"\n              createButtonType === createButtonAllTypes.LINK;\n              else showButton\n            \"\n          >\n            <a\n              *ngIf=\"!hideAddButton\"\n              class=\"button primary create\"\n              [routerLink]=\"{ cxRoute: structure.type + 'Create' } | cxUrl\"\n              routerLinkActive=\"disabled\"\n            >\n              {{ getCreateButtonLabel() | cxTranslate }}\n            </a>\n          </ng-container>\n        </div>\n      </div>\n\n      <cx-table\n        *ngIf=\"data.values && data.values.length > 0; else emptyList\"\n        [structure]=\"structure\"\n        [data]=\"data.values\"\n        [i18nRoot]=\"domainType\"\n        [currentItem]=\"{ property: key, value: currentKey$ | async }\"\n        (launch)=\"launchItem($event)\"\n        [cxFocus]=\"{ trap: trapFocus.both }\"\n      >\n      </cx-table>\n\n      <div class=\"footer\">\n        <cx-pagination\n          [pagination]=\"data.pagination\"\n          (viewPageEvent)=\"browse($any(data.pagination), $event)\"\n        ></cx-pagination>\n      </div>\n    </cx-view>\n\n    <!-- nested split views are rendered inside child routes -->\n    <router-outlet></router-outlet>\n  </ng-container>\n</cx-split-view>\n\n<ng-template #emptyList>\n  <p class=\"instruction is-empty\">\n    {{ 'organization.messages.emptyList' | cxTranslate }}\n  </p>\n</ng-template>\n\n<ng-template #listHint>\n  <p>\n    {{ viewType + '.hint' | cxTranslate }}\n  </p>\n</ng-template>\n\n<ng-template #showButton>\n  <button\n    *ngIf=\"!hideAddButton\"\n    class=\"button primary create\"\n    (click)=\"onCreateButtonClick()\"\n  >\n    {{ getCreateButtonLabel() | cxTranslate }}\n  </button>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.RouterOutlet, selector: "router-outlet", inputs: ["name"], outputs: ["activate", "deactivate", "attach", "detach"], exportAs: ["outlet"] }, { kind: "directive", type: i4.RouterLink, selector: "[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "directive", type: i4.RouterLinkActive, selector: "[routerLinkActive]", inputs: ["routerLinkActiveOptions", "ariaCurrentWhenActive", "routerLinkActive"], outputs: ["isActiveChange"], exportAs: ["routerLinkActive"] }, { kind: "component", type: i5.SplitViewComponent, selector: "cx-split-view", inputs: ["hideMode"] }, { kind: "component", type: i5.ViewComponent, selector: "cx-view", inputs: ["position", "hidden"], outputs: ["hiddenChange"] }, { kind: "component", type: i5.TableComponent, selector: "cx-table", inputs: ["structure", "data", "i18nRoot", "currentItem"], outputs: ["launch"] }, { kind: "component", type: i5.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "component", type: i5.PaginationComponent, selector: "cx-pagination", inputs: ["pageRoute", "queryParam", "defaultPage", "pagination"], outputs: ["viewPageEvent"] }, { kind: "component", type: i6.NgSelectComponent, selector: "ng-select", inputs: ["bindLabel", "bindValue", "markFirst", "placeholder", "notFoundText", "typeToSearchText", "addTagText", "loadingText", "clearAllText", "appearance", "dropdownPosition", "appendTo", "loading", "closeOnSelect", "hideSelected", "selectOnTab", "openOnEnter", "maxSelectedItems", "groupBy", "groupValue", "bufferAmount", "virtualScroll", "selectableGroup", "selectableGroupAsModel", "searchFn", "trackByFn", "clearOnBackspace", "labelForId", "inputAttrs", "tabIndex", "readonly", "searchWhileComposing", "minTermLength", "editableSearchTerm", "keyDownFn", "typeahead", "multiple", "addTag", "searchable", "clearable", "isOpen", "items", "compareWith", "clearSearchOnAdd"], outputs: ["blur", "focus", "change", "open", "close", "search", "clear", "add", "remove", "scroll", "scrollToEnd"] }, { kind: "component", type: i6.NgOptionComponent, selector: "ng-option", inputs: ["value", "disabled"] }, { kind: "directive", type: i7.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i7.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "directive", type: i5.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "directive", type: i5.PopoverDirective, selector: "[cxPopover]", inputs: ["cxPopover", "cxPopoverOptions"], outputs: ["openPopover", "closePopover"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i8.UrlPipe, name: "cxUrl" }, { kind: "pipe", type: i8.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: ListComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-org-list', changeDetection: ChangeDetectionStrategy.OnPush, template: "<cx-split-view [hideMode]=\"false\">\n  <ng-container *ngIf=\"structure$ | async as structure\">\n    <cx-view class=\"list\" *ngIf=\"listData$ | async as data\">\n      <div class=\"header\">\n        <div class=\"title\">\n          <h3>\n            {{\n              viewType + '.header' | cxTranslate: { count: getListCount(data) }\n            }}\n            <button\n              [cxPopover]=\"listHint\"\n              [cxPopoverOptions]=\"{\n                placement: 'auto',\n                class: 'hint-popover',\n                appendToBody: true,\n                displayCloseButton: true\n              }\"\n              [attr.aria-label]=\"'organization.information' | cxTranslate\"\n            >\n              <cx-icon [type]=\"iconTypes.INFO\"> </cx-icon>\n            </button>\n          </h3>\n        </div>\n\n        <div class=\"actions\">\n          <label>\n            <span *ngIf=\"data.pagination?.sort\">{{\n              structure.type + '.sortBy' | cxTranslate\n            }}</span>\n            <ng-select\n              name=\"sort\"\n              class=\"sort\"\n              *ngIf=\"data.pagination?.sort\"\n              [searchable]=\"false\"\n              [clearable]=\"false\"\n              (change)=\"sort($any(data.pagination))\"\n              [tabIndex]=\"0\"\n              [(ngModel)]=\"sortCode\"\n              [attr.aria-label]=\"\n                (sortCode\n                  ? structure.type + '.sort.' + sortCode\n                  : structure.type + '.sortBy'\n                ) | cxTranslate\n              \"\n            >\n              <ng-option *ngFor=\"let sort of data.sorts\" [value]=\"sort.code\">\n                {{ structure.type + '.sort.' + sort.code | cxTranslate }}\n              </ng-option>\n            </ng-select>\n          </label>\n\n          <ng-content select=\"[actions]\"></ng-content>\n\n          <ng-container\n            *ngIf=\"\n              createButtonType === createButtonAllTypes.LINK;\n              else showButton\n            \"\n          >\n            <a\n              *ngIf=\"!hideAddButton\"\n              class=\"button primary create\"\n              [routerLink]=\"{ cxRoute: structure.type + 'Create' } | cxUrl\"\n              routerLinkActive=\"disabled\"\n            >\n              {{ getCreateButtonLabel() | cxTranslate }}\n            </a>\n          </ng-container>\n        </div>\n      </div>\n\n      <cx-table\n        *ngIf=\"data.values && data.values.length > 0; else emptyList\"\n        [structure]=\"structure\"\n        [data]=\"data.values\"\n        [i18nRoot]=\"domainType\"\n        [currentItem]=\"{ property: key, value: currentKey$ | async }\"\n        (launch)=\"launchItem($event)\"\n        [cxFocus]=\"{ trap: trapFocus.both }\"\n      >\n      </cx-table>\n\n      <div class=\"footer\">\n        <cx-pagination\n          [pagination]=\"data.pagination\"\n          (viewPageEvent)=\"browse($any(data.pagination), $event)\"\n        ></cx-pagination>\n      </div>\n    </cx-view>\n\n    <!-- nested split views are rendered inside child routes -->\n    <router-outlet></router-outlet>\n  </ng-container>\n</cx-split-view>\n\n<ng-template #emptyList>\n  <p class=\"instruction is-empty\">\n    {{ 'organization.messages.emptyList' | cxTranslate }}\n  </p>\n</ng-template>\n\n<ng-template #listHint>\n  <p>\n    {{ viewType + '.hint' | cxTranslate }}\n  </p>\n</ng-template>\n\n<ng-template #showButton>\n  <button\n    *ngIf=\"!hideAddButton\"\n    class=\"button primary create\"\n    (click)=\"onCreateButtonClick()\"\n  >\n    {{ getCreateButtonLabel() | cxTranslate }}\n  </button>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ListService }, { type: i2.ItemService }]; }, propDecorators: { hasGhostData: [{
                type: HostBinding,
                args: ['class.ghost']
            }], viewType: [{
                type: HostBinding,
                args: ['class']
            }], key: [{
                type: Input
            }], hideAddButton: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JnYW5pemF0aW9uL2FkbWluaXN0cmF0aW9uL2NvbXBvbmVudHMvc2hhcmVkL2xpc3QvbGlzdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JnYW5pemF0aW9uL2FkbWluaXN0cmF0aW9uL2NvbXBvbmVudHMvc2hhcmVkL2xpc3QvbGlzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsV0FBVyxFQUNYLEtBQUssR0FDTixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQ0wsU0FBUyxFQUdULFNBQVMsR0FDVixNQUFNLHVCQUF1QixDQUFDO0FBRS9CLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUdyQyxPQUFPLEVBQWUsZ0JBQWdCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7OztBQU8vRCxNQUFNLE9BQU8sYUFBYTtJQUt4QixZQUNZLE9BQTBCLEVBQzFCLHVCQUF1QztRQUR2QyxZQUFPLEdBQVAsT0FBTyxDQUFtQjtRQUMxQiw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQWdCO1FBTjFDLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFFSCxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQVFqRCxhQUFRLEdBQTBCLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBRXhELGVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztRQUlyQyxjQUFTLEdBQUcsU0FBUyxDQUFDO1FBRXRCLHlCQUFvQixHQUFHLGdCQUFnQixDQUFDO1FBRXhDLHFCQUFnQixHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUV0RDs7OztXQUlHO1FBQ00sZ0JBQVcsR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDO1FBRWhELGVBQVUsR0FBK0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUVyRSxjQUFTLEdBQTZDLElBQUksQ0FBQyxPQUFPO2FBQ3hFLE9BQU8sRUFBRTthQUNULElBQUksQ0FDSCxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNYLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUM7WUFDdkMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0RCxDQUFDLENBQUMsQ0FDSCxDQUFDO1FBRUssUUFBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFekIsa0JBQWEsR0FBRyxLQUFLLENBQUM7SUFuQzVCLENBQUM7SUFxQ0o7O09BRUc7SUFDSCxZQUFZLENBQUMsU0FBbUM7UUFDOUMsT0FBTyxTQUFTLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQztJQUM1QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsVUFBeUIsRUFBRSxVQUFrQjtRQUNsRCxJQUFJLFVBQVUsRUFBRTtZQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztTQUMzQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILFVBQVUsQ0FBQyxLQUFRO1FBQ2pCLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxDQUFDLFVBQXlCO1FBQzVCLElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7Z0JBQ2hCLEdBQUcsVUFBVTtnQkFDYixHQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQXNCO2FBQ2hELENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsbUJBQW1CO1FBQ2pCLElBQUksQ0FBQyxPQUFPLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxvQkFBb0I7UUFDbEIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLENBQUM7SUFDN0MsQ0FBQzs7MEdBNUZVLGFBQWE7OEZBQWIsYUFBYSxtTUM5QjFCLGlsSEFvSEE7MkZEdEZhLGFBQWE7a0JBTHpCLFNBQVM7K0JBQ0UsYUFBYSxtQkFFTix1QkFBdUIsQ0FBQyxNQUFNOzRIQUtuQixZQUFZO3NCQUF2QyxXQUFXO3VCQUFDLGFBQWE7Z0JBUTFCLFFBQVE7c0JBRFAsV0FBVzt1QkFBQyxPQUFPO2dCQStCWCxHQUFHO3NCQUFYLEtBQUs7Z0JBRUcsYUFBYTtzQkFBckIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBFbnRpdGllc01vZGVsLCBQYWdpbmF0aW9uTW9kZWwsIFRyYW5zbGF0YWJsZSB9IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQge1xuICBJQ09OX1RZUEUsXG4gIFRhYmxlLFxuICBUYWJsZVN0cnVjdHVyZSxcbiAgVHJhcEZvY3VzLFxufSBmcm9tICdAc3BhcnRhY3VzL3N0b3JlZnJvbnQnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSXRlbVNlcnZpY2UgfSBmcm9tICcuLi9pdGVtLnNlcnZpY2UnO1xuaW1wb3J0IHsgT3JnYW5pemF0aW9uVGFibGVUeXBlIH0gZnJvbSAnLi4vb3JnYW5pemF0aW9uLm1vZGVsJztcbmltcG9ydCB7IExpc3RTZXJ2aWNlLCBDcmVhdGVCdXR0b25UeXBlIH0gZnJvbSAnLi9saXN0LnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1vcmctbGlzdCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIExpc3RDb21wb25lbnQ8VCA9IGFueSwgUCA9IFBhZ2luYXRpb25Nb2RlbD4ge1xuICByZWFkb25seSB0cmFwRm9jdXMgPSBUcmFwRm9jdXM7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5naG9zdCcpIGhhc0dob3N0RGF0YSA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBzZXJ2aWNlOiBMaXN0U2VydmljZTxULCBQPixcbiAgICBwcm90ZWN0ZWQgb3JnYW5pemF0aW9uSXRlbVNlcnZpY2U6IEl0ZW1TZXJ2aWNlPFQ+XG4gICkge31cblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcbiAgdmlld1R5cGU6IE9yZ2FuaXphdGlvblRhYmxlVHlwZSA9IHRoaXMuc2VydmljZS52aWV3VHlwZTtcblxuICBkb21haW5UeXBlID0gdGhpcy5zZXJ2aWNlLmRvbWFpblR5cGU7XG5cbiAgc29ydENvZGU6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICBpY29uVHlwZXMgPSBJQ09OX1RZUEU7XG5cbiAgY3JlYXRlQnV0dG9uQWxsVHlwZXMgPSBDcmVhdGVCdXR0b25UeXBlO1xuXG4gIGNyZWF0ZUJ1dHRvblR5cGUgPSB0aGlzLnNlcnZpY2UuZ2V0Q3JlYXRlQnV0dG9uVHlwZSgpO1xuXG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBrZXkgcmVwcmVzZW50cyB0aGUgY3VycmVudCBzZWxlY3RlZCBpdGVtIGZyb20gdGhlIGRhdGFzZXQuXG4gICAqIFRoaXMga2V5IGlzIHVzZWQgdG8gbG9hZCB0aGUgaXRlbSBkZXRhaWxzIGFzIHdlbGwgYXMgaGlnaGxpZ2h0IHRoZSBpdGVtIGluXG4gICAqIGEgbGlzdCBvZiBpdGVtcy5cbiAgICovXG4gIHJlYWRvbmx5IGN1cnJlbnRLZXkkID0gdGhpcy5vcmdhbml6YXRpb25JdGVtU2VydmljZS5rZXkkO1xuXG4gIHJlYWRvbmx5IHN0cnVjdHVyZSQ6IE9ic2VydmFibGU8VGFibGVTdHJ1Y3R1cmU+ID0gdGhpcy5zZXJ2aWNlLmdldFN0cnVjdHVyZSgpO1xuXG4gIHJlYWRvbmx5IGxpc3REYXRhJDogT2JzZXJ2YWJsZTxFbnRpdGllc01vZGVsPFQ+IHwgdW5kZWZpbmVkPiA9IHRoaXMuc2VydmljZVxuICAgIC5nZXREYXRhKClcbiAgICAucGlwZShcbiAgICAgIHRhcCgoZGF0YSkgPT4ge1xuICAgICAgICB0aGlzLnNvcnRDb2RlID0gZGF0YT8ucGFnaW5hdGlvbj8uc29ydDtcbiAgICAgICAgdGhpcy5oYXNHaG9zdERhdGEgPSB0aGlzLnNlcnZpY2UuaGFzR2hvc3REYXRhKGRhdGEpO1xuICAgICAgfSlcbiAgICApO1xuXG4gIEBJbnB1dCgpIGtleSA9IHRoaXMuc2VydmljZS5rZXkoKTtcblxuICBASW5wdXQoKSBoaWRlQWRkQnV0dG9uID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBpdGVtcy5cbiAgICovXG4gIGdldExpc3RDb3VudChkYXRhVGFibGU6IFRhYmxlIHwgRW50aXRpZXNNb2RlbDxUPik6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIGRhdGFUYWJsZS5wYWdpbmF0aW9uPy50b3RhbFJlc3VsdHM7XG4gIH1cblxuICAvKipcbiAgICogQnJvd3NlcyB0byB0aGUgZ2l2ZW4gcGFnZSBudW1iZXJcbiAgICovXG4gIGJyb3dzZShwYWdpbmF0aW9uOiBQIHwgdW5kZWZpbmVkLCBwYWdlTnVtYmVyOiBudW1iZXIpIHtcbiAgICBpZiAocGFnaW5hdGlvbikge1xuICAgICAgdGhpcy5zZXJ2aWNlLnZpZXcocGFnaW5hdGlvbiwgcGFnZU51bWJlcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE5hdmlnYXRlcyB0byB0aGUgZGV0YWlsZWQgdmlldyBvZiB0aGUgc2VsZWN0ZWQgbGlzdCBpdGVtLlxuICAgKi9cbiAgbGF1bmNoSXRlbShldmVudDogVCk6IHZvaWQge1xuICAgIHRoaXMub3JnYW5pemF0aW9uSXRlbVNlcnZpY2UubGF1bmNoRGV0YWlscyhldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogU29ydHMgdGhlIGxpc3QuXG4gICAqL1xuICBzb3J0KHBhZ2luYXRpb246IFAgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICBpZiAocGFnaW5hdGlvbikge1xuICAgICAgdGhpcy5zZXJ2aWNlLnNvcnQoe1xuICAgICAgICAuLi5wYWdpbmF0aW9uLFxuICAgICAgICAuLi4oeyBzb3J0OiB0aGlzLnNvcnRDb2RlIH0gYXMgUGFnaW5hdGlvbk1vZGVsKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBjYWxsIHdoZW4gJ01hbmFnZSBVc2VycycgYnV0dG9uIGlzIGNsaWNrZWRcbiAgICovXG4gIG9uQ3JlYXRlQnV0dG9uQ2xpY2soKTogdm9pZCB7XG4gICAgdGhpcy5zZXJ2aWNlLm9uQ3JlYXRlQnV0dG9uQ2xpY2soKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBsYWJlbCBmb3IgQ3JlYXRlIGJ1dHRvblxuICAgKi9cbiAgZ2V0Q3JlYXRlQnV0dG9uTGFiZWwoKTogVHJhbnNsYXRhYmxlIHtcbiAgICByZXR1cm4gdGhpcy5zZXJ2aWNlLmdldENyZWF0ZUJ1dHRvbkxhYmVsKCk7XG4gIH1cbn1cbiIsIjxjeC1zcGxpdC12aWV3IFtoaWRlTW9kZV09XCJmYWxzZVwiPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwic3RydWN0dXJlJCB8IGFzeW5jIGFzIHN0cnVjdHVyZVwiPlxuICAgIDxjeC12aWV3IGNsYXNzPVwibGlzdFwiICpuZ0lmPVwibGlzdERhdGEkIHwgYXN5bmMgYXMgZGF0YVwiPlxuICAgICAgPGRpdiBjbGFzcz1cImhlYWRlclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwidGl0bGVcIj5cbiAgICAgICAgICA8aDM+XG4gICAgICAgICAgICB7e1xuICAgICAgICAgICAgICB2aWV3VHlwZSArICcuaGVhZGVyJyB8IGN4VHJhbnNsYXRlOiB7IGNvdW50OiBnZXRMaXN0Q291bnQoZGF0YSkgfVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgW2N4UG9wb3Zlcl09XCJsaXN0SGludFwiXG4gICAgICAgICAgICAgIFtjeFBvcG92ZXJPcHRpb25zXT1cIntcbiAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICBjbGFzczogJ2hpbnQtcG9wb3ZlcicsXG4gICAgICAgICAgICAgICAgYXBwZW5kVG9Cb2R5OiB0cnVlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlDbG9zZUJ1dHRvbjogdHJ1ZVxuICAgICAgICAgICAgICB9XCJcbiAgICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCInb3JnYW5pemF0aW9uLmluZm9ybWF0aW9uJyB8IGN4VHJhbnNsYXRlXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGN4LWljb24gW3R5cGVdPVwiaWNvblR5cGVzLklORk9cIj4gPC9jeC1pY29uPlxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPC9oMz5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cImFjdGlvbnNcIj5cbiAgICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8c3BhbiAqbmdJZj1cImRhdGEucGFnaW5hdGlvbj8uc29ydFwiPnt7XG4gICAgICAgICAgICAgIHN0cnVjdHVyZS50eXBlICsgJy5zb3J0QnknIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgIH19PC9zcGFuPlxuICAgICAgICAgICAgPG5nLXNlbGVjdFxuICAgICAgICAgICAgICBuYW1lPVwic29ydFwiXG4gICAgICAgICAgICAgIGNsYXNzPVwic29ydFwiXG4gICAgICAgICAgICAgICpuZ0lmPVwiZGF0YS5wYWdpbmF0aW9uPy5zb3J0XCJcbiAgICAgICAgICAgICAgW3NlYXJjaGFibGVdPVwiZmFsc2VcIlxuICAgICAgICAgICAgICBbY2xlYXJhYmxlXT1cImZhbHNlXCJcbiAgICAgICAgICAgICAgKGNoYW5nZSk9XCJzb3J0KCRhbnkoZGF0YS5wYWdpbmF0aW9uKSlcIlxuICAgICAgICAgICAgICBbdGFiSW5kZXhdPVwiMFwiXG4gICAgICAgICAgICAgIFsobmdNb2RlbCldPVwic29ydENvZGVcIlxuICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgICAgIChzb3J0Q29kZVxuICAgICAgICAgICAgICAgICAgPyBzdHJ1Y3R1cmUudHlwZSArICcuc29ydC4nICsgc29ydENvZGVcbiAgICAgICAgICAgICAgICAgIDogc3RydWN0dXJlLnR5cGUgKyAnLnNvcnRCeSdcbiAgICAgICAgICAgICAgICApIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPG5nLW9wdGlvbiAqbmdGb3I9XCJsZXQgc29ydCBvZiBkYXRhLnNvcnRzXCIgW3ZhbHVlXT1cInNvcnQuY29kZVwiPlxuICAgICAgICAgICAgICAgIHt7IHN0cnVjdHVyZS50eXBlICsgJy5zb3J0LicgKyBzb3J0LmNvZGUgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgICA8L25nLW9wdGlvbj5cbiAgICAgICAgICAgIDwvbmctc2VsZWN0PlxuICAgICAgICAgIDwvbGFiZWw+XG5cbiAgICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJbYWN0aW9uc11cIj48L25nLWNvbnRlbnQ+XG5cbiAgICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICAqbmdJZj1cIlxuICAgICAgICAgICAgICBjcmVhdGVCdXR0b25UeXBlID09PSBjcmVhdGVCdXR0b25BbGxUeXBlcy5MSU5LO1xuICAgICAgICAgICAgICBlbHNlIHNob3dCdXR0b25cbiAgICAgICAgICAgIFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPGFcbiAgICAgICAgICAgICAgKm5nSWY9XCIhaGlkZUFkZEJ1dHRvblwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiYnV0dG9uIHByaW1hcnkgY3JlYXRlXCJcbiAgICAgICAgICAgICAgW3JvdXRlckxpbmtdPVwieyBjeFJvdXRlOiBzdHJ1Y3R1cmUudHlwZSArICdDcmVhdGUnIH0gfCBjeFVybFwiXG4gICAgICAgICAgICAgIHJvdXRlckxpbmtBY3RpdmU9XCJkaXNhYmxlZFwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHt7IGdldENyZWF0ZUJ1dHRvbkxhYmVsKCkgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICAgICAgPC9hPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8Y3gtdGFibGVcbiAgICAgICAgKm5nSWY9XCJkYXRhLnZhbHVlcyAmJiBkYXRhLnZhbHVlcy5sZW5ndGggPiAwOyBlbHNlIGVtcHR5TGlzdFwiXG4gICAgICAgIFtzdHJ1Y3R1cmVdPVwic3RydWN0dXJlXCJcbiAgICAgICAgW2RhdGFdPVwiZGF0YS52YWx1ZXNcIlxuICAgICAgICBbaTE4blJvb3RdPVwiZG9tYWluVHlwZVwiXG4gICAgICAgIFtjdXJyZW50SXRlbV09XCJ7IHByb3BlcnR5OiBrZXksIHZhbHVlOiBjdXJyZW50S2V5JCB8IGFzeW5jIH1cIlxuICAgICAgICAobGF1bmNoKT1cImxhdW5jaEl0ZW0oJGV2ZW50KVwiXG4gICAgICAgIFtjeEZvY3VzXT1cInsgdHJhcDogdHJhcEZvY3VzLmJvdGggfVwiXG4gICAgICA+XG4gICAgICA8L2N4LXRhYmxlPlxuXG4gICAgICA8ZGl2IGNsYXNzPVwiZm9vdGVyXCI+XG4gICAgICAgIDxjeC1wYWdpbmF0aW9uXG4gICAgICAgICAgW3BhZ2luYXRpb25dPVwiZGF0YS5wYWdpbmF0aW9uXCJcbiAgICAgICAgICAodmlld1BhZ2VFdmVudCk9XCJicm93c2UoJGFueShkYXRhLnBhZ2luYXRpb24pLCAkZXZlbnQpXCJcbiAgICAgICAgPjwvY3gtcGFnaW5hdGlvbj5cbiAgICAgIDwvZGl2PlxuICAgIDwvY3gtdmlldz5cblxuICAgIDwhLS0gbmVzdGVkIHNwbGl0IHZpZXdzIGFyZSByZW5kZXJlZCBpbnNpZGUgY2hpbGQgcm91dGVzIC0tPlxuICAgIDxyb3V0ZXItb3V0bGV0Pjwvcm91dGVyLW91dGxldD5cbiAgPC9uZy1jb250YWluZXI+XG48L2N4LXNwbGl0LXZpZXc+XG5cbjxuZy10ZW1wbGF0ZSAjZW1wdHlMaXN0PlxuICA8cCBjbGFzcz1cImluc3RydWN0aW9uIGlzLWVtcHR5XCI+XG4gICAge3sgJ29yZ2FuaXphdGlvbi5tZXNzYWdlcy5lbXB0eUxpc3QnIHwgY3hUcmFuc2xhdGUgfX1cbiAgPC9wPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNsaXN0SGludD5cbiAgPHA+XG4gICAge3sgdmlld1R5cGUgKyAnLmhpbnQnIHwgY3hUcmFuc2xhdGUgfX1cbiAgPC9wPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNzaG93QnV0dG9uPlxuICA8YnV0dG9uXG4gICAgKm5nSWY9XCIhaGlkZUFkZEJ1dHRvblwiXG4gICAgY2xhc3M9XCJidXR0b24gcHJpbWFyeSBjcmVhdGVcIlxuICAgIChjbGljayk9XCJvbkNyZWF0ZUJ1dHRvbkNsaWNrKClcIlxuICA+XG4gICAge3sgZ2V0Q3JlYXRlQnV0dG9uTGFiZWwoKSB8IGN4VHJhbnNsYXRlIH19XG4gIDwvYnV0dG9uPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==