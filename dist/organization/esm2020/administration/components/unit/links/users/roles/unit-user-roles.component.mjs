/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, ViewChild } from '@angular/core';
import { LoadStatus, } from '@spartacus/organization/administration/core';
import { filter, map, take, tap } from 'rxjs/operators';
import { ItemService } from '../../../../shared/item.service';
import { MessageService } from '../../../../shared/message/services/message.service';
import { UnitUserRolesItemService } from './unit-user-roles-item.service';
import * as i0 from "@angular/core";
import * as i1 from "../../../../shared/item.service";
import * as i2 from "./unit-user-roles-form.service";
import * as i3 from "@spartacus/organization/administration/core";
import * as i4 from "../../../../user/services/user-item.service";
import * as i5 from "@angular/common";
import * as i6 from "../../../../shared/card/card.component";
import * as i7 from "@angular/forms";
import * as i8 from "@angular/router";
import * as i9 from "@spartacus/storefront";
import * as i10 from "@spartacus/core";
export class UnitUserRolesFormComponent {
    constructor(itemService, formService, userService, userItemService) {
        this.itemService = itemService;
        this.formService = formService;
        this.userService = userService;
        this.userItemService = userItemService;
        this.form$ = this.itemService.current$.pipe(tap((item) => {
            if (!this.item) {
                this.item = item;
            }
            if (this.item?.roles?.join() !== item?.roles?.join()) {
                this.item = { ...this.item, ...item };
            }
        }), map((item) => this.formService.getForm(item)));
        this.availableRoles = this.userService.getAllRoles();
        this.availableRights = this.userService.getAllRights();
    }
    save(form) {
        form.disable();
        const rolesAndRights = [
            ...this.availableRoles,
            ...this.availableRights,
        ].filter((role) => !!form.get(role)?.value);
        this.userItemService
            .update(this.item?.customerId ?? '', { roles: rolesAndRights })
            .pipe(take(1), filter((data) => data.status === LoadStatus.SUCCESS))
            .subscribe((data) => {
            this.notify({ ...this.item, ...data.item });
            form.enable();
        });
    }
    notify(item) {
        this.messageService.add({
            message: {
                key: 'orgUnitUserRoles.messages.rolesUpdated',
                params: { item },
            },
        });
    }
}
UnitUserRolesFormComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: UnitUserRolesFormComponent, deps: [{ token: i1.ItemService }, { token: i2.UnitUserRolesFormService }, { token: i3.B2BUserService }, { token: i4.UserItemService }], target: i0.ɵɵFactoryTarget.Component });
UnitUserRolesFormComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: UnitUserRolesFormComponent, selector: "cx-org-unit-user-roles", host: { classAttribute: "content-wrapper" }, providers: [
        {
            provide: ItemService,
            useExisting: UnitUserRolesItemService,
        },
    ], viewQueries: [{ propertyName: "messageService", first: true, predicate: MessageService, descendants: true, read: MessageService }], ngImport: i0, template: "<form *ngIf=\"form$ | async as form\" (submit)=\"save(form)\">\n  <cx-org-card\n    #card\n    [previous]=\"false\"\n    i18nRoot=\"orgUnitUserRoles\"\n    [cxFocus]=\"{ autofocus: 'input', refreshFocus: form }\"\n  >\n    <a actions routerLink=\"../../\">\n      <span (click)=\"card.closeView($event)\">\n        {{ 'organization.done' | cxTranslate }}\n      </span>\n    </a>\n\n    <section main class=\"details\" [formGroup]=\"form\">\n      <fieldset class=\"full-width\">\n        <legend class=\"label-content required\">\n          {{ 'orgUser.roles' | cxTranslate }}\n        </legend>\n        <label class=\"form-check\" *ngFor=\"let role of availableRoles\">\n          <input\n            type=\"checkbox\"\n            [formControlName]=\"role\"\n            (change)=\"save(form)\"\n          />\n          <span class=\"form-check-label\">\n            {{ 'organization.userRoles.' + role | cxTranslate }}\n          </span>\n        </label>\n      </fieldset>\n      <fieldset class=\"full-width\">\n        <legend class=\"label-content required\">\n          {{ 'orgUser.rights' | cxTranslate }}\n        </legend>\n        <label class=\"form-check\" *ngFor=\"let right of availableRights\">\n          <input\n            type=\"checkbox\"\n            [formControlName]=\"right\"\n            (change)=\"save(form)\"\n          />\n          <span class=\"form-check-label\">\n            {{ 'organization.userRights.' + right | cxTranslate }}\n          </span>\n        </label>\n      </fieldset>\n    </section>\n  </cx-org-card>\n</form>\n", dependencies: [{ kind: "directive", type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i6.CardComponent, selector: "cx-org-card", inputs: ["i18nRoot", "previous", "subtitle", "showHint"] }, { kind: "directive", type: i7.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i7.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i7.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i7.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i7.NgForm, selector: "form:not([ngNoForm]):not([formGroup]),ng-form,[ngForm]", inputs: ["ngFormOptions"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i8.RouterLink, selector: "[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "directive", type: i7.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i7.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "directive", type: i9.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "pipe", type: i5.AsyncPipe, name: "async" }, { kind: "pipe", type: i10.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: UnitUserRolesFormComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-org-unit-user-roles', changeDetection: ChangeDetectionStrategy.OnPush, host: { class: 'content-wrapper' }, providers: [
                        {
                            provide: ItemService,
                            useExisting: UnitUserRolesItemService,
                        },
                    ], template: "<form *ngIf=\"form$ | async as form\" (submit)=\"save(form)\">\n  <cx-org-card\n    #card\n    [previous]=\"false\"\n    i18nRoot=\"orgUnitUserRoles\"\n    [cxFocus]=\"{ autofocus: 'input', refreshFocus: form }\"\n  >\n    <a actions routerLink=\"../../\">\n      <span (click)=\"card.closeView($event)\">\n        {{ 'organization.done' | cxTranslate }}\n      </span>\n    </a>\n\n    <section main class=\"details\" [formGroup]=\"form\">\n      <fieldset class=\"full-width\">\n        <legend class=\"label-content required\">\n          {{ 'orgUser.roles' | cxTranslate }}\n        </legend>\n        <label class=\"form-check\" *ngFor=\"let role of availableRoles\">\n          <input\n            type=\"checkbox\"\n            [formControlName]=\"role\"\n            (change)=\"save(form)\"\n          />\n          <span class=\"form-check-label\">\n            {{ 'organization.userRoles.' + role | cxTranslate }}\n          </span>\n        </label>\n      </fieldset>\n      <fieldset class=\"full-width\">\n        <legend class=\"label-content required\">\n          {{ 'orgUser.rights' | cxTranslate }}\n        </legend>\n        <label class=\"form-check\" *ngFor=\"let right of availableRights\">\n          <input\n            type=\"checkbox\"\n            [formControlName]=\"right\"\n            (change)=\"save(form)\"\n          />\n          <span class=\"form-check-label\">\n            {{ 'organization.userRights.' + right | cxTranslate }}\n          </span>\n        </label>\n      </fieldset>\n    </section>\n  </cx-org-card>\n</form>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ItemService }, { type: i2.UnitUserRolesFormService }, { type: i3.B2BUserService }, { type: i4.UserItemService }]; }, propDecorators: { messageService: [{
                type: ViewChild,
                args: [MessageService, { read: MessageService }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pdC11c2VyLXJvbGVzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9vcmdhbml6YXRpb24vYWRtaW5pc3RyYXRpb24vY29tcG9uZW50cy91bml0L2xpbmtzL3VzZXJzL3JvbGVzL3VuaXQtdXNlci1yb2xlcy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JnYW5pemF0aW9uL2FkbWluaXN0cmF0aW9uL2NvbXBvbmVudHMvdW5pdC9saW5rcy91c2Vycy9yb2xlcy91bml0LXVzZXItcm9sZXMuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRzlFLE9BQU8sRUFFTCxVQUFVLEdBQ1gsTUFBTSw2Q0FBNkMsQ0FBQztBQUVyRCxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQzlELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQUdyRixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7Ozs7Ozs7Ozs7O0FBYzFFLE1BQU0sT0FBTywwQkFBMEI7SUFxQnJDLFlBQ1ksV0FBaUMsRUFDakMsV0FBcUMsRUFDckMsV0FBMkIsRUFDM0IsZUFBZ0M7UUFIaEMsZ0JBQVcsR0FBWCxXQUFXLENBQXNCO1FBQ2pDLGdCQUFXLEdBQVgsV0FBVyxDQUEwQjtRQUNyQyxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFDM0Isb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBbkI1QyxVQUFLLEdBQXdDLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDekUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDWCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDZCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQzthQUNsQjtZQUNELElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRTtnQkFDcEQsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLElBQUksRUFBRSxDQUFDO2FBQ3ZDO1FBQ0gsQ0FBQyxDQUFDLEVBQ0YsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUM5QyxDQUFDO1FBRUYsbUJBQWMsR0FBa0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvRCxvQkFBZSxHQUFtQixJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBTy9ELENBQUM7SUFFSixJQUFJLENBQUMsSUFBc0I7UUFDekIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2YsTUFBTSxjQUFjLEdBQW1DO1lBQ3JELEdBQUcsSUFBSSxDQUFDLGNBQWM7WUFDdEIsR0FBRyxJQUFJLENBQUMsZUFBZTtTQUN4QixDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQWdDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRXhFLElBQUksQ0FBQyxlQUFlO2FBQ2pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFVBQVUsSUFBSSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLENBQUM7YUFDOUQsSUFBSSxDQUNILElBQUksQ0FBQyxDQUFDLENBQUMsRUFDUCxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEtBQUssVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUNyRDthQUNBLFNBQVMsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUM1QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRVMsTUFBTSxDQUFDLElBQWE7UUFDNUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUM7WUFDdEIsT0FBTyxFQUFFO2dCQUNQLEdBQUcsRUFBRSx3Q0FBd0M7Z0JBQzdDLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRTthQUNqQjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7O3VIQXREVSwwQkFBMEI7MkdBQTFCLDBCQUEwQiw4RkFQMUI7UUFDVDtZQUNFLE9BQU8sRUFBRSxXQUFXO1lBQ3BCLFdBQVcsRUFBRSx3QkFBd0I7U0FDdEM7S0FDRiwwRUFLVSxjQUFjLDJCQUFVLGNBQWMsNkJDcENuRCxtaURBK0NBOzJGRGRhLDBCQUEwQjtrQkFadEMsU0FBUzsrQkFDRSx3QkFBd0IsbUJBRWpCLHVCQUF1QixDQUFDLE1BQU0sUUFDekMsRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsYUFDdkI7d0JBQ1Q7NEJBQ0UsT0FBTyxFQUFFLFdBQVc7NEJBQ3BCLFdBQVcsRUFBRSx3QkFBd0I7eUJBQ3RDO3FCQUNGO29NQU1ELGNBQWM7c0JBRGIsU0FBUzt1QkFBQyxjQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBVbnR5cGVkRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQjJCVXNlciwgQjJCVXNlclJvbGUsIEIyQlVzZXJSaWdodCB9IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQge1xuICBCMkJVc2VyU2VydmljZSxcbiAgTG9hZFN0YXR1cyxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9vcmdhbml6YXRpb24vYWRtaW5pc3RyYXRpb24vY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCwgdGFrZSwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSXRlbVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvaXRlbS5zZXJ2aWNlJztcbmltcG9ydCB7IE1lc3NhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2hhcmVkL21lc3NhZ2Uvc2VydmljZXMvbWVzc2FnZS5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXJJdGVtU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3VzZXIvc2VydmljZXMvdXNlci1pdGVtLnNlcnZpY2UnO1xuaW1wb3J0IHsgVW5pdFVzZXJSb2xlc0Zvcm1TZXJ2aWNlIH0gZnJvbSAnLi91bml0LXVzZXItcm9sZXMtZm9ybS5zZXJ2aWNlJztcbmltcG9ydCB7IFVuaXRVc2VyUm9sZXNJdGVtU2VydmljZSB9IGZyb20gJy4vdW5pdC11c2VyLXJvbGVzLWl0ZW0uc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LW9yZy11bml0LXVzZXItcm9sZXMnLFxuICB0ZW1wbGF0ZVVybDogJy4vdW5pdC11c2VyLXJvbGVzLmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIGhvc3Q6IHsgY2xhc3M6ICdjb250ZW50LXdyYXBwZXInIH0sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IEl0ZW1TZXJ2aWNlLFxuICAgICAgdXNlRXhpc3Rpbmc6IFVuaXRVc2VyUm9sZXNJdGVtU2VydmljZSxcbiAgICB9LFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBVbml0VXNlclJvbGVzRm9ybUNvbXBvbmVudCB7XG4gIHByb3RlY3RlZCBpdGVtOiBCMkJVc2VyIHwgdW5kZWZpbmVkO1xuXG4gIEBWaWV3Q2hpbGQoTWVzc2FnZVNlcnZpY2UsIHsgcmVhZDogTWVzc2FnZVNlcnZpY2UgfSlcbiAgbWVzc2FnZVNlcnZpY2U6IE1lc3NhZ2VTZXJ2aWNlO1xuXG4gIGZvcm0kOiBPYnNlcnZhYmxlPFVudHlwZWRGb3JtR3JvdXAgfCBudWxsPiA9IHRoaXMuaXRlbVNlcnZpY2UuY3VycmVudCQucGlwZShcbiAgICB0YXAoKGl0ZW0pID0+IHtcbiAgICAgIGlmICghdGhpcy5pdGVtKSB7XG4gICAgICAgIHRoaXMuaXRlbSA9IGl0ZW07XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pdGVtPy5yb2xlcz8uam9pbigpICE9PSBpdGVtPy5yb2xlcz8uam9pbigpKSB7XG4gICAgICAgIHRoaXMuaXRlbSA9IHsgLi4udGhpcy5pdGVtLCAuLi5pdGVtIH07XG4gICAgICB9XG4gICAgfSksXG4gICAgbWFwKChpdGVtKSA9PiB0aGlzLmZvcm1TZXJ2aWNlLmdldEZvcm0oaXRlbSkpXG4gICk7XG5cbiAgYXZhaWxhYmxlUm9sZXM6IEIyQlVzZXJSb2xlW10gPSB0aGlzLnVzZXJTZXJ2aWNlLmdldEFsbFJvbGVzKCk7XG4gIGF2YWlsYWJsZVJpZ2h0czogQjJCVXNlclJpZ2h0W10gPSB0aGlzLnVzZXJTZXJ2aWNlLmdldEFsbFJpZ2h0cygpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBpdGVtU2VydmljZTogSXRlbVNlcnZpY2U8QjJCVXNlcj4sXG4gICAgcHJvdGVjdGVkIGZvcm1TZXJ2aWNlOiBVbml0VXNlclJvbGVzRm9ybVNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIHVzZXJTZXJ2aWNlOiBCMkJVc2VyU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgdXNlckl0ZW1TZXJ2aWNlOiBVc2VySXRlbVNlcnZpY2VcbiAgKSB7fVxuXG4gIHNhdmUoZm9ybTogVW50eXBlZEZvcm1Hcm91cCkge1xuICAgIGZvcm0uZGlzYWJsZSgpO1xuICAgIGNvbnN0IHJvbGVzQW5kUmlnaHRzOiAoQjJCVXNlclJvbGUgfCBCMkJVc2VyUmlnaHQpW10gPSBbXG4gICAgICAuLi50aGlzLmF2YWlsYWJsZVJvbGVzLFxuICAgICAgLi4udGhpcy5hdmFpbGFibGVSaWdodHMsXG4gICAgXS5maWx0ZXIoKHJvbGU6IEIyQlVzZXJSb2xlIHwgQjJCVXNlclJpZ2h0KSA9PiAhIWZvcm0uZ2V0KHJvbGUpPy52YWx1ZSk7XG5cbiAgICB0aGlzLnVzZXJJdGVtU2VydmljZVxuICAgICAgLnVwZGF0ZSh0aGlzLml0ZW0/LmN1c3RvbWVySWQgPz8gJycsIHsgcm9sZXM6IHJvbGVzQW5kUmlnaHRzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgZmlsdGVyKChkYXRhKSA9PiBkYXRhLnN0YXR1cyA9PT0gTG9hZFN0YXR1cy5TVUNDRVNTKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xuICAgICAgICB0aGlzLm5vdGlmeSh7IC4uLnRoaXMuaXRlbSwgLi4uZGF0YS5pdGVtIH0pO1xuICAgICAgICBmb3JtLmVuYWJsZSgpO1xuICAgICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgbm90aWZ5KGl0ZW06IEIyQlVzZXIpIHtcbiAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLmFkZCh7XG4gICAgICBtZXNzYWdlOiB7XG4gICAgICAgIGtleTogJ29yZ1VuaXRVc2VyUm9sZXMubWVzc2FnZXMucm9sZXNVcGRhdGVkJyxcbiAgICAgICAgcGFyYW1zOiB7IGl0ZW0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbn1cbiIsIjxmb3JtICpuZ0lmPVwiZm9ybSQgfCBhc3luYyBhcyBmb3JtXCIgKHN1Ym1pdCk9XCJzYXZlKGZvcm0pXCI+XG4gIDxjeC1vcmctY2FyZFxuICAgICNjYXJkXG4gICAgW3ByZXZpb3VzXT1cImZhbHNlXCJcbiAgICBpMThuUm9vdD1cIm9yZ1VuaXRVc2VyUm9sZXNcIlxuICAgIFtjeEZvY3VzXT1cInsgYXV0b2ZvY3VzOiAnaW5wdXQnLCByZWZyZXNoRm9jdXM6IGZvcm0gfVwiXG4gID5cbiAgICA8YSBhY3Rpb25zIHJvdXRlckxpbms9XCIuLi8uLi9cIj5cbiAgICAgIDxzcGFuIChjbGljayk9XCJjYXJkLmNsb3NlVmlldygkZXZlbnQpXCI+XG4gICAgICAgIHt7ICdvcmdhbml6YXRpb24uZG9uZScgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgPC9zcGFuPlxuICAgIDwvYT5cblxuICAgIDxzZWN0aW9uIG1haW4gY2xhc3M9XCJkZXRhaWxzXCIgW2Zvcm1Hcm91cF09XCJmb3JtXCI+XG4gICAgICA8ZmllbGRzZXQgY2xhc3M9XCJmdWxsLXdpZHRoXCI+XG4gICAgICAgIDxsZWdlbmQgY2xhc3M9XCJsYWJlbC1jb250ZW50IHJlcXVpcmVkXCI+XG4gICAgICAgICAge3sgJ29yZ1VzZXIucm9sZXMnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgPC9sZWdlbmQ+XG4gICAgICAgIDxsYWJlbCBjbGFzcz1cImZvcm0tY2hlY2tcIiAqbmdGb3I9XCJsZXQgcm9sZSBvZiBhdmFpbGFibGVSb2xlc1wiPlxuICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgdHlwZT1cImNoZWNrYm94XCJcbiAgICAgICAgICAgIFtmb3JtQ29udHJvbE5hbWVdPVwicm9sZVwiXG4gICAgICAgICAgICAoY2hhbmdlKT1cInNhdmUoZm9ybSlcIlxuICAgICAgICAgIC8+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJmb3JtLWNoZWNrLWxhYmVsXCI+XG4gICAgICAgICAgICB7eyAnb3JnYW5pemF0aW9uLnVzZXJSb2xlcy4nICsgcm9sZSB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L2xhYmVsPlxuICAgICAgPC9maWVsZHNldD5cbiAgICAgIDxmaWVsZHNldCBjbGFzcz1cImZ1bGwtd2lkdGhcIj5cbiAgICAgICAgPGxlZ2VuZCBjbGFzcz1cImxhYmVsLWNvbnRlbnQgcmVxdWlyZWRcIj5cbiAgICAgICAgICB7eyAnb3JnVXNlci5yaWdodHMnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgPC9sZWdlbmQ+XG4gICAgICAgIDxsYWJlbCBjbGFzcz1cImZvcm0tY2hlY2tcIiAqbmdGb3I9XCJsZXQgcmlnaHQgb2YgYXZhaWxhYmxlUmlnaHRzXCI+XG4gICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgICAgICAgW2Zvcm1Db250cm9sTmFtZV09XCJyaWdodFwiXG4gICAgICAgICAgICAoY2hhbmdlKT1cInNhdmUoZm9ybSlcIlxuICAgICAgICAgIC8+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJmb3JtLWNoZWNrLWxhYmVsXCI+XG4gICAgICAgICAgICB7eyAnb3JnYW5pemF0aW9uLnVzZXJSaWdodHMuJyArIHJpZ2h0IHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvbGFiZWw+XG4gICAgICA8L2ZpZWxkc2V0PlxuICAgIDwvc2VjdGlvbj5cbiAgPC9jeC1vcmctY2FyZD5cbjwvZm9ybT5cbiJdfQ==