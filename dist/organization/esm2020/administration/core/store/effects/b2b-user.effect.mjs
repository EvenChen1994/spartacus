import { Injectable, inject } from '@angular/core';
import { createEffect, ofType } from '@ngrx/effects';
import { AuthActions, B2BUserRole, LoggerService, StateUtils, normalizeHttpError, } from '@spartacus/core';
import { from, of } from 'rxjs';
import { catchError, groupBy, map, mergeMap, switchMap, take, tap, withLatestFrom, } from 'rxjs/operators';
import { B2BUserActions, OrgUnitActions, OrganizationActions, PermissionActions, UserGroupActions, } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/b2b-user/b2b-user.connector";
import * as i3 from "@spartacus/core";
import * as i4 from "@spartacus/user/account/root";
export class B2BUserEffects {
    constructor(actions$, b2bUserConnector, routingService, userAccountFacade, userIdService) {
        this.actions$ = actions$;
        this.b2bUserConnector = b2bUserConnector;
        this.routingService = routingService;
        this.userAccountFacade = userAccountFacade;
        this.userIdService = userIdService;
        this.logger = inject(LoggerService);
        this.loadB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomerId }) => {
            return this.b2bUserConnector.get(userId, orgCustomerId).pipe(map((b2bUser) => {
                return new B2BUserActions.LoadB2BUserSuccess([b2bUser]);
            }), catchError((error) => of(new B2BUserActions.LoadB2BUserFail({
                orgCustomerId,
                error: normalizeHttpError(error, this.logger),
            }))));
        })));
        this.createB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.CREATE_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomer }) => this.b2bUserConnector.create(userId, orgCustomer).pipe(switchMap((data) => {
            const isAssignedToApprovers = orgCustomer.isAssignedToApprovers;
            // TODO Workaround for not known customerId while user creation (redireciton)
            return this.routingService.getRouterState().pipe(take(1), tap((route) => this.redirectToDetails(route, data)), switchMap(() => {
                const successActions = [
                    new B2BUserActions.CreateB2BUserSuccess(data),
                    new B2BUserActions.CreateB2BUserSuccess({
                        customerId: undefined,
                    }),
                    new OrganizationActions.OrganizationClearData(),
                ];
                if (isAssignedToApprovers) {
                    successActions.splice(1, 0, new OrgUnitActions.AssignApprover({
                        userId,
                        orgUnitId: orgCustomer.orgUnit?.uid ?? '',
                        orgCustomerId: data.customerId ?? '',
                        roleId: B2BUserRole.APPROVER,
                    }));
                }
                return successActions;
            }));
        }), catchError((error) => from([
            new B2BUserActions.CreateB2BUserFail({
                orgCustomerId: orgCustomer.customerId ?? '',
                error: normalizeHttpError(error, this.logger),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.updateB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UPDATE_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomerId, orgCustomer }) => {
            const isAssignedToApprovers = orgCustomer.isAssignedToApprovers;
            return this.b2bUserConnector
                .update(userId, orgCustomerId, orgCustomer)
                .pipe(switchMap((_data) => {
                const successActions = [
                    // TODO: change for 'payload: data' when backend API start to return user data on PATCH
                    new B2BUserActions.UpdateB2BUserSuccess(orgCustomer),
                ];
                if (isAssignedToApprovers) {
                    successActions.push(new OrgUnitActions.AssignApprover({
                        userId,
                        orgUnitId: orgCustomer.orgUnit?.uid ?? '',
                        orgCustomerId,
                        roleId: B2BUserRole.APPROVER,
                    }));
                }
                return successActions;
            }), catchError((error) => from([
                new B2BUserActions.UpdateB2BUserFail({
                    orgCustomerId: orgCustomer.customerId ?? '',
                    error: normalizeHttpError(error, this.logger),
                }),
                new OrganizationActions.OrganizationClearData(),
            ])));
        })));
        this.checkSelfEmailUpdate$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UPDATE_B2B_USER_SUCCESS), map((action) => action.payload), withLatestFrom(this.userAccountFacade.get(), this.userIdService.getUserId()), switchMap(([payload, currentUser]) => {
            const currentUserEmailMatch = payload.customerId === currentUser?.customerId &&
                payload.email !== currentUser?.displayUid;
            if (currentUserEmailMatch) {
                this.routingService.go({ cxRoute: 'login' });
            }
            return currentUserEmailMatch
                ? [new AuthActions.Logout()]
                : [new OrganizationActions.OrganizationClearData()];
        })));
        this.loadB2BUsers$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USERS), map((action) => action.payload), switchMap((payload) => this.b2bUserConnector.getList(payload.userId, payload.params).pipe(switchMap((b2bUsers) => {
            const { values, page } = StateUtils.normalizeListPage(b2bUsers, 'customerId');
            return [
                new B2BUserActions.LoadB2BUserSuccess(values),
                new B2BUserActions.LoadB2BUsersSuccess({
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUsersFail({
            params: payload.params,
            error: normalizeHttpError(error, this.logger),
        })))))));
        this.loadB2BUserApprovers$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_APPROVERS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getApprovers(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((approvers) => {
            const { values, page } = StateUtils.normalizeListPage(approvers, 'customerId');
            return [
                new B2BUserActions.LoadB2BUserSuccess(values),
                new B2BUserActions.LoadB2BUserApproversSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserApproversFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error, this.logger),
        })))))))));
        this.loadB2BUserPermissions$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_PERMISSIONS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getPermissions(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((permissions) => {
            const { values, page } = StateUtils.normalizeListPage(permissions, 'code');
            return [
                new PermissionActions.LoadPermissionSuccess(values),
                new B2BUserActions.LoadB2BUserPermissionsSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserPermissionsFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error, this.logger),
        })))))))));
        this.loadB2BUserUserGroups$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_USER_GROUPS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getUserGroups(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((userGroups) => {
            const { values, page } = StateUtils.normalizeListPage(userGroups, 'uid');
            return [
                new UserGroupActions.LoadUserGroupSuccess(values),
                new B2BUserActions.LoadB2BUserUserGroupsSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserUserGroupsFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error, this.logger),
        })))))))));
        this.assignApproverToB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_APPROVER), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignApprover(payload.userId, payload.orgCustomerId, payload.approverId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserApproverSuccess({
                // Occ returned email, but we use customerId in store
                approverId: payload.approverId,
                selected: data.selected,
            }),
            // Clearing data in this case causes unexpected behavior (#10468)
            // new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserApproverFail({
                orgCustomerId: payload.orgCustomerId,
                approverId: payload.approverId,
                error: normalizeHttpError(error, this.logger),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.unassignApproverFromB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_APPROVER), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignApprover(payload.userId, payload.orgCustomerId, payload.approverId)
            .pipe(switchMap((data) => [
            new B2BUserActions.UnassignB2BUserApproverSuccess({
                // Occ returned email, but we use customerId in store
                approverId: payload.approverId,
                selected: data.selected,
            }),
            // Clearing data in this case causes unexpected behavior (#10468)
            // new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserApproverFail({
                orgCustomerId: payload.orgCustomerId,
                approverId: payload.approverId,
                error: normalizeHttpError(error, this.logger),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.assignPermissionToB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_PERMISSION), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignPermission(payload.userId, payload.orgCustomerId, payload.permissionId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserPermissionSuccess({
                permissionId: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserPermissionFail({
                orgCustomerId: payload.orgCustomerId,
                permissionId: payload.permissionId,
                error: normalizeHttpError(error, this.logger),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.unassignPermissionFromB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_PERMISSION), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignPermission(payload.userId, payload.orgCustomerId, payload.permissionId)
            .pipe(switchMap((data) => [
            new B2BUserActions.UnassignB2BUserPermissionSuccess({
                permissionId: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserPermissionFail({
                orgCustomerId: payload.orgCustomerId,
                permissionId: payload.permissionId,
                error: normalizeHttpError(error, this.logger),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.assignUserGroupToB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_USER_GROUP), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignUserGroup(payload.userId, payload.orgCustomerId, payload.userGroupId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserUserGroupSuccess({
                uid: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserUserGroupFail({
                orgCustomerId: payload.orgCustomerId,
                userGroupId: payload.userGroupId,
                error: normalizeHttpError(error, this.logger),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.unassignUserGroupFromB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_USER_GROUP), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignUserGroup(payload.userId, payload.orgCustomerId, payload.userGroupId)
            .pipe(switchMap(
        // TODO: Workaround because occ doesn't respond here
        // (data) =>
        //   new B2BUserActions.DeleteB2BUserUserGroupSuccess({
        //     uid: data.id,
        //     selected: data.selected,
        //   })
        () => [
            new B2BUserActions.UnassignB2BUserUserGroupSuccess({
                uid: payload.userGroupId,
                selected: false,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserUserGroupFail({
                orgCustomerId: payload.orgCustomerId,
                userGroupId: payload.userGroupId,
                error: normalizeHttpError(error, this.logger),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
    }
    redirectToDetails(route, data) {
        if (route?.state?.context?.id !== '/organization/units') {
            this.routingService.go({
                cxRoute: 'orgUserDetails',
                params: data,
            });
        }
    }
}
B2BUserEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: B2BUserEffects, deps: [{ token: i1.Actions }, { token: i2.B2BUserConnector }, { token: i3.RoutingService }, { token: i4.UserAccountFacade }, { token: i3.UserIdService }], target: i0.ɵɵFactoryTarget.Injectable });
B2BUserEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: B2BUserEffects });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: B2BUserEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.B2BUserConnector }, { type: i3.RoutingService }, { type: i4.UserAccountFacade }, { type: i3.UserIdService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjJiLXVzZXIuZWZmZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9hZG1pbmlzdHJhdGlvbi9jb3JlL3N0b3JlL2VmZmVjdHMvYjJiLXVzZXIuZWZmZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9BLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBVyxZQUFZLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlELE9BQU8sRUFDTCxXQUFXLEVBRVgsV0FBVyxFQUVYLGFBQWEsRUFHYixVQUFVLEVBR1Ysa0JBQWtCLEdBQ25CLE1BQU0saUJBQWlCLENBQUM7QUFFekIsT0FBTyxFQUFjLElBQUksRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUNMLFVBQVUsRUFDVixPQUFPLEVBQ1AsR0FBRyxFQUNILFFBQVEsRUFDUixTQUFTLEVBQ1QsSUFBSSxFQUNKLEdBQUcsRUFDSCxjQUFjLEdBQ2YsTUFBTSxnQkFBZ0IsQ0FBQztBQUl4QixPQUFPLEVBQ0wsY0FBYyxFQUNkLGNBQWMsRUFDZCxtQkFBbUIsRUFDbkIsaUJBQWlCLEVBQ2pCLGdCQUFnQixHQUNqQixNQUFNLGtCQUFrQixDQUFDOzs7Ozs7QUFHMUIsTUFBTSxPQUFPLGNBQWM7SUF5a0J6QixZQUNVLFFBQWlCLEVBQ2pCLGdCQUFrQyxFQUNsQyxjQUE4QixFQUM5QixpQkFBb0MsRUFDcEMsYUFBNEI7UUFKNUIsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBN2tCNUIsV0FBTSxHQUFHLE1BQU0s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QUssS0FBYSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRSxLQUFLLHFCQUFxQixFQUFFO1lBQ2hFLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO2dCQUNyQixPQUFPLEVBQUUsZ0JBQWdCO2dCQUN6QixNQUFNLEVBQUUsSUFBSTthQUNiLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7MkdBeGxCVSxjQUFjOytHQUFkLGNBQWM7MkZBQWQsY0FBYztrQkFEMUIsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3Rpb25zLCBjcmVhdGVFZmZlY3QsIG9mVHlwZSB9IGZyb20gJ0BuZ3J4L2VmZmVjdHMnO1xuaW1wb3J0IHtcbiAgQXV0aEFjdGlvbnMsXG4gIEIyQlVzZXIsXG4gIEIyQlVzZXJSb2xlLFxuICBFbnRpdGllc01vZGVsLFxuICBMb2dnZXJTZXJ2aWNlLFxuICBSb3V0ZXJTdGF0ZSxcbiAgUm91dGluZ1NlcnZpY2UsXG4gIFN0YXRlVXRpbHMsXG4gIFVzZXIsXG4gIFVzZXJJZFNlcnZpY2UsXG4gIG5vcm1hbGl6ZUh0dHBFcnJvcixcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IFVzZXJBY2NvdW50RmFjYWRlIH0gZnJvbSAnQHNwYXJ0YWN1cy91c2VyL2FjY291bnQvcm9vdCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgY2F0Y2hFcnJvcixcbiAgZ3JvdXBCeSxcbiAgbWFwLFxuICBtZXJnZU1hcCxcbiAgc3dpdGNoTWFwLFxuICB0YWtlLFxuICB0YXAsXG4gIHdpdGhMYXRlc3RGcm9tLFxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBCMkJVc2VyQ29ubmVjdG9yIH0gZnJvbSAnLi4vLi4vY29ubmVjdG9ycy9iMmItdXNlci9iMmItdXNlci5jb25uZWN0b3InO1xuaW1wb3J0IHsgUGVybWlzc2lvbiB9IGZyb20gJy4uLy4uL21vZGVsL3Blcm1pc3Npb24ubW9kZWwnO1xuaW1wb3J0IHsgVXNlckdyb3VwIH0gZnJvbSAnLi4vLi4vbW9kZWwvdXNlci1ncm91cC5tb2RlbCc7XG5pbXBvcnQge1xuICBCMkJVc2VyQWN0aW9ucyxcbiAgT3JnVW5pdEFjdGlvbnMsXG4gIE9yZ2FuaXphdGlvbkFjdGlvbnMsXG4gIFBlcm1pc3Npb25BY3Rpb25zLFxuICBVc2VyR3JvdXBBY3Rpb25zLFxufSBmcm9tICcuLi9hY3Rpb25zL2luZGV4JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEIyQlVzZXJFZmZlY3RzIHtcbiAgcHJvdGVjdGVkIGxvZ2dlciA9IGluamVjdChMb2dnZXJTZXJ2aWNlKTtcblxuICBsb2FkQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJGYWlsXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuTE9BRF9CMkJfVVNFUiksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIG9yZ0N1c3RvbWVySWQgfSkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5iMmJVc2VyQ29ubmVjdG9yLmdldCh1c2VySWQsIG9yZ0N1c3RvbWVySWQpLnBpcGUoXG4gICAgICAgICAgbWFwKChiMmJVc2VyOiBCMkJVc2VyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyU3VjY2VzcyhbYjJiVXNlcl0pO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIG9mKFxuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJGYWlsKHtcbiAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IsIHRoaXMubG9nZ2VyKSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgIClcbiAgKTtcblxuICBjcmVhdGVCMkJVc2VyJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkNyZWF0ZUIyQlVzZXJTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5DcmVhdGVCMkJVc2VyRmFpbFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuQXNzaWduQXBwcm92ZXJcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuQ1JFQVRFX0IyQl9VU0VSKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5DcmVhdGVCMkJVc2VyKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHsgdXNlcklkLCBvcmdDdXN0b21lciB9KSA9PlxuICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3IuY3JlYXRlKHVzZXJJZCwgb3JnQ3VzdG9tZXIpLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpc0Fzc2lnbmVkVG9BcHByb3ZlcnMgPSBvcmdDdXN0b21lci5pc0Fzc2lnbmVkVG9BcHByb3ZlcnM7XG4gICAgICAgICAgICAvLyBUT0RPIFdvcmthcm91bmQgZm9yIG5vdCBrbm93biBjdXN0b21lcklkIHdoaWxlIHVzZXIgY3JlYXRpb24gKHJlZGlyZWNpdG9uKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucm91dGluZ1NlcnZpY2UuZ2V0Um91dGVyU3RhdGUoKS5waXBlKFxuICAgICAgICAgICAgICB0YWtlKDEpLFxuICAgICAgICAgICAgICB0YXAoKHJvdXRlKSA9PiB0aGlzLnJlZGlyZWN0VG9EZXRhaWxzKHJvdXRlLCBkYXRhKSksXG4gICAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3VjY2Vzc0FjdGlvbnMgPSBbXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQ3JlYXRlQjJCVXNlclN1Y2Nlc3MoZGF0YSksXG4gICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQ3JlYXRlQjJCVXNlclN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21lcklkOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgICAgIF0gYXMgYW55W107XG4gICAgICAgICAgICAgICAgaWYgKGlzQXNzaWduZWRUb0FwcHJvdmVycykge1xuICAgICAgICAgICAgICAgICAgc3VjY2Vzc0FjdGlvbnMuc3BsaWNlKFxuICAgICAgICAgICAgICAgICAgICAxLFxuICAgICAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQXNzaWduQXBwcm92ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICBvcmdVbml0SWQ6IG9yZ0N1c3RvbWVyLm9yZ1VuaXQ/LnVpZCA/PyAnJyxcbiAgICAgICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBkYXRhLmN1c3RvbWVySWQgPz8gJycsXG4gICAgICAgICAgICAgICAgICAgICAgcm9sZUlkOiBCMkJVc2VyUm9sZS5BUFBST1ZFUixcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzQWN0aW9ucztcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5DcmVhdGVCMkJVc2VyRmFpbCh7XG4gICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogb3JnQ3VzdG9tZXIuY3VzdG9tZXJJZCA/PyAnJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yLCB0aGlzLmxvZ2dlciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIHVwZGF0ZUIyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuVXBkYXRlQjJCVXNlclN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLlVwZGF0ZUIyQlVzZXJGYWlsXG4gICAgfCBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3ZlclxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5VUERBVEVfQjJCX1VTRVIpLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLlVwZGF0ZUIyQlVzZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIG9yZ0N1c3RvbWVySWQsIG9yZ0N1c3RvbWVyIH0pID0+IHtcbiAgICAgICAgY29uc3QgaXNBc3NpZ25lZFRvQXBwcm92ZXJzID0gb3JnQ3VzdG9tZXIuaXNBc3NpZ25lZFRvQXBwcm92ZXJzO1xuICAgICAgICByZXR1cm4gdGhpcy5iMmJVc2VyQ29ubmVjdG9yXG4gICAgICAgICAgLnVwZGF0ZSh1c2VySWQsIG9yZ0N1c3RvbWVySWQsIG9yZ0N1c3RvbWVyKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChfZGF0YSkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzQWN0aW9ucyA9IFtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBjaGFuZ2UgZm9yICdwYXlsb2FkOiBkYXRhJyB3aGVuIGJhY2tlbmQgQVBJIHN0YXJ0IHRvIHJldHVybiB1c2VyIGRhdGEgb24gUEFUQ0hcbiAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuVXBkYXRlQjJCVXNlclN1Y2Nlc3Mob3JnQ3VzdG9tZXIpLFxuICAgICAgICAgICAgICBdIGFzIGFueVtdO1xuICAgICAgICAgICAgICBpZiAoaXNBc3NpZ25lZFRvQXBwcm92ZXJzKSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzc0FjdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3Zlcih7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgb3JnVW5pdElkOiBvcmdDdXN0b21lci5vcmdVbml0Py51aWQgPz8gJycsXG4gICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICAgIHJvbGVJZDogQjJCVXNlclJvbGUuQVBQUk9WRVIsXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3NBY3Rpb25zO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VcGRhdGVCMkJVc2VyRmFpbCh7XG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBvcmdDdXN0b21lci5jdXN0b21lcklkID8/ICcnLFxuICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciwgdGhpcy5sb2dnZXIpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICB9KVxuICAgIClcbiAgKTtcblxuICBjaGVja1NlbGZFbWFpbFVwZGF0ZSQ6IE9ic2VydmFibGU8XG4gICAgfCBBdXRoQWN0aW9ucy5Mb2dvdXRcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLlVQREFURV9CMkJfVVNFUl9TVUNDRVNTKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5VcGRhdGVCMkJVc2VyU3VjY2VzcykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgd2l0aExhdGVzdEZyb20oXG4gICAgICAgIHRoaXMudXNlckFjY291bnRGYWNhZGUuZ2V0KCksXG4gICAgICAgIHRoaXMudXNlcklkU2VydmljZS5nZXRVc2VySWQoKVxuICAgICAgKSxcbiAgICAgIHN3aXRjaE1hcChcbiAgICAgICAgKFtwYXlsb2FkLCBjdXJyZW50VXNlcl06IFtCMkJVc2VyLCBVc2VyIHwgdW5kZWZpbmVkLCBzdHJpbmddKSA9PiB7XG4gICAgICAgICAgY29uc3QgY3VycmVudFVzZXJFbWFpbE1hdGNoID1cbiAgICAgICAgICAgIHBheWxvYWQuY3VzdG9tZXJJZCA9PT0gY3VycmVudFVzZXI/LmN1c3RvbWVySWQgJiZcbiAgICAgICAgICAgIHBheWxvYWQuZW1haWwgIT09IGN1cnJlbnRVc2VyPy5kaXNwbGF5VWlkO1xuXG4gICAgICAgICAgaWYgKGN1cnJlbnRVc2VyRW1haWxNYXRjaCkge1xuICAgICAgICAgICAgdGhpcy5yb3V0aW5nU2VydmljZS5nbyh7IGN4Um91dGU6ICdsb2dpbicgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBjdXJyZW50VXNlckVtYWlsTWF0Y2hcbiAgICAgICAgICAgID8gW25ldyBBdXRoQWN0aW9ucy5Mb2dvdXQoKV1cbiAgICAgICAgICAgIDogW25ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpXTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBsb2FkQjJCVXNlcnMkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJzU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlcnNGYWlsXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuTE9BRF9CMkJfVVNFUlMpLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VycykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3IuZ2V0TGlzdChwYXlsb2FkLnVzZXJJZCwgcGF5bG9hZC5wYXJhbXMpLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKChiMmJVc2VyczogRW50aXRpZXNNb2RlbDxCMkJVc2VyPikgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICAgIGIyYlVzZXJzLFxuICAgICAgICAgICAgICAnY3VzdG9tZXJJZCdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlcnNTdWNjZXNzKHtcbiAgICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2Vyc0ZhaWwoe1xuICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciwgdGhpcy5sb2dnZXIpLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBsb2FkQjJCVXNlckFwcHJvdmVycyQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckFwcHJvdmVyc1N1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyQXBwcm92ZXJzRmFpbFxuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuTE9BRF9CMkJfVVNFUl9BUFBST1ZFUlMpLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyQXBwcm92ZXJzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBncm91cEJ5KCh7IG9yZ0N1c3RvbWVySWQsIHBhcmFtcyB9KSA9PlxuICAgICAgICBTdGF0ZVV0aWxzLnNlcmlhbGl6ZVBhcmFtcyhvcmdDdXN0b21lcklkLCBwYXJhbXMpXG4gICAgICApLFxuICAgICAgbWVyZ2VNYXAoKGdyb3VwKSA9PlxuICAgICAgICBncm91cC5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT5cbiAgICAgICAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAgICAgICAuZ2V0QXBwcm92ZXJzKFxuICAgICAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICBwYXlsb2FkLnBhcmFtc1xuICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgoYXBwcm92ZXJzOiBFbnRpdGllc01vZGVsPEIyQlVzZXI+KSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB7IHZhbHVlcywgcGFnZSB9ID0gU3RhdGVVdGlscy5ub3JtYWxpemVMaXN0UGFnZShcbiAgICAgICAgICAgICAgICAgICAgYXBwcm92ZXJzLFxuICAgICAgICAgICAgICAgICAgICAnY3VzdG9tZXJJZCdcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckFwcHJvdmVyc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyQXBwcm92ZXJzRmFpbCh7XG4gICAgICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciwgdGhpcy5sb2dnZXIpLFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBsb2FkQjJCVXNlclBlcm1pc3Npb25zJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyUGVybWlzc2lvbnNTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclBlcm1pc3Npb25zRmFpbFxuICAgIHwgUGVybWlzc2lvbkFjdGlvbnMuTG9hZFBlcm1pc3Npb25TdWNjZXNzXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuTE9BRF9CMkJfVVNFUl9QRVJNSVNTSU9OUyksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJQZXJtaXNzaW9ucykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgZ3JvdXBCeSgoeyBvcmdDdXN0b21lcklkLCBwYXJhbXMgfSkgPT5cbiAgICAgICAgU3RhdGVVdGlscy5zZXJpYWxpemVQYXJhbXMob3JnQ3VzdG9tZXJJZCwgcGFyYW1zKVxuICAgICAgKSxcbiAgICAgIG1lcmdlTWFwKChncm91cCkgPT5cbiAgICAgICAgZ3JvdXAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgICAgICAgLmdldFBlcm1pc3Npb25zKFxuICAgICAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICBwYXlsb2FkLnBhcmFtc1xuICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgocGVybWlzc2lvbnM6IEVudGl0aWVzTW9kZWw8UGVybWlzc2lvbj4pID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWVzLCBwYWdlIH0gPSBTdGF0ZVV0aWxzLm5vcm1hbGl6ZUxpc3RQYWdlKFxuICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgJ2NvZGUnXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IFBlcm1pc3Npb25BY3Rpb25zLkxvYWRQZXJtaXNzaW9uU3VjY2Vzcyh2YWx1ZXMpLFxuICAgICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJQZXJtaXNzaW9uc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyUGVybWlzc2lvbnNGYWlsKHtcbiAgICAgICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yLCB0aGlzLmxvZ2dlciksXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIGxvYWRCMkJVc2VyVXNlckdyb3VwcyQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclVzZXJHcm91cHNTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclVzZXJHcm91cHNGYWlsXG4gICAgfCBVc2VyR3JvdXBBY3Rpb25zLkxvYWRVc2VyR3JvdXBTdWNjZXNzXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuTE9BRF9CMkJfVVNFUl9VU0VSX0dST1VQUyksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJVc2VyR3JvdXBzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBncm91cEJ5KCh7IG9yZ0N1c3RvbWVySWQsIHBhcmFtcyB9KSA9PlxuICAgICAgICBTdGF0ZVV0aWxzLnNlcmlhbGl6ZVBhcmFtcyhvcmdDdXN0b21lcklkLCBwYXJhbXMpXG4gICAgICApLFxuICAgICAgbWVyZ2VNYXAoKGdyb3VwKSA9PlxuICAgICAgICBncm91cC5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT5cbiAgICAgICAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAgICAgICAuZ2V0VXNlckdyb3VwcyhcbiAgICAgICAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgcGF5bG9hZC5wYXJhbXNcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKHVzZXJHcm91cHM6IEVudGl0aWVzTW9kZWw8VXNlckdyb3VwPikgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICAgICAgICAgIHVzZXJHcm91cHMsXG4gICAgICAgICAgICAgICAgICAgICd1aWQnXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IFVzZXJHcm91cEFjdGlvbnMuTG9hZFVzZXJHcm91cFN1Y2Nlc3ModmFsdWVzKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyVXNlckdyb3Vwc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyVXNlckdyb3Vwc0ZhaWwoe1xuICAgICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IsIHRoaXMubG9nZ2VyKSxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgYXNzaWduQXBwcm92ZXJUb0IyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlckFwcHJvdmVyU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlckFwcHJvdmVyRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5BU1NJR05fQjJCX1VTRVJfQVBQUk9WRVIpLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJBcHByb3ZlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAgIC5hc3NpZ25BcHByb3ZlcihcbiAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5hcHByb3ZlcklkXG4gICAgICAgICAgKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiBbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyQXBwcm92ZXJTdWNjZXNzKHtcbiAgICAgICAgICAgICAgICAvLyBPY2MgcmV0dXJuZWQgZW1haWwsIGJ1dCB3ZSB1c2UgY3VzdG9tZXJJZCBpbiBzdG9yZVxuICAgICAgICAgICAgICAgIGFwcHJvdmVySWQ6IHBheWxvYWQuYXBwcm92ZXJJZCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIC8vIENsZWFyaW5nIGRhdGEgaW4gdGhpcyBjYXNlIGNhdXNlcyB1bmV4cGVjdGVkIGJlaGF2aW9yICgjMTA0NjgpXG4gICAgICAgICAgICAgIC8vIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyQXBwcm92ZXJGYWlsKHtcbiAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgIGFwcHJvdmVySWQ6IHBheWxvYWQuYXBwcm92ZXJJZCxcbiAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IsIHRoaXMubG9nZ2VyKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIHVuYXNzaWduQXBwcm92ZXJGcm9tQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJBcHByb3ZlclN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlckFwcHJvdmVyRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5VTkFTU0lHTl9CMkJfVVNFUl9BUFBST1ZFUiksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyQXBwcm92ZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PlxuICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgICAudW5hc3NpZ25BcHByb3ZlcihcbiAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5hcHByb3ZlcklkXG4gICAgICAgICAgKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiBbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJBcHByb3ZlclN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIC8vIE9jYyByZXR1cm5lZCBlbWFpbCwgYnV0IHdlIHVzZSBjdXN0b21lcklkIGluIHN0b3JlXG4gICAgICAgICAgICAgICAgYXBwcm92ZXJJZDogcGF5bG9hZC5hcHByb3ZlcklkLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkYXRhLnNlbGVjdGVkLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgLy8gQ2xlYXJpbmcgZGF0YSBpbiB0aGlzIGNhc2UgY2F1c2VzIHVuZXhwZWN0ZWQgYmVoYXZpb3IgKCMxMDQ2OClcbiAgICAgICAgICAgICAgLy8gbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlckFwcHJvdmVyRmFpbCh7XG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICBhcHByb3ZlcklkOiBwYXlsb2FkLmFwcHJvdmVySWQsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yLCB0aGlzLmxvZ2dlciksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBhc3NpZ25QZXJtaXNzaW9uVG9CMkJVc2VyJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclBlcm1pc3Npb25GYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkFTU0lHTl9CMkJfVVNFUl9QRVJNSVNTSU9OKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyUGVybWlzc2lvbikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAgIC5hc3NpZ25QZXJtaXNzaW9uKFxuICAgICAgICAgICAgcGF5bG9hZC51c2VySWQsXG4gICAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICBwYXlsb2FkLnBlcm1pc3Npb25JZFxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclBlcm1pc3Npb25TdWNjZXNzKHtcbiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uSWQ6IGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRhdGEuc2VsZWN0ZWQsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICBmcm9tKFtcbiAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclBlcm1pc3Npb25GYWlsKHtcbiAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25JZDogcGF5bG9hZC5wZXJtaXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yLCB0aGlzLmxvZ2dlciksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICB1bmFzc2lnblBlcm1pc3Npb25Gcm9tQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyUGVybWlzc2lvbkZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuVU5BU1NJR05fQjJCX1VTRVJfUEVSTUlTU0lPTiksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyUGVybWlzc2lvbikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAgIC51bmFzc2lnblBlcm1pc3Npb24oXG4gICAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgIHBheWxvYWQucGVybWlzc2lvbklkXG4gICAgICAgICAgKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiBbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgcGVybWlzc2lvbklkOiBkYXRhLmlkLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkYXRhLnNlbGVjdGVkLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlclBlcm1pc3Npb25GYWlsKHtcbiAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25JZDogcGF5bG9hZC5wZXJtaXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yLCB0aGlzLmxvZ2dlciksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBhc3NpZ25Vc2VyR3JvdXBUb0IyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclVzZXJHcm91cFN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJVc2VyR3JvdXBGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkFTU0lHTl9CMkJfVVNFUl9VU0VSX0dST1VQKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyVXNlckdyb3VwKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBtZXJnZU1hcCgocGF5bG9hZCkgPT5cbiAgICAgICAgdGhpcy5iMmJVc2VyQ29ubmVjdG9yXG4gICAgICAgICAgLmFzc2lnblVzZXJHcm91cChcbiAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgcGF5bG9hZC51c2VyR3JvdXBJZFxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclVzZXJHcm91cFN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIHVpZDogZGF0YS5pZCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyVXNlckdyb3VwRmFpbCh7XG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICB1c2VyR3JvdXBJZDogcGF5bG9hZC51c2VyR3JvdXBJZCxcbiAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IsIHRoaXMubG9nZ2VyKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIHVuYXNzaWduVXNlckdyb3VwRnJvbUIyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyVXNlckdyb3VwU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyVXNlckdyb3VwRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5VTkFTU0lHTl9CMkJfVVNFUl9VU0VSX0dST1VQKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJVc2VyR3JvdXApID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PlxuICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgICAudW5hc3NpZ25Vc2VyR3JvdXAoXG4gICAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgIHBheWxvYWQudXNlckdyb3VwSWRcbiAgICAgICAgICApXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBzd2l0Y2hNYXAoXG4gICAgICAgICAgICAgIC8vIFRPRE86IFdvcmthcm91bmQgYmVjYXVzZSBvY2MgZG9lc24ndCByZXNwb25kIGhlcmVcbiAgICAgICAgICAgICAgLy8gKGRhdGEpID0+XG4gICAgICAgICAgICAgIC8vICAgbmV3IEIyQlVzZXJBY3Rpb25zLkRlbGV0ZUIyQlVzZXJVc2VyR3JvdXBTdWNjZXNzKHtcbiAgICAgICAgICAgICAgLy8gICAgIHVpZDogZGF0YS5pZCxcbiAgICAgICAgICAgICAgLy8gICAgIHNlbGVjdGVkOiBkYXRhLnNlbGVjdGVkLFxuICAgICAgICAgICAgICAvLyAgIH0pXG4gICAgICAgICAgICAgICgpID0+IFtcbiAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyVXNlckdyb3VwU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgICB1aWQ6IHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJVc2VyR3JvdXBGYWlsKHtcbiAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgIHVzZXJHcm91cElkOiBwYXlsb2FkLnVzZXJHcm91cElkLFxuICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciwgdGhpcy5sb2dnZXIpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBhY3Rpb25zJDogQWN0aW9ucyxcbiAgICBwcml2YXRlIGIyYlVzZXJDb25uZWN0b3I6IEIyQlVzZXJDb25uZWN0b3IsXG4gICAgcHJpdmF0ZSByb3V0aW5nU2VydmljZTogUm91dGluZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSB1c2VyQWNjb3VudEZhY2FkZTogVXNlckFjY291bnRGYWNhZGUsXG4gICAgcHJpdmF0ZSB1c2VySWRTZXJ2aWNlOiBVc2VySWRTZXJ2aWNlXG4gICkge31cblxuICBwcm90ZWN0ZWQgcmVkaXJlY3RUb0RldGFpbHMocm91dGU6IFJvdXRlclN0YXRlLCBkYXRhOiBCMkJVc2VyKSB7XG4gICAgaWYgKChyb3V0ZSBhcyBhbnkpPy5zdGF0ZT8uY29udGV4dD8uaWQgIT09ICcvb3JnYW5pemF0aW9uL3VuaXRzJykge1xuICAgICAgdGhpcy5yb3V0aW5nU2VydmljZS5nbyh7XG4gICAgICAgIGN4Um91dGU6ICdvcmdVc2VyRGV0YWlscycsXG4gICAgICAgIHBhcmFtczogZGF0YSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19