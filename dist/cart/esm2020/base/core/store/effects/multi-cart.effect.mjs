/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Injectable } from '@angular/core';
import { createEffect, ofType } from '@ngrx/effects';
import { CartType } from '@spartacus/cart/base/root';
import { isNotUndefined, OCC_CART_ID_CURRENT } from '@spartacus/core';
import { filter, map } from 'rxjs/operators';
import { isSelectiveCart } from '../../utils/utils';
import { CartActions } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "./multi-cart-effect.service";
export class MultiCartEffects {
    /**
     * Verifies if cart is the current cart and returns the appropriate cart type
     * @param action
     * @returns cart type needed on load
     */
    getActiveCartTypeOnLoad(action) {
        if (action?.payload?.cartId === OCC_CART_ID_CURRENT) {
            return new CartActions.SetCartTypeIndex({
                cartType: CartType.ACTIVE,
                cartId: '',
            });
        }
        return undefined;
    }
    /**
     * Verifies if cart is the active cart or saved cart and returns the appropriate cart type
     * @param action
     * @returns cart type
     */
    getActiveCartTypeOnLoadSuccess(action) {
        // Extracted small portion of private effect's logic to a public service
        // to allow FSA for customizing it (for more, see CXSPA-3551)
        return this.multiCartEffectsService.getActiveCartTypeOnLoadSuccess(action);
    }
    /**
     * Verifies if cart is active and returns the appropriate cart type
     * @param action
     * @returns cart type needed on creation
     */
    getActiveCartTypeOnCreate(action) {
        if (action?.payload?.extraData?.active) {
            return new CartActions.SetCartTypeIndex({
                cartType: CartType.ACTIVE,
                cartId: action.meta.entityId,
            });
        }
        return undefined;
    }
    constructor(actions$, multiCartEffectsService) {
        this.actions$ = actions$;
        this.multiCartEffectsService = multiCartEffectsService;
        // TODO(#7241): Remove when we drop ADD_VOUCHER process and we sort out checkout and cart dependencies
        this.processesIncrement$ = createEffect(() => this.actions$.pipe(ofType(CartActions.CART_ADD_VOUCHER), map((action) => action.payload), map((payload) => new CartActions.CartProcessesIncrement(payload.cartId))));
        this.setSelectiveId$ = createEffect(() => this.actions$.pipe(ofType(CartActions.LOAD_CART_SUCCESS), map((action) => {
            switch (action.type) {
                case CartActions.LOAD_CART_SUCCESS: {
                    const payload = action.payload;
                    if (isSelectiveCart(payload.cartId)) {
                        return new CartActions.SetCartTypeIndex({
                            cartType: CartType.SELECTIVE,
                            cartId: payload.cartId,
                        });
                    }
                    break;
                }
            }
        }), filter(isNotUndefined)));
        this.setActiveCartId$ = createEffect(() => this.actions$.pipe(ofType(CartActions.LOAD_CART_SUCCESS, CartActions.LOAD_CART, CartActions.CREATE_CART_SUCCESS, CartActions.CREATE_CART, CartActions.SET_ACTIVE_CART_ID), map((action) => {
            switch (action.type) {
                case CartActions.LOAD_CART: {
                    return this.getActiveCartTypeOnLoad(action);
                }
                case CartActions.LOAD_CART_SUCCESS: {
                    return this.getActiveCartTypeOnLoadSuccess(action);
                }
                case CartActions.CREATE_CART: {
                    return this.getActiveCartTypeOnCreate(action);
                }
                case CartActions.CREATE_CART_SUCCESS: {
                    return new CartActions.SetCartTypeIndex({
                        cartType: action?.payload?.extraData?.active
                            ? CartType.ACTIVE
                            : CartType.NEW_CREATED,
                        cartId: action.meta.entityId,
                    });
                }
                case CartActions.SET_ACTIVE_CART_ID:
                    return new CartActions.SetCartTypeIndex({
                        cartType: CartType.ACTIVE,
                        cartId: action.payload,
                    });
            }
            return undefined;
        }), filter(isNotUndefined)));
    }
}
MultiCartEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: MultiCartEffects, deps: [{ token: i1.Actions }, { token: i2.MultiCartEffectsService }], target: i0.ɵɵFactoryTarget.Injectable });
MultiCartEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: MultiCartEffects });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: MultiCartEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.MultiCartEffectsService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktY2FydC5lZmZlY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvY2FydC9iYXNlL2NvcmUvc3RvcmUvZWZmZWN0cy9tdWx0aS1jYXJ0LmVmZmVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQVcsWUFBWSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU5RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDckQsT0FBTyxFQUFFLGNBQWMsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXRFLE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7OztBQUkvQyxNQUFNLE9BQU8sZ0JBQWdCO0lBMEUzQjs7OztPQUlHO0lBQ0ssdUJBQXVCLENBQzdCLE1BQTRCO1FBRTVCLElBQUksTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLEtBQUssbUJBQW1CLEVBQUU7WUFDbkQsT0FBTyxJQUFJLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxNQUFNO2dCQUN6QixNQUFNLEVBQUUsRUFBRTthQUNYLENBQUMsQ0FBQztTQUNKO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyw4QkFBOEIsQ0FDcEMsTUFBbUM7UUFFbkMsd0VBQXdFO1FBQ3hFLDZEQUE2RDtRQUM3RCxPQUFPLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyw4QkFBOEIsQ0FBQyxNQUFNLENBQUMs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LE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTTs0QkFDMUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNOzRCQUNqQixDQUFDLENBQUMsUUFBUSxDQUFDLFdBQVc7d0JBQ3hCLE1BQU0sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQWtCO3FCQUN2QyxDQUFDLENBQUM7aUJBQ0o7Z0JBQ0QsS0FBSyxXQUFXLENBQUMsa0JBQWtCO29CQUNqQyxPQUFPLElBQUksV0FBVyxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QyxRQUFRLEVBQUUsUUFBUSxDQUFDLE1BQU07d0JBQ3pCLE1BQU0sRUFBRSxNQUFNLENBQUMsT0FBTztxQkFDdkIsQ0FBQyxDQUFDO2FBQ047WUFDRCxPQUFPLFNBQVMsQ0FBQztRQUNuQixDQUFDLENBQUMsRUFDRixNQUFNLENBQUMsY0FBYyxDQUFDLENBQ3ZCLENBQ0osQ0FBQztJQW9EQyxDQUFDOzs2R0E1SE8sZ0JBQWdCO2lIQUFoQixnQkFBZ0I7MkZBQWhCLGdCQUFnQjtrQkFENUIsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGlvbnMsIGNyZWF0ZUVmZmVjdCwgb2ZUeXBlIH0gZnJvbSAnQG5ncngvZWZmZWN0cyc7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5pbXBvcnQgeyBDYXJ0VHlwZSB9IGZyb20gJ0BzcGFydGFjdXMvY2FydC9iYXNlL3Jvb3QnO1xuaW1wb3J0IHsgaXNOb3RVbmRlZmluZWQsIE9DQ19DQVJUX0lEX0NVUlJFTlQgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBpc1NlbGVjdGl2ZUNhcnQgfSBmcm9tICcuLi8uLi91dGlscy91dGlscyc7XG5pbXBvcnQgeyBDYXJ0QWN0aW9ucyB9IGZyb20gJy4uL2FjdGlvbnMvaW5kZXgnO1xuaW1wb3J0IHsgTXVsdGlDYXJ0RWZmZWN0c1NlcnZpY2UgfSBmcm9tICcuL211bHRpLWNhcnQtZWZmZWN0LnNlcnZpY2UnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTXVsdGlDYXJ0RWZmZWN0cyB7XG4gIC8vIFRPRE8oIzcyNDEpOiBSZW1vdmUgd2hlbiB3ZSBkcm9wIEFERF9WT1VDSEVSIHByb2Nlc3MgYW5kIHdlIHNvcnQgb3V0IGNoZWNrb3V0IGFuZCBjYXJ0IGRlcGVuZGVuY2llc1xuXG4gIHByb2Nlc3Nlc0luY3JlbWVudCQ6IE9ic2VydmFibGU8Q2FydEFjdGlvbnMuQ2FydFByb2Nlc3Nlc0luY3JlbWVudD4gPVxuICAgIGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgICBvZlR5cGUoQ2FydEFjdGlvbnMuQ0FSVF9BRERfVk9VQ0hFUiksXG4gICAgICAgIG1hcCgoYWN0aW9uOiBDYXJ0QWN0aW9ucy5DYXJ0QWRkVm91Y2hlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgICBtYXAoKHBheWxvYWQpID0+IG5ldyBDYXJ0QWN0aW9ucy5DYXJ0UHJvY2Vzc2VzSW5jcmVtZW50KHBheWxvYWQuY2FydElkKSlcbiAgICAgIClcbiAgICApO1xuXG4gIHNldFNlbGVjdGl2ZUlkJDogT2JzZXJ2YWJsZTxDYXJ0QWN0aW9ucy5TZXRDYXJ0VHlwZUluZGV4PiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShDYXJ0QWN0aW9ucy5MT0FEX0NBUlRfU1VDQ0VTUyksXG4gICAgICBtYXAoKGFjdGlvbjogQWN0aW9uKSA9PiB7XG4gICAgICAgIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICAgICAgICBjYXNlIENhcnRBY3Rpb25zLkxPQURfQ0FSVF9TVUNDRVNTOiB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gKGFjdGlvbiBhcyBDYXJ0QWN0aW9ucy5Mb2FkQ2FydFN1Y2Nlc3MpLnBheWxvYWQ7XG4gICAgICAgICAgICBpZiAoaXNTZWxlY3RpdmVDYXJ0KHBheWxvYWQuY2FydElkKSkge1xuICAgICAgICAgICAgICByZXR1cm4gbmV3IENhcnRBY3Rpb25zLlNldENhcnRUeXBlSW5kZXgoe1xuICAgICAgICAgICAgICAgIGNhcnRUeXBlOiBDYXJ0VHlwZS5TRUxFQ1RJVkUsXG4gICAgICAgICAgICAgICAgY2FydElkOiBwYXlsb2FkLmNhcnRJZCxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgZmlsdGVyKGlzTm90VW5kZWZpbmVkKVxuICAgIClcbiAgKTtcblxuICBzZXRBY3RpdmVDYXJ0SWQkOiBPYnNlcnZhYmxlPENhcnRBY3Rpb25zLlNldENhcnRUeXBlSW5kZXg+ID0gY3JlYXRlRWZmZWN0KFxuICAgICgpID0+XG4gICAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICAgIG9mVHlwZShcbiAgICAgICAgICBDYXJ0QWN0aW9ucy5MT0FEX0NBUlRfU1VDQ0VTUyxcbiAgICAgICAgICBDYXJ0QWN0aW9ucy5MT0FEX0NBUlQsXG4gICAgICAgICAgQ2FydEFjdGlvbnMuQ1JFQVRFX0NBUlRfU1VDQ0VTUyxcbiAgICAgICAgICBDYXJ0QWN0aW9ucy5DUkVBVEVfQ0FSVCxcbiAgICAgICAgICBDYXJ0QWN0aW9ucy5TRVRfQUNUSVZFX0NBUlRfSURcbiAgICAgICAgKSxcbiAgICAgICAgbWFwKChhY3Rpb246IENhcnRBY3Rpb25zLkNhcnRBY3Rpb24gfCBDYXJ0QWN0aW9ucy5TZXRBY3RpdmVDYXJ0SWQpID0+IHtcbiAgICAgICAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIENhcnRBY3Rpb25zLkxPQURfQ0FSVDoge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRBY3RpdmVDYXJ0VHlwZU9uTG9hZChhY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBDYXJ0QWN0aW9ucy5MT0FEX0NBUlRfU1VDQ0VTUzoge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRBY3RpdmVDYXJ0VHlwZU9uTG9hZFN1Y2Nlc3MoYWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgQ2FydEFjdGlvbnMuQ1JFQVRFX0NBUlQ6IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWN0aXZlQ2FydFR5cGVPbkNyZWF0ZShhY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBDYXJ0QWN0aW9ucy5DUkVBVEVfQ0FSVF9TVUNDRVNTOiB7XG4gICAgICAgICAgICAgIHJldHVybiBuZXcgQ2FydEFjdGlvbnMuU2V0Q2FydFR5cGVJbmRleCh7XG4gICAgICAgICAgICAgICAgY2FydFR5cGU6IGFjdGlvbj8ucGF5bG9hZD8uZXh0cmFEYXRhPy5hY3RpdmVcbiAgICAgICAgICAgICAgICAgID8gQ2FydFR5cGUuQUNUSVZFXG4gICAgICAgICAgICAgICAgICA6IENhcnRUeXBlLk5FV19DUkVBVEVELFxuICAgICAgICAgICAgICAgIGNhcnRJZDogYWN0aW9uLm1ldGEuZW50aXR5SWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgQ2FydEFjdGlvbnMuU0VUX0FDVElWRV9DQVJUX0lEOlxuICAgICAgICAgICAgICByZXR1cm4gbmV3IENhcnRBY3Rpb25zLlNldENhcnRUeXBlSW5kZXgoe1xuICAgICAgICAgICAgICAgIGNhcnRUeXBlOiBDYXJ0VHlwZS5BQ1RJVkUsXG4gICAgICAgICAgICAgICAgY2FydElkOiBhY3Rpb24ucGF5bG9hZCxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0pLFxuICAgICAgICBmaWx0ZXIoaXNOb3RVbmRlZmluZWQpXG4gICAgICApXG4gICk7XG5cbiAgLyoqXG4gICAqIFZlcmlmaWVzIGlmIGNhcnQgaXMgdGhlIGN1cnJlbnQgY2FydCBhbmQgcmV0dXJucyB0aGUgYXBwcm9wcmlhdGUgY2FydCB0eXBlXG4gICAqIEBwYXJhbSBhY3Rpb25cbiAgICogQHJldHVybnMgY2FydCB0eXBlIG5lZWRlZCBvbiBsb2FkXG4gICAqL1xuICBwcml2YXRlIGdldEFjdGl2ZUNhcnRUeXBlT25Mb2FkKFxuICAgIGFjdGlvbjogQ2FydEFjdGlvbnMuTG9hZENhcnRcbiAgKTogQ2FydEFjdGlvbnMuU2V0Q2FydFR5cGVJbmRleCB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKGFjdGlvbj8ucGF5bG9hZD8uY2FydElkID09PSBPQ0NfQ0FSVF9JRF9DVVJSRU5UKSB7XG4gICAgICByZXR1cm4gbmV3IENhcnRBY3Rpb25zLlNldENhcnRUeXBlSW5kZXgoe1xuICAgICAgICBjYXJ0VHlwZTogQ2FydFR5cGUuQUNUSVZFLFxuICAgICAgICBjYXJ0SWQ6ICcnLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpZXMgaWYgY2FydCBpcyB0aGUgYWN0aXZlIGNhcnQgb3Igc2F2ZWQgY2FydCBhbmQgcmV0dXJucyB0aGUgYXBwcm9wcmlhdGUgY2FydCB0eXBlXG4gICAqIEBwYXJhbSBhY3Rpb25cbiAgICogQHJldHVybnMgY2FydCB0eXBlXG4gICAqL1xuICBwcml2YXRlIGdldEFjdGl2ZUNhcnRUeXBlT25Mb2FkU3VjY2VzcyhcbiAgICBhY3Rpb246IENhcnRBY3Rpb25zLkxvYWRDYXJ0U3VjY2Vzc1xuICApOiBDYXJ0QWN0aW9ucy5TZXRDYXJ0VHlwZUluZGV4IHwgdW5kZWZpbmVkIHtcbiAgICAvLyBFeHRyYWN0ZWQgc21hbGwgcG9ydGlvbiBvZiBwcml2YXRlIGVmZmVjdCdzIGxvZ2ljIHRvIGEgcHVibGljIHNlcnZpY2VcbiAgICAvLyB0byBhbGxvdyBGU0EgZm9yIGN1c3RvbWl6aW5nIGl0IChmb3IgbW9yZSwgc2VlIENYU1BBLTM1NTEpXG4gICAgcmV0dXJuIHRoaXMubXVsdGlDYXJ0RWZmZWN0c1NlcnZpY2UuZ2V0QWN0aXZlQ2FydFR5cGVPbkxvYWRTdWNjZXNzKGFjdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpZXMgaWYgY2FydCBpcyBhY3RpdmUgYW5kIHJldHVybnMgdGhlIGFwcHJvcHJpYXRlIGNhcnQgdHlwZVxuICAgKiBAcGFyYW0gYWN0aW9uXG4gICAqIEByZXR1cm5zIGNhcnQgdHlwZSBuZWVkZWQgb24gY3JlYXRpb25cbiAgICovXG4gIHByaXZhdGUgZ2V0QWN0aXZlQ2FydFR5cGVPbkNyZWF0ZShcbiAgICBhY3Rpb246IENhcnRBY3Rpb25zLkNyZWF0ZUNhcnRcbiAgKTogQ2FydEFjdGlvbnMuU2V0Q2FydFR5cGVJbmRleCB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKGFjdGlvbj8ucGF5bG9hZD8uZXh0cmFEYXRhPy5hY3RpdmUpIHtcbiAgICAgIHJldHVybiBuZXcgQ2FydEFjdGlvbnMuU2V0Q2FydFR5cGVJbmRleCh7XG4gICAgICAgIGNhcnRUeXBlOiBDYXJ0VHlwZS5BQ1RJVkUsXG4gICAgICAgIGNhcnRJZDogYWN0aW9uLm1ldGEuZW50aXR5SWQgYXMgc3RyaW5nLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGFjdGlvbnMkOiBBY3Rpb25zLFxuICAgIHByaXZhdGUgbXVsdGlDYXJ0RWZmZWN0c1NlcnZpY2U6IE11bHRpQ2FydEVmZmVjdHNTZXJ2aWNlXG4gICkge31cbn1cbiJdfQ==