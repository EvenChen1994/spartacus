/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Component } from '@angular/core';
import { FormUtils } from '@spartacus/storefront';
import { CustomerTicketingDialogComponent } from '../../../shared/customer-ticketing-dialog/customer-ticketing-dialog.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@spartacus/storefront";
import * as i3 from "@angular/forms";
import * as i4 from "@spartacus/core";
export class CustomerTicketingReopenDialogComponent extends CustomerTicketingDialogComponent {
    ngOnInit() {
        this.buildForm();
    }
    reopenRequest() {
        if (this.form.invalid) {
            this.form.markAllAsTouched();
            FormUtils.deepUpdateValueAndValidity(this.form);
        }
        else {
            const mustWaitForAttachment = this.form.get('file')?.value?.length > 0 ?? false;
            this.isDataLoading$.next(true);
            this.subscription = this.customerTicketingFacade
                .createTicketEvent(this.prepareTicketEvent(), mustWaitForAttachment)
                .subscribe({
                next: (createdEvent) => {
                    if (this.form.get('file')?.value?.length && createdEvent.code) {
                        this.customerTicketingFacade.uploadAttachment(this.form.get('file')?.value?.item(0), createdEvent.code);
                    }
                },
                complete: () => {
                    this.onComplete();
                },
                error: () => {
                    this.onError();
                },
            });
        }
    }
    onComplete() {
        this.isDataLoading$.next(false);
        this.close('Ticket reopened successfully');
    }
    onError() {
        this.isDataLoading$.next(false);
        this.close('Something went wrong while reopening ticket');
    }
    prepareTicketEvent() {
        return {
            message: this.form?.get('message')?.value,
            toStatus: {
                id: "INPROCESS" /* STATUS.INPROCESS */,
                name: "INPROCESS" /* STATUS_NAME.INPROCESS */,
            },
        };
    }
    ngOnDestroy() {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
}
CustomerTicketingReopenDialogComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CustomerTicketingReopenDialogComponent, deps: null, target: i0.ɵɵFactoryTarget.Component });
CustomerTicketingReopenDialogComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: CustomerTicketingReopenDialogComponent, selector: "cx-customer-ticketing-reopen-dialog", usesInheritance: true, ngImport: i0, template: "<div\n  [cxFocus]=\"focusConfig\"\n  (esc)=\"close('Escape clicked')\"\n  class=\"cx-customer-ticket-form-dialog\"\n>\n  <form [formGroup]=\"form\" class=\"cx-customer-ticket-form-container\">\n    <div class=\"modal-header cx-customer-ticket-form-header\">\n      <div class=\"cx-customer-ticket-form-title modal-title\">\n        {{ 'customerTicketingDetails.reopenRequest' | cxTranslate }}\n      </div>\n      <button\n        (click)=\"close('Close Reopen Request Dialog')\"\n        [attr.aria-label]=\"'common.close' | cxTranslate\"\n        class=\"cx-customer-ticket-form-close close\"\n        type=\"button\"\n      >\n        <span aria-hidden=\"true\">\n          <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n        </span>\n      </button>\n    </div>\n\n    <div class=\"cx-customer-ticket-form-body\">\n      <div class=\"cx-customer-ticket-form-row\">\n        <label>\n          <span class=\"cx-customer-ticket-label label-content\">\n            {{ 'customerTicketing.message' | cxTranslate }}\n          </span>\n          <textarea\n            [maxLength]=\"inputCharactersLimit\"\n            class=\"form-control\"\n            formControlName=\"message\"\n            rows=\"5\"\n          ></textarea>\n\n          <cx-form-errors [control]=\"form.get('message')\"></cx-form-errors>\n\n          <p class=\"cx-customer-ticket-input-hint\">\n            {{\n              'customerTicketing.charactersLeft'\n                | cxTranslate: { count: messagesCharacterLeft }\n            }}\n          </p>\n        </label>\n      </div>\n\n      <div>\n        <cx-file-upload\n          [formControl]=\"$any(form.get('file'))\"\n          [accept]=\"allowedTypes\"\n        >\n          <ng-template>\n            <cx-icon [type]=\"iconTypes.UPLOAD\"></cx-icon>\n            <span class=\"cx-message-footer-text\">{{\n              'customerTicketing.uploadFile' | cxTranslate\n            }}</span>\n          </ng-template>\n        </cx-file-upload>\n\n        <p class=\"cx-customer-ticket-file-upload-hint\">\n          {{\n            'customerTicketing.fileSizeLimit' | cxTranslate: { count: maxSize }\n          }}\n        </p>\n        <p class=\"cx-customer-ticket-file-upload-hint\">\n          {{ 'customerTicketing.maximumAttachment' | cxTranslate }}\n        </p>\n\n        <cx-form-errors\n          [control]=\"form.get('file')\"\n          prefix=\"formErrors.file\"\n        ></cx-form-errors>\n      </div>\n\n      <div class=\"cx-customer-ticket-form-footer\">\n        <button\n          (click)=\"close('Close Reopen Request Dialog')\"\n          class=\"btn btn-secondary\"\n          type=\"button\"\n        >\n          {{ 'customerTicketing.cancel' | cxTranslate }}\n        </button>\n        <button (click)=\"reopenRequest()\" class=\"btn btn-primary\" type=\"button\">\n          {{ 'customerTicketing.submit' | cxTranslate }}\n        </button>\n      </div>\n    </div>\n    <cx-spinner *ngIf=\"isDataLoading$ | async\" class=\"overlay\"></cx-spinner>\n  </form>\n</div>\n", dependencies: [{ kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "directive", type: i2.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "directive", type: i3.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i3.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i3.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "directive", type: i3.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i3.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "component", type: i2.FormErrorsComponent, selector: "cx-form-errors", inputs: ["prefix", "translationParams", "control"] }, { kind: "component", type: i2.FileUploadComponent, selector: "cx-file-upload", inputs: ["accept", "multiple"], outputs: ["update"] }, { kind: "component", type: i2.SpinnerComponent, selector: "cx-spinner" }, { kind: "pipe", type: i1.AsyncPipe, name: "async" }, { kind: "pipe", type: i4.TranslatePipe, name: "cxTranslate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CustomerTicketingReopenDialogComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-customer-ticketing-reopen-dialog', template: "<div\n  [cxFocus]=\"focusConfig\"\n  (esc)=\"close('Escape clicked')\"\n  class=\"cx-customer-ticket-form-dialog\"\n>\n  <form [formGroup]=\"form\" class=\"cx-customer-ticket-form-container\">\n    <div class=\"modal-header cx-customer-ticket-form-header\">\n      <div class=\"cx-customer-ticket-form-title modal-title\">\n        {{ 'customerTicketingDetails.reopenRequest' | cxTranslate }}\n      </div>\n      <button\n        (click)=\"close('Close Reopen Request Dialog')\"\n        [attr.aria-label]=\"'common.close' | cxTranslate\"\n        class=\"cx-customer-ticket-form-close close\"\n        type=\"button\"\n      >\n        <span aria-hidden=\"true\">\n          <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n        </span>\n      </button>\n    </div>\n\n    <div class=\"cx-customer-ticket-form-body\">\n      <div class=\"cx-customer-ticket-form-row\">\n        <label>\n          <span class=\"cx-customer-ticket-label label-content\">\n            {{ 'customerTicketing.message' | cxTranslate }}\n          </span>\n          <textarea\n            [maxLength]=\"inputCharactersLimit\"\n            class=\"form-control\"\n            formControlName=\"message\"\n            rows=\"5\"\n          ></textarea>\n\n          <cx-form-errors [control]=\"form.get('message')\"></cx-form-errors>\n\n          <p class=\"cx-customer-ticket-input-hint\">\n            {{\n              'customerTicketing.charactersLeft'\n                | cxTranslate: { count: messagesCharacterLeft }\n            }}\n          </p>\n        </label>\n      </div>\n\n      <div>\n        <cx-file-upload\n          [formControl]=\"$any(form.get('file'))\"\n          [accept]=\"allowedTypes\"\n        >\n          <ng-template>\n            <cx-icon [type]=\"iconTypes.UPLOAD\"></cx-icon>\n            <span class=\"cx-message-footer-text\">{{\n              'customerTicketing.uploadFile' | cxTranslate\n            }}</span>\n          </ng-template>\n        </cx-file-upload>\n\n        <p class=\"cx-customer-ticket-file-upload-hint\">\n          {{\n            'customerTicketing.fileSizeLimit' | cxTranslate: { count: maxSize }\n          }}\n        </p>\n        <p class=\"cx-customer-ticket-file-upload-hint\">\n          {{ 'customerTicketing.maximumAttachment' | cxTranslate }}\n        </p>\n\n        <cx-form-errors\n          [control]=\"form.get('file')\"\n          prefix=\"formErrors.file\"\n        ></cx-form-errors>\n      </div>\n\n      <div class=\"cx-customer-ticket-form-footer\">\n        <button\n          (click)=\"close('Close Reopen Request Dialog')\"\n          class=\"btn btn-secondary\"\n          type=\"button\"\n        >\n          {{ 'customerTicketing.cancel' | cxTranslate }}\n        </button>\n        <button (click)=\"reopenRequest()\" class=\"btn btn-primary\" type=\"button\">\n          {{ 'customerTicketing.submit' | cxTranslate }}\n        </button>\n      </div>\n    </div>\n    <cx-spinner *ngIf=\"isDataLoading$ | async\" class=\"overlay\"></cx-spinner>\n  </form>\n</div>\n" }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VzdG9tZXItdGlja2V0aW5nLXJlb3Blbi1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL2N1c3RvbWVyLXRpY2tldGluZy9jb21wb25lbnRzL2RldGFpbHMvY3VzdG9tZXItdGlja2V0aW5nLXJlb3Blbi9jdXN0b21lci10aWNrZXRpbmctcmVvcGVuLWRpYWxvZy9jdXN0b21lci10aWNrZXRpbmctcmVvcGVuLWRpYWxvZy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvY3VzdG9tZXItdGlja2V0aW5nL2NvbXBvbmVudHMvZGV0YWlscy9jdXN0b21lci10aWNrZXRpbmctcmVvcGVuL2N1c3RvbWVyLXRpY2tldGluZy1yZW9wZW4tZGlhbG9nL2N1c3RvbWVyLXRpY2tldGluZy1yZW9wZW4tZGlhbG9nLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsU0FBUyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQU03RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFbEQsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLE1BQU0sK0VBQStFLENBQUM7Ozs7OztBQU1qSSxNQUFNLE9BQU8sc0NBQ1gsU0FBUSxnQ0FBZ0M7SUFLeEMsUUFBUTtRQUNOLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsYUFBYTtRQUNYLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDckIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQzdCLFNBQVMsQ0FBQywwQkFBMEIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDakQ7YUFBTTtZQUNMLE1BQU0scUJBQXFCLEdBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLEdBQUcsQ0FBQyxJQUFJLEtBQUssQ0FBQztZQUNwRCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyx1QkFBdUI7aUJBQzdDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLHFCQUFxQixDQUFDO2lCQUNuRSxTQUFTLENBQUM7Z0JBQ1QsSUFBSSxFQUFFLENBQUMsWUFBeUIsRUFBRSxFQUFFO29CQUNsQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLElBQUksWUFBWSxDQUFDLElBQUksRUFBRTt3QkFDN0QsSUFBSSxDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixDQUMzQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNyQyxZQUFZLENBQUMsSUFBSSxDQUNsQixDQUFDO3FCQUNIO2dCQUNILENBQUM7Z0JBQ0QsUUFBUSxFQUFFLEdBQUcsRUFBRTtvQkFDYixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ3BCLENBQUM7Z0JBQ0QsS0FBSyxFQUFFLEdBQUcsRUFBRTtvQkFDVixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ2pCLENBQUM7YUFDRixDQUFDLENBQUM7U0FDTjtJQUNILENBQUM7SUFFUyxVQUFVO1FBQ2xCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRVMsT0FBTztRQUNmLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxLQUFLLENBQUMsNkNBQTZDLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRVMsa0JBQWtCO1FBQzFCLE9BQU87WUFDTCxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSztZQUN6QyxRQUFRLEVBQUU7Z0JBQ1IsRUFBRSxvQ0FBa0I7Z0JBQ3BCLElBQUkseUNBQXVCO2FBQzVCO1NBQ0YsQ0FBQztJQUNKLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDakM7SUFDSCxDQUFDOzttSUEvRFUsc0NBQXNDO3VIQUF0QyxzQ0FBc0Msa0dDcEJuRCxnK0ZBMEZBOzJGRHRFYSxzQ0FBc0M7a0JBSmxELFNBQVM7K0JBQ0UscUNBQXFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjMgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgU1RBVFVTLFxuICBTVEFUVVNfTkFNRSxcbiAgVGlja2V0RXZlbnQsXG59IGZyb20gJ0BzcGFydGFjdXMvY3VzdG9tZXItdGlja2V0aW5nL3Jvb3QnO1xuaW1wb3J0IHsgRm9ybVV0aWxzIH0gZnJvbSAnQHNwYXJ0YWN1cy9zdG9yZWZyb250JztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQ3VzdG9tZXJUaWNrZXRpbmdEaWFsb2dDb21wb25lbnQgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvY3VzdG9tZXItdGlja2V0aW5nLWRpYWxvZy9jdXN0b21lci10aWNrZXRpbmctZGlhbG9nLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LWN1c3RvbWVyLXRpY2tldGluZy1yZW9wZW4tZGlhbG9nJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2N1c3RvbWVyLXRpY2tldGluZy1yZW9wZW4tZGlhbG9nLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgQ3VzdG9tZXJUaWNrZXRpbmdSZW9wZW5EaWFsb2dDb21wb25lbnRcbiAgZXh0ZW5kcyBDdXN0b21lclRpY2tldGluZ0RpYWxvZ0NvbXBvbmVudFxuICBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95XG57XG4gIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuYnVpbGRGb3JtKCk7XG4gIH1cblxuICByZW9wZW5SZXF1ZXN0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmZvcm0uaW52YWxpZCkge1xuICAgICAgdGhpcy5mb3JtLm1hcmtBbGxBc1RvdWNoZWQoKTtcbiAgICAgIEZvcm1VdGlscy5kZWVwVXBkYXRlVmFsdWVBbmRWYWxpZGl0eSh0aGlzLmZvcm0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtdXN0V2FpdEZvckF0dGFjaG1lbnQgPVxuICAgICAgICB0aGlzLmZvcm0uZ2V0KCdmaWxlJyk/LnZhbHVlPy5sZW5ndGggPiAwID8/IGZhbHNlO1xuICAgICAgdGhpcy5pc0RhdGFMb2FkaW5nJC5uZXh0KHRydWUpO1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSB0aGlzLmN1c3RvbWVyVGlja2V0aW5nRmFjYWRlXG4gICAgICAgIC5jcmVhdGVUaWNrZXRFdmVudCh0aGlzLnByZXBhcmVUaWNrZXRFdmVudCgpLCBtdXN0V2FpdEZvckF0dGFjaG1lbnQpXG4gICAgICAgIC5zdWJzY3JpYmUoe1xuICAgICAgICAgIG5leHQ6IChjcmVhdGVkRXZlbnQ6IFRpY2tldEV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5mb3JtLmdldCgnZmlsZScpPy52YWx1ZT8ubGVuZ3RoICYmIGNyZWF0ZWRFdmVudC5jb2RlKSB7XG4gICAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJUaWNrZXRpbmdGYWNhZGUudXBsb2FkQXR0YWNobWVudChcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm0uZ2V0KCdmaWxlJyk/LnZhbHVlPy5pdGVtKDApLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWRFdmVudC5jb2RlXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbkNvbXBsZXRlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvcjogKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbkVycm9yKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIG9uQ29tcGxldGUoKTogdm9pZCB7XG4gICAgdGhpcy5pc0RhdGFMb2FkaW5nJC5uZXh0KGZhbHNlKTtcbiAgICB0aGlzLmNsb3NlKCdUaWNrZXQgcmVvcGVuZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gIH1cblxuICBwcm90ZWN0ZWQgb25FcnJvcigpOiB2b2lkIHtcbiAgICB0aGlzLmlzRGF0YUxvYWRpbmckLm5leHQoZmFsc2UpO1xuICAgIHRoaXMuY2xvc2UoJ1NvbWV0aGluZyB3ZW50IHdyb25nIHdoaWxlIHJlb3BlbmluZyB0aWNrZXQnKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBwcmVwYXJlVGlja2V0RXZlbnQoKTogVGlja2V0RXZlbnQge1xuICAgIHJldHVybiB7XG4gICAgICBtZXNzYWdlOiB0aGlzLmZvcm0/LmdldCgnbWVzc2FnZScpPy52YWx1ZSxcbiAgICAgIHRvU3RhdHVzOiB7XG4gICAgICAgIGlkOiBTVEFUVVMuSU5QUk9DRVNTLFxuICAgICAgICBuYW1lOiBTVEFUVVNfTkFNRS5JTlBST0NFU1MsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2XG4gIFtjeEZvY3VzXT1cImZvY3VzQ29uZmlnXCJcbiAgKGVzYyk9XCJjbG9zZSgnRXNjYXBlIGNsaWNrZWQnKVwiXG4gIGNsYXNzPVwiY3gtY3VzdG9tZXItdGlja2V0LWZvcm0tZGlhbG9nXCJcbj5cbiAgPGZvcm0gW2Zvcm1Hcm91cF09XCJmb3JtXCIgY2xhc3M9XCJjeC1jdXN0b21lci10aWNrZXQtZm9ybS1jb250YWluZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyIGN4LWN1c3RvbWVyLXRpY2tldC1mb3JtLWhlYWRlclwiPlxuICAgICAgPGRpdiBjbGFzcz1cImN4LWN1c3RvbWVyLXRpY2tldC1mb3JtLXRpdGxlIG1vZGFsLXRpdGxlXCI+XG4gICAgICAgIHt7ICdjdXN0b21lclRpY2tldGluZ0RldGFpbHMucmVvcGVuUmVxdWVzdCcgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgPC9kaXY+XG4gICAgICA8YnV0dG9uXG4gICAgICAgIChjbGljayk9XCJjbG9zZSgnQ2xvc2UgUmVvcGVuIFJlcXVlc3QgRGlhbG9nJylcIlxuICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIidjb21tb24uY2xvc2UnIHwgY3hUcmFuc2xhdGVcIlxuICAgICAgICBjbGFzcz1cImN4LWN1c3RvbWVyLXRpY2tldC1mb3JtLWNsb3NlIGNsb3NlXCJcbiAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICA+XG4gICAgICAgIDxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPlxuICAgICAgICAgIDxjeC1pY29uIFt0eXBlXT1cImljb25UeXBlcy5DTE9TRVwiPjwvY3gtaWNvbj5cbiAgICAgICAgPC9zcGFuPlxuICAgICAgPC9idXR0b24+XG4gICAgPC9kaXY+XG5cbiAgICA8ZGl2IGNsYXNzPVwiY3gtY3VzdG9tZXItdGlja2V0LWZvcm0tYm9keVwiPlxuICAgICAgPGRpdiBjbGFzcz1cImN4LWN1c3RvbWVyLXRpY2tldC1mb3JtLXJvd1wiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJjeC1jdXN0b21lci10aWNrZXQtbGFiZWwgbGFiZWwtY29udGVudFwiPlxuICAgICAgICAgICAge3sgJ2N1c3RvbWVyVGlja2V0aW5nLm1lc3NhZ2UnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPHRleHRhcmVhXG4gICAgICAgICAgICBbbWF4TGVuZ3RoXT1cImlucHV0Q2hhcmFjdGVyc0xpbWl0XCJcbiAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cIm1lc3NhZ2VcIlxuICAgICAgICAgICAgcm93cz1cIjVcIlxuICAgICAgICAgID48L3RleHRhcmVhPlxuXG4gICAgICAgICAgPGN4LWZvcm0tZXJyb3JzIFtjb250cm9sXT1cImZvcm0uZ2V0KCdtZXNzYWdlJylcIj48L2N4LWZvcm0tZXJyb3JzPlxuXG4gICAgICAgICAgPHAgY2xhc3M9XCJjeC1jdXN0b21lci10aWNrZXQtaW5wdXQtaGludFwiPlxuICAgICAgICAgICAge3tcbiAgICAgICAgICAgICAgJ2N1c3RvbWVyVGlja2V0aW5nLmNoYXJhY3RlcnNMZWZ0J1xuICAgICAgICAgICAgICAgIHwgY3hUcmFuc2xhdGU6IHsgY291bnQ6IG1lc3NhZ2VzQ2hhcmFjdGVyTGVmdCB9XG4gICAgICAgICAgICB9fVxuICAgICAgICAgIDwvcD5cbiAgICAgICAgPC9sYWJlbD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8Y3gtZmlsZS11cGxvYWRcbiAgICAgICAgICBbZm9ybUNvbnRyb2xdPVwiJGFueShmb3JtLmdldCgnZmlsZScpKVwiXG4gICAgICAgICAgW2FjY2VwdF09XCJhbGxvd2VkVHlwZXNcIlxuICAgICAgICA+XG4gICAgICAgICAgPG5nLXRlbXBsYXRlPlxuICAgICAgICAgICAgPGN4LWljb24gW3R5cGVdPVwiaWNvblR5cGVzLlVQTE9BRFwiPjwvY3gtaWNvbj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiY3gtbWVzc2FnZS1mb290ZXItdGV4dFwiPnt7XG4gICAgICAgICAgICAgICdjdXN0b21lclRpY2tldGluZy51cGxvYWRGaWxlJyB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICB9fTwvc3Bhbj5cbiAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8L2N4LWZpbGUtdXBsb2FkPlxuXG4gICAgICAgIDxwIGNsYXNzPVwiY3gtY3VzdG9tZXItdGlja2V0LWZpbGUtdXBsb2FkLWhpbnRcIj5cbiAgICAgICAgICB7e1xuICAgICAgICAgICAgJ2N1c3RvbWVyVGlja2V0aW5nLmZpbGVTaXplTGltaXQnIHwgY3hUcmFuc2xhdGU6IHsgY291bnQ6IG1heFNpemUgfVxuICAgICAgICAgIH19XG4gICAgICAgIDwvcD5cbiAgICAgICAgPHAgY2xhc3M9XCJjeC1jdXN0b21lci10aWNrZXQtZmlsZS11cGxvYWQtaGludFwiPlxuICAgICAgICAgIHt7ICdjdXN0b21lclRpY2tldGluZy5tYXhpbXVtQXR0YWNobWVudCcgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICA8L3A+XG5cbiAgICAgICAgPGN4LWZvcm0tZXJyb3JzXG4gICAgICAgICAgW2NvbnRyb2xdPVwiZm9ybS5nZXQoJ2ZpbGUnKVwiXG4gICAgICAgICAgcHJlZml4PVwiZm9ybUVycm9ycy5maWxlXCJcbiAgICAgICAgPjwvY3gtZm9ybS1lcnJvcnM+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBjbGFzcz1cImN4LWN1c3RvbWVyLXRpY2tldC1mb3JtLWZvb3RlclwiPlxuICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgKGNsaWNrKT1cImNsb3NlKCdDbG9zZSBSZW9wZW4gUmVxdWVzdCBEaWFsb2cnKVwiXG4gICAgICAgICAgY2xhc3M9XCJidG4gYnRuLXNlY29uZGFyeVwiXG4gICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgID5cbiAgICAgICAgICB7eyAnY3VzdG9tZXJUaWNrZXRpbmcuY2FuY2VsJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIChjbGljayk9XCJyZW9wZW5SZXF1ZXN0KClcIiBjbGFzcz1cImJ0biBidG4tcHJpbWFyeVwiIHR5cGU9XCJidXR0b25cIj5cbiAgICAgICAgICB7eyAnY3VzdG9tZXJUaWNrZXRpbmcuc3VibWl0JyB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGN4LXNwaW5uZXIgKm5nSWY9XCJpc0RhdGFMb2FkaW5nJCB8IGFzeW5jXCIgY2xhc3M9XCJvdmVybGF5XCI+PC9jeC1zcGlubmVyPlxuICA8L2Zvcm0+XG48L2Rpdj5cbiJdfQ==