"use strict";(self.webpackChunkstorefrontapp=self.webpackChunkstorefrontapp||[]).push([[5708],{5708:(te,D,c)=>{c.r(D),c.d(D,{CdcModule:()=>q});var e=c(4650),f=c(6895),i=c(5955),h=c(2700),R=c(6916),_=c(5778),v=c(2994),p=c(2986);function G(t,o){if(1&t&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&t){const n=e.oxw().ngIf,s=e.oxw(2).ngIf,r=e.oxw();e.uIk("id",s.containerID),e.xp6(1),e.hij(" ",r.displayScreenSet(s,n)," ")}}function w(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"a",4),e.NdJ("click",function(){e.CHM(n);const r=e.oxw().ngIf,a=e.oxw(2).ngIf,d=e.oxw();return e.KtG(d.showScreenSet(a,r))}),e._uU(1),e.qZA()}if(2&t){const n=e.oxw(3).ngIf;e.uIk("data-cdc-id",n.uid)("data-profile-edit",n.profileEdit),e.xp6(1),e.Oqu(n.linkText)}}function k(t,o){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,G,2,2,"div",2),e.YNc(2,w,2,3,"ng-template",null,3,e.W1O),e.qZA()),2&t){const n=e.MAs(3),s=e.oxw(2).ngIf,r=e.oxw();e.xp6(1),e.Q6J("ngIf",r.displayInEmbedMode(s))("ngIfElse",n)}}function J(t,o){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,k,4,2,"div",0),e.ALo(2,"async"),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,n.language$))}}function Y(t,o){1&t&&(e.TgZ(0,"div",5),e._uU(1),e.ALo(2,"cxTranslate"),e.ALo(3,"cxTranslate"),e.qZA()),2&t&&(e.xp6(1),e.AsE(" ",e.lcZ(2,2,"errorHandlers.scriptFailedToLoad")," ",e.lcZ(3,4,"errorHandlers.refreshThePage")," "))}function $(t,o){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,J,3,3,"div",0),e.ALo(2,"async"),e.YNc(3,Y,4,6,"div",1),e.ALo(4,"async"),e.qZA()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,n.jsLoaded$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,n.jsError$))}}let O=(()=>{class t{constructor(n,s,r,a,d,g,l){this.component=n,this.baseSiteService=s,this.languageService=r,this.cdcConfig=a,this.winRef=d,this.cdcJSService=g,this.zone=l,this.renderScreenSet=!0}ngOnInit(){this.jsLoaded$=this.cdcJSService.didLoad(),this.jsError$=this.cdcJSService.didScriptFailToLoad(),this.language$=this.languageService.getActive().pipe((0,_.x)(),(0,v.b)(()=>this.renderScreenSet=!0))}displayScreenSet(n,s){this.renderScreenSet&&this.showScreenSet(n,s),this.renderScreenSet=!1}showScreenSet(n,s){this.winRef.nativeWindow?.gigya?.accounts?.showScreenSet({screenSet:n.screenSet,startScreen:n.startScreen,lang:s,...this.displayInEmbedMode(n)?{containerID:n.containerID}:{},...this.isLoginScreenSet(n)?{sessionExpiration:this.getSessionExpirationValue()}:{onAfterSubmit:(...r)=>{this.zone.run(()=>this.cdcJSService.onProfileUpdateEventHandler(...r))}}})}isLoginScreenSet(n){return!("true"===n.profileEdit)}getSessionExpirationValue(){if(void 0!==this.cdcConfig?.cdc){const n=this.cdcConfig.cdc.filter(s=>s.baseSite===this.getCurrentBaseSite());if(n&&n.length>0)return n[0].sessionExpiration}return 3600}getCurrentBaseSite(){let n="";return this.baseSiteService.getActive().pipe((0,p.q)(1)).subscribe(s=>n=s),n}displayInEmbedMode(n){return!!("true"===n.embed&&n.containerID&&n.containerID.length>0)}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(R.exf),e.Y36(i.Do$),e.Y36(i.TSl),e.Y36(h.Y4),e.Y36(i.X9E),e.Y36(h.bF),e.Y36(e.R0b))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cx-gigya-raas"]],decls:2,vars:3,consts:[[4,"ngIf"],["class","js-error",4,"ngIf"],[4,"ngIf","ngIfElse"],["popupLink",""],[1,"popup-link",3,"click"],[1,"js-error"]],template:function(n,s){1&n&&(e.YNc(0,$,5,6,"div",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,s.component.data$))},dependencies:[f.O5,f.Ov,i.X$D],styles:["cx-gigya-raas .popup-link{cursor:pointer;color:var(--cx-color-primary)}cx-gigya-raas .js-error{text-align:center;padding:4rem}\n"],encapsulation:2,changeDetection:0}),t})(),N=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[f.ez,i.LUR,i.pEA.withConfig({cmsComponents:{GigyaRaasComponent:{component:O}},layoutSlots:{GigyaLoginPageTemplate:{slots:["BodyContent","BottomContent"]}}})]}),t})(),j=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[f.ez,N]}),t})();var M=c(529),z=c(1737),T=c(1086),B=c(6053),Z=c(8896),U=c(7221),y=c(4850),S=c(7545),C=c(1709),b=c(5359),W=c(8353),u=c(5024);let I=(()=>{class t{constructor(n,s){this.http=n,this.authConfigService=s}loadTokenUsingCustomFlow(n,s,r,a,d){const g=this.authConfigService.getTokenEndpoint(),l=(new M.LE).set("client_id",this.authConfigService.getClientId()).set("client_secret",this.authConfigService.getClientSecret()).set("grant_type","custom").set("UID",encodeURIComponent(n)).set("UIDSignature",encodeURIComponent(s)).set("signatureTimestamp",encodeURIComponent(r)).set("id_token",encodeURIComponent(a)).set("baseSite",encodeURIComponent(d));return this.http.post(g,l).pipe((0,U.K)(ee=>(0,z._)(ee)))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(M.eN),e.LFG(i.dSP))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})(),L=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[I],imports:[f.ez,i.nyr]}),t})();const A="[Auth] Load CDC User Token",E="[Auth] Load CDC User Token Fail";class x{constructor(o){this.payload=o,this.type=E}}class F{constructor(o){this.payload=o,this.type=A}}let m=(()=>{class t{constructor(n,s,r,a,d){this.store=n,this.authStorageService=s,this.userIdService=r,this.globalMessageService=a,this.authRedirectService=d}loginWithCustomCdcFlow(n,s,r,a,d){this.store.dispatch(new F({UID:n,UIDSignature:s,signatureTimestamp:r,idToken:a,baseSite:d}))}isAsmAuthStorageService(n){return"getTokenTarget"in n}loginWithToken(n){let s=(0,T.of)(!0);this.isAsmAuthStorageService(this.authStorageService)&&(s=(0,B.aj)([this.authStorageService.getToken(),this.authStorageService.getTokenTarget()]).pipe((0,p.q)(1),(0,y.U)(([r,a])=>!!r?.access_token&&a===W.gt.CSAgent),(0,v.b)(r=>{r&&this.globalMessageService.add({key:"asm.auth.agentLoggedInError"},i.xUg.MSG_TYPE_ERROR)}),(0,y.U)(r=>!r))),s.pipe((0,p.q)(1)).subscribe(r=>{r&&(this.setTokenData(n),this.userIdService.setUserId(i.zyp),this.store.dispatch(new i.uQL.Login),this.globalMessageService.remove(i.xUg.MSG_TYPE_ERROR),this.authRedirectService.redirect())})}setTokenData(n){if(this.authStorageService.setItem("access_token",n.access_token),n.granted_scopes&&Array.isArray(n.granted_scopes)&&this.authStorageService.setItem("granted_scopes",JSON.stringify(n.granted_scopes)),this.authStorageService.setItem("access_token_stored_at",""+Date.now()),n.expires_in){const s=1e3*n.expires_in,a=(new Date).getTime()+s;this.authStorageService.setItem("expires_at",""+a)}n.refresh_token&&this.authStorageService.setItem("refresh_token",n.refresh_token)}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(b.yh),e.LFG(i.jg0),e.LFG(i.XBV),e.LFG(i.IWp),e.LFG(i.FUY))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();const P=[m,{provide:h.Wz,useExisting:m}];let K=(()=>{class t{constructor(n,s){this.stateEventService=n,this.eventService=s,this.register()}register(){this.registerLoadUserTokenFail()}registerLoadUserTokenFail(){this.stateEventService.register({action:E,event:h.yB})}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(i.vL$),e.LFG(i.POd))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Q=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(K))},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({}),t})();const X=[(()=>{class t{constructor(n,s,r,a){this.actions$=n,this.userTokenService=s,this.globalMessageService=r,this.cdcAuthService=a,this.logger=(0,e.f3M)(i.mQy),this.loadCdcUserToken$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(A),(0,y.U)(d=>d.payload),(0,C.zg)(d=>this.userTokenService.loadTokenUsingCustomFlow(d.UID,d.UIDSignature,d.signatureTimestamp,d.idToken,d.baseSite).pipe((0,S.w)(g=>(this.cdcAuthService.loginWithToken(g),Z.E)),(0,U.K)(g=>(this.globalMessageService.add({key:"httpHandlers.badGateway"},i.xUg.MSG_TYPE_ERROR),(0,T.of)(new x({error:(0,i.cxH)(g,this.logger),initialActionPayload:d}))))))))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(u.eX),e.LFG(I),e.LFG(i.IWp),e.LFG(m))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})(),(()=>{class t{getAddresses(){return this.userIdService.takeUserId().pipe((0,p.q)(1),(0,S.w)(n=>this.userAddressConnector.getAll(n)))}getDefaultAddress(n){return n.find(s=>!0===s?.defaultAddress)}getCountryName(n,s){return n.find(r=>r.isocode===s)?.name}updateDefaultAddressInCDC(){return this.getAddresses().pipe((0,p.q)(1),(0,S.w)(n=>{const s=this.getDefaultAddress(n)||{};return this.sendAddressToCDC(s)}))}sendAddressToCDC(n){const s=n.formattedAddress||" ";return this.userAddressService.getDeliveryCountries().pipe((0,p.q)(1),(0,S.w)(r=>{const a=this.getCountryName(r,n.country?.isocode||" ")||" ";return this.cdcJsService.updateAddressWithoutScreenSet(s,n.postalCode||" ",n.town||" ",a)}))}showErrorMessage(n){this.messageService.add(n?.errorMessage||" ",i.xUg.MSG_TYPE_ERROR)}constructor(n,s,r,a,d,g){this.actions$=n,this.userIdService=s,this.userAddressConnector=r,this.userAddressService=a,this.messageService=d,this.cdcJsService=g,this.addressFieldKeys=["line1","line2","region.name","town","postalCode"],this.cdcAddUserAddress$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(i.EJN.ADD_USER_ADDRESS_SUCCESS),(0,C.zg)(()=>this.updateDefaultAddressInCDC()),(0,v.b)({error:l=>this.showErrorMessage(l)})),{dispatch:!1}),this.cdcUpdateUserAddress$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(i.EJN.UPDATE_USER_ADDRESS_SUCCESS),(0,C.zg)(()=>this.updateDefaultAddressInCDC()),(0,v.b)({error:l=>this.showErrorMessage(l)})),{dispatch:!1}),this.cdcDeleteUserAddress$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(i.EJN.DELETE_USER_ADDRESS_SUCCESS),(0,C.zg)(()=>this.updateDefaultAddressInCDC()),(0,v.b)({error:l=>this.showErrorMessage(l)})),{dispatch:!1})}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(u.eX),e.LFG(i.XBV),e.LFG(i.t3T),e.LFG(i.kFJ),e.LFG(i.IWp),e.LFG(h.bF))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})()];let H=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[m],imports:[f.ez,L,u.sQ.forFeature(X)]}),t})(),V=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[...P],imports:[L,Q,H]}),t})(),q=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[j,V]}),t})()}}]);