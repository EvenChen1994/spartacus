<ng-container *ngIf="messageEvents$ | async as messageEvents">
  <div class="container">
    <div class="cx-avatar-line"></div>
    <div
      class="cx-messages"
      id="cx-messages"
      (keydown.arrowdown)="focusNextChild($event)"
      (keydown.arrowup)="focusPreviousChild($event)"
      [attr.aria-label]="'chatMessaging.messages' | cxTranslate"
    >
      <ng-container *ngFor="let message of messageEvents; let i = index">
        <div
          class="cx-message-card"
          [ngClass]="{ 'cx-message-display': message.rightAlign }"
        >
          <cx-avatar [message]="message"> </cx-avatar>

          <div>
            <label>{{
              message.createdAt
                | cxDate: messagingConfigs.dateFormat ?? dateFormat
            }}</label>
            <div
              [ngClass]="
                message.rightAlign
                  ? 'cx-message-right-align-text'
                  : 'cx-message-left-align-text'
              "
              [tabindex]="i ? -1 : 0"
              role="listitem"
              [attr.aria-label]="
                'chatMessaging.textLabel'
                  | cxTranslate
                    : {
                        author: message.author,
                        text: message.text,
                        date:
                          message.createdAt
                          | cxDate: messagingConfigs.dateFormat ?? dateFormat
                      }
              "
            >
              {{ message.text }}
            </div>
            <a
              *ngFor="let attachment of message.attachments"
              class="cx-attachment"
              href="{{ attachment.URL }}"
              target="_blank"
            >
              <cx-icon [type]="iconTypes.ATTACHMENT"></cx-icon>
              {{ attachment.filename }}
            </a>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <div [formGroup]="form" class="cx-message-footer">
    <div class="cx-message-box">
      <input
        formControlName="message"
        type="text"
        class="form-control"
        placeholder="{{
          messagingConfigs?.newMessagePlaceHolder ||
            ('chatMessaging.addNewMessage' | cxTranslate)
        }}"
        [maxLength]="messagingConfigs?.charactersLimit || MAX_INPUT_CHARACTERS"
      />
      <div class="cx-message-footer-labels" id="cx-message-footer">
        <cx-file-upload
          [formControl]="form.get('file')"
          [accept]="messagingConfigs?.attachmentRestrictions?.allowedTypes"
          multiple="maxEntries > 1"
          *ngIf="messagingConfigs?.enableFileUploadOption"
        >
          <ng-template>
            <cx-icon [type]="iconTypes.UPLOAD"></cx-icon>
            <span class="cx-message-footer-text">{{
              'chatMessaging.uploadFile' | cxTranslate
            }}</span>
          </ng-template>
        </cx-file-upload>

        <p class="cx-message-footer-label">
          {{
            'chatMessaging.charactersLeft'
              | cxTranslate: { count: inputCharacterLeft }
          }}
        </p>
      </div>
      <cx-form-errors
        [control]="form.get('file')"
        prefix="formErrors.file"
      ></cx-form-errors>
    </div>

    <div class="col-xs-6 col-md-3 col-lg-2">
      <button class="btn btn-block btn-primary" (click)="onSend()">
        {{ 'chatMessaging.send' | cxTranslate }}
      </button>
    </div>
  </div>
</ng-container>
